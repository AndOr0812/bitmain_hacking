diff '--color=auto' cgminer-4.9.0/aclocal.m4 cgminer-4.10.0/aclocal.m4
1c1
< # generated automatically by aclocal 1.14.1 -*- Autoconf -*-
---
> # generated automatically by aclocal 1.15 -*- Autoconf -*-
3c3
< # Copyright (C) 1996-2013 Free Software Foundation, Inc.
---
> # Copyright (C) 1996-2014 Free Software Foundation, Inc.
23,48c23,79
< # pkg.m4 - Macros to locate and utilise pkg-config.            -*- Autoconf -*-
< # serial 1 (pkg-config-0.24)
< # 
< # Copyright © 2004 Scott James Remnant <scott@netsplit.com>.
< #
< # This program is free software; you can redistribute it and/or modify
< # it under the terms of the GNU General Public License as published by
< # the Free Software Foundation; either version 2 of the License, or
< # (at your option) any later version.
< #
< # This program is distributed in the hope that it will be useful, but
< # WITHOUT ANY WARRANTY; without even the implied warranty of
< # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
< # General Public License for more details.
< #
< # You should have received a copy of the GNU General Public License
< # along with this program; if not, write to the Free Software
< # Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
< #
< # As a special exception to the GNU General Public License, if you
< # distribute this file as part of a program that contains a
< # configuration script generated by Autoconf, you may include it under
< # the same distribution terms that you use for the rest of that program.
< 
< # PKG_PROG_PKG_CONFIG([MIN-VERSION])
< # ----------------------------------
---
> dnl pkg.m4 - Macros to locate and utilise pkg-config.   -*- Autoconf -*-
> dnl serial 11 (pkg-config-0.29.1)
> dnl
> dnl Copyright © 2004 Scott James Remnant <scott@netsplit.com>.
> dnl Copyright © 2012-2015 Dan Nicholson <dbn.lists@gmail.com>
> dnl
> dnl This program is free software; you can redistribute it and/or modify
> dnl it under the terms of the GNU General Public License as published by
> dnl the Free Software Foundation; either version 2 of the License, or
> dnl (at your option) any later version.
> dnl
> dnl This program is distributed in the hope that it will be useful, but
> dnl WITHOUT ANY WARRANTY; without even the implied warranty of
> dnl MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
> dnl General Public License for more details.
> dnl
> dnl You should have received a copy of the GNU General Public License
> dnl along with this program; if not, write to the Free Software
> dnl Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
> dnl 02111-1307, USA.
> dnl
> dnl As a special exception to the GNU General Public License, if you
> dnl distribute this file as part of a program that contains a
> dnl configuration script generated by Autoconf, you may include it under
> dnl the same distribution terms that you use for the rest of that
> dnl program.
> 
> dnl PKG_PREREQ(MIN-VERSION)
> dnl -----------------------
> dnl Since: 0.29
> dnl
> dnl Verify that the version of the pkg-config macros are at least
> dnl MIN-VERSION. Unlike PKG_PROG_PKG_CONFIG, which checks the user's
> dnl installed version of pkg-config, this checks the developer's version
> dnl of pkg.m4 when generating configure.
> dnl
> dnl To ensure that this macro is defined, also add:
> dnl m4_ifndef([PKG_PREREQ],
> dnl     [m4_fatal([must install pkg-config 0.29 or later before running autoconf/autogen])])
> dnl
> dnl See the "Since" comment for each macro you use to see what version
> dnl of the macros you require.
> m4_defun([PKG_PREREQ],
> [m4_define([PKG_MACROS_VERSION], [0.29.1])
> m4_if(m4_version_compare(PKG_MACROS_VERSION, [$1]), -1,
>     [m4_fatal([pkg.m4 version $1 or higher is required but ]PKG_MACROS_VERSION[ found])])
> ])dnl PKG_PREREQ
> 
> dnl PKG_PROG_PKG_CONFIG([MIN-VERSION])
> dnl ----------------------------------
> dnl Since: 0.16
> dnl
> dnl Search for the pkg-config tool and set the PKG_CONFIG variable to
> dnl first found in the path. Checks that the version of pkg-config found
> dnl is at least MIN-VERSION. If MIN-VERSION is not specified, 0.9.0 is
> dnl used since that's the first version where most current features of
> dnl pkg-config existed.
70c101
< ])# PKG_PROG_PKG_CONFIG
---
> ])dnl PKG_PROG_PKG_CONFIG
72,81c103,113
< # PKG_CHECK_EXISTS(MODULES, [ACTION-IF-FOUND], [ACTION-IF-NOT-FOUND])
< #
< # Check to see whether a particular set of modules exists.  Similar
< # to PKG_CHECK_MODULES(), but does not set variables or print errors.
< #
< # Please remember that m4 expands AC_REQUIRE([PKG_PROG_PKG_CONFIG])
< # only at the first occurence in configure.ac, so if the first place
< # it's called might be skipped (such as if it is within an "if", you
< # have to call PKG_CHECK_EXISTS manually
< # --------------------------------------------------------------
---
> dnl PKG_CHECK_EXISTS(MODULES, [ACTION-IF-FOUND], [ACTION-IF-NOT-FOUND])
> dnl -------------------------------------------------------------------
> dnl Since: 0.18
> dnl
> dnl Check to see whether a particular set of modules exists. Similar to
> dnl PKG_CHECK_MODULES(), but does not set variables or print errors.
> dnl
> dnl Please remember that m4 expands AC_REQUIRE([PKG_PROG_PKG_CONFIG])
> dnl only at the first occurence in configure.ac, so if the first place
> dnl it's called might be skipped (such as if it is within an "if", you
> dnl have to call PKG_CHECK_EXISTS manually
91,92c123,126
< # _PKG_CONFIG([VARIABLE], [COMMAND], [MODULES])
< # ---------------------------------------------
---
> dnl _PKG_CONFIG([VARIABLE], [COMMAND], [MODULES])
> dnl ---------------------------------------------
> dnl Internal wrapper calling pkg-config via PKG_CONFIG and setting
> dnl pkg_failed based on the result.
104c138
< ])# _PKG_CONFIG
---
> ])dnl _PKG_CONFIG
106,107c140,142
< # _PKG_SHORT_ERRORS_SUPPORTED
< # -----------------------------
---
> dnl _PKG_SHORT_ERRORS_SUPPORTED
> dnl ---------------------------
> dnl Internal check to see if pkg-config supports short errors.
115c150
< ])# _PKG_SHORT_ERRORS_SUPPORTED
---
> ])dnl _PKG_SHORT_ERRORS_SUPPORTED
118,127c153,160
< # PKG_CHECK_MODULES(VARIABLE-PREFIX, MODULES, [ACTION-IF-FOUND],
< # [ACTION-IF-NOT-FOUND])
< #
< #
< # Note that if there is a possibility the first call to
< # PKG_CHECK_MODULES might not happen, you should be sure to include an
< # explicit call to PKG_PROG_PKG_CONFIG in your configure.ac
< #
< #
< # --------------------------------------------------------------
---
> dnl PKG_CHECK_MODULES(VARIABLE-PREFIX, MODULES, [ACTION-IF-FOUND],
> dnl   [ACTION-IF-NOT-FOUND])
> dnl --------------------------------------------------------------
> dnl Since: 0.4.0
> dnl
> dnl Note that if there is a possibility the first call to
> dnl PKG_CHECK_MODULES might not happen, you should be sure to include an
> dnl explicit call to PKG_PROG_PKG_CONFIG in your configure.ac
181c214,294
< ])# PKG_CHECK_MODULES
---
> ])dnl PKG_CHECK_MODULES
> 
> 
> dnl PKG_CHECK_MODULES_STATIC(VARIABLE-PREFIX, MODULES, [ACTION-IF-FOUND],
> dnl   [ACTION-IF-NOT-FOUND])
> dnl ---------------------------------------------------------------------
> dnl Since: 0.29
> dnl
> dnl Checks for existence of MODULES and gathers its build flags with
> dnl static libraries enabled. Sets VARIABLE-PREFIX_CFLAGS from --cflags
> dnl and VARIABLE-PREFIX_LIBS from --libs.
> dnl
> dnl Note that if there is a possibility the first call to
> dnl PKG_CHECK_MODULES_STATIC might not happen, you should be sure to
> dnl include an explicit call to PKG_PROG_PKG_CONFIG in your
> dnl configure.ac.
> AC_DEFUN([PKG_CHECK_MODULES_STATIC],
> [AC_REQUIRE([PKG_PROG_PKG_CONFIG])dnl
> _save_PKG_CONFIG=$PKG_CONFIG
> PKG_CONFIG="$PKG_CONFIG --static"
> PKG_CHECK_MODULES($@)
> PKG_CONFIG=$_save_PKG_CONFIG[]dnl
> ])dnl PKG_CHECK_MODULES_STATIC
> 
> 
> dnl PKG_INSTALLDIR([DIRECTORY])
> dnl -------------------------
> dnl Since: 0.27
> dnl
> dnl Substitutes the variable pkgconfigdir as the location where a module
> dnl should install pkg-config .pc files. By default the directory is
> dnl $libdir/pkgconfig, but the default can be changed by passing
> dnl DIRECTORY. The user can override through the --with-pkgconfigdir
> dnl parameter.
> AC_DEFUN([PKG_INSTALLDIR],
> [m4_pushdef([pkg_default], [m4_default([$1], ['${libdir}/pkgconfig'])])
> m4_pushdef([pkg_description],
>     [pkg-config installation directory @<:@]pkg_default[@:>@])
> AC_ARG_WITH([pkgconfigdir],
>     [AS_HELP_STRING([--with-pkgconfigdir], pkg_description)],,
>     [with_pkgconfigdir=]pkg_default)
> AC_SUBST([pkgconfigdir], [$with_pkgconfigdir])
> m4_popdef([pkg_default])
> m4_popdef([pkg_description])
> ])dnl PKG_INSTALLDIR
> 
> 
> dnl PKG_NOARCH_INSTALLDIR([DIRECTORY])
> dnl --------------------------------
> dnl Since: 0.27
> dnl
> dnl Substitutes the variable noarch_pkgconfigdir as the location where a
> dnl module should install arch-independent pkg-config .pc files. By
> dnl default the directory is $datadir/pkgconfig, but the default can be
> dnl changed by passing DIRECTORY. The user can override through the
> dnl --with-noarch-pkgconfigdir parameter.
> AC_DEFUN([PKG_NOARCH_INSTALLDIR],
> [m4_pushdef([pkg_default], [m4_default([$1], ['${datadir}/pkgconfig'])])
> m4_pushdef([pkg_description],
>     [pkg-config arch-independent installation directory @<:@]pkg_default[@:>@])
> AC_ARG_WITH([noarch-pkgconfigdir],
>     [AS_HELP_STRING([--with-noarch-pkgconfigdir], pkg_description)],,
>     [with_noarch_pkgconfigdir=]pkg_default)
> AC_SUBST([noarch_pkgconfigdir], [$with_noarch_pkgconfigdir])
> m4_popdef([pkg_default])
> m4_popdef([pkg_description])
> ])dnl PKG_NOARCH_INSTALLDIR
> 
> 
> dnl PKG_CHECK_VAR(VARIABLE, MODULE, CONFIG-VARIABLE,
> dnl [ACTION-IF-FOUND], [ACTION-IF-NOT-FOUND])
> dnl -------------------------------------------
> dnl Since: 0.28
> dnl
> dnl Retrieves the value of the pkg-config variable for the given module.
> AC_DEFUN([PKG_CHECK_VAR],
> [AC_REQUIRE([PKG_PROG_PKG_CONFIG])dnl
> AC_ARG_VAR([$1], [value of $3 for $2, overriding pkg-config])dnl
> 
> _PKG_CONFIG([$1], [variable="][$3]["], [$2])
> AS_VAR_COPY([$1], [pkg_cv_][$1])
183c296,299
< # Copyright (C) 2002-2013 Free Software Foundation, Inc.
---
> AS_VAR_IF([$1], [""], [$5], [$4])dnl
> ])dnl PKG_CHECK_VAR
> 
> # Copyright (C) 2002-2014 Free Software Foundation, Inc.
195c311
< [am__api_version='1.14'
---
> [am__api_version='1.15'
198c314
< m4_if([$1], [1.14.1], [],
---
> m4_if([$1], [1.15], [],
214c330
< [AM_AUTOMAKE_VERSION([1.14.1])dnl
---
> [AM_AUTOMAKE_VERSION([1.15])dnl
221c337
< # Copyright (C) 2001-2013 Free Software Foundation, Inc.
---
> # Copyright (C) 2001-2014 Free Software Foundation, Inc.
266,269c382,384
< [dnl Rely on autoconf to set up CDPATH properly.
< AC_PREREQ([2.50])dnl
< # expand $ac_aux_dir to an absolute path
< am_aux_dir=`cd $ac_aux_dir && pwd`
---
> [AC_REQUIRE([AC_CONFIG_AUX_DIR_DEFAULT])dnl
> # Expand $ac_aux_dir to an absolute path.
> am_aux_dir=`cd "$ac_aux_dir" && pwd`
274c389
< # Copyright (C) 1997-2013 Free Software Foundation, Inc.
---
> # Copyright (C) 1997-2014 Free Software Foundation, Inc.
305c420
< # Copyright (C) 1999-2013 Free Software Foundation, Inc.
---
> # Copyright (C) 1999-2014 Free Software Foundation, Inc.
496c611
< # Copyright (C) 1999-2013 Free Software Foundation, Inc.
---
> # Copyright (C) 1999-2014 Free Software Foundation, Inc.
572c687
< # Copyright (C) 1996-2013 Free Software Foundation, Inc.
---
> # Copyright (C) 1996-2014 Free Software Foundation, Inc.
662,663c777,778
< # We need awk for the "check" target.  The system "awk" is bad on
< # some platforms.
---
> # We need awk for the "check" target (and possibly the TAP driver).  The
> # system "awk" is bad on some platforms.
736c851,855
< fi])
---
> fi
> dnl The trailing newline in this macro's definition is deliberate, for
> dnl backward compatibility and to allow trailing 'dnl'-style comments
> dnl after the AM_INIT_AUTOMAKE invocation. See automake bug#16841.
> ])
765c884
< # Copyright (C) 2001-2013 Free Software Foundation, Inc.
---
> # Copyright (C) 2001-2014 Free Software Foundation, Inc.
776c895
< if test x"${install_sh}" != xset; then
---
> if test x"${install_sh+set}" != xset; then
786c905
< # Copyright (C) 2003-2013 Free Software Foundation, Inc.
---
> # Copyright (C) 2003-2014 Free Software Foundation, Inc.
808c927
< # Copyright (C) 1996-2013 Free Software Foundation, Inc.
---
> # Copyright (C) 1996-2014 Free Software Foundation, Inc.
843c962
< # Copyright (C) 2001-2013 Free Software Foundation, Inc.
---
> # Copyright (C) 2001-2014 Free Software Foundation, Inc.
893c1012
< # Copyright (C) 1997-2013 Free Software Foundation, Inc.
---
> # Copyright (C) 1997-2014 Free Software Foundation, Inc.
932c1051
< # Copyright (C) 2001-2013 Free Software Foundation, Inc.
---
> # Copyright (C) 2001-2014 Free Software Foundation, Inc.
961c1080
< # Copyright (C) 1999-2013 Free Software Foundation, Inc.
---
> # Copyright (C) 1999-2014 Free Software Foundation, Inc.
1008c1127
< # Copyright (C) 2001-2013 Free Software Foundation, Inc.
---
> # Copyright (C) 2001-2014 Free Software Foundation, Inc.
1027c1146
< # Copyright (C) 1996-2013 Free Software Foundation, Inc.
---
> # Copyright (C) 1996-2014 Free Software Foundation, Inc.
1108c1227
< # Copyright (C) 2009-2013 Free Software Foundation, Inc.
---
> # Copyright (C) 2009-2014 Free Software Foundation, Inc.
1168c1287
< # Copyright (C) 2001-2013 Free Software Foundation, Inc.
---
> # Copyright (C) 2001-2014 Free Software Foundation, Inc.
1196c1315
< # Copyright (C) 2006-2013 Free Software Foundation, Inc.
---
> # Copyright (C) 2006-2014 Free Software Foundation, Inc.
1215c1334
< # Copyright (C) 2004-2013 Free Software Foundation, Inc.
---
> # Copyright (C) 2004-2014 Free Software Foundation, Inc.
1351d1469
< m4_include([m4/libtool.m4])
1353,1356d1470
< m4_include([m4/ltoptions.m4])
< m4_include([m4/ltsugar.m4])
< m4_include([m4/ltversion.m4])
< m4_include([m4/lt~obsolete.m4])
diff '--color=auto' cgminer-4.9.0/api.c cgminer-4.10.0/api.c
2,3c2,3
<  * Copyright 2011-2014 Andrew Smith
<  * Copyright 2011-2014 Con Kolivas
---
>  * Copyright 2011-2015 Andrew Smith
>  * Copyright 2011-2015 Con Kolivas
33,34c33,35
< 	defined(USE_ANT_S1) || defined(USE_ANT_S2) || defined(USE_SP10) || defined(USE_SP30) || \
< 	defined(USE_ICARUS) || defined(USE_HASHRATIO)
---
> 	defined(USE_ANT_S1) || defined(USE_ANT_S2) || defined(USE_ANT_S3) || defined(USE_SP10) || \
> 	defined(USE_SP30) || defined(USE_ICARUS) || defined(USE_HASHRATIO) || defined(USE_AVALON_MINER) || \
> 	defined(USE_AVALON7)
124c125
< #if defined(__APPLE__)
---
> #if defined(__APPLE__) || defined(__FreeBSD__)
141c142
< static const char *APIVERSION = "3.5";
---
> static const char *APIVERSION = "3.7";
168a170,172
> #ifdef USE_ANT_S3
> 			"AS3 "
> #endif
442a447,448
> #define MSG_DEPRECATED 126
> 
562a569
>  { SEVERITY_ERR,   MSG_DEPRECATED, PARAM_STR,	"Deprecated config option '%s'" },
698,699c705,706
< 	io_data = malloc(sizeof(*io_data));
< 	io_data->ptr = malloc(initial);
---
> 	io_data = cgmalloc(sizeof(*io_data));
> 	io_data->ptr = cgmalloc(initial);
704c711
< 	io_list = malloc(sizeof(*io_list));
---
> 	io_list = cgmalloc(sizeof(*io_list));
737c744
< 		io_data->ptr = realloc(io_data->ptr, new);
---
> 		io_data->ptr = cgrealloc(io_data->ptr, new);
808,812c815
< 	buf = malloc(strlen(str) + count + 1);
< 	if (unlikely(!buf)) {
< 		quithere(1, "Failed to malloc escape buf %d",
< 			    (int)(strlen(str) + count + 1));
< 	}
---
> 	buf = cgmalloc(strlen(str) + count + 1);
874c877
< 	api_data = (struct api_data *)malloc(sizeof(struct api_data));
---
> 	api_data = cgmalloc(sizeof(struct api_data));
906c909
< 				api_data->data = (void *)malloc(strlen((char *)data) + 1);
---
> 				api_data->data = cgmalloc(strlen((char *)data) + 1);
911c914
< 				api_data->data = malloc(4);
---
> 				api_data->data = cgmalloc(4);
916c919
< 				api_data->data = malloc(4);
---
> 				api_data->data = cgmalloc(4);
921c924
< 				api_data->data = malloc(4);
---
> 				api_data->data = cgmalloc(4);
925c928
< 				api_data->data = (void *)malloc(sizeof(int));
---
> 				api_data->data = cgmalloc(sizeof(int));
929c932
< 				api_data->data = (void *)malloc(sizeof(unsigned int));
---
> 				api_data->data = cgmalloc(sizeof(unsigned int));
933c936
< 				api_data->data = (void *)malloc(sizeof(uint32_t));
---
> 				api_data->data = cgmalloc(sizeof(uint32_t));
937c940
< 				api_data->data = (void *)malloc(sizeof(uint32_t));
---
> 				api_data->data = cgmalloc(sizeof(uint32_t));
941c944
< 				api_data->data = (void *)malloc(sizeof(uint64_t));
---
> 				api_data->data = cgmalloc(sizeof(uint64_t));
945c948
< 				api_data->data = (void *)malloc(sizeof(int64_t));
---
> 				api_data->data = cgmalloc(sizeof(int64_t));
957c960
< 				api_data->data = (void *)malloc(sizeof(double));
---
> 				api_data->data = cgmalloc(sizeof(double));
961c964
< 				api_data->data = (void *)malloc(sizeof(bool));
---
> 				api_data->data = cgmalloc(sizeof(bool));
965c968
< 				api_data->data = (void *)malloc(sizeof(struct timeval));
---
> 				api_data->data = cgmalloc(sizeof(struct timeval));
969c972
< 				api_data->data = (void *)malloc(sizeof(time_t));
---
> 				api_data->data = cgmalloc(sizeof(time_t));
975c978
< 				api_data->data = (void *)malloc(sizeof(float));
---
> 				api_data->data = cgmalloc(sizeof(float));
1136,1140c1139
< 		DATASB(item)->buf = buf = realloc(DATASB(item)->buf, DATASB(item)->tot + ext);
< 		if (!buf) {
< 			quithere(1, "OOM buf siz=%d tot=%d ext=%d",
< 				    (int)siz, (int)(DATASB(item)->tot), (int)ext);
< 		}
---
> 		DATASB(item)->buf = buf = cgrealloc(DATASB(item)->buf, DATASB(item)->tot + ext);
1607,1612c1606,1607
< 	list = calloc(1, sizeof(*list));
< 	if (!list)
< 		quithere(1, "OOM list");
< 	list->info = calloc(1, sizeof(*(list->info)));
< 	if (!list->info)
< 		quithere(1, "OOM info");
---
> 	list = cgcalloc(1, sizeof(*list));
> 	list->info = cgcalloc(1, sizeof(*(list->info)));
1647,1652c1642,1643
< 	stat = calloc(1, sizeof(*stat));
< 	if (!stat)
< 		quithere(1, "OOM stat");
< 	line = calloc(1, sizeof(*line));
< 	if (!line)
< 		quithere(1, "OOM line");
---
> 	stat = cgcalloc(1, sizeof(*stat));
> 	line = cgcalloc(1, sizeof(*line));
1972,1975d1962
< 	root = api_add_bool(root, "Failover-Only", &opt_fail_only, false);
< 	root = api_add_int(root, "ScanTime", &opt_scantime, false);
< 	root = api_add_int(root, "Queue", &opt_queue, false);
< 	root = api_add_int(root, "Expiry", &opt_expiry, false);
2502a2490
> 	double sdiff0 = 0.0;
2570a2559
> 		root = api_add_diff(root, "Work Difficulty", &(pool->cgminer_pool_stats.last_diff), false);
2573c2562
< 		if (pool->stratum_active)
---
> 		if (pool->stratum_active) {
2575c2564,2565
< 		else
---
> 			root = api_add_diff(root, "Stratum Difficulty", &(pool->sdiff), false);
> 		} else {
2576a2567,2568
> 			root = api_add_diff(root, "Stratum Difficulty", &(sdiff0), false);
> 		}
2584a2577,2580
> 		root = api_add_uint64(root, "Bad Work", &(pool->bad_work), true);
> 		root = api_add_uint32(root, "Current Block Height", &(pool->current_height), true);
> 		uint32_t nversion = (uint32_t)strtoul(pool->bbversion, NULL, 16);
> 		root = api_add_uint32(root, "Current Block Version", &nversion, true);
2728,2730c2724
< 	ptr = buf = malloc(strlen(param)+1);
< 	if (unlikely(!buf))
< 		quit(1, "Failed to malloc pooldetails buf");
---
> 	ptr = buf = cgmalloc(strlen(param)+1);
3397,3413c3391
< 	if (param == NULL || *param == '\0') {
< 		message(io_data, MSG_MISBOOL, 0, NULL, isjson);
< 		return;
< 	}
< 
< 	*param = tolower(*param);
< 
< 	if (*param != 't' && *param != 'f') {
< 		message(io_data, MSG_INVBOOL, 0, NULL, isjson);
< 		return;
< 	}
< 
< 	bool tf = (*param == 't');
< 
< 	opt_fail_only = tf;
< 
< 	message(io_data, MSG_FOO, tf, NULL, isjson);
---
> 	message(io_data, MSG_DEPRECATED, 0, param, isjson);
3518,3524c3496,3497
< 	char *comma;
< 	int value;
< 
< 	if (param == NULL || *param == '\0') {
< 		message(io_data, MSG_CONPAR, 0, NULL, isjson);
< 		return;
< 	}
---
> 	if (!strcasecmp(param, "queue") || ! strcasecmp(param, "scantime") || !strcasecmp(param, "expiry"))
> 		message(io_data, MSG_DEPRECATED, 0, param, isjson);
3526,3550c3499
< 	comma = strchr(param, ',');
< 	if (!comma) {
< 		message(io_data, MSG_CONVAL, 0, param, isjson);
< 		return;
< 	}
< 
< 	*(comma++) = '\0';
< 	value = atoi(comma);
< 	if (value < 0 || value > 9999) {
< 		message(io_data, MSG_INVNUM, value, param, isjson);
< 		return;
< 	}
< 
< 	if (strcasecmp(param, "queue") == 0)
< 		opt_queue = value;
< 	else if (strcasecmp(param, "scantime") == 0)
< 		opt_scantime = value;
< 	else if (strcasecmp(param, "expiry") == 0)
< 		opt_expiry = value;
< 	else {
< 		message(io_data, MSG_UNKCON, 0, param, isjson);
< 		return;
< 	}
< 
< 	message(io_data, MSG_SETCONFIG, value, param, isjson);
---
> 	message(io_data, MSG_UNKCON, 0, param, isjson);
4308,4310c4257
< 	buf = malloc(strlen(api_groups) + 1);
< 	if (unlikely(!buf))
< 		quit(1, "Failed to malloc ipgroups buf");
---
> 	buf = cgmalloc(strlen(api_groups) + 1);
4398,4400c4345
< 		ptr = apigroups[GROUPOFFSET(group)].commands = malloc(strlen(commands) + 1);
< 		if (unlikely(!ptr))
< 			quit(1, "Failed to malloc group commands buf");
---
> 		ptr = apigroups[GROUPOFFSET(group)].commands = cgmalloc(strlen(commands) + 1);
4418,4420c4363
< 	ptr = apigroups[GROUPOFFSET(NOPRIVGROUP)].commands = malloc(strlen(commands) + 1);
< 	if (unlikely(!ptr))
< 		quit(1, "Failed to malloc noprivgroup commands buf");
---
> 	ptr = apigroups[GROUPOFFSET(NOPRIVGROUP)].commands = cgmalloc(strlen(commands) + 1);
4441c4384
< 	char *buf, *ptr, *comma, *slash, *end;
---
> 	char *buf, *ptr, *comma, *slash, *end, *dot;
4442a4386
> 	char tmp[64], original[64];
4445d4388
< 	char tmp[30];
4447,4449c4390
< 	buf = malloc(strlen(opt_api_allow) + 1);
< 	if (unlikely(!buf))
< 		quit(1, "Failed to malloc ipaccess buf");
---
> 	buf = cgmalloc(strlen(opt_api_allow) + 1);
4460,4462c4401
< 	ipaccess = calloc(ipcount, sizeof(struct IPACCESS));
< 	if (unlikely(!ipaccess))
< 		quit(1, "Failed to calloc ipaccess");
---
> 	ipaccess = cgcalloc(ipcount, sizeof(struct IPACCESS));
4478a4418,4419
> 		strncpy(original, ptr, sizeof(original));
> 		original[sizeof(original)-1] = '\0';
4514c4455,4458
< 				if (mask < 1 || (mask += ipv6 ? 0 : 96) > 128 )
---
> 				if (mask < 1 || (mask += ipv6 ? 0 : 96) > 128) {
> 					applog(LOG_ERR, "API: ignored address with "
> 							"invalid mask (%d) '%s'",
> 							mask, original);
4515a4460
> 				}
4534c4479,4482
< 				if (INET_PTON(AF_INET6, ptr, &(ipaccess[ips].ip)) != 1)
---
> 				if (INET_PTON(AF_INET6, ptr, &(ipaccess[ips].ip)) != 1) {
> 					applog(LOG_ERR, "API: ignored invalid "
> 							"IPv6 address '%s'",
> 							original);
4535a4484
> 				}
4538,4540c4487,4517
< 				// v4 mapped v6 address, such as "::ffff:255.255.255.255"
< 				sprintf(tmp, "::ffff:%s", ptr);
< 				if (INET_PTON(AF_INET6, tmp, &(ipaccess[ips].ip)) != 1)
---
> 				/* v4 mapped v6 address,
> 				 * such as "::ffff:255.255.255.255"
> 				 * but pad on extra missing .0 as needed */
> 				dot = strchr(ptr, '.');
> 				if (!dot) {
> 					snprintf(tmp, sizeof(tmp),
> 						 "::ffff:%s.0.0.0",
> 						 ptr);
> 				} else {
> 					dot = strchr(dot+1, '.');
> 					if (!dot) {
> 						snprintf(tmp, sizeof(tmp),
> 							 "::ffff:%s.0.0",
> 							 ptr);
> 					} else {
> 						dot = strchr(dot+1, '.');
> 						if (!dot) {
> 							snprintf(tmp, sizeof(tmp),
> 								 "::ffff:%s.0",
> 								 ptr);
> 						} else {
> 							snprintf(tmp, sizeof(tmp),
> 								 "::ffff:%s",
> 								 ptr);
> 						}
> 					}
> 				}
> 				if (INET_PTON(AF_INET6, tmp, &(ipaccess[ips].ip)) != 1) {
> 					applog(LOG_ERR, "API: ignored invalid "
> 							"IPv4 address '%s' (as %s)",
> 							original, tmp);
4541a4519
> 				}
4591c4569
< 	*connectaddr = (char *)malloc(INET6_ADDRSTRLEN);
---
> 	*connectaddr = cgmalloc(INET6_ADDRSTRLEN);
4607c4585
< 			for (j = 0; j < 16; j++)
---
> 			for (j = 0; j < 16; j++) {
4612a4591
> 			}
4730,4732c4709
< 	expect_code = malloc(expect_code_len+1);
< 	if (!expect_code)
< 		quit(1, "Failed to malloc mcast expect_code");
---
> 	expect_code = cgmalloc(expect_code_len + 1);
4836,4838c4813
< 	thr = calloc(1, sizeof(*thr));
< 	if (!thr)
< 		quit(1, "Failed to calloc mcast thr");
---
> 	thr = cgcalloc(1, sizeof(*thr));
4865c4840
< 	json_t *json_config = NULL;
---
> 	json_t *json_config;
4868c4843
< 	bool did, isjoin = false, firstjoin;
---
> 	bool did, isjoin, firstjoin;
4871d4845
< 
4874c4848
< 	apisock = malloc(sizeof(*apisock));
---
> 	apisock = cgmalloc(sizeof(*apisock));
4875a4850,4851
> 	json_config = NULL;
> 	isjoin = false;
5073,5075c5049
< 						cmdsbuf = malloc(strlen(cmd) + 3);
< 						if (!cmdsbuf)
< 							quithere(1, "OOM cmdsbuf");
---
> 						cmdsbuf = cgmalloc(strlen(cmd) + 3);
diff '--color=auto' cgminer-4.9.0/api-example.c cgminer-4.10.0/api-example.c
28c28
< #if defined(unix)
---
> #if defined(unix) || defined(__APPLE__)
diff '--color=auto' cgminer-4.9.0/API-README cgminer-4.10.0/API-README
160,163d159
<                               Failover-Only=true/false, <- failover-only setting
<                               ScanTime=N, <- --scan-time setting
<                               Queue=N, <- --queue setting
<                               Expiry=N| <- --expiry setting
320,321c316,317
<                none           There is no reply section just the STATUS section
<                               stating what failover-only was set to
---
>                none           This command has been deprecated, only returning a
>                               deprecated message.
351,353c347,348
<                               The valid values for name are currently:
<                               queue, scantime, expiry
<                               N is an integer in the range 0 to 9999
---
>                               No values are supported any more and only a
>                               deprecated message will be returned.
524a520,536
> API V3.7 (cgminer v4.9.3?)
> 
> Modified API commands:
>  'pools' - add 'Work Difficulty'
> 
> ---------
> 
> API V3.6 (cgminer v4.9.2)
> 
> Modified API commands:
>  'pools' - add 'Bad Work'
>  'setconfig' - expire, scantime and queue have all been deprecated and will
>  only return a deprecated message.
>  'failover-only' - deprecated, a deprecated message will be returned.
> 
> ---------
> 
527c539
< - Made quit and restart return valid JSON as a STATUS mirroring the reqest.
---
> - Made quit and restart return valid JSON as a STATUS mirroring the request.
diff '--color=auto' cgminer-4.9.0/ASIC-README cgminer-4.10.0/ASIC-README
10c10,11
< - Avalon4
---
> - Avalon4/4.1/6
> - Avalon7
17a19
> - Compac bitshopperde and GekkoScience
51c53
< Avalon4 will come up as AV4.
---
> Avalon4/4.1 will come up as AV4, Please use the MM version to distinguish.
53c55,59
< Avalon4 devies need the --enable-avalon4 option when compiling cgminer.
---
> Avalon6 will come up as AV6.
> 
> Avalon4/4.1/6 devies need the --enable-avalon4 option when compiling cgminer.
> 
> Avalon7 will come up as AV7.
69c75,76
< compiling cgminer.
---
> compiling cgminer. This driver is apparently BROKEN and the original contributor
> has not submitted fixes.
107a115,121
> Compac devices
> 
> Compac devices need the --enable-icarus option when compiling cgminer.
> 
> bitshopperde come up as BSC and GekkoScience as GSC
> 
> 
245c259
< --au3-volt <arg>    Set AntminerU3 voltage in mv, range 725-850, 0 to not set (default: 750)
---
> --au3-volt <arg>    Set AntminerU3 voltage in mv, range 725-850, 0 to not set (default: 775)
266a281,314
> --avalon4-miningmode <arg> Set Avalon4 mining mode(0:custom, 1:eco, 2:normal, 3:turbo (default: 0)
> --avalon4-freezesafe Make Avalon4 running as a radiator when stratum server failed
> --avalon4-ntcb <arg> Set Avalon4 MM NTC B value (default: 3450)
> --avalon4-freq-min <arg> Set minimum frequency for Avalon4 (default: 100)
> --avalon4-freq-max <arg> Set maximum frequency for Avalon4 (default: 1000)
> --avalon4-noncecheck-off Disable A3218 inside nonce check function
> --avalon4-smart-speed <arg> Set smart speed, range 0-3. 0 means Disable (default: 2)
> --avalon4-speed-bingo <arg> Set A3218 speed bingo for smart speed mode 1 (default: 255)
> --avalon4-speed-error <arg> Set A3218 speed error for smart speed mode 1 (default: 3)
> --avalon4-least-pll <arg> Set least pll check threshold for smart speed mode 2 (default: 768)
> --avalon4-most-pll <arg> Set most pll check threshold for smart speed mode 2 (default: 256)
> --avalon7-voltage   Set Avalon7 default core voltage, in millivolts, step: 78
> --avalon7-voltage-level Set Avalon7 default level of core voltage, range:[0, 15], step: 1
> --avalon7-voltage-offset Set Avalon7 default offset of core voltage, range:[-2, 1], step: 1
> --avalon7-freq      Set Avalon7 default frequency, range:[24, 1404], step: 12, example: 500
> --avalon7-freq-sel <arg> Set Avalon7 default frequency select, range:[0, 5], step: 1, example: 3 (default: 0)
> --avalon7-fan       Set Avalon7 target fan speed, range:[0, 100], step: 1, example: 0-100
> --avalon7-temp <arg> Set Avalon7 target temperature, range:[0, 100] (default: 99)
> --avalon7-polling-delay <arg> Set Avalon7 polling delay value (ms) (default: 20)
> --avalon7-aucspeed <arg> Set AUC3 IIC bus speed (default: 400000)
> --avalon7-aucxdelay <arg> Set AUC3 IIC xfer read delay, 4800 ~= 1ms (default: 19200)
> --avalon7-smart-speed <arg> Set Avalon7 smart speed, range 0-1. 0 means Disable (default: 1)
> --avalon7-th-pass <arg> Set A3212 th pass value (default: 162)
> --avalon7-th-fail <arg> Set A3212 th fail value (default: 10921)
> --avalon7-th-init <arg> Set A3212 th init value (default: 32767)
> --avalon7-th-ms <arg> Set A3212 th ms value (default: 1)
> --avalon7-th-timeout <arg> Set A3212 th timeout value (default: 0)
> --avalon7-iic-detect Enable Avalon7 detect through iic controller
> --avalon7-freqadj-time <arg> Set Avalon7 check interval when run in AVA7_FREQ_TEMPADJ_MODE (default: 60)
> --avalon7-delta-temp <arg> Set Avalon7 delta temperature when reset freq in AVA7_FREQ_TEMPADJ_MODE (default: 0)
> --avalon7-delta-freq <arg> Set Avalon7 delta freq when adjust freq in AVA7_FREQ_TEMPADJ_MODE (default: 100)
> --avalon7-freqadj-temp <arg> Set Avalon7 check temperature when run into AVA7_FREQ_TEMPADJ_MODE (default: 104)
> --avalon7-nonce-mask <arg> Set A3212 nonce mask, range 24-32. (default: 31)
> --no-avalon7-asic-debug Disable A3212 debug.
274,276c322,324
< --bitmain-cutoff    Set bitmain overheat cut off temperature
< --bitmain-fan       Set fanspeed percentage for bitmain, single value or range (default: 20-100)
< --bitmain-freq      Set frequency range for bitmain-auto, single value or range
---
> --bitmain-cutoff <arg> Set bitmain overheat cut off temperature
> --bitmain-fan <arg> Set fanspeed percentage for bitmain, single value or range (default: 20-100)
> --bitmain-freq <arg> Set bitmain freq options timeout:freq:regdata
278,279c326,332
< --bitmain-options   Set bitmain options baud:miners:asic:timeout:freq
< --bitmain-temp      Set bitmain target temperature
---
> --bitmain-options <arg> Set bitmain options baud:miners:asic:timeout:freq:regdata
> --bitmain-temp <arg> Set bitmain target temperature
> --bitmain-workdelay <arg> Set bitmain work delay (ms) 0-100
> --bitmain-voltage <arg> Set bitmain voltage - S2/S3 only
> --bitmain-dev <arg> Set bitmain device - S2 only
> --bitmainbeeper     Set bitmain beeper ringing
> --bitmaintempoverctrl Set bitmain stop runing when temprerature is over 80 degree Celsius
549c602,638
< 
---
> --avalon4-miningmode <arg> Set Avalon4 mining mode(0:custom, 1:eco, 2:normal, 3:turbo (default: 0)
> --avalon4-freezesafe Make Avalon4 running as a radiator when stratum server failed
> --avalon4-ntcb <arg> Set Avalon4 MM NTC B value (default: 3450)
> --avalon4-freq-min <arg> Set minimum frequency for Avalon4 (default: 100)
> --avalon4-freq-max <arg> Set maximum frequency for Avalon4 (default: 1000)
> --avalon4-noncecheck-off Disable A3218 inside nonce check function
> --avalon4-smart-speed <arg> Set smart speed, range 0-3. 0 means Disable (default: 2)
> --avalon4-speed-bingo <arg> Set A3218 speed bingo for smart speed mode 1 (default: 255)
> --avalon4-speed-error <arg> Set A3218 speed error for smart speed mode 1 (default: 3)
> --avalon4-least-pll <arg> Set least pll check threshold for smart speed mode 2 (default: 768)
> --avalon4-most-pll <arg> Set most pll check threshold for smart speed mode 2 (default: 256)
> 
> Avalon7 Devices
> 
> --avalon7-voltage   Set Avalon7 default core voltage, in millivolts, step: 78
> --avalon7-voltage-level Set Avalon7 default level of core voltage, range:[0, 15], step: 1
> --avalon7-voltage-offset Set Avalon7 default offset of core voltage, range:[-2, 1], step: 1
> --avalon7-freq      Set Avalon7 default frequency, range:[24, 1404], step: 12, example: 500
> --avalon7-freq-sel <arg> Set Avalon7 default frequency select, range:[0, 5], step: 1, example: 3 (default: 0)
> --avalon7-fan       Set Avalon7 target fan speed, range:[0, 100], step: 1, example: 0-100
> --avalon7-temp <arg> Set Avalon7 target temperature, range:[0, 100] (default: 99)
> --avalon7-polling-delay <arg> Set Avalon7 polling delay value (ms) (default: 20)
> --avalon7-aucspeed <arg> Set AUC3 IIC bus speed (default: 400000)
> --avalon7-aucxdelay <arg> Set AUC3 IIC xfer read delay, 4800 ~= 1ms (default: 19200)
> --avalon7-smart-speed <arg> Set Avalon7 smart speed, range 0-1. 0 means Disable (default: 1)
> --avalon7-th-pass <arg> Set A3212 th pass value (default: 162)
> --avalon7-th-fail <arg> Set A3212 th fail value (default: 10921)
> --avalon7-th-init <arg> Set A3212 th init value (default: 32767)
> --avalon7-th-ms <arg> Set A3212 th ms value (default: 1)
> --avalon7-th-timeout <arg> Set A3212 th timeout value (default: 0)
> --avalon7-iic-detect Enable Avalon7 detect through iic controller
> --avalon7-freqadj-time <arg> Set Avalon7 check interval when run in AVA7_FREQ_TEMPADJ_MODE (default: 60)
> --avalon7-delta-temp <arg> Set Avalon7 delta temperature when reset freq in AVA7_FREQ_TEMPADJ_MODE (default: 0)
> --avalon7-delta-freq <arg> Set Avalon7 delta freq when adjust freq in AVA7_FREQ_TEMPADJ_MODE (default: 100)
> --avalon7-freqadj-temp <arg> Set Avalon7 check temperature when run into AVA7_FREQ_TEMPADJ_MODE (default: 104)
> --avalon7-nonce-mask <arg> Set A3212 nonce mask, range 24-32. (default: 31)
> --no-avalon7-asic-debug Disable A3212 debug.
715c804
< this takes as option the clock speed alone or clock speed and voltage, 
---
> this takes as option the clock speed alone or clock speed and voltage,
Common subdirectories: cgminer-4.9.0/bitstreams and cgminer-4.10.0/bitstreams
Common subdirectories: cgminer-4.9.0/ccan and cgminer-4.10.0/ccan
diff '--color=auto' cgminer-4.9.0/cgminer.c cgminer-4.10.0/cgminer.c
2c2,3
<  * Copyright 2011-2014 Con Kolivas
---
>  * Copyright 2011-2015 Con Kolivas
>  * Copyright 2011-2015 Andrew Smith
35a37,40
> #ifdef USE_LIBSYSTEMD
> #include <systemd/sd-daemon.h>
> #endif
> 
41a47
> #include <winsock2.h>
78a85,92
> #ifdef USE_AVALON7
> #include "driver-avalon7.h"
> #endif
> 
> #ifdef USE_AVALON_MINER
> #include "driver-avalon-miner.h"
> #endif
> 
107c121
< #if defined(USE_ANT_S1) || defined(USE_ANT_S2)
---
> #if defined(USE_ANT_S1) || defined(USE_ANT_S2) || defined(USE_ANT_S3)
165,170c179,182
< int opt_queue = 1;
< static int max_queue = 1;
< int opt_scantime = -1;
< int opt_expiry = 120;
< static const bool opt_time = true;
< unsigned long long global_hashrate;
---
> static const int max_queue = 1;
> const int max_scantime = 60;
> const int max_expiry = 600;
> uint64_t global_hashrate;
172a185
> int opt_pool_fallback = 120;
198d210
< bool opt_fail_only;
224c236,237
< int opt_au3_volt = 750;
---
> float opt_compac_freq = 150;
> int opt_au3_volt = 775;
243a257,267
> #ifdef USE_AVALON7
> static char *opt_set_avalon7_fan;
> static char *opt_set_avalon7_voltage;
> static char *opt_set_avalon7_voltage_level;
> static char *opt_set_avalon7_voltage_offset;
> static char *opt_set_avalon7_freq;
> #endif
> #ifdef USE_AVALON_MINER
> static char *opt_set_avalonm_voltage;
> static char *opt_set_avalonm_freq;
> #endif
264c288,292
< static char *opt_set_bitmain_freq;
---
> char *opt_bitmain_freq;
> // Ignored
> static bool opt_bitmain_nobeeper;
> static bool opt_bitmain_notempoverctrl;
> static bool opt_bitmain_homemode;
266a295
> #ifndef USE_ANT_S3
268a298,299
> char *opt_bitmain_voltage = BITMAIN_VOLTAGE_DEF;
> #endif
298a330,331
> static bool polling_usb;
> static bool usb_reinit;
302a336
> bool opt_gen_stratum_work;
442c476
< struct sigaction termhandler, inthandler;
---
> struct sigaction termhandler, inthandler, abrthandler;
509a544
> 	int ms = (int)(tv->tv_usec / 1000);
511c546
< 	snprintf(f, fsiz, "[%d-%02d-%02d %02d:%02d:%02d]",
---
> 	snprintf(f, fsiz, "[%d-%02d-%02d %02d:%02d:%02d.%03d]",
517c552
< 		tm->tm_sec);
---
> 		tm->tm_sec, ms);
524a560
> 	int ms = (int)(tv->tv_usec / 1000);
526c562
< 	snprintf(f, fsiz, "[%02d:%02d:%02d]",
---
> 	snprintf(f, fsiz, "[%02d:%02d:%02d.%03d]",
529c565
< 		tm->tm_sec);
---
> 		tm->tm_sec, ms);
624,625d659
< static char *getwork_req = "{\"method\": \"getwork\", \"params\": [], \"id\":0}\n";
< 
628c662,694
< static char *gbt_solo_req = "{\"id\": 0, \"method\": \"getblocktemplate\"}\n";
---
> static char *gbt_solo_req = "{\"id\": 0, \"method\": \"getblocktemplate\", \"params\": [{\"rules\" : [\"segwit\"]}]}\n";
> 
> static const char *gbt_understood_rules[1] = { NULL };
> static const char *gbt_solo_understood_rules[2] = {"segwit", NULL};
> 
> static bool gbt_check_required_rule(const char* rule, const char** understood_rules)
> {
> 	const char *understood_rule;
> 
> 	if (!understood_rules || !rule)
> 		return false;
> 	while ((understood_rule = *understood_rules++)) {
> 		if (strcmp(understood_rule, rule) == 0)
> 			return true;
> 	}
> 	return false;
> }
> 
> static bool gbt_check_rules(json_t* rules_arr, const char** understood_rules)
> {
> 	int i, rule_count;
> 	const char *rule;
> 
> 	if (!rules_arr)
> 		return true;
> 	rule_count = json_array_size(rules_arr);
> 	for (i = 0; i < rule_count; i++) {
> 		rule = json_string_value(json_array_get(rules_arr, i));
> 		if (rule && *rule++ == '!' && !gbt_check_required_rule(rule, understood_rules))
> 			return false;
> 	}
> 	return true;
> }
671c737
< /* Return value is ignored if not called from add_pool_details */
---
> /* Return value is ignored if not called from input_pool */
676,678c742
< 	pool = calloc(sizeof(struct pool), 1);
< 	if (!pool)
< 		quit(1, "Failed to malloc pool in add_pool");
---
> 	pool = cgcalloc(sizeof(struct pool), 1);
680c744
< 	pools = realloc(pools, sizeof(struct pool *) * (total_pools + 2));
---
> 	pools = cgrealloc(pools, sizeof(struct pool *) * (total_pools + 2));
693c757
< 	pool->rpc_req = getwork_req;
---
> 	pool->rpc_req = gbt_req;
749a814,818
> static char *set_int_0_to_65535(const char *arg, int *i)
> {
> 	return set_int_range(arg, i, 0, 65535);
> }
> 
759a829,833
> static char *set_int_0_to_5(const char *arg, int *i)
> {
> 	return set_int_range(arg, i, 0, 5);
> }
> 
774a849,865
> static char *set_int_1_to_255(const char *arg, int *i)
> {
>         return set_int_range(arg, i, 1, 255);
> }
> 
> static char *set_int_0_to_7680(const char *arg, int *i)
> {
>         return set_int_range(arg, i, 0, 7680);
> }
> 
> #if defined(USE_AVALON4) || defined(USE_AVALON7)
> static char *set_int_1_to_60(const char *arg, int *i)
> {
>         return set_int_range(arg, i, 1, 60);
> }
> #endif
> 
785c876
< static char *set_int_22_to_55(const char *arg, int *i)
---
> static char *set_int_22_to_75(const char *arg, int *i)
787c878
< 	return set_int_range(arg, i, 22, 55);
---
> 	return set_int_range(arg, i, 22, 75);
790c881
< static char *set_int_42_to_65(const char *arg, int *i)
---
> static char *set_int_42_to_85(const char *arg, int *i)
792c883
< 	return set_int_range(arg, i, 42, 62);
---
> 	return set_int_range(arg, i, 42, 85);
799a891,895
> static char *set_int_24_to_32(const char *arg, int *i)
> {
> 	return set_int_range(arg, i, 24, 32);
> }
> 
847a944,945
> 	bool ret = false;
> 
849c947
< 		return false;
---
> 		goto out;
855c953
< 		return true;
---
> 		ret = true;
857,858c955,961
< 
< 	return false;
---
> out:
> 	if (!ret) {
> 		free(pool->sockaddr_url);
> 		free(pool->stratum_port);
> 		pool->stratum_port = pool->sockaddr_url = NULL;
> 	}
> 	return ret;
869c972
< static void setup_url(struct pool *pool, char *arg)
---
> static char *setup_url(struct pool *pool, char *arg)
874c977
< 		return;
---
> 		goto out;
879c982
< 		char *httpinput;
---
> 		char httpinput[256];
881,883d983
< 		httpinput = malloc(256);
< 		if (!httpinput)
< 			quit(1, "Failed to malloc httpinput");
887a988,989
> out:
> 	return pool->rpc_url;
1088a1191,1203
> static char *set_float_100_to_500(const char *arg, float *i)
> {
> 	char *err = opt_set_floatval(arg, i);
> 
> 	if (err)
> 		return err;
> 
> 	if (*i < 100 || *i > 500)
> 		return "Value out of range";
> 
> 	return NULL;
> }
> 
1213,1214c1328,1329
< 			opt_set_bool, &opt_avalon4_autov,
< 			"Automatic adjust voltage base on module DH"),
---
> 		     opt_set_bool, &opt_avalon4_autov,
> 		     "Automatic adjust voltage base on module DH"),
1225c1340
< 		     set_int_22_to_55, opt_show_intval, &opt_avalon4_temp_target,
---
> 		     set_int_22_to_75, opt_show_intval, &opt_avalon4_temp_target,
1228c1343
< 		     set_int_42_to_65, opt_show_intval, &opt_avalon4_overheat,
---
> 		     set_int_42_to_85, opt_show_intval, &opt_avalon4_overheat,
1241a1357,1492
> 	OPT_WITH_ARG("--avalon4-miningmode",
> 		     opt_set_intval, opt_show_intval, &opt_avalon4_miningmode,
> 		     "Set Avalon4 mining mode(0:custom, 1:eco, 2:normal, 3:turbo"),
> 	OPT_WITHOUT_ARG("--avalon4-freezesafe",
> 		     opt_set_bool, &opt_avalon4_freezesafe,
> 		     "Make Avalon4 running as a radiator when stratum server failed"),
> 	OPT_WITH_ARG("--avalon4-ntcb",
> 		     opt_set_intval, opt_show_intval, &opt_avalon4_ntcb,
> 		     "Set Avalon4 MM NTC B value"),
> 	OPT_WITH_ARG("--avalon4-freq-min",
> 		     opt_set_intval, opt_show_intval, &opt_avalon4_freq_min,
> 		     "Set minimum frequency for Avalon4"),
> 	OPT_WITH_ARG("--avalon4-freq-max",
> 		     opt_set_intval, opt_show_intval, &opt_avalon4_freq_max,
> 		     "Set maximum frequency for Avalon4"),
> 	OPT_WITHOUT_ARG("--avalon4-noncecheck-off",
> 		     opt_set_invbool, &opt_avalon4_noncecheck,
> 		     "Disable A3218 inside nonce check function"),
> 	OPT_WITH_ARG("--avalon4-smart-speed",
> 		     opt_set_intval, opt_show_intval, &opt_avalon4_smart_speed,
> 		     "Set smart speed, range 0-3. 0 means Disable"),
> 	OPT_WITH_ARG("--avalon4-speed-bingo",
> 		     set_int_1_to_255, opt_show_intval, &opt_avalon4_speed_bingo,
> 		     "Set A3218 speed bingo for smart speed mode 1"),
> 	OPT_WITH_ARG("--avalon4-speed-error",
> 		     set_int_1_to_255, opt_show_intval, &opt_avalon4_speed_error,
> 		     "Set A3218 speed error for smart speed mode 1"),
> 	OPT_WITH_ARG("--avalon4-least-pll",
> 		     set_int_0_to_7680, opt_show_intval, &opt_avalon4_least_pll_check,
> 		     "Set least pll check threshold for smart speed mode 2"),
> 	OPT_WITH_ARG("--avalon4-most-pll",
> 		     set_int_0_to_7680, opt_show_intval, &opt_avalon4_most_pll_check,
> 		     "Set most pll check threshold for smart speed mode 2"),
> 	OPT_WITHOUT_ARG("--avalon4-iic-detect",
> 		     opt_set_bool, &opt_avalon4_iic_detect,
> 		     "Enable miner detect through iic controller"),
> 	OPT_WITH_ARG("--avalon4-freqadj-time",
> 		     set_int_1_to_60, opt_show_intval, &opt_avalon4_freqadj_time,
> 		     "Set Avalon4 check interval when run in AVA4_FREQ_TEMPADJ_MODE"),
> 	OPT_WITH_ARG("--avalon4-delta-temp",
> 		     opt_set_intval, opt_show_intval, &opt_avalon4_delta_temp,
> 		     "Set Avalon4 delta temperature when reset freq in AVA4_FREQ_TEMPADJ_MODE"),
> 	OPT_WITH_ARG("--avalon4-delta-freq",
> 		     opt_set_intval, opt_show_intval, &opt_avalon4_delta_freq,
> 		     "Set Avalon4 delta freq when adjust freq in AVA4_FREQ_TEMPADJ_MODE"),
> 	OPT_WITH_ARG("--avalon4-freqadj-temp",
> 		     opt_set_intval, opt_show_intval, &opt_avalon4_freqadj_temp,
> 		     "Set Avalon4 check temperature when run into AVA4_FREQ_TEMPADJ_MODE"),
> #endif
> #ifdef USE_AVALON7
> 	OPT_WITH_CBARG("--avalon7-voltage",
> 		     set_avalon7_voltage, NULL, &opt_set_avalon7_voltage,
> 		     "Set Avalon7 default core voltage, in millivolts, step: 78"),
> 	OPT_WITH_CBARG("--avalon7-voltage-level",
> 		     set_avalon7_voltage_level, NULL, &opt_set_avalon7_voltage_level,
> 		     "Set Avalon7 default level of core voltage, range:[0, 15], step: 1"),
> 	OPT_WITH_CBARG("--avalon7-voltage-offset",
> 		     set_avalon7_voltage_offset, NULL, &opt_set_avalon7_voltage_offset,
> 		     "Set Avalon7 default offset of core voltage, range:[-2, 1], step: 1"),
> 	OPT_WITH_CBARG("--avalon7-freq",
> 		     set_avalon7_freq, NULL, &opt_set_avalon7_freq,
> 		     "Set Avalon7 default frequency, range:[24, 1404], step: 12, example: 500"),
> 	OPT_WITH_ARG("--avalon7-freq-sel",
> 		     set_int_0_to_5, opt_show_intval, &opt_avalon7_freq_sel,
> 		     "Set Avalon7 default frequency select, range:[0, 5], step: 1, example: 3"),
> 	OPT_WITH_CBARG("--avalon7-fan",
> 		     set_avalon7_fan, NULL, &opt_set_avalon7_fan,
> 		     "Set Avalon7 target fan speed, range:[0, 100], step: 1, example: 0-100"),
> 	OPT_WITH_ARG("--avalon7-temp",
> 		     set_int_0_to_100, opt_show_intval, &opt_avalon7_temp_target,
> 		     "Set Avalon7 target temperature, range:[0, 100]"),
> 	OPT_WITH_ARG("--avalon7-polling-delay",
> 		     set_int_1_to_65535, opt_show_intval, &opt_avalon7_polling_delay,
> 		     "Set Avalon7 polling delay value (ms)"),
> 	OPT_WITH_ARG("--avalon7-aucspeed",
> 		     opt_set_intval, opt_show_intval, &opt_avalon7_aucspeed,
> 		     "Set AUC3 IIC bus speed"),
> 	OPT_WITH_ARG("--avalon7-aucxdelay",
> 		     opt_set_intval, opt_show_intval, &opt_avalon7_aucxdelay,
> 		     "Set AUC3 IIC xfer read delay, 4800 ~= 1ms"),
> 	OPT_WITH_ARG("--avalon7-smart-speed",
> 		     opt_set_intval, opt_show_intval, &opt_avalon7_smart_speed,
> 		     "Set Avalon7 smart speed, range 0-1. 0 means Disable"),
> 	OPT_WITH_ARG("--avalon7-th-pass",
> 		     set_int_0_to_65535, opt_show_intval, &opt_avalon7_th_pass,
> 		     "Set A3212 th pass value"),
> 	OPT_WITH_ARG("--avalon7-th-fail",
> 		     set_int_0_to_65535, opt_show_intval, &opt_avalon7_th_fail,
> 		     "Set A3212 th fail value"),
> 	OPT_WITH_ARG("--avalon7-th-init",
> 		     set_int_0_to_65535, opt_show_intval, &opt_avalon7_th_init,
> 		     "Set A3212 th init value"),
> 	OPT_WITH_ARG("--avalon7-th-ms",
> 		     set_int_0_to_65535, opt_show_intval, &opt_avalon7_th_ms,
> 		     "Set A3212 th ms value"),
> 	OPT_WITH_ARG("--avalon7-th-timeout",
> 		     opt_set_uintval, opt_show_uintval, &opt_avalon7_th_timeout,
> 		     "Set A3212 th timeout value"),
> 	OPT_WITHOUT_ARG("--avalon7-iic-detect",
> 		     opt_set_bool, &opt_avalon7_iic_detect,
> 		     "Enable Avalon7 detect through iic controller"),
> 	OPT_WITH_ARG("--avalon7-freqadj-time",
> 		     set_int_1_to_60, opt_show_intval, &opt_avalon7_freqadj_time,
> 		     "Set Avalon7 check interval when run in AVA7_FREQ_TEMPADJ_MODE"),
> 	OPT_WITH_ARG("--avalon7-delta-temp",
> 		     opt_set_intval, opt_show_intval, &opt_avalon7_delta_temp,
> 		     "Set Avalon7 delta temperature when reset freq in AVA7_FREQ_TEMPADJ_MODE"),
> 	OPT_WITH_ARG("--avalon7-delta-freq",
> 		     opt_set_intval, opt_show_intval, &opt_avalon7_delta_freq,
> 		     "Set Avalon7 delta freq when adjust freq in AVA7_FREQ_TEMPADJ_MODE"),
> 	OPT_WITH_ARG("--avalon7-freqadj-temp",
> 		     opt_set_intval, opt_show_intval, &opt_avalon7_freqadj_temp,
> 		     "Set Avalon7 check temperature when run into AVA7_FREQ_TEMPADJ_MODE"),
> 	OPT_WITH_ARG("--avalon7-nonce-mask",
> 		     set_int_24_to_32, opt_show_intval, &opt_avalon7_nonce_mask,
> 		     "Set A3212 nonce mask, range 24-32."),
> 	OPT_WITHOUT_ARG("--no-avalon7-asic-debug",
> 		     opt_set_invbool, &opt_avalon7_asic_debug,
> 		     "Disable A3212 debug."),
> #endif
> #ifdef USE_AVALON_MINER
> 	OPT_WITH_CBARG("--avalonm-voltage",
> 		     set_avalonm_voltage, NULL, &opt_set_avalonm_voltage,
> 		     "Set Avalon miner core voltage, in millivolts, step: 125"),
> 	OPT_WITH_CBARG("--avalonm-freq",
> 		     set_avalonm_freq, NULL, &opt_set_avalonm_freq,
> 		     "Set frequency for Avalon miner, 1 to 3 values, example: 275:250:200"),
> 	OPT_WITH_ARG("--avalonm-ntime-offset",
> 		     opt_set_intval, opt_show_intval, &opt_avalonm_ntime_offset,
> 		     "Set Avalon miner ntime rolling max offset, range 0-4"),
> 	OPT_WITH_ARG("--avalonm-spispeed",
> 		     opt_set_intval, opt_show_intval, &opt_avalonm_spispeed,
> 		     "Set spi speed for Avalon miner"),
> 	OPT_WITHOUT_ARG("--avalonm-automatic-freq",
> 			opt_set_bool, &opt_avalonm_autof,
> 			"Automatic adjust frequency base on chip HW"),
1292,1293c1543,1544
< 		     set_bitmain_freq, NULL, &opt_set_bitmain_freq,
< 		     "Set frequency range for bitmain-auto, single value or range"),
---
> 		     opt_set_charp, NULL, &opt_bitmain_freq,
> 		     "Set bitmain freq options timeout:freq:regdata"),
1299c1550,1555
< 		     "Set bitmain options baud:miners:asic:timeout:freq"),
---
> #ifdef USE_ANT_S1
> 		     "Set bitmain options baud:miners:asic:timeout:freq:regdata"
> #else
> 		     "Set bitmain options baud:miners:asic:ignored..."
> #endif
> 			),
1302a1559,1561
> 	OPT_WITH_ARG("--bitmain-workdelay",
> 		     set_int_0_to_100, opt_show_intval, &opt_bitmain_workdelay,
> 		     "Set bitmain work delay (ms) 0-100"),
1304a1564,1567
> 	OPT_WITH_ARG("--bitmain-voltage",
> 		     opt_set_charp, NULL, &opt_bitmain_voltage,
> 		     "Set bitmain voltage (default: "BITMAIN_VOLTAGE_DEF")"),
> #ifndef USE_ANT_S3
1307a1571
> #endif
1319a1584,1593
> 	// Ignored
> 	OPT_WITHOUT_ARG("--bitmain-nobeeper",
> 			opt_set_bool, &opt_bitmain_nobeeper,
> 			opt_hidden),
> 	OPT_WITHOUT_ARG("--bitmain-notempoverctrl",
> 			opt_set_bool, &opt_bitmain_notempoverctrl,
> 			opt_hidden),
> 	OPT_WITHOUT_ARG("--bitmain-homemode",
> 			opt_set_bool, &opt_bitmain_homemode,
> 			opt_hidden),
1352a1627,1631
> #ifdef USE_ICARUS
> 	OPT_WITH_ARG("--compac-freq",
> 		     set_float_100_to_500, &opt_show_floatval, &opt_compac_freq,
> 		     "Set GekkoScience Compac frequency in MHz, range 100-500"),
> #endif
1381,1382c1660,1661
< 		     set_int_0_to_9999, opt_show_intval, &opt_expiry,
< 		     "Upper bound on how many seconds after getting work we consider a share from it stale"),
---
> 		     set_null, NULL, &opt_set_null,
> 		     opt_hidden),
1384,1385c1663,1667
< 			opt_set_bool, &opt_fail_only,
< 			"Don't leak work to backup pools when primary pool is lagging"),
---
> 			set_null, &opt_set_null,
> 			opt_hidden),
> 	OPT_WITH_ARG("--fallback-time",
> 		     opt_set_intval, opt_show_intval, &opt_pool_fallback,
> 		     "Set time in seconds to fall back to a higher priority pool after period of instability"),
1388c1670
< 			"Do not redirect to a different getwork protocol (eg. stratum)"),
---
> 			"Do not redirect to stratum protocol from GBT"),
1550,1551c1832,1833
< 		     set_int_0_to_9999, opt_show_intval, &opt_queue,
< 		     "Maximum number of work items to have queued"),
---
> 		     set_null, NULL, &opt_set_null,
> 		     opt_hidden),
1584,1585c1866,1867
< 		     set_int_0_to_9999, opt_show_intval, &opt_scantime,
< 		     "Upper bound on time spent scanning current work, in seconds"),
---
> 		     set_null, NULL, &opt_set_null,
> 		     opt_hidden),
1674c1956
< 		if (!opt->names)
---
> 		if (!opt->names || !strlen(opt->names))
1681a1964,1966
> 			if (strlen(p) < 3)
> 				continue;
> 
1783,1786c2068
< 		json_error = malloc(siz);
< 		if (!json_error)
< 			quit(1, "Malloc failure in json error");
< 
---
> 		json_error = cgmalloc(siz);
1809c2091
< 	cnfbuf = malloc(PATH_MAX);
---
> 	cnfbuf = cgmalloc(PATH_MAX);
1829a2112,2114
> #ifdef USE_ANT_S3
> 		"ant.S3 "
> #else
1831a2117
> #endif
1840a2127,2132
> #ifdef USE_AVALON7
> 		"avalon7 "
> #endif
> #ifdef USE_AVALON_MINER
> 		"avalon miner"
> #endif
1927,1951d2218
< #ifdef HAVE_LIBCURL
< static bool jobj_binary(const json_t *obj, const char *key,
< 			void *buf, size_t buflen, bool required)
< {
< 	const char *hexstr;
< 	json_t *tmp;
< 
< 	tmp = json_object_get(obj, key);
< 	if (unlikely(!tmp)) {
< 		if (unlikely(required))
< 			applog(LOG_ERR, "JSON key '%s' not found", key);
< 		return false;
< 	}
< 	hexstr = json_string_value(tmp);
< 	if (unlikely(!hexstr)) {
< 		applog(LOG_ERR, "JSON key '%s' is not a string", key);
< 		return false;
< 	}
< 	if (!hex2bin(buf, hexstr, buflen))
< 		return false;
< 
< 	return true;
< }
< #endif
< 
1961c2228
< 	memcpy(work->midstate, ctx.h, 32);
---
> 	cg_memcpy(work->midstate, ctx.h, 32);
1979,1982c2246
< 	struct work *work = calloc(1, sizeof(struct work));
< 
< 	if (unlikely(!work))
< 		quit(1, "Failed to calloc work in make_work");
---
> 	struct work *work = cgcalloc(1, sizeof(struct work));
1985d2248
< 
2001,2003c2264,2275
<  * ram from arrays allocated within the work struct */
< void _free_work(struct work *work)
< {
---
>  * ram from arrays allocated within the work struct. Null the actual pointer
>  * used to call free_work. */
> void _free_work(struct work **workptr, const char *file, const char *func, const int line)
> {
> 	struct work *work = *workptr;
> 
> 	if (unlikely(!work)) {
> 		applog(LOG_ERR, "Free work called with null work from %s %s:%d",
> 		       file, func, line);
> 		return;
> 	}
> 
2005a2278
> 	*workptr = NULL;
2033c2306
< 	memcpy(merkle_sha, merkle_root, 32);
---
> 	cg_memcpy(merkle_sha, merkle_root, 32);
2035c2308
< 		memcpy(merkle_sha + 32, pool->merklebin + i * 32, 32);
---
> 		cg_memcpy(merkle_sha + 32, pool->merklebin + i * 32, 32);
2037c2310
< 		memcpy(merkle_sha, merkle_root, 32);
---
> 		cg_memcpy(merkle_sha, merkle_root, 32);
2092c2365
< 	memcpy(pool->coinbase + pool->nonce2_offset, &nonce2le, pool->n2size);
---
> 	cg_memcpy(pool->coinbase + pool->nonce2_offset, &nonce2le, pool->n2size);
2097,2100c2370,2373
< 	memcpy(work->data, &pool->gbt_version, 4);
< 	memcpy(work->data + 4, pool->previousblockhash, 32);
< 	memcpy(work->data + 4 + 32 + 32, &pool->curtime, 4);
< 	memcpy(work->data + 4 + 32 + 32 + 4, &pool->gbt_bits, 4);
---
> 	cg_memcpy(work->data, &pool->gbt_version, 4);
> 	cg_memcpy(work->data + 4, pool->previousblockhash, 32);
> 	cg_memcpy(work->data + 4 + 32 + 32, &pool->curtime, 4);
> 	cg_memcpy(work->data + 4 + 32 + 32 + 4, &pool->gbt_bits, 4);
2102c2375
< 	memcpy(work->target, pool->gbt_target, 32);
---
> 	cg_memcpy(work->target, pool->gbt_target, 32);
2193d2465
< 	align_len(&cal_len);
2195,2197c2467
< 	pool->coinbase = calloc(cal_len, 1);
< 	if (unlikely(!pool->coinbase))
< 		quit(1, "Failed to calloc pool coinbase in gbt_decode");
---
> 	pool->coinbase = cgcalloc(cal_len, 1);
2228a2499,2500
> 	if (pool->transactions < 3)
> 		pool->bad_work++;
2234,2259d2505
< static bool getwork_decode(json_t *res_val, struct work *work)
< {
< 	if (unlikely(!jobj_binary(res_val, "data", work->data, sizeof(work->data), true))) {
< 		applog(LOG_ERR, "JSON inval data");
< 		return false;
< 	}
< 
< 	if (!jobj_binary(res_val, "midstate", work->midstate, sizeof(work->midstate), false)) {
< 		// Calculate it ourselves
< 		applog(LOG_DEBUG, "Calculating midstate locally");
< 		calc_midstate(work);
< 	}
< 
< 	if (unlikely(!jobj_binary(res_val, "target", work->target, sizeof(work->target), true))) {
< 		applog(LOG_ERR, "JSON inval target");
< 		return false;
< 	}
< 	return true;
< }
< 
< /* Returns whether the pool supports local work generation or not. */
< static bool pool_localgen(struct pool *pool)
< {
< 	return (pool->has_stratum || pool->has_gbt || pool->gbt_solo);
< }
< 
2290,2292c2536
< 		pool->txn_data = malloc(len + 1);
< 		if (unlikely(!pool->txn_data))
< 			quit(1, "Failed to calloc txn_data in gbt_merkle_bins");
---
> 		pool->txn_data = cgmalloc(len + 1);
2297a2542
> 			const char *txid;
2299a2545
> 			txid = json_string_value(json_object_get(arr_val, "txid"));
2300a2547,2548
> 			if(!txid)
> 				txid = hash;
2303c2551
< 			memcpy(pool->txn_data + ofs, txn, len);
---
> 			cg_memcpy(pool->txn_data + ofs, txn, len);
2304a2553,2556
> #if 0
> 			// This logic no longer works post-segwit. The txids will always need to be sent,
> 			// as the full txns will also contain witness data that must be omitted in these
> 			// hashes.
2310,2312c2562
< 				txn_bin = malloc(txn_len);
< 				if (!txn_bin)
< 					quit(1, "Failed to malloc txn_bin in gbt_merkle_bins");
---
> 				txn_bin = cgmalloc(txn_len);
2319,2320c2569,2575
< 			if (!hex2bin(binswap, hash, 32)) {
< 				applog(LOG_ERR, "Failed to hex2bin hash in gbt_merkle_bins");
---
> #endif
> 			if (!txid) {
> 				applog(LOG_ERR, "missing txid in gbt_merkle_bins");
> 				return;
> 			}
> 			if (!hex2bin(binswap, txid, 32)) {
> 				applog(LOG_ERR, "Failed to hex2bin txid in gbt_merkle_bins");
2330c2585
< 			memcpy(pool->merklebin + (pool->merkles * 32), hashbin + 32, 32);
---
> 			cg_memcpy(pool->merklebin + (pool->merkles * 32), hashbin + 32, 32);
2333c2588
< 				memcpy(hashbin + binlen, hashbin + binlen - 32, 32);
---
> 				cg_memcpy(hashbin + binlen, hashbin + binlen - 32, 32);
2355a2611,2664
> static const unsigned char witness_nonce[32] = {0};
> static const int witness_nonce_size = sizeof(witness_nonce);
> static const unsigned char witness_header[] = {0xaa, 0x21, 0xa9, 0xed};
> static const int witness_header_size = sizeof(witness_header);
> 
> static bool gbt_witness_data(json_t *transaction_arr, unsigned char* witnessdata, int avail_size)
> {
> 	int i, binlen, txncount = json_array_size(transaction_arr);
> 	unsigned char *hashbin;
> 	const char *hash;
> 	json_t *arr_val;
> 
> 	binlen = txncount * 32 + 32;
> 	hashbin = alloca(binlen + 32);
> 	memset(hashbin, 0, 32);
> 
> 	if (avail_size < witness_header_size + 32)
> 		return false;
> 
> 	for (i = 0; i < txncount; i++) {
> 		unsigned char binswap[32];
> 
> 		arr_val = json_array_get(transaction_arr, i);
> 		hash = json_string_value(json_object_get(arr_val, "hash"));
> 		if (unlikely(!hash)) {
> 			applog(LOG_ERR, "Hash missing for transaction");
> 			return false;
> 		}
> 		if (!hex2bin(binswap, hash, 32)) {
> 			applog(LOG_ERR, "Failed to hex2bin hash in gbt_witness_data");
> 			return false;
> 		}
> 		swab256(hashbin + 32 + 32 * i, binswap);
> 	}
> 
> 	// Build merkle root (copied from libblkmaker)
> 	for (txncount++ ; txncount > 1 ; txncount /= 2) {
> 		if (txncount % 2) {
> 			// Odd number, duplicate the last
> 			memcpy(hashbin + 32 * txncount, hashbin + 32 * (txncount - 1), 32);
> 			txncount++;
> 		}
> 		for (i = 0; i < txncount; i += 2) {
> 			// We overlap input and output here, on the first pair
> 			gen_hash(hashbin + 32 * i, hashbin + 32 * (i / 2), 64);
> 		}
> 	}
> 
> 	memcpy(witnessdata, witness_header, witness_header_size);
> 	memcpy(hashbin + 32, &witness_nonce, witness_nonce_size);
> 	gen_hash(hashbin, witnessdata + witness_header_size, 32 + witness_nonce_size);
> 	return true;
> }
> 
2363c2672
< 	json_t *transaction_arr, *coinbase_aux;
---
> 	json_t *transaction_arr, *rules_arr, *coinbase_aux;
2371c2680
< 	char header[228];
---
> 	char header[260];
2377a2687,2691
> 	int witness_txout_len = 0;
> 	int witnessdata_size = 0;
> 	bool insert_witness = false;
> 	unsigned char witnessdata[36] = {};
> 	const char *default_witness_commitment;
2381a2696
> 	rules_arr = json_object_get(res_val, "rules");
2388a2704
> 	default_witness_commitment = json_string_value(json_object_get(res_val, "default_witness_commitment"));
2394a2711,2729
> 	if (rules_arr) {
> 		int i;
> 		int rule_count = json_array_size(rules_arr);
> 		const char *rule;
> 
> 		for (i = 0; i < rule_count; i++) {
> 			rule = json_string_value(json_array_get(rules_arr, i));
> 			if (!rule)
> 				continue;
> 			if (*rule == '!')
> 				rule++;
> 			if (strncmp(rule, "segwit", 6)) {
> 				insert_witness = true;
> 				break;
> 			}
> 		}
> 	}
> 
> 
2419a2755,2775
> 
> 	if (insert_witness) {
> 		char witness_str[sizeof(witnessdata) * 2];
> 
> 		witnessdata_size = sizeof(witnessdata);
> 		if (!gbt_witness_data(transaction_arr, witnessdata, witnessdata_size)) {
> 			applog(LOG_ERR, "error calculating witness data");
> 			return false;
> 		}
> 		__bin2hex(witness_str, witnessdata, witnessdata_size);
> 		applog(LOG_DEBUG, "calculated witness data: %s", witness_str);
> 		if (default_witness_commitment) {
> 			if (strncmp(witness_str, default_witness_commitment + 4, witnessdata_size * 2) != 0) {
> 				applog(LOG_ERR, "bad witness data. %s != %s", default_witness_commitment + 4, witness_str);
> 				return false;
> 			}
> 		}
> 	}
> 
> 	if (pool->transactions < 3)
> 		pool->bad_work++;
2445c2801
< 	memcpy(pool->scriptsig_base + ofs, "\x09\x63\x67\x6d\x69\x6e\x65\x72\x34\x32", 10);
---
> 	cg_memcpy(pool->scriptsig_base + ofs, "\x09\x63\x67\x6d\x69\x6e\x65\x72\x34\x32", 10);
2458c2814
< 		memcpy(pool->scriptsig_base + ofs, opt_btc_sig, len);
---
> 		cg_memcpy(pool->scriptsig_base + ofs, opt_btc_sig, len);
2468c2824
< 		+ 1 // transactions
---
> 		+ 1 // txouts
2471a2828,2833
> 
> 	if (insert_witness) {
> 		len +=  8 //value
> 			+   1 + 2 + witnessdata_size; // total scriptPubKey size + OP_RETURN + push size + data
> 	}
> 
2473,2479c2835,2838
< 	pool->coinbase = calloc(len, 1);
< 	if (unlikely(!pool->coinbase))
< 		quit(1, "Failed to calloc coinbase in gbt_solo_decode");
< 
< 	memcpy(pool->coinbase + 41, pool->scriptsig_base, ofs);
< 	memcpy(pool->coinbase + 41 + ofs, "\xff\xff\xff\xff", 4);
< 	pool->coinbase[41 + ofs + 4] = 1;
---
> 	pool->coinbase = cgcalloc(len, 1);
> 	cg_memcpy(pool->coinbase + 41, pool->scriptsig_base, ofs);
> 	cg_memcpy(pool->coinbase + 41 + ofs, "\xff\xff\xff\xff", 4);
> 	pool->coinbase[41 + ofs + 4] = insert_witness ? 2 : 1;
2482a2842,2853
> 	if (insert_witness) {
> 		unsigned char *witness = &pool->coinbase[41 + ofs + 4 + 1 + 8 + 1 + 25];
> 
> 		memset(witness, 0, 8);
> 		witness_txout_len += 8;
> 		witness[witness_txout_len++] = witnessdata_size + 2; // total scriptPubKey size
> 		witness[witness_txout_len++] = 0x6a; // OP_RETURN
> 		witness[witness_txout_len++] = witnessdata_size;
> 		memcpy(&witness[witness_txout_len], witnessdata, witnessdata_size);
> 		witness_txout_len += witnessdata_size;
> 	}
> 
2485c2856
< 	pool->coinbase_len = 41 + ofs + 4 + 1 + 8 + 1 + 25 + 4;
---
> 	pool->coinbase_len = 41 + ofs + 4 + 1 + 8 + 1 + 25 + witness_txout_len + 4;
2488c2859
< 	snprintf(header, 225, "%s%s%s%s%s%s%s",
---
> 	snprintf(header, 257, "%s%s%s%s%s%s%s",
2496c2867
< 	if (unlikely(!hex2bin(pool->header_bin, header, 112)))
---
> 	if (unlikely(!hex2bin(pool->header_bin, header, 128)))
2516,2524c2887,2889
< 		ret = true;
< 		goto out;
< 	} else if (pool->has_gbt) {
< 		if (unlikely(!gbt_decode(pool, res_val)))
< 			goto out;
< 		work->gbt = true;
< 		ret = true;
< 		goto out;
< 	} else if (unlikely(!getwork_decode(res_val, work)))
---
> 		goto out_true;
> 	}
> 	if (unlikely(!gbt_decode(pool, res_val)))
2526c2891
< 
---
> 	work->gbt = true;
2530c2895
< 
---
> out_true:
2532d2896
< 
2537,2538d2900
< /* Always true with stratum */
< #define pool_localgen(pool) (true)
2850c3212
< 		memcpy(unique_id, blanks, 8);
---
> 		cg_memcpy(unique_id, blanks, 8);
3172c3534
< 				memcpy(2 + reason, reasontmp, reasonLen);
---
> 				cg_memcpy(2 + reason, reasontmp, reasonLen);
3174c3536
< 				memcpy(disposition + 7, reasontmp, reasonLen);
---
> 				cg_memcpy(disposition + 7, reasontmp, reasonLen);
3264c3626
< 	struct cgpu_info *cgpu;
---
> 	struct cgpu_info *cgpu = get_thr_cgpu(thr_id);
3272,3273c3634,3635
< 
< 	cgpu = get_thr_cgpu(thr_id);
---
> 	char gbt_block[1024], varint[12];
> 	unsigned char data[80];
3276,3288c3638,3639
< 	if (work->gbt) {
< 		char gbt_block[1024], varint[12];
< 		unsigned char data[80];
< 
< 		flip80(data, work->data);
< 		__bin2hex(gbt_block, data, 80); // 160 length
< 
< 		if (work->gbt_txns < 0xfd) {
< 			uint8_t val8 = work->gbt_txns;
< 
< 			__bin2hex(varint, (const unsigned char *)&val8, 1);
< 		} else if (work->gbt_txns <= 0xffff) {
< 			uint16_t val16 = htole16(work->gbt_txns);
---
> 	flip80(data, work->data);
> 	__bin2hex(gbt_block, data, 80); // 160 length
3290,3293c3641,3642
< 			strcat(gbt_block, "fd"); // +2
< 			__bin2hex(varint, (const unsigned char *)&val16, 2);
< 		} else {
< 			uint32_t val32 = htole32(work->gbt_txns);
---
> 	if (work->gbt_txns < 0xfd) {
> 		uint8_t val8 = work->gbt_txns;
3295,3299c3644,3646
< 			strcat(gbt_block, "fe"); // +2
< 			__bin2hex(varint, (const unsigned char *)&val32, 4);
< 		}
< 		strcat(gbt_block, varint); // +8 max
< 		strcat(gbt_block, work->coinbase);
---
> 		__bin2hex(varint, (const unsigned char *)&val8, 1);
> 	} else if (work->gbt_txns <= 0xffff) {
> 		uint16_t val16 = htole16(work->gbt_txns);
3301,3317c3648,3649
< 		s = malloc(1024);
< 		if (unlikely(!s))
< 			quit(1, "Failed to malloc s in submit_upstream_work");
< 		sprintf(s, "{\"id\": 0, \"method\": \"submitblock\", \"params\": [\"%s", gbt_block);
< 		/* Has submit/coinbase support */
< 		if (!pool->has_gbt) {
< 			cg_rlock(&pool->gbt_lock);
< 			if (pool->txn_data)
< 				s = realloc_strcat(s, pool->txn_data);
< 			cg_runlock(&pool->gbt_lock);
< 		}
< 		if (work->job_id) {
< 			s = realloc_strcat(s, "\", {\"workid\": \"");
< 			s = realloc_strcat(s, work->job_id);
< 			s = realloc_strcat(s, "\"}]}");
< 		} else
< 			s = realloc_strcat(s, "\"]}");
---
> 		strcat(gbt_block, "fd"); // +2
> 		__bin2hex(varint, (const unsigned char *)&val16, 2);
3319,3321c3651
< 		char *hexstr;
< 
< 		endian_flip128(work->data, work->data);
---
> 		uint32_t val32 = htole32(work->gbt_txns);
3323,3328c3653,3654
< 		/* build hex string */
< 		hexstr = bin2hex(work->data, 118);
< 		s = strdup("{\"method\": \"getwork\", \"params\": [ \"");
< 		s = realloc_strcat(s, hexstr);
< 		s = realloc_strcat(s, "\" ], \"id\":1}");
< 		free(hexstr);
---
> 		strcat(gbt_block, "fe"); // +2
> 		__bin2hex(varint, (const unsigned char *)&val32, 4);
3329a3656,3673
> 	strcat(gbt_block, varint); // +8 max
> 	strcat(gbt_block, work->coinbase);
> 
> 	s = cgmalloc(1024);
> 	sprintf(s, "{\"id\": 0, \"method\": \"submitblock\", \"params\": [\"%s", gbt_block);
> 	/* Has submit/coinbase support */
> 	if (!pool->has_gbt) {
> 		cg_rlock(&pool->gbt_lock);
> 		if (pool->txn_data)
> 			s = realloc_strcat(s, pool->txn_data);
> 		cg_runlock(&pool->gbt_lock);
> 	}
> 	if (work->job_id) {
> 		s = realloc_strcat(s, "\", {\"workid\": \"");
> 		s = realloc_strcat(s, work->job_id);
> 		s = realloc_strcat(s, "\"}]}");
> 	} else
> 		s = realloc_strcat(s, "\"]}");
3377c3721
< 			memcpy(&tm_getwork, tm, sizeof(struct tm));
---
> 			cg_memcpy(&tm_getwork, tm, sizeof(struct tm));
3380c3724
< 			memcpy(&tm_submit_reply, tm, sizeof(struct tm));
---
> 			cg_memcpy(&tm_submit_reply, tm, sizeof(struct tm));
3435,3489d3778
< 
< static bool get_upstream_work(struct work *work, CURL *curl)
< {
< 	struct pool *pool = work->pool;
< 	struct cgminer_pool_stats *pool_stats = &(pool->cgminer_pool_stats);
< 	struct timeval tv_elapsed;
< 	json_t *val = NULL;
< 	bool rc = false;
< 	char *url;
< 
< 	url = pool->rpc_url;
< 
< 	applog(LOG_DEBUG, "DBG: sending %s get RPC call: %s", url, pool->rpc_req);
< 
< 	cgtime(&work->tv_getwork);
< 
< 	val = json_rpc_call(curl, url, pool->rpc_userpass, pool->rpc_req, false,
< 			    false, &work->rolltime, pool, false);
< 	pool_stats->getwork_attempts++;
< 
< 	if (likely(val)) {
< 		rc = work_decode(pool, work, val);
< 		if (unlikely(!rc))
< 			applog(LOG_DEBUG, "Failed to decode work in get_upstream_work");
< 	} else
< 		applog(LOG_DEBUG, "Failed json_rpc_call in get_upstream_work");
< 
< 	cgtime(&work->tv_getwork_reply);
< 	timersub(&(work->tv_getwork_reply), &(work->tv_getwork), &tv_elapsed);
< 	pool_stats->getwork_wait_rolling += ((double)tv_elapsed.tv_sec + ((double)tv_elapsed.tv_usec / 1000000)) * 0.63;
< 	pool_stats->getwork_wait_rolling /= 1.63;
< 
< 	timeradd(&tv_elapsed, &(pool_stats->getwork_wait), &(pool_stats->getwork_wait));
< 	if (timercmp(&tv_elapsed, &(pool_stats->getwork_wait_max), >)) {
< 		pool_stats->getwork_wait_max.tv_sec = tv_elapsed.tv_sec;
< 		pool_stats->getwork_wait_max.tv_usec = tv_elapsed.tv_usec;
< 	}
< 	if (timercmp(&tv_elapsed, &(pool_stats->getwork_wait_min), <)) {
< 		pool_stats->getwork_wait_min.tv_sec = tv_elapsed.tv_sec;
< 		pool_stats->getwork_wait_min.tv_usec = tv_elapsed.tv_usec;
< 	}
< 	pool_stats->getwork_calls++;
< 
< 	work->pool = pool;
< 	work->longpoll = false;
< 	work->getwork_mode = GETWORK_MODE_POOL;
< 	calc_diff(work, 0);
< 	total_getworks++;
< 	pool->getwork_requested++;
< 
< 	if (likely(val))
< 		json_decref(val);
< 
< 	return rc;
< }
3493c3782
< static bool pool_unworkable(struct pool *pool)
---
> static bool pool_unusable(struct pool *pool)
3499c3788
< 	if (pool->has_stratum && !pool->stratum_active)
---
> 	if (pool->has_stratum && (!pool->stratum_active || !pool->stratum_notify))
3517c3806
< 		if (pool_unworkable(pool))
---
> 		if (pool_unusable(pool))
3530d3818
< static bool pool_unusable(struct pool *pool);
3534c3822
< static inline struct pool *select_pool(bool lagging)
---
> static inline struct pool *select_pool(void)
3548c3836
< 	if (pool_strategy != POOL_LOADBALANCE && (!lagging || opt_fail_only)) {
---
> 	if (pool_strategy != POOL_LOADBALANCE) {
3576c3864
< 			if (!pool_unworkable(pool))
---
> 			if (!pool_unusable(pool))
3578,3581d3865
< 			/* Failover-only flag for load-balance means distribute
< 			 * unused quota to priority pool 0. */
< 			if (opt_fail_only)
< 				priority_pool(0)->quota_used--;
3693c3977
< 	memcpy(work->target, bench_target, 32);
---
> 	cg_memcpy(work->target, bench_target, 32);
3919d4202
< #ifndef WIN32
3922,3925d4204
< #else
< 		if (pth && pth->p)
< 			pthread_join(*pth, NULL);
< #endif
4011a4291,4294
> #ifdef USE_LIBSYSTEMD
> 	sd_notify(false, "RELOADING=1\n"
> 		"STATUS=Restarting...");
> #endif
4031a4315
> 	sigaction(SIGABRT, &abrthandler, NULL);
4075a4360,4382
> void roll_work_ntime(struct work *work, int noffset)
> {
> 	uint32_t *work_ntime;
> 	uint32_t ntime;
> 
> 	work_ntime = (uint32_t *)(work->data + 68);
> 	ntime = be32toh(*work_ntime);
> 	ntime += noffset;
> 	*work_ntime = htobe32(ntime);
> 	local_work++;
> 	work->rolls += noffset;
> 	work->nonce = 0;
> 	applog(LOG_DEBUG, "Successfully rolled work");
> 
> 	/* Change the ntime field if this is stratum work */
> 	if (work->ntime)
> 		modify_ntime(work->ntime, noffset);
> 
> 	/* This is now a different work item so it needs a different ID for the
> 	 * hashtable */
> 	work->id = total_work_inc();
> }
> 
4096,4099c4403
< 	struct curl_ent *ce = calloc(sizeof(struct curl_ent), 1);
< 
< 	if (unlikely(!ce))
< 		quit(1, "Failed to calloc in recruit_curl");
---
> 	struct curl_ent *ce = cgcalloc(sizeof(struct curl_ent), 1);
4116c4420
< 	int curl_limit = opt_delaynet ? 5 : (mining_threads + opt_queue) * 2;
---
> 	int curl_limit = opt_delaynet ? 5 : (mining_threads + max_queue) * 2;
4162c4466
< 	if (work->rolltime > opt_scantime)
---
> 	if (work->rolltime > max_scantime)
4165c4469
< 		expiry = opt_scantime;
---
> 		expiry = max_scantime;
4228,4256d4531
< static bool clone_available(void)
< {
< 	struct work *work_clone = NULL, *work, *tmp;
< 	bool cloned = false;
< 
< 	mutex_lock(stgd_lock);
< 	if (!staged_rollable)
< 		goto out_unlock;
< 
< 	HASH_ITER(hh, staged_work, work, tmp) {
< 		if (can_roll(work) && should_roll(work)) {
< 			roll_work(work);
< 			work_clone = make_clone(work);
< 			roll_work(work);
< 			cloned = true;
< 			break;
< 		}
< 	}
< 
< out_unlock:
< 	mutex_unlock(stgd_lock);
< 
< 	if (cloned) {
< 		applog(LOG_DEBUG, "Pushing cloned available work to stage thread");
< 		stage_work(work_clone);
< 	}
< 	return cloned;
< }
< 
4262c4537
< 	int mrs = mining_threads + opt_queue - total_staged();
---
> 	int mrs = mining_threads + max_queue - total_staged();
4321c4596
< 	memcpy(work, base_work, sizeof(struct work));
---
> 	cg_memcpy(work, base_work, sizeof(struct work));
4393d4667
< 	int getwork_delay;
4406c4680
< 	if (work->rolltime > opt_scantime)
---
> 	if (work->rolltime > max_scantime)
4409c4683
< 		work_expiry = opt_expiry;
---
> 		work_expiry = max_expiry;
4434,4437d4707
< 	/* Factor in the average getwork delay of this pool, rounding it up to
< 	 * the nearest second */
< 	getwork_delay = pool->cgminer_pool_stats.getwork_wait_rolling * 5 + 1;
< 	work_expiry -= getwork_delay;
4447,4452d4716
< 	if (opt_fail_only && !share && pool != current_pool() && !work->mandatory &&
< 	    pool_strategy != POOL_LOADBALANCE && pool_strategy != POOL_BALANCE) {
< 		applog(LOG_DEBUG, "Work stale due to fail only pool mismatch");
< 		return true;
< 	}
< 
4521,4530d4784
< /* Specifies whether we can switch to this pool or not. */
< static bool pool_unusable(struct pool *pool)
< {
< 	if (pool->idle)
< 		return true;
< 	if (pool->enabled != POOL_ENABLED)
< 		return true;
< 	return false;
< }
< 
4593,4598d4846
< 	/* Set the lagging flag to avoid pool not providing work fast enough
< 	 * messages in failover only mode since  we have to get all fresh work
< 	 * as in restart_threads */
< 	if (opt_fail_only)
< 		pool_tset(pool, &pool->lagging);
< 
4601,4602c4849
< 		if (pool_localgen(pool) || opt_fail_only)
< 			clear_pool_work(last_pool);
---
> 		clear_pool_work(last_pool);
4608d4854
< 
4611c4857
< void _discard_work(struct work *work)
---
> void _discard_work(struct work **workptr, const char *file, const char *func, const int line)
4612a4859,4865
> 	struct work *work = *workptr;
> 
> 	if (unlikely(!work)) {
> 		applog(LOG_ERR, "Discard work called with null work from %s %s:%d",
> 		       file, func, line);
> 		return;
> 	}
4623c4876
< 	free_work(work);
---
> 	_free_work(workptr, file, func, line);
4683d4935
< 	struct pool *cp = current_pool();
4689,4692d4940
< 	/* Artificially set the lagging flag to avoid pool not providing work
< 	 * fast enough  messages after every long poll */
< 	pool_tset(cp, &cp->lagging);
< 
4732c4980
< 		quit(1, "Failed to create restart thread");
---
> 		quithere(1, "Failed to create restart thread errno=%d", errno);
4748c4996
< static void set_curblock(char *hexstr, unsigned char *bedata)
---
> static void set_curblock(const char *hexstr, const unsigned char *bedata)
4755c5003
< 	memcpy(current_block, bedata, 32);
---
> 	cg_memcpy(current_block, bedata, 32);
4769,4793d5016
< /* Search to see if this string is from a block that has been seen before */
< static bool block_exists(char *hexstr)
< {
< 	struct block *s;
< 
< 	rd_lock(&blk_lock);
< 	HASH_FIND_STR(blocks, hexstr, s);
< 	rd_unlock(&blk_lock);
< 
< 	if (s)
< 		return true;
< 	return false;
< }
< 
< /* Tests if this work is from a block that has been seen before */
< static inline bool from_existing_block(struct work *work)
< {
< 	char *hexstr = bin2hex(work->data + 8, 18);
< 	bool ret;
< 
< 	ret = block_exists(hexstr);
< 	free(hexstr);
< 	return ret;
< }
< 
4803a5027,5028
> 	if (powdiff < 8)
> 		powdiff = 8;
4815c5040,5041
< static bool test_work_current(struct work *work)
---
> /* Search to see if this string is from a block that has been seen before */
> static bool block_exists(const char *hexstr, const unsigned char *bedata, const struct work *work)
4817,4819c5043,5044
< 	struct pool *pool = work->pool;
< 	unsigned char bedata[32];
< 	char hexstr[68];
---
> 	int deleted_block = 0;
> 	struct block *s;
4822,4833c5047,5050
< 	if (work->mandatory)
< 		return ret;
< 
< 	swap256(bedata, work->data + 4);
< 	__bin2hex(hexstr, bedata, 32);
< 
< 	/* Search to see if this block exists yet and if not, consider it a
< 	 * new block and set the current block details to this one */
< 	if (!block_exists(hexstr)) {
< 		struct block *s = calloc(sizeof(struct block), 1);
< 		int deleted_block = 0;
< 
---
> 	wr_lock(&blk_lock);
> 	HASH_FIND_STR(blocks, hexstr, s);
> 	if (!s) {
> 		s = cgcalloc(sizeof(struct block), 1);
4835c5052
< 			quit (1, "test_work_current OOM");
---
> 			quit (1, "block_exists OOM");
4839c5056
< 		wr_lock(&blk_lock);
---
> 		ret = false;
4854,4855d5070
< 		wr_unlock(&blk_lock);
< 
4857a5073,5076
> 	}
> 	wr_unlock(&blk_lock);
> 
> 	if (!ret)
4858a5078,5119
> 	if (deleted_block)
> 		applog(LOG_DEBUG, "Deleted block %d from database", deleted_block);
> 
> 	return ret;
> }
> 
> static bool test_work_current(struct work *work)
> {
> 	struct pool *pool = work->pool;
> 	unsigned char bedata[32];
> 	char hexstr[68];
> 	bool ret = true;
> 	unsigned char *bin_height = &pool->coinbase[43];
> 	uint8_t cb_height_sz = bin_height[-1];
> 	uint32_t height = 0;
> 
> 	if (work->mandatory)
> 		return ret;
> 
> 	swap256(bedata, work->data + 4);
> 	__bin2hex(hexstr, bedata, 32);
> 
> 	/* Calculate block height */
> 	if (cb_height_sz <= 4) {
> 		memcpy(&height, bin_height, cb_height_sz);
> 		height = le32toh(height);
> 		height--;
> 	}
> 
> 	cg_wlock(&pool->data_lock);
> 	if (pool->swork.clean) {
> 		pool->swork.clean = false;
> 		work->longpoll = true;
> 	}
> 	if (pool->current_height != height) {
> 		pool->current_height = height;
> 	}
> 	cg_wunlock(&pool->data_lock);
> 
> 	/* Search to see if this block exists yet and if not, consider it a
> 	 * new block and set the current block details to this one */
> 	if (!block_exists(hexstr, bedata, work)) {
4861c5122
< 		memcpy(pool->prev_block, bedata, 32);
---
> 		cg_memcpy(pool->prev_block, bedata, 32);
4871,4872c5132,5133
< 				applog(LOG_NOTICE, "Stratum from pool %d detected new block",
< 				       pool->pool_no);
---
> 				applog(LOG_NOTICE, "Stratum from pool %d detected new block at height %d",
> 				       pool->pool_no, height);
4874,4875c5135,5136
< 				applog(LOG_NOTICE, "%sLONGPOLL from pool %d detected new block",
< 				       work->gbt ? "GBT " : "", work->pool->pool_no);
---
> 				applog(LOG_NOTICE, "%sLONGPOLL from pool %d detected new block at height %d",
> 				       work->gbt ? "GBT " : "", pool->pool_no, height);
4878c5139,5140
< 			applog(LOG_NOTICE, "New block detected on network before pool notification");
---
> 			applog(LOG_NOTICE, "New block detected on network before pool notification from pool %d at height %d",
> 			       pool->pool_no, height);
4880c5142,5143
< 			applog(LOG_NOTICE, "New block detected on network");
---
> 			applog(LOG_NOTICE, "New block detected on network from pool %d at height %d",
> 			       pool->pool_no, height);
4890c5153
< 				applog(LOG_DEBUG, "Stale data from pool %d", pool->pool_no);
---
> 				applog(LOG_DEBUG, "Stale data from pool %d at height %d", pool->pool_no, height);
4895,4896c5158,5159
< 				applog(LOG_INFO, "Pool %d now up to date", pool->pool_no);
< 				memcpy(pool->prev_block, bedata, 32);
---
> 				applog(LOG_INFO, "Pool %d now up to date at height %d", pool->pool_no, height);
> 				cg_memcpy(pool->prev_block, bedata, 32);
4914c5177
< 					       work->gbt ? "GBT " : "", work->pool->pool_no);
---
> 					       work->gbt ? "GBT " : "", pool->pool_no);
4983,4984d5245
< 	double efficiency = 0.0;
< 
4991c5252
< 		wlog(" Queued work requests: %d\n", pool->getwork_requested);
---
> 		wlog(" Work templates received: %d\n", pool->getwork_requested);
4999,5001d5259
< 		efficiency = pool->getwork_requested ? pool->accepted * 100.0 / pool->getwork_requested : 0.0;
< 		if (!pool_localgen(pool))
< 			wlog(" Efficiency (accepted / queued): %.0f%%\n", efficiency);
5065,5068c5323,5324
< 	ptr = buf = malloc(strlen(str) * 2 + 1);
< 
< 	jeptr = malloc(sizeof(*jeptr));
< 
---
> 	ptr = buf = cgmalloc(strlen(str) * 2 + 1);
> 	jeptr = cgmalloc(sizeof(*jeptr));
5134a5391
> 			     (void *)opt->cb_arg == (void *)set_int_0_to_65535 ||
5135a5393
> 			     (void *)opt->cb_arg == (void *)set_int_0_to_5 ||
5137a5396
> 			     (void *)opt->cb_arg == (void *)set_int_24_to_32 ||
5139a5399,5400
> 			     (void *)opt->cb_arg == (void *)set_int_1_to_255 ||
> 			     (void *)opt->cb_arg == (void *)set_int_0_to_7680 ||
5143,5144c5404,5405
< 			     (void *)opt->cb_arg == (void *)set_int_22_to_55 ||
< 			     (void *)opt->cb_arg == (void *)set_int_42_to_65)) {
---
> 			     (void *)opt->cb_arg == (void *)set_int_22_to_75 ||
> 			     (void *)opt->cb_arg == (void *)set_int_42_to_85)) {
5337d5597
< 	wlogprint("[F]ailover only %s\n", opt_fail_only ? "enabled" : "disabled");
5447,5449d5706
< 	} else if (!strncasecmp(&input, "f", 1)) {
< 		opt_fail_only ^= true;
< 		goto updated;
5588d5844
< 	int selected;
5595,5597c5851
< 	wlogprint("[Q]ueue: %d\n[S]cantime: %d\n[E]xpiry: %d\n"
< 		  "[W]rite config file\n[C]gminer restart\n",
< 		opt_queue, opt_scantime, opt_expiry);
---
> 	wlogprint("[W]rite config file\n[C]gminer restart\n");
5602,5628c5856
< 	if (!strncasecmp(&input, "q", 1)) {
< 		selected = curses_int("Extra work items to queue");
< 		if (selected < 0 || selected > 9999) {
< 			wlogprint("Invalid selection\n");
< 			goto retry;
< 		}
< 		opt_queue = selected;
< 		if (opt_queue < max_queue)
< 			max_queue = opt_queue;
< 		goto retry;
< 	} else if  (!strncasecmp(&input, "s", 1)) {
< 		selected = curses_int("Set scantime in seconds");
< 		if (selected < 0 || selected > 9999) {
< 			wlogprint("Invalid selection\n");
< 			goto retry;
< 		}
< 		opt_scantime = selected;
< 		goto retry;
< 	} else if  (!strncasecmp(&input, "e", 1)) {
< 		selected = curses_int("Set expiry time in seconds");
< 		if (selected < 0 || selected > 9999) {
< 			wlogprint("Invalid selection\n");
< 			goto retry;
< 		}
< 		opt_expiry = selected;
< 		goto retry;
< 	} else if  (!strncasecmp(&input, "w", 1)) {
---
> 	if  (!strncasecmp(&input, "w", 1)) {
6053a6282,6285
> #ifdef USE_LIBSYSTEMD
> 	sd_notifyf(false, "STATUS=%s", statusline);
> #endif
> 
6248,6249d6479
< 	/* Getwork pools without opt_fail_only need backup pools up to be able
< 	 * to leak shares */
6253,6254d6482
< 	if (!pool_localgen(cp) && (!opt_fail_only || !cp->hdr_path))
< 		return true;
6327a6556
> 				pool_died(pool);
6330,6333c6559
< 				if (enabled_pools > 1)
< 					cgsleep_ms(30000);
< 				else
< 					cgsleep_ms(3000);
---
> 				cgsleep_ms(5000);
6365a6592
> 				pool_died(pool);
6368c6595
< 				cgsleep_ms(30000);
---
> 				cgsleep_ms(5000);
6384d6610
< 			pool->swork.clean = false;
6386d6611
< 			work->longpoll = true;
6457c6682
< 		sshare = calloc(sizeof(struct stratum_share), 1);
---
> 		sshare = cgcalloc(sizeof(struct stratum_share), 1);
6572c6797
< 	memcpy(pool->coinbase, scriptsig_header_bin, 41);
---
> 	cg_memcpy(pool->coinbase, scriptsig_header_bin, 41);
6574c6799
< 	memcpy(pool->coinbase + 41 + pool->n1_len + 4 + 1 + 8 + 1, pool->script_pubkey, 25);
---
> 	cg_memcpy(pool->coinbase + 41 + pool->n1_len + 4 + 1 + 8 + 1, pool->script_pubkey, 25);
6590c6815
< 	snprintf(s, 256, "{\"method\": \"validateaddress\", \"params\": [\"%s\"]}\n", opt_btc_address);
---
> 	snprintf(s, 256, "{\"id\": 1, \"method\": \"validateaddress\", \"params\": [\"%s\"]}\n", opt_btc_address);
6686c6911,6933
< 				    gbt_req, true, false, &rolltime, pool, false);
---
> 					gbt_req, true, false, &rolltime, pool, false);
> 		if (val) {
> 			json_t *rules_arr = json_object_get(val, "rules");
> 
> 			if (!gbt_check_rules(rules_arr, gbt_understood_rules)) {
> 				applog(LOG_DEBUG, "Not all rules understood for GBT");
> 				json_decref(val);
> 				val = NULL;
> 			}
> 		}
> 		if (!val) {
> 			json_t *rules_arr;
> 
> 			applog(LOG_DEBUG, "Probing for GBT solo support");
> 			val = json_rpc_call(curl, pool->rpc_url, pool->rpc_userpass,
> 					gbt_solo_req, true, false, &rolltime, pool, false);
> 			rules_arr = json_object_get(val, "rules");
> 			if (!gbt_check_rules(rules_arr, gbt_solo_understood_rules)) {
> 				applog(LOG_DEBUG, "Not all rules understood for GBT solo");
> 				json_decref(val);
> 				val = NULL;
> 			}
> 		}
6733c6980
< 			applog(LOG_DEBUG, "No GBT coinbase + append support found, using getwork protocol");
---
> 			applog(LOG_DEBUG, "No GBT coinbase + append support found, pool unusable if it has no stratum");
6741,6742c6988,6989
< 	/* Detect if a http getwork pool has an X-Stratum header at startup,
< 	 * and if so, switch to that in preference to getwork if it works */
---
> 	/* Detect if a http pool has an X-Stratum header at startup,
> 	 * and if so, switch to that in preference to gbt if it works */
6752a7000,7003
> 	if (!pool->has_stratum && !pool->gbt_solo && !pool->has_gbt) {
> 		applog(LOG_WARNING, "No Stratum, GBT or Solo support in pool %d %s unable to use", pool->pool_no, pool->rpc_url);
> 		return false;
> 	}
6758a7010,7011
> 			applog(LOG_DEBUG, "Successfully retrieved and deciphered work from pool %u %s",
> 			       pool->pool_no, pool->rpc_url);
6766,6767d7018
< 			applog(LOG_DEBUG, "Successfully retrieved and deciphered work from pool %u %s",
< 			       pool->pool_no, pool->rpc_url);
6806,6811c7057
< 				pool->lp_url = malloc(siz);
< 				if (!pool->lp_url) {
< 					applog(LOG_ERR, "Malloc failure in pool_active");
< 					return false;
< 				}
< 
---
> 				pool->lp_url = cgmalloc(siz);
6819,6824d7064
< 		/* If we failed to parse a getwork, this could be a stratum
< 		 * url without the prefix stratum+tcp:// so let's check it */
< 		if (initiate_stratum(pool)) {
< 			pool->has_stratum = true;
< 			goto retry_stratum;
< 		}
6858,6863d7097
< 		/* Increase the queue if we reach zero and we know we can reach
< 		 * the maximum we're asking for. */
< 		if (work_filled && max_queue < opt_queue) {
< 			max_queue++;
< 			work_filled = false;
< 		}
6976c7210
< 	memcpy(dest_target, target, 32);
---
> 	cg_memcpy(dest_target, target, 32);
6979c7213
< #if defined (USE_AVALON2) || defined (USE_AVALON4) || defined (USE_HASHRATIO)
---
> #if defined (USE_AVALON2) || defined (USE_AVALON4) || defined (USE_AVALON7) || defined (USE_AVALON_MINER) || defined (USE_HASHRATIO)
6994,6996c7228
< 	while (ntime--) {
< 		roll_work(work);
< 	}
---
> 	roll_work_ntime(work, ntime);
6998a7231,7232
> 	/* Inherit the sdiff from the original stratum */
> 	work->sdiff = pool->sdiff;
7029c7263
< 	memcpy(pool->coinbase + pool->nonce2_offset, &nonce2le, pool->n2size);
---
> 	cg_memcpy(pool->coinbase + pool->nonce2_offset, &nonce2le, pool->n2size);
7038c7272
< 	memcpy(merkle_sha, merkle_root, 32);
---
> 	cg_memcpy(merkle_sha, merkle_root, 32);
7040c7274
< 		memcpy(merkle_sha + 32, pool->swork.merkle_bin[i], 32);
---
> 		cg_memcpy(merkle_sha + 32, pool->swork.merkle_bin[i], 32);
7042c7276
< 		memcpy(merkle_sha, merkle_root, 32);
---
> 		cg_memcpy(merkle_sha, merkle_root, 32);
7049,7050c7283,7284
< 	memcpy(work->data, pool->header_bin, 112);
< 	memcpy(work->data + 36, merkle_root, 32);
---
> 	cg_memcpy(work->data, pool->header_bin, 112);
> 	cg_memcpy(work->data + 36, merkle_root, 32);
7170c7404
< 	memcpy(pool->coinbase + pool->nonce2_offset, &nonce2le, pool->n2size);
---
> 	cg_memcpy(pool->coinbase + pool->nonce2_offset, &nonce2le, pool->n2size);
7180c7414
< 	memcpy(merkle_sha, merkle_root, 32);
---
> 	cg_memcpy(merkle_sha, merkle_root, 32);
7185c7419
< 		memcpy(merkle_sha + 32, merkle_bin, 32);
---
> 		cg_memcpy(merkle_sha + 32, merkle_bin, 32);
7187c7421
< 		memcpy(merkle_sha, merkle_root, 32);
---
> 		cg_memcpy(merkle_sha, merkle_root, 32);
7194,7195c7428,7429
< 	memcpy(work->data, pool->header_bin, 112);
< 	memcpy(work->data + 36, merkle_root, 32);
---
> 	cg_memcpy(work->data, pool->header_bin, 112);
> 	cg_memcpy(work->data + 36, merkle_root, 32);
7201c7435
< 	memcpy(work->target, pool->gbt_target, 32);
---
> 	cg_memcpy(work->target, pool->gbt_target, 32);
7250c7484
< 		memcpy(work, &bench_hidiff_bins[cgpu->hidiff][0], 160);
---
> 		cg_memcpy(work, &bench_hidiff_bins[cgpu->hidiff][0], 160);
7252c7486
< 		memcpy(work, &bench_lodiff_bins[cgpu->lodiff][0], 160);
---
> 		cg_memcpy(work, &bench_lodiff_bins[cgpu->lodiff][0], 160);
7340c7574
< 		if (unlikely(!tq_push(pool->stratum_q, work))) {
---
> 		if (unlikely(!pool->stratum_q || !tq_push(pool->stratum_q, work))) {
7502c7736
< 	if (wdiff->tv_sec > opt_scantime || hashes >= 0xfffffffe ||
---
> 	if (wdiff->tv_sec > max_scantime || hashes >= 0xfffffffe ||
7835a8070,8082
> struct work *clone_queued_work_byid(struct cgpu_info *cgpu, uint32_t id)
> {
> 	struct work *work, *ret = NULL;
> 
> 	rd_lock(&cgpu->qlock);
> 	work = __find_work_byid(cgpu->queued_work, id);
> 	if (work)
> 		ret = copy_work(work);
> 	rd_unlock(&cgpu->qlock);
> 
> 	return ret;
> }
> 
7929,7930d8175
< 		mythr->work_update = false;
< 
7960c8205
< 		if (mythr->work_update)
---
> 		if (mythr->work_update) {
7961a8207,8208
> 			mythr->work_update = false;
> 		}
7982,7983d8228
< 		mythr->work_update = false;
< 
8011c8256
< 		if (mythr->work_update)
---
> 		if (mythr->work_update) {
8012a8258,8259
> 			mythr->work_update = false;
> 		}
8087,8095d8333
< 	/* Don't use backup LPs as work if we have failover-only enabled. Use
< 	 * the longpoll work from a pool that has been rejecting shares as a
< 	 * way to detect when the pool has recovered.
< 	 */
< 	if (pool != current_pool() && opt_fail_only && pool->enabled != POOL_REJECTING) {
< 		free_work(work);
< 		return;
< 	}
< 
8249,8260c8487,8488
< 	if (pool->has_gbt) {
< 		lp_url = pool->rpc_url;
< 		applog(LOG_WARNING, "GBT longpoll ID activated for %s", lp_url);
< 	} else {
< 		strcpy(lpreq, getwork_req);
< 
< 		lp_url = pool->lp_url;
< 		if (cp == pool)
< 			applog(LOG_WARNING, "Long-polling activated for %s", lp_url);
< 		else
< 			applog(LOG_WARNING, "Long-polling activated for %s via %s", cp->rpc_url, lp_url);
< 	}
---
> 	lp_url = pool->rpc_url;
> 	applog(LOG_WARNING, "GBT longpoll ID activated for %s", lp_url);
8412a8641
> 	cgtimer_t cgt;
8418a8648
> 	cgtimer_time(&cgt);
8424c8654
< 		if (++intervals > 20)
---
> 		if (++intervals > 120)
8437c8667
< 			if (intervals > 19) {
---
> 			if (intervals > 119) {
8453,8455c8683,8684
< 			/* Test pool is idle once every minute */
< 			if (pool->idle && now.tv_sec - pool->tv_idle.tv_sec > 30) {
< 				if (pool_active(pool, true) && pool_tclear(pool, &pool->idle))
---
> 			if (pool_active(pool, true)) {
> 				if (pool_tclear(pool, &pool->idle))
8457,8459c8686,8687
< 				else
< 					cgtime(&pool->tv_idle);
< 			}
---
> 			} else
> 				cgtime(&pool->tv_idle);
8465,8467c8693,8695
< 			    now.tv_sec - pool->tv_idle.tv_sec > 300) {
< 				applog(LOG_WARNING, "Pool %d %s stable for 5 mins",
< 				       pool->pool_no, pool->rpc_url);
---
> 			    now.tv_sec - pool->tv_idle.tv_sec > opt_pool_fallback) {
> 				applog(LOG_WARNING, "Pool %d %s stable for >%d seconds",
> 				       pool->pool_no, pool->rpc_url, opt_pool_fallback);
8480,8481c8708,8709
< 		cgsleep_ms(30000);
< 
---
> 		cgsleep_ms_r(&cgt, 5000);
> 		cgtimer_time(&cgt);
8499a8728,8742
> #ifdef USE_LIBSYSTEMD
> 	uint64_t notify_usec;
> 	struct timeval notify_interval, notify_tv;
> 
> 	if (sd_watchdog_enabled(false, &notify_usec)) {
> 		notify_usec = notify_usec / 2;
> 		us_to_timeval(&notify_interval, notify_usec);
> 		cgtime(&notify_tv);
> 		addtime(&notify_interval, &notify_tv);
> 
> 		applog(LOG_DEBUG, "Watchdog notify interval: %.3gs",
> 				notify_usec / 1000000.0);
> 	}
> #endif
> 
8551a8795,8803
> #if USE_LIBSYSTEMD
> 		if (notify_usec && !time_more(&notify_tv, &now)) {
> 			sd_notify(false, "WATCHDOG=1");
> 			copy_time(&notify_tv, &now);
> 			addtime(&notify_interval, &notify_tv);
> 			applog(LOG_DEBUG, "Notified watchdog");
> 		}
> #endif
> 
8605c8857
< 			if (thr->getwork || *denable == DEV_DISABLED)
---
> 			if (thr->getwork || *denable == DEV_DISABLED || thr->pause)
8772a9025,9029
> #ifdef USE_LIBSYSTEMD
> 	sd_notify(false, "STOPPING=1\n"
> 		"STATUS=Shutting down...");
> #endif
> 
8805,8807c9062
< 	input = malloc(255);
< 	if (!input)
< 		quit(1, "Failed to malloc input");
---
> 	input = cgmalloc(255);
8827a9083,9084
> 	if (pool->removed)
> 		goto out;
8829d9085
< 		pool_tset(pool, &pool->lagging);
8849,8850c9105,9108
< 		sleep(5);
< 		goto retry;
---
> 		if (!pool->blocking) {
> 			sleep(5);
> 			goto retry;
> 		}
8854c9112
< 
---
> out:
8865,8866d9122
< 	url = get_proxy(url, pool);
< 
8871,8873c9127
< 	pool->rpc_userpass = malloc(siz);
< 	if (!pool->rpc_userpass)
< 		quit(1, "Failed to malloc userpass");
---
> 	pool->rpc_userpass = cgmalloc(siz);
8892c9146
< 	char *url = NULL, *user = NULL, *pass = NULL;
---
> 	char *url, *user, *pass;
8898a9153,9156
> retry:
> 	url = NULL;
> 	user = NULL;
> 	pass = NULL;
8900c9158,9159
< 	if (!strcmp(url, "-1"))
---
> 	if (!strcmp(url, "-1")) {
> 		wlogprint("Invalid input\n");
8901a9161
> 	}
8904c9164,9165
< 	if (!strcmp(user, "-1"))
---
> 	if (!strcmp(user, "-1")) {
> 		wlogprint("Invalid input\n");
8905a9167
> 	}
8907c9169
< 	pass = curses_input("Password");
---
> 	pass = curses_input("Password [enter for none]");
8914,8923c9176,9180
< 
< 	if (!detect_stratum(pool, url) && strncmp(url, "http://", 7) &&
< 	    strncmp(url, "https://", 8)) {
< 		char *httpinput;
< 
< 		httpinput = malloc(256);
< 		if (!httpinput)
< 			quit(1, "Failed to malloc httpinput");
< 		strcpy(httpinput, "http://");
< 		strncat(httpinput, url, 248);
---
> 	url = setup_url(pool, url);
> 	ret = add_pool_details(pool, live, url, user, pass);
> 	if (!ret) {
> 		remove_pool(pool);
> 		wlogprint("URL %s failed alive testing, reinput details\n", url);
8925c9182,9184
< 		url = httpinput;
---
> 		free(user);
> 		free(pass);
> 		goto retry;
8927,8928d9185
< 
< 	ret = add_pool_details(pool, live, url, user, pass);
9105a9363,9369
> static void generic_zero_stats(struct cgpu_info *cgpu)
> {
> 	cgpu->diff_accepted =
> 	cgpu->diff_rejected =
> 	cgpu->hw_errors = 0;
> }
> 
9109d9372
< #define noop_zero_stats noop_reinit_device
9148c9411
< 		drv->zero_stats = &noop_zero_stats;
---
> 		drv->zero_stats = &generic_zero_stats;
9152a9416,9417
> 	if (!drv->genwork)
> 		opt_gen_stratum_work = true;
9178c9443
< 	drv->zero_stats = &noop_zero_stats;
---
> 	drv->zero_stats = &generic_zero_stats;
9186d9450
< 	drv->zero_stats = &noop_zero_stats;
9243,9244c9507,9508
< 		d = malloc(sizeof(*d));
< 		memcpy(d->name, cgpu->drv->name, sizeof(d->name));
---
> 		d = cgmalloc(sizeof(*d));
> 		cg_memcpy(d->name, cgpu->drv->name, sizeof(d->name));
9250c9514
< 	devices = realloc(devices, sizeof(struct cgpu_info *) * (total_devices + new_devices + 2));
---
> 	devices = cgrealloc(devices, sizeof(struct cgpu_info *) * (total_devices + new_devices + 2));
9275,9279c9539,9540
< 	if (unlikely(!(copy = malloc(sizeof(*copy))))) {
< 		quit(1, "Failed to allocate device_drv copy of %s (%s)",
< 				drv->name, drv->copy ? "copy" : "original");
< 	}
< 	memcpy(copy, drv, sizeof(*copy));
---
> 	copy = cgmalloc(sizeof(*copy));
> 	cg_memcpy(copy, drv, sizeof(*copy));
9301,9309c9562,9564
< 	mining_thr = realloc(mining_thr, sizeof(thr) * (mining_threads + new_threads + 1));
< 
< 	if (!mining_thr)
< 		quit(1, "Failed to hotplug realloc mining_thr");
< 	for (i = 0; i < new_threads; i++) {
< 		mining_thr[mining_threads + i] = calloc(1, sizeof(*thr));
< 		if (!mining_thr[mining_threads + i])
< 			quit(1, "Failed to hotplug calloc mining_thr[%d]", i);
< 	}
---
> 	mining_thr = cgrealloc(mining_thr, sizeof(thr) * (mining_threads + new_threads + 1));
> 	for (i = 0; i < new_threads; i++)
> 		mining_thr[mining_threads + i] = cgcalloc(1, sizeof(*thr));
9314c9569
< 		cgpu->thr = malloc(sizeof(*cgpu->thr) * (cgpu->threads+1));
---
> 		cgpu->thr = cgmalloc(sizeof(*cgpu->thr) * (cgpu->threads+1));
9357a9613,9629
> static void reinit_usb(void)
> {
> 	int err;
> 
> 	usb_reinit = true;
> 	/* Wait till libusb_poll_thread is no longer polling */
> 	while (polling_usb)
> 		cgsleep_ms(100);
> 
> 	applog(LOG_DEBUG, "Reinitialising libusb");
> 	libusb_exit(NULL);
> 	err = libusb_init(NULL);
> 	if (err)
> 		quit(1, "Reinit of libusb failed err %d:%s", err, libusb_error_name(err));
> 	usb_reinit = false;
> }
> 
9383a9656,9660
> 			/* If we have no active devices, libusb may need to
> 			 * be re-initialised to work properly */
> 			if (total_devices == zombie_devs)
> 				reinit_usb();
> 
9411c9688
< 	struct timeval tv_end = {1, 0};
---
> 	struct timeval tv_end;
9415c9692,9699
< 	while (usb_polling)
---
> 	while (likely(usb_polling)) {
> 		tv_end.tv_sec = 0;
> 		tv_end.tv_usec = 100000;
> 		while (usb_reinit) {
> 			polling_usb = false;
> 			cgsleep_ms(100);
> 		}
> 		polling_usb = true;
9416a9701
> 	}
9423c9708,9710
< 	do {
---
> 	while (async_usb_transfers()) {
> 		tv_end.tv_sec = 0;
> 		tv_end.tv_usec = 0;
9425c9712
< 	} while (async_usb_transfers());
---
> 	};
9461a9749,9752
> #ifdef USE_LIBSYSTEMD
> 	sd_notify(false, "STATUS=Starting up...");
> #endif
> 
9476c9767
< 	initial_args = malloc(sizeof(char *) * (argc + 1));
---
> 	initial_args = cgmalloc(sizeof(char *) * (argc + 1));
9519a9811
> 	sigaction(SIGABRT, &handler, &abrthandler);
9537,9539c9829
< 	block = calloc(sizeof(struct block), 1);
< 	if (unlikely(!block))
< 		quit (1, "main OOM");
---
> 	block = cgcalloc(sizeof(struct block), 1);
9564c9854
< 		pool->rpc_url = malloc(255);
---
> 		pool->rpc_url = cgmalloc(255);
9619,9620c9909,9914
< 	if (opt_scantime < 0)
< 		opt_scantime = 60;
---
> #ifdef HAVE_SYSLOG_H
> 	if (opt_log_output)
> 		setlogmask(LOG_UPTO(LOG_DEBUG));
> 	else
> 		setlogmask(LOG_UPTO(LOG_NOTICE));
> #endif
9623,9625c9917
< 	control_thr = calloc(total_control_threads, sizeof(*thr));
< 	if (!control_thr)
< 		early_quit(1, "Failed to calloc control_thr");
---
> 	control_thr = cgcalloc(total_control_threads, sizeof(*thr));
9709,9711c10001
< 			pool->rpc_userpass = malloc(siz);
< 			if (!pool->rpc_userpass)
< 				early_quit(1, "Failed to malloc userpass");
---
> 			pool->rpc_userpass = cgmalloc(siz);
9728,9735c10018,10020
< 	mining_thr = calloc(mining_threads, sizeof(thr));
< 	if (!mining_thr)
< 		early_quit(1, "Failed to calloc mining_thr");
< 	for (i = 0; i < mining_threads; i++) {
< 		mining_thr[i] = calloc(1, sizeof(*thr));
< 		if (!mining_thr[i])
< 			early_quit(1, "Failed to calloc mining_thr[%d]", i);
< 	}
---
> 	mining_thr = cgcalloc(mining_threads, sizeof(thr));
> 	for (i = 0; i < mining_threads; i++)
> 		mining_thr[i] = cgcalloc(1, sizeof(*thr));
9741c10026
< 		cgpu->thr = malloc(sizeof(*cgpu->thr) * (cgpu->threads+1));
---
> 		cgpu->thr = cgmalloc(sizeof(*cgpu->thr) * (cgpu->threads+1));
9870a10156,10160
> #ifdef USE_LIBSYSTEMD
> 	sd_notify(false, "READY=1\n"
> 		"STATUS=Started");
> #endif
> 
9874,9875c10164
< 		struct pool *pool, *cp;
< 		bool lagging = false;
---
> 		struct pool *pool;
9880,9885d10168
< 		cp = current_pool();
< 
< 		/* If the primary pool is a getwork pool and cannot roll work,
< 		 * try to stage one extra work per mining thread */
< 		if (!pool_localgen(cp) && !staged_rollable)
< 			max_staged += mining_threads;
9889,9892d10171
< 
< 		if (!pool_localgen(cp) && !ts && !opt_fail_only)
< 			lagging = true;
< 
9895,9898d10173
< 			if (work_emptied && max_queue < opt_queue) {
< 				max_queue++;
< 				work_emptied = false;
< 			}
9909,9912d10183
< 			if (work_emptied && max_queue < opt_queue) {
< 				max_queue++;
< 				work_emptied = false;
< 			}
9924,9932c10195,10203
< 		if (lagging && !pool_tset(cp, &cp->lagging)) {
< 			applog(LOG_WARNING, "Pool %d not providing work fast enough", cp->pool_no);
< 			cp->getfail_occasions++;
< 			total_go++;
< 			if (!pool_localgen(cp) && max_queue < opt_queue)
< 				applog(LOG_INFO, "Increasing queue to %d", ++max_queue);
< 		}
< 		pool = select_pool(lagging);
< retry:
---
> 		while (42) {
> 			pool = select_pool();
> 			if (!pool_unusable(pool))
> 				break;
> 			switch_pools(NULL);
> 			pool = select_pool();
> 			if (pool_unusable(pool))
> 				cgsleep_ms(5);
> 		};
9934,9941c10205,10208
< 			while (!pool->stratum_active || !pool->stratum_notify) {
< 				struct pool *altpool = select_pool(true);
< 
< 				cgsleep_ms(5000);
< 				if (altpool != pool) {
< 					pool = altpool;
< 					goto retry;
< 				}
---
> 			if (opt_gen_stratum_work) {
> 				gen_stratum_work(pool, work);
> 				applog(LOG_DEBUG, "Generated stratum work");
> 				stage_work(work);
9943,9957d10209
< 			gen_stratum_work(pool, work);
< 			applog(LOG_DEBUG, "Generated stratum work");
< 			stage_work(work);
< 			continue;
< 		}
< 
< 		if (opt_benchfile) {
< 			get_benchfile_work(work);
< 			applog(LOG_DEBUG, "Generated benchfile work");
< 			stage_work(work);
< 			continue;
< 		} else if (opt_benchmark) {
< 			get_benchmark_work(work);
< 			applog(LOG_DEBUG, "Generated benchmark work");
< 			stage_work(work);
9962,9963d10213
< 		struct curl_ent *ce;
< 
9965,9973d10214
< 			while (pool->idle) {
< 				struct pool *altpool = select_pool(true);
< 
< 				cgsleep_ms(5000);
< 				if (altpool != pool) {
< 					pool = altpool;
< 					goto retry;
< 				}
< 			}
9981,9989d10221
< 			while (pool->idle) {
< 				struct pool *altpool = select_pool(true);
< 
< 				cgsleep_ms(5000);
< 				if (altpool != pool) {
< 					pool = altpool;
< 					goto retry;
< 				}
< 			}
9995,9998c10227,10236
< 
< 		if (clone_available()) {
< 			applog(LOG_DEBUG, "Cloned getwork work");
< 			free_work(work);
---
> #endif
> 		if (opt_benchfile) {
> 			get_benchfile_work(work);
> 			applog(LOG_DEBUG, "Generated benchfile work");
> 			stage_work(work);
> 			continue;
> 		} else if (opt_benchmark) {
> 			get_benchmark_work(work);
> 			applog(LOG_DEBUG, "Generated benchmark work");
> 			stage_work(work);
10001,10025d10238
< 
< 		work->pool = pool;
< 		ce = pop_curl_entry(pool);
< 		/* obtain new work from bitcoin via JSON-RPC */
< 		if (!get_upstream_work(work, ce->curl)) {
< 			applog(LOG_DEBUG, "Pool %d json_rpc_call failed on get work, retrying in 5s", pool->pool_no);
< 			/* Make sure the pool just hasn't stopped serving
< 			 * requests but is up as we'll keep hammering it */
< 			if (++pool->seq_getfails > mining_threads + opt_queue)
< 				pool_died(pool);
< 			cgsleep_ms(5000);
< 			push_curl_entry(ce, pool);
< 			pool = select_pool(!opt_fail_only);
< 			free_work(work);
< 			goto retry;
< 		}
< 		if (ts >= max_staged)
< 			pool_tclear(pool, &pool->lagging);
< 		if (pool_tclear(pool, &pool->idle))
< 			pool_resus(pool);
< 
< 		applog(LOG_DEBUG, "Generated getwork work");
< 		stage_work(work);
< 		push_curl_entry(ce, pool);
< #endif
Common subdirectories: cgminer-4.9.0/compat and cgminer-4.10.0/compat
diff '--color=auto' cgminer-4.9.0/compat.h cgminer-4.10.0/compat.h
13a14
> #include <winsock2.h>
49c50
< 
---
> #if 0
59c60
< 
---
> #endif
diff '--color=auto' cgminer-4.9.0/compile cgminer-4.10.0/compile
6c6
< # Copyright (C) 1999-2013 Free Software Foundation, Inc.
---
> # Copyright (C) 1999-2014 Free Software Foundation, Inc.
diff '--color=auto' cgminer-4.9.0/config.guess cgminer-4.10.0/config.guess
3c3
< #   Copyright 1992-2013 Free Software Foundation, Inc.
---
> #   Copyright 1992-2016 Free Software Foundation, Inc.
5c5
< timestamp='2013-06-10'
---
> timestamp='2016-04-02'
27c27
< # Originally written by Per Bothner.
---
> # Originally written by Per Bothner; maintained since 2000 by Ben Elliston.
30c30
< # http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD
---
> # http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess
32c32
< # Please send patches with a ChangeLog entry to config-patches@gnu.org.
---
> # Please send patches to <config-patches@gnu.org>.
53c53
< Copyright 1992-2013 Free Software Foundation, Inc.
---
> Copyright 1992-2016 Free Software Foundation, Inc.
152c152
< 	eval `$CC_FOR_BUILD -E $dummy.c 2>/dev/null | grep '^LIBC'`
---
> 	eval `$CC_FOR_BUILD -E $dummy.c 2>/dev/null | grep '^LIBC' | sed 's, ,,g'`
171,172c171,174
< 	UNAME_MACHINE_ARCH=`(/sbin/$sysctl 2>/dev/null || \
< 	    /usr/sbin/$sysctl 2>/dev/null || echo unknown)`
---
> 	UNAME_MACHINE_ARCH=`(uname -p 2>/dev/null || \
> 	    /sbin/$sysctl 2>/dev/null || \
> 	    /usr/sbin/$sysctl 2>/dev/null || \
> 	    echo unknown)`
178a181,185
> 	    earmv*)
> 		arch=`echo ${UNAME_MACHINE_ARCH} | sed -e 's,^e\(armv[0-9]\).*$,\1,'`
> 		endian=`echo ${UNAME_MACHINE_ARCH} | sed -ne 's,^.*\(eb\)$,\1,p'`
> 		machine=${arch}${endian}-unknown
> 		;;
184c191
< 	    arm*|i386|m68k|ns32k|sh3*|sparc|vax)
---
> 	    arm*|earm*|i386|m68k|ns32k|sh3*|sparc|vax)
199a207,213
> 	# Determine ABI tags.
> 	case "${UNAME_MACHINE_ARCH}" in
> 	    earm*)
> 		expr='s/^earmv[0-9]/-eabi/;s/eb$//'
> 		abi=`echo ${UNAME_MACHINE_ARCH} | sed -e "$expr"`
> 		;;
> 	esac
210c224
< 		release=`echo ${UNAME_RELEASE}|sed -e 's/[-_].*/\./'`
---
> 		release=`echo ${UNAME_RELEASE} | sed -e 's/[-_].*//' | cut -d. -f1,2`
216c230
< 	echo "${machine}-${os}${release}"
---
> 	echo "${machine}-${os}${release}${abi}"
225a240,243
>     *:LibertyBSD:*:*)
> 	UNAME_MACHINE_ARCH=`arch | sed 's/^.*BSD\.//'`
> 	echo ${UNAME_MACHINE_ARCH}-unknown-libertybsd${UNAME_RELEASE}
> 	exit ;;
237a256,258
>     *:Sortix:*:*)
> 	echo ${UNAME_MACHINE}-unknown-sortix
> 	exit ;;
254c275
< 		UNAME_MACHINE="alpha" ;;
---
> 		UNAME_MACHINE=alpha ;;
256c277
< 		UNAME_MACHINE="alpha" ;;
---
> 		UNAME_MACHINE=alpha ;;
258c279
< 		UNAME_MACHINE="alpha" ;;
---
> 		UNAME_MACHINE=alpha ;;
260c281
< 		UNAME_MACHINE="alphaev5" ;;
---
> 		UNAME_MACHINE=alphaev5 ;;
262c283
< 		UNAME_MACHINE="alphaev56" ;;
---
> 		UNAME_MACHINE=alphaev56 ;;
264c285
< 		UNAME_MACHINE="alphapca56" ;;
---
> 		UNAME_MACHINE=alphapca56 ;;
266c287
< 		UNAME_MACHINE="alphapca57" ;;
---
> 		UNAME_MACHINE=alphapca57 ;;
268c289
< 		UNAME_MACHINE="alphaev6" ;;
---
> 		UNAME_MACHINE=alphaev6 ;;
270c291
< 		UNAME_MACHINE="alphaev67" ;;
---
> 		UNAME_MACHINE=alphaev67 ;;
272c293
< 		UNAME_MACHINE="alphaev68" ;;
---
> 		UNAME_MACHINE=alphaev68 ;;
274c295
< 		UNAME_MACHINE="alphaev68" ;;
---
> 		UNAME_MACHINE=alphaev68 ;;
276c297
< 		UNAME_MACHINE="alphaev68" ;;
---
> 		UNAME_MACHINE=alphaev68 ;;
278c299
< 		UNAME_MACHINE="alphaev69" ;;
---
> 		UNAME_MACHINE=alphaev69 ;;
280c301
< 		UNAME_MACHINE="alphaev7" ;;
---
> 		UNAME_MACHINE=alphaev7 ;;
282c303
< 		UNAME_MACHINE="alphaev79" ;;
---
> 		UNAME_MACHINE=alphaev79 ;;
289c310
< 	echo ${UNAME_MACHINE}-dec-osf`echo ${UNAME_RELEASE} | sed -e 's/^[PVTX]//' | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
---
> 	echo ${UNAME_MACHINE}-dec-osf`echo ${UNAME_RELEASE} | sed -e 's/^[PVTX]//' | tr ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz`
362c383
< 	SUN_ARCH="i386"
---
> 	SUN_ARCH=i386
366c387
< 	if [ "$CC_FOR_BUILD" != 'no_compiler_found' ]; then
---
> 	if [ "$CC_FOR_BUILD" != no_compiler_found ]; then
368c389
< 		(CCOPTS= $CC_FOR_BUILD -E - 2>/dev/null) | \
---
> 		(CCOPTS="" $CC_FOR_BUILD -E - 2>/dev/null) | \
371c392
< 		SUN_ARCH="x86_64"
---
> 		SUN_ARCH=x86_64
396c417
< 	test "x${UNAME_RELEASE}" = "x" && UNAME_RELEASE=3
---
> 	test "x${UNAME_RELEASE}" = x && UNAME_RELEASE=3
582,583c603,605
< 	if [ -x /usr/bin/oslevel ] ; then
< 		IBM_REV=`/usr/bin/oslevel`
---
> 	if [ -x /usr/bin/lslpp ] ; then
> 		IBM_REV=`/usr/bin/lslpp -Lqc bos.rte.libc |
> 			   awk -F: '{ print $3 }' | sed s/[0-9]*$/0/`
620,621c642,643
< 		      523) HP_ARCH="hppa1.0" ;; # CPU_PA_RISC1_0
< 		      528) HP_ARCH="hppa1.1" ;; # CPU_PA_RISC1_1
---
> 		      523) HP_ARCH=hppa1.0 ;; # CPU_PA_RISC1_0
> 		      528) HP_ARCH=hppa1.1 ;; # CPU_PA_RISC1_1
624,626c646,648
< 			  32) HP_ARCH="hppa2.0n" ;;
< 			  64) HP_ARCH="hppa2.0w" ;;
< 			  '') HP_ARCH="hppa2.0" ;;   # HP-UX 10.20
---
> 			  32) HP_ARCH=hppa2.0n ;;
> 			  64) HP_ARCH=hppa2.0w ;;
> 			  '') HP_ARCH=hppa2.0 ;;   # HP-UX 10.20
665c687
< 		    (CCOPTS= $CC_FOR_BUILD -o $dummy $dummy.c 2>/dev/null) && HP_ARCH=`$dummy`
---
> 		    (CCOPTS="" $CC_FOR_BUILD -o $dummy $dummy.c 2>/dev/null) && HP_ARCH=`$dummy`
669c691
< 	if [ ${HP_ARCH} = "hppa2.0w" ]
---
> 	if [ ${HP_ARCH} = hppa2.0w ]
682c704
< 	    if echo __LP64__ | (CCOPTS= $CC_FOR_BUILD -E - 2>/dev/null) |
---
> 	    if echo __LP64__ | (CCOPTS="" $CC_FOR_BUILD -E - 2>/dev/null) |
685c707
< 		HP_ARCH="hppa2.0w"
---
> 		HP_ARCH=hppa2.0w
687c709
< 		HP_ARCH="hppa64"
---
> 		HP_ARCH=hppa64
792,793c814,815
< 	FUJITSU_PROC=`uname -m | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
< 	FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
---
> 	FUJITSU_PROC=`uname -m | tr ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz`
> 	FUJITSU_SYS=`uname -p | tr ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz | sed -e 's/\///'`
798,799c820,821
< 	FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
< 	FUJITSU_REL=`echo ${UNAME_RELEASE} | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/ /_/'`
---
> 	FUJITSU_SYS=`uname -p | tr ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz | sed -e 's/\///'`
> 	FUJITSU_REL=`echo ${UNAME_RELEASE} | tr ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz | sed -e 's/ /_/'`
829c851
<     i*:MSYS*:*)
---
>     *:MSYS*:*)
881c903
< 	echo ${UNAME_MACHINE}-unknown-`echo ${UNAME_SYSTEM} | sed 's,^[^/]*/,,' | tr '[A-Z]' '[a-z]'``echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`-${LIBC}
---
> 	echo ${UNAME_MACHINE}-unknown-`echo ${UNAME_SYSTEM} | sed 's,^[^/]*/,,' | tr "[:upper:]" "[:lower:]"``echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`-${LIBC}
904c926
< 	if test "$?" = 0 ; then LIBC="gnulibc1" ; fi
---
> 	if test "$?" = 0 ; then LIBC=gnulibc1 ; fi
934a957,959
>     e2k:Linux:*:*)
> 	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
> 	exit ;;
946a972,974
>     k1om:Linux:*:*)
> 	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
> 	exit ;;
972,973c1000,1001
<     or1k:Linux:*:*)
< 	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
---
>     openrisc*:Linux:*:*)
> 	echo or1k-unknown-linux-${LIBC}
975c1003
<     or32:Linux:*:*)
---
>     or32:Linux:*:* | or1k*:Linux:*:*)
1023c1051
< 	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
---
> 	echo ${UNAME_MACHINE}-pc-linux-${LIBC}
1102c1130
< 	# prints for the "djgpp" host, or else GDB configury will decide that
---
> 	# prints for the "djgpp" host, or else GDB configure will decide that
1250a1279,1281
>     SX-ACE:SUPER-UX:*:*)
> 	echo sxace-nec-superux${UNAME_RELEASE}
> 	exit ;;
1263,1271c1294,1304
< 	if [ "$CC_FOR_BUILD" != 'no_compiler_found' ]; then
< 	    if (echo '#ifdef __LP64__'; echo IS_64BIT_ARCH; echo '#endif') | \
< 		(CCOPTS= $CC_FOR_BUILD -E - 2>/dev/null) | \
< 		grep IS_64BIT_ARCH >/dev/null
< 	    then
< 		case $UNAME_PROCESSOR in
< 		    i386) UNAME_PROCESSOR=x86_64 ;;
< 		    powerpc) UNAME_PROCESSOR=powerpc64 ;;
< 		esac
---
> 	if test `echo "$UNAME_RELEASE" | sed -e 's/\..*//'` -le 10 ; then
> 	    if [ "$CC_FOR_BUILD" != no_compiler_found ]; then
> 		if (echo '#ifdef __LP64__'; echo IS_64BIT_ARCH; echo '#endif') | \
> 		    (CCOPTS="" $CC_FOR_BUILD -E - 2>/dev/null) | \
> 		    grep IS_64BIT_ARCH >/dev/null
> 		then
> 		    case $UNAME_PROCESSOR in
> 			i386) UNAME_PROCESSOR=x86_64 ;;
> 			powerpc) UNAME_PROCESSOR=powerpc64 ;;
> 		    esac
> 		fi
1272a1306,1313
> 	elif test "$UNAME_PROCESSOR" = i386 ; then
> 	    # Avoid executing cc on OS X 10.9, as it ships with a stub
> 	    # that puts up a graphical alert prompting to install
> 	    # developer tools.  Any system running Mac OS X 10.7 or
> 	    # later (Darwin 11 and later) is required to have a 64-bit
> 	    # processor. This is not true of the ARM version of Darwin
> 	    # that Apple uses in portable devices.
> 	    UNAME_PROCESSOR=x86_64
1278c1319
< 	if test "$UNAME_PROCESSOR" = "x86"; then
---
> 	if test "$UNAME_PROCESSOR" = x86; then
1309c1350
< 	if test "$cputype" = "386"; then
---
> 	if test "$cputype" = 386; then
1351c1392
< 	echo ${UNAME_MACHINE}-pc-skyos`echo ${UNAME_RELEASE}` | sed -e 's/ .*$//'
---
> 	echo ${UNAME_MACHINE}-pc-skyos`echo ${UNAME_RELEASE} | sed -e 's/ .*$//'`
1362,1504c1403,1404
< esac
< 
< eval $set_cc_for_build
< cat >$dummy.c <<EOF
< #ifdef _SEQUENT_
< # include <sys/types.h>
< # include <sys/utsname.h>
< #endif
< main ()
< {
< #if defined (sony)
< #if defined (MIPSEB)
<   /* BFD wants "bsd" instead of "newsos".  Perhaps BFD should be changed,
<      I don't know....  */
<   printf ("mips-sony-bsd\n"); exit (0);
< #else
< #include <sys/param.h>
<   printf ("m68k-sony-newsos%s\n",
< #ifdef NEWSOS4
< 	"4"
< #else
< 	""
< #endif
< 	); exit (0);
< #endif
< #endif
< 
< #if defined (__arm) && defined (__acorn) && defined (__unix)
<   printf ("arm-acorn-riscix\n"); exit (0);
< #endif
< 
< #if defined (hp300) && !defined (hpux)
<   printf ("m68k-hp-bsd\n"); exit (0);
< #endif
< 
< #if defined (NeXT)
< #if !defined (__ARCHITECTURE__)
< #define __ARCHITECTURE__ "m68k"
< #endif
<   int version;
<   version=`(hostinfo | sed -n 's/.*NeXT Mach \([0-9]*\).*/\1/p') 2>/dev/null`;
<   if (version < 4)
<     printf ("%s-next-nextstep%d\n", __ARCHITECTURE__, version);
<   else
<     printf ("%s-next-openstep%d\n", __ARCHITECTURE__, version);
<   exit (0);
< #endif
< 
< #if defined (MULTIMAX) || defined (n16)
< #if defined (UMAXV)
<   printf ("ns32k-encore-sysv\n"); exit (0);
< #else
< #if defined (CMU)
<   printf ("ns32k-encore-mach\n"); exit (0);
< #else
<   printf ("ns32k-encore-bsd\n"); exit (0);
< #endif
< #endif
< #endif
< 
< #if defined (__386BSD__)
<   printf ("i386-pc-bsd\n"); exit (0);
< #endif
< 
< #if defined (sequent)
< #if defined (i386)
<   printf ("i386-sequent-dynix\n"); exit (0);
< #endif
< #if defined (ns32000)
<   printf ("ns32k-sequent-dynix\n"); exit (0);
< #endif
< #endif
< 
< #if defined (_SEQUENT_)
<     struct utsname un;
< 
<     uname(&un);
< 
<     if (strncmp(un.version, "V2", 2) == 0) {
< 	printf ("i386-sequent-ptx2\n"); exit (0);
<     }
<     if (strncmp(un.version, "V1", 2) == 0) { /* XXX is V1 correct? */
< 	printf ("i386-sequent-ptx1\n"); exit (0);
<     }
<     printf ("i386-sequent-ptx\n"); exit (0);
< 
< #endif
< 
< #if defined (vax)
< # if !defined (ultrix)
< #  include <sys/param.h>
< #  if defined (BSD)
< #   if BSD == 43
<       printf ("vax-dec-bsd4.3\n"); exit (0);
< #   else
< #    if BSD == 199006
<       printf ("vax-dec-bsd4.3reno\n"); exit (0);
< #    else
<       printf ("vax-dec-bsd\n"); exit (0);
< #    endif
< #   endif
< #  else
<     printf ("vax-dec-bsd\n"); exit (0);
< #  endif
< # else
<     printf ("vax-dec-ultrix\n"); exit (0);
< # endif
< #endif
< 
< #if defined (alliant) && defined (i860)
<   printf ("i860-alliant-bsd\n"); exit (0);
< #endif
< 
<   exit (1);
< }
< EOF
< 
< $CC_FOR_BUILD -o $dummy $dummy.c 2>/dev/null && SYSTEM_NAME=`$dummy` &&
< 	{ echo "$SYSTEM_NAME"; exit; }
< 
< # Apollos put the system type in the environment.
< 
< test -d /usr/apollo && { echo ${ISP}-apollo-${SYSTYPE}; exit; }
< 
< # Convex versions that predate uname can use getsysinfo(1)
< 
< if [ -x /usr/convex/getsysinfo ]
< then
<     case `getsysinfo -f cpu_type` in
<     c1*)
< 	echo c1-convex-bsd
< 	exit ;;
<     c2*)
< 	if getsysinfo -f scalar_acc
< 	then echo c32-convex-bsd
< 	else echo c2-convex-bsd
< 	fi
< 	exit ;;
<     c34*)
< 	echo c34-convex-bsd
< 	exit ;;
<     c38*)
< 	echo c38-convex-bsd
---
>     amd64:Isilon\ OneFS:*:*)
> 	echo x86_64-unknown-onefs
1506,1510c1406
<     c4*)
< 	echo c4-convex-bsd
< 	exit ;;
<     esac
< fi
---
> esac
1519c1415
<   http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD
---
>   http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess
1521c1417
<   http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD
---
>   http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub
diff '--color=auto' cgminer-4.9.0/config.h.in cgminer-4.10.0/config.h.in
97,99d96
< /* Define to 1 if you have the <dlfcn.h> header file. */
< #undef HAVE_DLFCN_H
< 
102a100,102
> /* Define if you have jansson >= 2.6 */
> #undef HAVE_JANSSON
> 
281,284d280
< /* Define to the sub-directory in which libtool stores uninstalled libraries.
<    */
< #undef LT_OBJDIR
< 
337a334,336
> /* Defined to 1 if Antminer S3 Bitmain support is wanted */
> #undef USE_ANT_S3
> 
346a346,351
> /* Defined to 1 if Avalon7 support is wanted */
> #undef USE_AVALON7
> 
> /* Defined to 1 if Avalon miner support is wanted */
> #undef USE_AVALON_MINER
> 
385a391,393
> /* Defined to 1 if libsystemd support is wanted */
> #undef USE_LIBSYSTEMD
> 
421,423d428
< 
< /* "WinNT version for XP+ support" */
< #undef _WIN32_WINNT
Only in cgminer-4.9.0: config.rpath
diff '--color=auto' cgminer-4.9.0/config.sub cgminer-4.10.0/config.sub
3c3
< #   Copyright 1992-2013 Free Software Foundation, Inc.
---
> #   Copyright 1992-2016 Free Software Foundation, Inc.
5c5
< timestamp='2013-08-10'
---
> timestamp='2016-03-30'
28c28
< # Please send patches with a ChangeLog entry to config-patches@gnu.org.
---
> # Please send patches to <config-patches@gnu.org>.
36c36
< # http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD
---
> # http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub
56,57c56
< Usage: $0 [OPTION] CPU-MFR-OPSYS
<        $0 [OPTION] ALIAS
---
> Usage: $0 [OPTION] CPU-MFR-OPSYS or ALIAS
71c70
< Copyright 1992-2013 Free Software Foundation, Inc.
---
> Copyright 1992-2016 Free Software Foundation, Inc.
120c119
<   knetbsd*-gnu* | netbsd*-gnu* | \
---
>   knetbsd*-gnu* | netbsd*-gnu* | netbsd*-eabi* | \
257a257
> 	| ba \
262,263c262,263
< 	| epiphany \
< 	| fido | fr30 | frv \
---
> 	| e2k | epiphany \
> 	| fido | fr30 | frv | ft32 \
267a268
> 	| k1om \
284a286
> 	| mipsisa32r6 | mipsisa32r6el \
286a289
> 	| mipsisa64r6 | mipsisa64r6el \
298,299c301
< 	| open8 \
< 	| or1k | or32 \
---
> 	| open8 | or1k | or1knd | or32 \
302a305
> 	| riscv32 | riscv64 \
305c308
< 	| sh | sh[1234] | sh[24]a | sh[24]aeb | sh[23]e | sh[34]eb | sheb | shbe | shle | sh[1234]le | sh3ele \
---
> 	| sh | sh[1234] | sh[24]a | sh[24]aeb | sh[23]e | sh[234]eb | sheb | shbe | shle | sh[1234]le | sh3ele \
312a316
> 	| visium \
327c331,334
< 	m6811 | m68hc11 | m6812 | m68hc12 | m68hcs12x | picochip)
---
> 	leon|leon[3-9])
> 		basic_machine=sparc-$basic_machine
> 		;;
> 	m6811 | m68hc11 | m6812 | m68hc12 | m68hcs12x | nvptx | picochip)
371a379
> 	| ba-* \
377c385
< 	| elxsi-* \
---
> 	| e2k-* | elxsi-* \
383a392
> 	| k1om-* \
402a412
> 	| mipsisa32r6-* | mipsisa32r6el-* \
404a415
> 	| mipsisa64r6-* | mipsisa64r6el-* \
415a427
> 	| or1k*-* \
419a432
> 	| riscv32-* | riscv64-* \
425c438
< 	| sparcv8-* | sparcv9-* | sparcv9b-* | sparcv9v-* | sv1-* | sx?-* \
---
> 	| sparcv8-* | sparcv9-* | sparcv9b-* | sparcv9v-* | sv1-* | sx*-* \
432a446
> 	| visium-* \
508a523,525
> 	asmjs)
> 		basic_machine=asmjs-unknown
> 		;;
769a787,789
> 	leon-*|leon[3-9]-*)
> 		basic_machine=sparc-`echo $basic_machine | sed 's/-.*//'`
> 		;;
824a845,848
> 	moxiebox)
> 		basic_machine=moxie-unknown
> 		os=-moxiebox
> 		;;
1357c1381
< 	      | -aos* | -aros* \
---
> 	      | -aos* | -aros* | -cloudabi* | -sortix* \
1361c1385
< 	      | -bitrig* | -openbsd* | -solidbsd* \
---
> 	      | -bitrig* | -openbsd* | -solidbsd* | -libertybsd* \
1370c1394
< 	      | -uxpv* | -beos* | -mpeix* | -udk* \
---
> 	      | -uxpv* | -beos* | -mpeix* | -udk* | -moxiebox* \
1377c1401,1402
< 	      | -skyos* | -haiku* | -rdos* | -toppers* | -drops* | -es*)
---
> 	      | -skyos* | -haiku* | -rdos* | -toppers* | -drops* | -es* \
> 	      | -onefs* | -tirtos*)
1508a1534,1535
> 	-ios)
> 		;;
1593,1595d1619
< 		os=-elf
< 		;;
< 	or1k-*)
diff '--color=auto' cgminer-4.9.0/configure cgminer-4.10.0/configure
3c3
< # Generated by GNU Autoconf 2.69 for cgminer 4.9.0.
---
> # Generated by GNU Autoconf 2.69 for cgminer 4.10.0.
201,209c201
< test \$(( 1 + 1 )) = 2 || exit 1
< 
<   test -n \"\${ZSH_VERSION+set}\${BASH_VERSION+set}\" || (
<     ECHO='\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'
<     ECHO=\$ECHO\$ECHO\$ECHO\$ECHO\$ECHO
<     ECHO=\$ECHO\$ECHO\$ECHO\$ECHO\$ECHO\$ECHO
<     PATH=/empty FPATH=/empty; export PATH FPATH
<     test \"X\`printf %s \$ECHO\`\" = \"X\$ECHO\" \\
<       || test \"X\`print -r -- \$ECHO\`\" = \"X\$ECHO\" ) || exit 1"
---
> test \$(( 1 + 1 )) = 2 || exit 1"
567,568d558
< SHELL=${CONFIG_SHELL-/bin/sh}
< 
593,594c583,584
< PACKAGE_VERSION='4.9.0'
< PACKAGE_STRING='cgminer 4.9.0'
---
> PACKAGE_VERSION='4.10.0'
> PACKAGE_STRING='cgminer 4.10.0'
655c645,648
< JANSSON_LIBS
---
> LIBSYSTEMD_LIBS
> LIBSYSTEMD_CFLAGS
> STATIC_CURL_FALSE
> STATIC_CURL_TRUE
658,659c651,652
< WANT_STATIC_LIBUSB_FALSE
< WANT_STATIC_LIBUSB_TRUE
---
> WANT_STATIC_JANSSON_FALSE
> WANT_STATIC_JANSSON_TRUE
660a654,655
> JANSSON_LIBS
> JANSSON_CFLAGS
665a661,662
> NEED_I2C_CONTEXT_FALSE
> NEED_I2C_CONTEXT_TRUE
713a711,714
> HAS_AVALON_MINER_FALSE
> HAS_AVALON_MINER_TRUE
> HAS_AVALON7_FALSE
> HAS_AVALON7_TRUE
719a721,722
> HAS_ANT_S3_FALSE
> HAS_ANT_S3_TRUE
851,868d853
< OTOOL64
< OTOOL
< LIPO
< NMEDIT
< DSYMUTIL
< MANIFEST_TOOL
< ac_ct_AR
< AR
< DLLTOOL
< OBJDUMP
< LN_S
< NM
< ac_ct_DUMPBIN
< DUMPBIN
< LD
< FGREP
< SED
< LIBTOOL
953a939
> runstatedir
979,985d964
< enable_shared
< enable_static
< with_pic
< enable_fast_install
< with_gnu_ld
< with_sysroot
< enable_libtool_lock
987a967
> enable_ants3
990a971,972
> enable_avalon7
> enable_avalon_miner
1010,1011c992
< with_system_libusb
< enable_udev
---
> with_system_jansson
1012a994
> enable_libsystemd
1027a1010,1011
> JANSSON_CFLAGS
> JANSSON_LIBS
1029,1031c1013,1016
< LIBCURL_LIBS'
< ac_subdirs_all='compat/libusb-1.0
< compat/jansson-2.6'
---
> LIBCURL_LIBS
> LIBSYSTEMD_CFLAGS
> LIBSYSTEMD_LIBS'
> ac_subdirs_all='compat/jansson-2.9'
1068a1054
> runstatedir='${localstatedir}/run'
1320a1307,1315
>   -runstatedir | --runstatedir | --runstatedi | --runstated \
>   | --runstate | --runstat | --runsta | --runst | --runs \
>   | --run | --ru | --r)
>     ac_prev=runstatedir ;;
>   -runstatedir=* | --runstatedir=* | --runstatedi=* | --runstated=* \
>   | --runstate=* | --runstat=* | --runsta=* | --runst=* | --runs=* \
>   | --run=* | --ru=* | --r=*)
>     runstatedir=$ac_optarg ;;
> 
1458c1453
< 		libdir localedir mandir
---
> 		libdir localedir mandir runstatedir
1571c1566
< \`configure' configures cgminer 4.9.0 to adapt to many kinds of systems.
---
> \`configure' configures cgminer 4.10.0 to adapt to many kinds of systems.
1610a1606
>   --runstatedir=DIR       modifiable per-process data [LOCALSTATEDIR/run]
1642c1638
<      short | recursive ) echo "Configuration of cgminer 4.9.0:";;
---
>      short | recursive ) echo "Configuration of cgminer 4.10.0:";;
1659,1663d1654
<   --enable-shared[=PKGS]  build shared libraries [default=no]
<   --enable-static[=PKGS]  build static libraries [default=yes]
<   --enable-fast-install[=PKGS]
<                           optimize for fast installation [default=yes]
<   --disable-libtool-lock  avoid locking (might break parallel builds)
1667a1659,1660
>   --enable-ants3          Compile support for Antminer S3 Bitmain
>                           STANDALONE(default disabled)
1670a1664,1665
>   --enable-avalon7        Compile support for Avalon7 (default disabled)
>   --enable-avalon-miner   Compile support for Avalon miner(default disabled)
1679c1674,1675
<   --enable-blockerupter   Compile support for BlockErupter (default disabled)
---
>   --enable-blockerupter   Compile support for BlockErupter BROKEN DRIVER
>                           (default disabled)
1699,1701c1695,1697
<   --disable-udev          Disable building libusb with udev
<   --disable-libcurl       Disable building with libcurl for getwork and GBT
<                           support
---
>   --disable-libcurl       Disable building with libcurl for GBT support
>   --enable-libsystemd     Enable building with libsystemd for watchdog and
>                           status notification support
1706,1710d1701
<   --with-pic[=PKGS]       try to use only PIC/non-PIC objects [default=use
<                           both]
<   --with-gnu-ld           assume the C compiler uses GNU ld [default=no]
<   --with-sysroot=DIR Search for dependent libraries within DIR
<                         (or the compiler's sysroot if not specified).
1712,1713c1703,1704
<   --with-system-libusb    NOT RECOMMENDED! Compile against dynamic system
<                           libusb. (Default use included static libusb)
---
>   --with-system-jansson   NOT RECOMMENDED! Compile against dynamic system
>                           jansson. (Default use included static jansson)
1731a1723,1726
>   JANSSON_CFLAGS
>               C compiler flags for JANSSON, overriding pkg-config
>   JANSSON_LIBS
>               linker flags for JANSSON, overriding pkg-config
1735a1731,1734
>   LIBSYSTEMD_CFLAGS
>               C compiler flags for LIBSYSTEMD, overriding pkg-config
>   LIBSYSTEMD_LIBS
>               linker flags for LIBSYSTEMD, overriding pkg-config
1803c1802
< cgminer configure 4.9.0
---
> cgminer configure 4.10.0
2512c2511
< It was created by cgminer $as_me 4.9.0, which was
---
> It was created by cgminer $as_me 4.10.0, which was
3014c3013
< am__api_version='1.14'
---
> am__api_version='1.15'
3186,3187c3185,3186
< # expand $ac_aux_dir to an absolute path
< am_aux_dir=`cd $ac_aux_dir && pwd`
---
> # Expand $ac_aux_dir to an absolute path.
> am_aux_dir=`cd "$ac_aux_dir" && pwd`
3206c3205
< if test x"${install_sh}" != xset; then
---
> if test x"${install_sh+set}" != xset; then
3501c3500
<  VERSION='4.9.0'
---
>  VERSION='4.10.0'
3535,3536c3534,3535
< # We need awk for the "check" target.  The system "awk" is bad on
< # some platforms.
---
> # We need awk for the "check" target (and possibly the TAP driver).  The
> # system "awk" is bad on some platforms.
3592a3592
> 
5152c5152
< #define CGMINER_MINOR_VERSION 9
---
> #define CGMINER_MINOR_VERSION 10
5160c5160
< version_info="13:0:9"
---
> version_info="14:0:10"
6082,13207d6081
< case `pwd` in
<   *\ * | *\	*)
<     { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: Libtool does not cope well with whitespace in \`pwd\`" >&5
< $as_echo "$as_me: WARNING: Libtool does not cope well with whitespace in \`pwd\`" >&2;} ;;
< esac
< 
< 
< 
< macro_version='2.4.2'
< macro_revision='1.3337'
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< ltmain="$ac_aux_dir/ltmain.sh"
< 
< # Backslashify metacharacters that are still active within
< # double-quoted strings.
< sed_quote_subst='s/\(["`$\\]\)/\\\1/g'
< 
< # Same as above, but do not quote variable references.
< double_quote_subst='s/\(["`\\]\)/\\\1/g'
< 
< # Sed substitution to delay expansion of an escaped shell variable in a
< # double_quote_subst'ed string.
< delay_variable_subst='s/\\\\\\\\\\\$/\\\\\\$/g'
< 
< # Sed substitution to delay expansion of an escaped single quote.
< delay_single_quote_subst='s/'\''/'\'\\\\\\\'\''/g'
< 
< # Sed substitution to avoid accidental globbing in evaled expressions
< no_glob_subst='s/\*/\\\*/g'
< 
< ECHO='\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'
< ECHO=$ECHO$ECHO$ECHO$ECHO$ECHO
< ECHO=$ECHO$ECHO$ECHO$ECHO$ECHO$ECHO
< 
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking how to print strings" >&5
< $as_echo_n "checking how to print strings... " >&6; }
< # Test print first, because it will be a builtin if present.
< if test "X`( print -r -- -n ) 2>/dev/null`" = X-n && \
<    test "X`print -r -- $ECHO 2>/dev/null`" = "X$ECHO"; then
<   ECHO='print -r --'
< elif test "X`printf %s $ECHO 2>/dev/null`" = "X$ECHO"; then
<   ECHO='printf %s\n'
< else
<   # Use this function as a fallback that always works.
<   func_fallback_echo ()
<   {
<     eval 'cat <<_LTECHO_EOF
< $1
< _LTECHO_EOF'
<   }
<   ECHO='func_fallback_echo'
< fi
< 
< # func_echo_all arg...
< # Invoke $ECHO with all args, space-separated.
< func_echo_all ()
< {
<     $ECHO ""
< }
< 
< case "$ECHO" in
<   printf*) { $as_echo "$as_me:${as_lineno-$LINENO}: result: printf" >&5
< $as_echo "printf" >&6; } ;;
<   print*) { $as_echo "$as_me:${as_lineno-$LINENO}: result: print -r" >&5
< $as_echo "print -r" >&6; } ;;
<   *) { $as_echo "$as_me:${as_lineno-$LINENO}: result: cat" >&5
< $as_echo "cat" >&6; } ;;
< esac
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for a sed that does not truncate output" >&5
< $as_echo_n "checking for a sed that does not truncate output... " >&6; }
< if ${ac_cv_path_SED+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<             ac_script=s/aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa/bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb/
<      for ac_i in 1 2 3 4 5 6 7; do
<        ac_script="$ac_script$as_nl$ac_script"
<      done
<      echo "$ac_script" 2>/dev/null | sed 99q >conftest.sed
<      { ac_script=; unset ac_script;}
<      if test -z "$SED"; then
<   ac_path_SED_found=false
<   # Loop through the user's path and test for each of PROGNAME-LIST
<   as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
< for as_dir in $PATH
< do
<   IFS=$as_save_IFS
<   test -z "$as_dir" && as_dir=.
<     for ac_prog in sed gsed; do
<     for ac_exec_ext in '' $ac_executable_extensions; do
<       ac_path_SED="$as_dir/$ac_prog$ac_exec_ext"
<       as_fn_executable_p "$ac_path_SED" || continue
< # Check for GNU ac_path_SED and select it if it is found.
<   # Check for GNU $ac_path_SED
< case `"$ac_path_SED" --version 2>&1` in
< *GNU*)
<   ac_cv_path_SED="$ac_path_SED" ac_path_SED_found=:;;
< *)
<   ac_count=0
<   $as_echo_n 0123456789 >"conftest.in"
<   while :
<   do
<     cat "conftest.in" "conftest.in" >"conftest.tmp"
<     mv "conftest.tmp" "conftest.in"
<     cp "conftest.in" "conftest.nl"
<     $as_echo '' >> "conftest.nl"
<     "$ac_path_SED" -f conftest.sed < "conftest.nl" >"conftest.out" 2>/dev/null || break
<     diff "conftest.out" "conftest.nl" >/dev/null 2>&1 || break
<     as_fn_arith $ac_count + 1 && ac_count=$as_val
<     if test $ac_count -gt ${ac_path_SED_max-0}; then
<       # Best one so far, save it but keep looking for a better one
<       ac_cv_path_SED="$ac_path_SED"
<       ac_path_SED_max=$ac_count
<     fi
<     # 10*(2^10) chars as input seems more than enough
<     test $ac_count -gt 10 && break
<   done
<   rm -f conftest.in conftest.tmp conftest.nl conftest.out;;
< esac
< 
<       $ac_path_SED_found && break 3
<     done
<   done
<   done
< IFS=$as_save_IFS
<   if test -z "$ac_cv_path_SED"; then
<     as_fn_error $? "no acceptable sed could be found in \$PATH" "$LINENO" 5
<   fi
< else
<   ac_cv_path_SED=$SED
< fi
< 
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_path_SED" >&5
< $as_echo "$ac_cv_path_SED" >&6; }
<  SED="$ac_cv_path_SED"
<   rm -f conftest.sed
< 
< test -z "$SED" && SED=sed
< Xsed="$SED -e 1s/^X//"
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for fgrep" >&5
< $as_echo_n "checking for fgrep... " >&6; }
< if ${ac_cv_path_FGREP+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   if echo 'ab*c' | $GREP -F 'ab*c' >/dev/null 2>&1
<    then ac_cv_path_FGREP="$GREP -F"
<    else
<      if test -z "$FGREP"; then
<   ac_path_FGREP_found=false
<   # Loop through the user's path and test for each of PROGNAME-LIST
<   as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
< for as_dir in $PATH$PATH_SEPARATOR/usr/xpg4/bin
< do
<   IFS=$as_save_IFS
<   test -z "$as_dir" && as_dir=.
<     for ac_prog in fgrep; do
<     for ac_exec_ext in '' $ac_executable_extensions; do
<       ac_path_FGREP="$as_dir/$ac_prog$ac_exec_ext"
<       as_fn_executable_p "$ac_path_FGREP" || continue
< # Check for GNU ac_path_FGREP and select it if it is found.
<   # Check for GNU $ac_path_FGREP
< case `"$ac_path_FGREP" --version 2>&1` in
< *GNU*)
<   ac_cv_path_FGREP="$ac_path_FGREP" ac_path_FGREP_found=:;;
< *)
<   ac_count=0
<   $as_echo_n 0123456789 >"conftest.in"
<   while :
<   do
<     cat "conftest.in" "conftest.in" >"conftest.tmp"
<     mv "conftest.tmp" "conftest.in"
<     cp "conftest.in" "conftest.nl"
<     $as_echo 'FGREP' >> "conftest.nl"
<     "$ac_path_FGREP" FGREP < "conftest.nl" >"conftest.out" 2>/dev/null || break
<     diff "conftest.out" "conftest.nl" >/dev/null 2>&1 || break
<     as_fn_arith $ac_count + 1 && ac_count=$as_val
<     if test $ac_count -gt ${ac_path_FGREP_max-0}; then
<       # Best one so far, save it but keep looking for a better one
<       ac_cv_path_FGREP="$ac_path_FGREP"
<       ac_path_FGREP_max=$ac_count
<     fi
<     # 10*(2^10) chars as input seems more than enough
<     test $ac_count -gt 10 && break
<   done
<   rm -f conftest.in conftest.tmp conftest.nl conftest.out;;
< esac
< 
<       $ac_path_FGREP_found && break 3
<     done
<   done
<   done
< IFS=$as_save_IFS
<   if test -z "$ac_cv_path_FGREP"; then
<     as_fn_error $? "no acceptable fgrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" "$LINENO" 5
<   fi
< else
<   ac_cv_path_FGREP=$FGREP
< fi
< 
<    fi
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_path_FGREP" >&5
< $as_echo "$ac_cv_path_FGREP" >&6; }
<  FGREP="$ac_cv_path_FGREP"
< 
< 
< test -z "$GREP" && GREP=grep
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< # Check whether --with-gnu-ld was given.
< if test "${with_gnu_ld+set}" = set; then :
<   withval=$with_gnu_ld; test "$withval" = no || with_gnu_ld=yes
< else
<   with_gnu_ld=no
< fi
< 
< ac_prog=ld
< if test "$GCC" = yes; then
<   # Check if gcc -print-prog-name=ld gives a path.
<   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for ld used by $CC" >&5
< $as_echo_n "checking for ld used by $CC... " >&6; }
<   case $host in
<   *-*-mingw*)
<     # gcc leaves a trailing carriage return which upsets mingw
<     ac_prog=`($CC -print-prog-name=ld) 2>&5 | tr -d '\015'` ;;
<   *)
<     ac_prog=`($CC -print-prog-name=ld) 2>&5` ;;
<   esac
<   case $ac_prog in
<     # Accept absolute paths.
<     [\\/]* | ?:[\\/]*)
<       re_direlt='/[^/][^/]*/\.\./'
<       # Canonicalize the pathname of ld
<       ac_prog=`$ECHO "$ac_prog"| $SED 's%\\\\%/%g'`
<       while $ECHO "$ac_prog" | $GREP "$re_direlt" > /dev/null 2>&1; do
< 	ac_prog=`$ECHO $ac_prog| $SED "s%$re_direlt%/%"`
<       done
<       test -z "$LD" && LD="$ac_prog"
<       ;;
<   "")
<     # If it fails, then pretend we aren't using GCC.
<     ac_prog=ld
<     ;;
<   *)
<     # If it is relative, then search for the first ld in PATH.
<     with_gnu_ld=unknown
<     ;;
<   esac
< elif test "$with_gnu_ld" = yes; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for GNU ld" >&5
< $as_echo_n "checking for GNU ld... " >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for non-GNU ld" >&5
< $as_echo_n "checking for non-GNU ld... " >&6; }
< fi
< if ${lt_cv_path_LD+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   if test -z "$LD"; then
<   lt_save_ifs="$IFS"; IFS=$PATH_SEPARATOR
<   for ac_dir in $PATH; do
<     IFS="$lt_save_ifs"
<     test -z "$ac_dir" && ac_dir=.
<     if test -f "$ac_dir/$ac_prog" || test -f "$ac_dir/$ac_prog$ac_exeext"; then
<       lt_cv_path_LD="$ac_dir/$ac_prog"
<       # Check to see if the program is GNU ld.  I'd rather use --version,
<       # but apparently some variants of GNU ld only accept -v.
<       # Break only if it was the GNU/non-GNU ld that we prefer.
<       case `"$lt_cv_path_LD" -v 2>&1 </dev/null` in
<       *GNU* | *'with BFD'*)
< 	test "$with_gnu_ld" != no && break
< 	;;
<       *)
< 	test "$with_gnu_ld" != yes && break
< 	;;
<       esac
<     fi
<   done
<   IFS="$lt_save_ifs"
< else
<   lt_cv_path_LD="$LD" # Let the user override the test with a path.
< fi
< fi
< 
< LD="$lt_cv_path_LD"
< if test -n "$LD"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $LD" >&5
< $as_echo "$LD" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
< $as_echo "no" >&6; }
< fi
< test -z "$LD" && as_fn_error $? "no acceptable ld found in \$PATH" "$LINENO" 5
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking if the linker ($LD) is GNU ld" >&5
< $as_echo_n "checking if the linker ($LD) is GNU ld... " >&6; }
< if ${lt_cv_prog_gnu_ld+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   # I'd rather use --version here, but apparently some GNU lds only accept -v.
< case `$LD -v 2>&1 </dev/null` in
< *GNU* | *'with BFD'*)
<   lt_cv_prog_gnu_ld=yes
<   ;;
< *)
<   lt_cv_prog_gnu_ld=no
<   ;;
< esac
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_gnu_ld" >&5
< $as_echo "$lt_cv_prog_gnu_ld" >&6; }
< with_gnu_ld=$lt_cv_prog_gnu_ld
< 
< 
< 
< 
< 
< 
< 
< 
< 
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for BSD- or MS-compatible name lister (nm)" >&5
< $as_echo_n "checking for BSD- or MS-compatible name lister (nm)... " >&6; }
< if ${lt_cv_path_NM+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   if test -n "$NM"; then
<   # Let the user override the test.
<   lt_cv_path_NM="$NM"
< else
<   lt_nm_to_check="${ac_tool_prefix}nm"
<   if test -n "$ac_tool_prefix" && test "$build" = "$host"; then
<     lt_nm_to_check="$lt_nm_to_check nm"
<   fi
<   for lt_tmp_nm in $lt_nm_to_check; do
<     lt_save_ifs="$IFS"; IFS=$PATH_SEPARATOR
<     for ac_dir in $PATH /usr/ccs/bin/elf /usr/ccs/bin /usr/ucb /bin; do
<       IFS="$lt_save_ifs"
<       test -z "$ac_dir" && ac_dir=.
<       tmp_nm="$ac_dir/$lt_tmp_nm"
<       if test -f "$tmp_nm" || test -f "$tmp_nm$ac_exeext" ; then
< 	# Check to see if the nm accepts a BSD-compat flag.
< 	# Adding the `sed 1q' prevents false positives on HP-UX, which says:
< 	#   nm: unknown option "B" ignored
< 	# Tru64's nm complains that /dev/null is an invalid object file
< 	case `"$tmp_nm" -B /dev/null 2>&1 | sed '1q'` in
< 	*/dev/null* | *'Invalid file or object type'*)
< 	  lt_cv_path_NM="$tmp_nm -B"
< 	  break
< 	  ;;
< 	*)
< 	  case `"$tmp_nm" -p /dev/null 2>&1 | sed '1q'` in
< 	  */dev/null*)
< 	    lt_cv_path_NM="$tmp_nm -p"
< 	    break
< 	    ;;
< 	  *)
< 	    lt_cv_path_NM=${lt_cv_path_NM="$tmp_nm"} # keep the first match, but
< 	    continue # so that we can try to find one that supports BSD flags
< 	    ;;
< 	  esac
< 	  ;;
< 	esac
<       fi
<     done
<     IFS="$lt_save_ifs"
<   done
<   : ${lt_cv_path_NM=no}
< fi
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_path_NM" >&5
< $as_echo "$lt_cv_path_NM" >&6; }
< if test "$lt_cv_path_NM" != "no"; then
<   NM="$lt_cv_path_NM"
< else
<   # Didn't find any BSD compatible name lister, look for dumpbin.
<   if test -n "$DUMPBIN"; then :
<     # Let the user override the test.
<   else
<     if test -n "$ac_tool_prefix"; then
<   for ac_prog in dumpbin "link -dump"
<   do
<     # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
< set dummy $ac_tool_prefix$ac_prog; ac_word=$2
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
< $as_echo_n "checking for $ac_word... " >&6; }
< if ${ac_cv_prog_DUMPBIN+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   if test -n "$DUMPBIN"; then
<   ac_cv_prog_DUMPBIN="$DUMPBIN" # Let the user override the test.
< else
< as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
< for as_dir in $PATH
< do
<   IFS=$as_save_IFS
<   test -z "$as_dir" && as_dir=.
<     for ac_exec_ext in '' $ac_executable_extensions; do
<   if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
<     ac_cv_prog_DUMPBIN="$ac_tool_prefix$ac_prog"
<     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
<     break 2
<   fi
< done
<   done
< IFS=$as_save_IFS
< 
< fi
< fi
< DUMPBIN=$ac_cv_prog_DUMPBIN
< if test -n "$DUMPBIN"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $DUMPBIN" >&5
< $as_echo "$DUMPBIN" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
< $as_echo "no" >&6; }
< fi
< 
< 
<     test -n "$DUMPBIN" && break
<   done
< fi
< if test -z "$DUMPBIN"; then
<   ac_ct_DUMPBIN=$DUMPBIN
<   for ac_prog in dumpbin "link -dump"
< do
<   # Extract the first word of "$ac_prog", so it can be a program name with args.
< set dummy $ac_prog; ac_word=$2
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
< $as_echo_n "checking for $ac_word... " >&6; }
< if ${ac_cv_prog_ac_ct_DUMPBIN+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   if test -n "$ac_ct_DUMPBIN"; then
<   ac_cv_prog_ac_ct_DUMPBIN="$ac_ct_DUMPBIN" # Let the user override the test.
< else
< as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
< for as_dir in $PATH
< do
<   IFS=$as_save_IFS
<   test -z "$as_dir" && as_dir=.
<     for ac_exec_ext in '' $ac_executable_extensions; do
<   if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
<     ac_cv_prog_ac_ct_DUMPBIN="$ac_prog"
<     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
<     break 2
<   fi
< done
<   done
< IFS=$as_save_IFS
< 
< fi
< fi
< ac_ct_DUMPBIN=$ac_cv_prog_ac_ct_DUMPBIN
< if test -n "$ac_ct_DUMPBIN"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_DUMPBIN" >&5
< $as_echo "$ac_ct_DUMPBIN" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
< $as_echo "no" >&6; }
< fi
< 
< 
<   test -n "$ac_ct_DUMPBIN" && break
< done
< 
<   if test "x$ac_ct_DUMPBIN" = x; then
<     DUMPBIN=":"
<   else
<     case $cross_compiling:$ac_tool_warned in
< yes:)
< { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
< $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
< ac_tool_warned=yes ;;
< esac
<     DUMPBIN=$ac_ct_DUMPBIN
<   fi
< fi
< 
<     case `$DUMPBIN -symbols /dev/null 2>&1 | sed '1q'` in
<     *COFF*)
<       DUMPBIN="$DUMPBIN -symbols"
<       ;;
<     *)
<       DUMPBIN=:
<       ;;
<     esac
<   fi
< 
<   if test "$DUMPBIN" != ":"; then
<     NM="$DUMPBIN"
<   fi
< fi
< test -z "$NM" && NM=nm
< 
< 
< 
< 
< 
< 
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking the name lister ($NM) interface" >&5
< $as_echo_n "checking the name lister ($NM) interface... " >&6; }
< if ${lt_cv_nm_interface+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   lt_cv_nm_interface="BSD nm"
<   echo "int some_variable = 0;" > conftest.$ac_ext
<   (eval echo "\"\$as_me:$LINENO: $ac_compile\"" >&5)
<   (eval "$ac_compile" 2>conftest.err)
<   cat conftest.err >&5
<   (eval echo "\"\$as_me:$LINENO: $NM \\\"conftest.$ac_objext\\\"\"" >&5)
<   (eval "$NM \"conftest.$ac_objext\"" 2>conftest.err > conftest.out)
<   cat conftest.err >&5
<   (eval echo "\"\$as_me:$LINENO: output\"" >&5)
<   cat conftest.out >&5
<   if $GREP 'External.*some_variable' conftest.out > /dev/null; then
<     lt_cv_nm_interface="MS dumpbin"
<   fi
<   rm -f conftest*
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_nm_interface" >&5
< $as_echo "$lt_cv_nm_interface" >&6; }
< 
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether ln -s works" >&5
< $as_echo_n "checking whether ln -s works... " >&6; }
< LN_S=$as_ln_s
< if test "$LN_S" = "ln -s"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
< $as_echo "yes" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no, using $LN_S" >&5
< $as_echo "no, using $LN_S" >&6; }
< fi
< 
< # find the maximum length of command line arguments
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking the maximum length of command line arguments" >&5
< $as_echo_n "checking the maximum length of command line arguments... " >&6; }
< if ${lt_cv_sys_max_cmd_len+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<     i=0
<   teststring="ABCD"
< 
<   case $build_os in
<   msdosdjgpp*)
<     # On DJGPP, this test can blow up pretty badly due to problems in libc
<     # (any single argument exceeding 2000 bytes causes a buffer overrun
<     # during glob expansion).  Even if it were fixed, the result of this
<     # check would be larger than it should be.
<     lt_cv_sys_max_cmd_len=12288;    # 12K is about right
<     ;;
< 
<   gnu*)
<     # Under GNU Hurd, this test is not required because there is
<     # no limit to the length of command line arguments.
<     # Libtool will interpret -1 as no limit whatsoever
<     lt_cv_sys_max_cmd_len=-1;
<     ;;
< 
<   cygwin* | mingw* | cegcc*)
<     # On Win9x/ME, this test blows up -- it succeeds, but takes
<     # about 5 minutes as the teststring grows exponentially.
<     # Worse, since 9x/ME are not pre-emptively multitasking,
<     # you end up with a "frozen" computer, even though with patience
<     # the test eventually succeeds (with a max line length of 256k).
<     # Instead, let's just punt: use the minimum linelength reported by
<     # all of the supported platforms: 8192 (on NT/2K/XP).
<     lt_cv_sys_max_cmd_len=8192;
<     ;;
< 
<   mint*)
<     # On MiNT this can take a long time and run out of memory.
<     lt_cv_sys_max_cmd_len=8192;
<     ;;
< 
<   amigaos*)
<     # On AmigaOS with pdksh, this test takes hours, literally.
<     # So we just punt and use a minimum line length of 8192.
<     lt_cv_sys_max_cmd_len=8192;
<     ;;
< 
<   netbsd* | freebsd* | openbsd* | darwin* | dragonfly*)
<     # This has been around since 386BSD, at least.  Likely further.
<     if test -x /sbin/sysctl; then
<       lt_cv_sys_max_cmd_len=`/sbin/sysctl -n kern.argmax`
<     elif test -x /usr/sbin/sysctl; then
<       lt_cv_sys_max_cmd_len=`/usr/sbin/sysctl -n kern.argmax`
<     else
<       lt_cv_sys_max_cmd_len=65536	# usable default for all BSDs
<     fi
<     # And add a safety zone
<     lt_cv_sys_max_cmd_len=`expr $lt_cv_sys_max_cmd_len \/ 4`
<     lt_cv_sys_max_cmd_len=`expr $lt_cv_sys_max_cmd_len \* 3`
<     ;;
< 
<   interix*)
<     # We know the value 262144 and hardcode it with a safety zone (like BSD)
<     lt_cv_sys_max_cmd_len=196608
<     ;;
< 
<   os2*)
<     # The test takes a long time on OS/2.
<     lt_cv_sys_max_cmd_len=8192
<     ;;
< 
<   osf*)
<     # Dr. Hans Ekkehard Plesser reports seeing a kernel panic running configure
<     # due to this test when exec_disable_arg_limit is 1 on Tru64. It is not
<     # nice to cause kernel panics so lets avoid the loop below.
<     # First set a reasonable default.
<     lt_cv_sys_max_cmd_len=16384
<     #
<     if test -x /sbin/sysconfig; then
<       case `/sbin/sysconfig -q proc exec_disable_arg_limit` in
<         *1*) lt_cv_sys_max_cmd_len=-1 ;;
<       esac
<     fi
<     ;;
<   sco3.2v5*)
<     lt_cv_sys_max_cmd_len=102400
<     ;;
<   sysv5* | sco5v6* | sysv4.2uw2*)
<     kargmax=`grep ARG_MAX /etc/conf/cf.d/stune 2>/dev/null`
<     if test -n "$kargmax"; then
<       lt_cv_sys_max_cmd_len=`echo $kargmax | sed 's/.*[	 ]//'`
<     else
<       lt_cv_sys_max_cmd_len=32768
<     fi
<     ;;
<   *)
<     lt_cv_sys_max_cmd_len=`(getconf ARG_MAX) 2> /dev/null`
<     if test -n "$lt_cv_sys_max_cmd_len" && \
< 	test undefined != "$lt_cv_sys_max_cmd_len"; then
<       lt_cv_sys_max_cmd_len=`expr $lt_cv_sys_max_cmd_len \/ 4`
<       lt_cv_sys_max_cmd_len=`expr $lt_cv_sys_max_cmd_len \* 3`
<     else
<       # Make teststring a little bigger before we do anything with it.
<       # a 1K string should be a reasonable start.
<       for i in 1 2 3 4 5 6 7 8 ; do
<         teststring=$teststring$teststring
<       done
<       SHELL=${SHELL-${CONFIG_SHELL-/bin/sh}}
<       # If test is not a shell built-in, we'll probably end up computing a
<       # maximum length that is only half of the actual maximum length, but
<       # we can't tell.
<       while { test "X"`env echo "$teststring$teststring" 2>/dev/null` \
< 	         = "X$teststring$teststring"; } >/dev/null 2>&1 &&
< 	      test $i != 17 # 1/2 MB should be enough
<       do
<         i=`expr $i + 1`
<         teststring=$teststring$teststring
<       done
<       # Only check the string length outside the loop.
<       lt_cv_sys_max_cmd_len=`expr "X$teststring" : ".*" 2>&1`
<       teststring=
<       # Add a significant safety factor because C++ compilers can tack on
<       # massive amounts of additional arguments before passing them to the
<       # linker.  It appears as though 1/2 is a usable value.
<       lt_cv_sys_max_cmd_len=`expr $lt_cv_sys_max_cmd_len \/ 2`
<     fi
<     ;;
<   esac
< 
< fi
< 
< if test -n $lt_cv_sys_max_cmd_len ; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_sys_max_cmd_len" >&5
< $as_echo "$lt_cv_sys_max_cmd_len" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: none" >&5
< $as_echo "none" >&6; }
< fi
< max_cmd_len=$lt_cv_sys_max_cmd_len
< 
< 
< 
< 
< 
< 
< : ${CP="cp -f"}
< : ${MV="mv -f"}
< : ${RM="rm -f"}
< 
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the shell understands some XSI constructs" >&5
< $as_echo_n "checking whether the shell understands some XSI constructs... " >&6; }
< # Try some XSI features
< xsi_shell=no
< ( _lt_dummy="a/b/c"
<   test "${_lt_dummy##*/},${_lt_dummy%/*},${_lt_dummy#??}"${_lt_dummy%"$_lt_dummy"}, \
<       = c,a/b,b/c, \
<     && eval 'test $(( 1 + 1 )) -eq 2 \
<     && test "${#_lt_dummy}" -eq 5' ) >/dev/null 2>&1 \
<   && xsi_shell=yes
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $xsi_shell" >&5
< $as_echo "$xsi_shell" >&6; }
< 
< 
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the shell understands \"+=\"" >&5
< $as_echo_n "checking whether the shell understands \"+=\"... " >&6; }
< lt_shell_append=no
< ( foo=bar; set foo baz; eval "$1+=\$2" && test "$foo" = barbaz ) \
<     >/dev/null 2>&1 \
<   && lt_shell_append=yes
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_shell_append" >&5
< $as_echo "$lt_shell_append" >&6; }
< 
< 
< if ( (MAIL=60; unset MAIL) || exit) >/dev/null 2>&1; then
<   lt_unset=unset
< else
<   lt_unset=false
< fi
< 
< 
< 
< 
< 
< # test EBCDIC or ASCII
< case `echo X|tr X '\101'` in
<  A) # ASCII based system
<     # \n is not interpreted correctly by Solaris 8 /usr/ucb/tr
<   lt_SP2NL='tr \040 \012'
<   lt_NL2SP='tr \015\012 \040\040'
<   ;;
<  *) # EBCDIC based system
<   lt_SP2NL='tr \100 \n'
<   lt_NL2SP='tr \r\n \100\100'
<   ;;
< esac
< 
< 
< 
< 
< 
< 
< 
< 
< 
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking how to convert $build file names to $host format" >&5
< $as_echo_n "checking how to convert $build file names to $host format... " >&6; }
< if ${lt_cv_to_host_file_cmd+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   case $host in
<   *-*-mingw* )
<     case $build in
<       *-*-mingw* ) # actually msys
<         lt_cv_to_host_file_cmd=func_convert_file_msys_to_w32
<         ;;
<       *-*-cygwin* )
<         lt_cv_to_host_file_cmd=func_convert_file_cygwin_to_w32
<         ;;
<       * ) # otherwise, assume *nix
<         lt_cv_to_host_file_cmd=func_convert_file_nix_to_w32
<         ;;
<     esac
<     ;;
<   *-*-cygwin* )
<     case $build in
<       *-*-mingw* ) # actually msys
<         lt_cv_to_host_file_cmd=func_convert_file_msys_to_cygwin
<         ;;
<       *-*-cygwin* )
<         lt_cv_to_host_file_cmd=func_convert_file_noop
<         ;;
<       * ) # otherwise, assume *nix
<         lt_cv_to_host_file_cmd=func_convert_file_nix_to_cygwin
<         ;;
<     esac
<     ;;
<   * ) # unhandled hosts (and "normal" native builds)
<     lt_cv_to_host_file_cmd=func_convert_file_noop
<     ;;
< esac
< 
< fi
< 
< to_host_file_cmd=$lt_cv_to_host_file_cmd
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_to_host_file_cmd" >&5
< $as_echo "$lt_cv_to_host_file_cmd" >&6; }
< 
< 
< 
< 
< 
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking how to convert $build file names to toolchain format" >&5
< $as_echo_n "checking how to convert $build file names to toolchain format... " >&6; }
< if ${lt_cv_to_tool_file_cmd+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   #assume ordinary cross tools, or native build.
< lt_cv_to_tool_file_cmd=func_convert_file_noop
< case $host in
<   *-*-mingw* )
<     case $build in
<       *-*-mingw* ) # actually msys
<         lt_cv_to_tool_file_cmd=func_convert_file_msys_to_w32
<         ;;
<     esac
<     ;;
< esac
< 
< fi
< 
< to_tool_file_cmd=$lt_cv_to_tool_file_cmd
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_to_tool_file_cmd" >&5
< $as_echo "$lt_cv_to_tool_file_cmd" >&6; }
< 
< 
< 
< 
< 
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $LD option to reload object files" >&5
< $as_echo_n "checking for $LD option to reload object files... " >&6; }
< if ${lt_cv_ld_reload_flag+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   lt_cv_ld_reload_flag='-r'
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_ld_reload_flag" >&5
< $as_echo "$lt_cv_ld_reload_flag" >&6; }
< reload_flag=$lt_cv_ld_reload_flag
< case $reload_flag in
< "" | " "*) ;;
< *) reload_flag=" $reload_flag" ;;
< esac
< reload_cmds='$LD$reload_flag -o $output$reload_objs'
< case $host_os in
<   cygwin* | mingw* | pw32* | cegcc*)
<     if test "$GCC" != yes; then
<       reload_cmds=false
<     fi
<     ;;
<   darwin*)
<     if test "$GCC" = yes; then
<       reload_cmds='$LTCC $LTCFLAGS -nostdlib ${wl}-r -o $output$reload_objs'
<     else
<       reload_cmds='$LD$reload_flag -o $output$reload_objs'
<     fi
<     ;;
< esac
< 
< 
< 
< 
< 
< 
< 
< 
< 
< if test -n "$ac_tool_prefix"; then
<   # Extract the first word of "${ac_tool_prefix}objdump", so it can be a program name with args.
< set dummy ${ac_tool_prefix}objdump; ac_word=$2
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
< $as_echo_n "checking for $ac_word... " >&6; }
< if ${ac_cv_prog_OBJDUMP+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   if test -n "$OBJDUMP"; then
<   ac_cv_prog_OBJDUMP="$OBJDUMP" # Let the user override the test.
< else
< as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
< for as_dir in $PATH
< do
<   IFS=$as_save_IFS
<   test -z "$as_dir" && as_dir=.
<     for ac_exec_ext in '' $ac_executable_extensions; do
<   if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
<     ac_cv_prog_OBJDUMP="${ac_tool_prefix}objdump"
<     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
<     break 2
<   fi
< done
<   done
< IFS=$as_save_IFS
< 
< fi
< fi
< OBJDUMP=$ac_cv_prog_OBJDUMP
< if test -n "$OBJDUMP"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $OBJDUMP" >&5
< $as_echo "$OBJDUMP" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
< $as_echo "no" >&6; }
< fi
< 
< 
< fi
< if test -z "$ac_cv_prog_OBJDUMP"; then
<   ac_ct_OBJDUMP=$OBJDUMP
<   # Extract the first word of "objdump", so it can be a program name with args.
< set dummy objdump; ac_word=$2
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
< $as_echo_n "checking for $ac_word... " >&6; }
< if ${ac_cv_prog_ac_ct_OBJDUMP+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   if test -n "$ac_ct_OBJDUMP"; then
<   ac_cv_prog_ac_ct_OBJDUMP="$ac_ct_OBJDUMP" # Let the user override the test.
< else
< as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
< for as_dir in $PATH
< do
<   IFS=$as_save_IFS
<   test -z "$as_dir" && as_dir=.
<     for ac_exec_ext in '' $ac_executable_extensions; do
<   if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
<     ac_cv_prog_ac_ct_OBJDUMP="objdump"
<     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
<     break 2
<   fi
< done
<   done
< IFS=$as_save_IFS
< 
< fi
< fi
< ac_ct_OBJDUMP=$ac_cv_prog_ac_ct_OBJDUMP
< if test -n "$ac_ct_OBJDUMP"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_OBJDUMP" >&5
< $as_echo "$ac_ct_OBJDUMP" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
< $as_echo "no" >&6; }
< fi
< 
<   if test "x$ac_ct_OBJDUMP" = x; then
<     OBJDUMP="false"
<   else
<     case $cross_compiling:$ac_tool_warned in
< yes:)
< { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
< $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
< ac_tool_warned=yes ;;
< esac
<     OBJDUMP=$ac_ct_OBJDUMP
<   fi
< else
<   OBJDUMP="$ac_cv_prog_OBJDUMP"
< fi
< 
< test -z "$OBJDUMP" && OBJDUMP=objdump
< 
< 
< 
< 
< 
< 
< 
< 
< 
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking how to recognize dependent libraries" >&5
< $as_echo_n "checking how to recognize dependent libraries... " >&6; }
< if ${lt_cv_deplibs_check_method+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   lt_cv_file_magic_cmd='$MAGIC_CMD'
< lt_cv_file_magic_test_file=
< lt_cv_deplibs_check_method='unknown'
< # Need to set the preceding variable on all platforms that support
< # interlibrary dependencies.
< # 'none' -- dependencies not supported.
< # `unknown' -- same as none, but documents that we really don't know.
< # 'pass_all' -- all dependencies passed with no checks.
< # 'test_compile' -- check by making test program.
< # 'file_magic [[regex]]' -- check by looking for files in library path
< # which responds to the $file_magic_cmd with a given extended regex.
< # If you have `file' or equivalent on your system and you're not sure
< # whether `pass_all' will *always* work, you probably want this one.
< 
< case $host_os in
< aix[4-9]*)
<   lt_cv_deplibs_check_method=pass_all
<   ;;
< 
< beos*)
<   lt_cv_deplibs_check_method=pass_all
<   ;;
< 
< bsdi[45]*)
<   lt_cv_deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [ML]SB (shared object|dynamic lib)'
<   lt_cv_file_magic_cmd='/usr/bin/file -L'
<   lt_cv_file_magic_test_file=/shlib/libc.so
<   ;;
< 
< cygwin*)
<   # func_win32_libid is a shell function defined in ltmain.sh
<   lt_cv_deplibs_check_method='file_magic ^x86 archive import|^x86 DLL'
<   lt_cv_file_magic_cmd='func_win32_libid'
<   ;;
< 
< mingw* | pw32*)
<   # Base MSYS/MinGW do not provide the 'file' command needed by
<   # func_win32_libid shell function, so use a weaker test based on 'objdump',
<   # unless we find 'file', for example because we are cross-compiling.
<   # func_win32_libid assumes BSD nm, so disallow it if using MS dumpbin.
<   if ( test "$lt_cv_nm_interface" = "BSD nm" && file / ) >/dev/null 2>&1; then
<     lt_cv_deplibs_check_method='file_magic ^x86 archive import|^x86 DLL'
<     lt_cv_file_magic_cmd='func_win32_libid'
<   else
<     # Keep this pattern in sync with the one in func_win32_libid.
<     lt_cv_deplibs_check_method='file_magic file format (pei*-i386(.*architecture: i386)?|pe-arm-wince|pe-x86-64)'
<     lt_cv_file_magic_cmd='$OBJDUMP -f'
<   fi
<   ;;
< 
< cegcc*)
<   # use the weaker test based on 'objdump'. See mingw*.
<   lt_cv_deplibs_check_method='file_magic file format pe-arm-.*little(.*architecture: arm)?'
<   lt_cv_file_magic_cmd='$OBJDUMP -f'
<   ;;
< 
< darwin* | rhapsody*)
<   lt_cv_deplibs_check_method=pass_all
<   ;;
< 
< freebsd* | dragonfly*)
<   if echo __ELF__ | $CC -E - | $GREP __ELF__ > /dev/null; then
<     case $host_cpu in
<     i*86 )
<       # Not sure whether the presence of OpenBSD here was a mistake.
<       # Let's accept both of them until this is cleared up.
<       lt_cv_deplibs_check_method='file_magic (FreeBSD|OpenBSD|DragonFly)/i[3-9]86 (compact )?demand paged shared library'
<       lt_cv_file_magic_cmd=/usr/bin/file
<       lt_cv_file_magic_test_file=`echo /usr/lib/libc.so.*`
<       ;;
<     esac
<   else
<     lt_cv_deplibs_check_method=pass_all
<   fi
<   ;;
< 
< haiku*)
<   lt_cv_deplibs_check_method=pass_all
<   ;;
< 
< hpux10.20* | hpux11*)
<   lt_cv_file_magic_cmd=/usr/bin/file
<   case $host_cpu in
<   ia64*)
<     lt_cv_deplibs_check_method='file_magic (s[0-9][0-9][0-9]|ELF-[0-9][0-9]) shared object file - IA64'
<     lt_cv_file_magic_test_file=/usr/lib/hpux32/libc.so
<     ;;
<   hppa*64*)
<     lt_cv_deplibs_check_method='file_magic (s[0-9][0-9][0-9]|ELF[ -][0-9][0-9])(-bit)?( [LM]SB)? shared object( file)?[, -]* PA-RISC [0-9]\.[0-9]'
<     lt_cv_file_magic_test_file=/usr/lib/pa20_64/libc.sl
<     ;;
<   *)
<     lt_cv_deplibs_check_method='file_magic (s[0-9][0-9][0-9]|PA-RISC[0-9]\.[0-9]) shared library'
<     lt_cv_file_magic_test_file=/usr/lib/libc.sl
<     ;;
<   esac
<   ;;
< 
< interix[3-9]*)
<   # PIC code is broken on Interix 3.x, that's why |\.a not |_pic\.a here
<   lt_cv_deplibs_check_method='match_pattern /lib[^/]+(\.so|\.a)$'
<   ;;
< 
< irix5* | irix6* | nonstopux*)
<   case $LD in
<   *-32|*"-32 ") libmagic=32-bit;;
<   *-n32|*"-n32 ") libmagic=N32;;
<   *-64|*"-64 ") libmagic=64-bit;;
<   *) libmagic=never-match;;
<   esac
<   lt_cv_deplibs_check_method=pass_all
<   ;;
< 
< # This must be glibc/ELF.
< linux* | k*bsd*-gnu | kopensolaris*-gnu | gnu*)
<   lt_cv_deplibs_check_method=pass_all
<   ;;
< 
< netbsd* | netbsdelf*-gnu)
<   if echo __ELF__ | $CC -E - | $GREP __ELF__ > /dev/null; then
<     lt_cv_deplibs_check_method='match_pattern /lib[^/]+(\.so\.[0-9]+\.[0-9]+|_pic\.a)$'
<   else
<     lt_cv_deplibs_check_method='match_pattern /lib[^/]+(\.so|_pic\.a)$'
<   fi
<   ;;
< 
< newos6*)
<   lt_cv_deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [ML]SB (executable|dynamic lib)'
<   lt_cv_file_magic_cmd=/usr/bin/file
<   lt_cv_file_magic_test_file=/usr/lib/libnls.so
<   ;;
< 
< *nto* | *qnx*)
<   lt_cv_deplibs_check_method=pass_all
<   ;;
< 
< openbsd*)
<   if test -z "`echo __ELF__ | $CC -E - | $GREP __ELF__`" || test "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
<     lt_cv_deplibs_check_method='match_pattern /lib[^/]+(\.so\.[0-9]+\.[0-9]+|\.so|_pic\.a)$'
<   else
<     lt_cv_deplibs_check_method='match_pattern /lib[^/]+(\.so\.[0-9]+\.[0-9]+|_pic\.a)$'
<   fi
<   ;;
< 
< osf3* | osf4* | osf5*)
<   lt_cv_deplibs_check_method=pass_all
<   ;;
< 
< rdos*)
<   lt_cv_deplibs_check_method=pass_all
<   ;;
< 
< solaris*)
<   lt_cv_deplibs_check_method=pass_all
<   ;;
< 
< sysv5* | sco3.2v5* | sco5v6* | unixware* | OpenUNIX* | sysv4*uw2*)
<   lt_cv_deplibs_check_method=pass_all
<   ;;
< 
< sysv4 | sysv4.3*)
<   case $host_vendor in
<   motorola)
<     lt_cv_deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [ML]SB (shared object|dynamic lib) M[0-9][0-9]* Version [0-9]'
<     lt_cv_file_magic_test_file=`echo /usr/lib/libc.so*`
<     ;;
<   ncr)
<     lt_cv_deplibs_check_method=pass_all
<     ;;
<   sequent)
<     lt_cv_file_magic_cmd='/bin/file'
<     lt_cv_deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [LM]SB (shared object|dynamic lib )'
<     ;;
<   sni)
<     lt_cv_file_magic_cmd='/bin/file'
<     lt_cv_deplibs_check_method="file_magic ELF [0-9][0-9]*-bit [LM]SB dynamic lib"
<     lt_cv_file_magic_test_file=/lib/libc.so
<     ;;
<   siemens)
<     lt_cv_deplibs_check_method=pass_all
<     ;;
<   pc)
<     lt_cv_deplibs_check_method=pass_all
<     ;;
<   esac
<   ;;
< 
< tpf*)
<   lt_cv_deplibs_check_method=pass_all
<   ;;
< esac
< 
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_deplibs_check_method" >&5
< $as_echo "$lt_cv_deplibs_check_method" >&6; }
< 
< file_magic_glob=
< want_nocaseglob=no
< if test "$build" = "$host"; then
<   case $host_os in
<   mingw* | pw32*)
<     if ( shopt | grep nocaseglob ) >/dev/null 2>&1; then
<       want_nocaseglob=yes
<     else
<       file_magic_glob=`echo aAbBcCdDeEfFgGhHiIjJkKlLmMnNoOpPqQrRsStTuUvVwWxXyYzZ | $SED -e "s/\(..\)/s\/[\1]\/[\1]\/g;/g"`
<     fi
<     ;;
<   esac
< fi
< 
< file_magic_cmd=$lt_cv_file_magic_cmd
< deplibs_check_method=$lt_cv_deplibs_check_method
< test -z "$deplibs_check_method" && deplibs_check_method=unknown
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< if test -n "$ac_tool_prefix"; then
<   # Extract the first word of "${ac_tool_prefix}dlltool", so it can be a program name with args.
< set dummy ${ac_tool_prefix}dlltool; ac_word=$2
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
< $as_echo_n "checking for $ac_word... " >&6; }
< if ${ac_cv_prog_DLLTOOL+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   if test -n "$DLLTOOL"; then
<   ac_cv_prog_DLLTOOL="$DLLTOOL" # Let the user override the test.
< else
< as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
< for as_dir in $PATH
< do
<   IFS=$as_save_IFS
<   test -z "$as_dir" && as_dir=.
<     for ac_exec_ext in '' $ac_executable_extensions; do
<   if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
<     ac_cv_prog_DLLTOOL="${ac_tool_prefix}dlltool"
<     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
<     break 2
<   fi
< done
<   done
< IFS=$as_save_IFS
< 
< fi
< fi
< DLLTOOL=$ac_cv_prog_DLLTOOL
< if test -n "$DLLTOOL"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $DLLTOOL" >&5
< $as_echo "$DLLTOOL" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
< $as_echo "no" >&6; }
< fi
< 
< 
< fi
< if test -z "$ac_cv_prog_DLLTOOL"; then
<   ac_ct_DLLTOOL=$DLLTOOL
<   # Extract the first word of "dlltool", so it can be a program name with args.
< set dummy dlltool; ac_word=$2
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
< $as_echo_n "checking for $ac_word... " >&6; }
< if ${ac_cv_prog_ac_ct_DLLTOOL+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   if test -n "$ac_ct_DLLTOOL"; then
<   ac_cv_prog_ac_ct_DLLTOOL="$ac_ct_DLLTOOL" # Let the user override the test.
< else
< as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
< for as_dir in $PATH
< do
<   IFS=$as_save_IFS
<   test -z "$as_dir" && as_dir=.
<     for ac_exec_ext in '' $ac_executable_extensions; do
<   if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
<     ac_cv_prog_ac_ct_DLLTOOL="dlltool"
<     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
<     break 2
<   fi
< done
<   done
< IFS=$as_save_IFS
< 
< fi
< fi
< ac_ct_DLLTOOL=$ac_cv_prog_ac_ct_DLLTOOL
< if test -n "$ac_ct_DLLTOOL"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_DLLTOOL" >&5
< $as_echo "$ac_ct_DLLTOOL" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
< $as_echo "no" >&6; }
< fi
< 
<   if test "x$ac_ct_DLLTOOL" = x; then
<     DLLTOOL="false"
<   else
<     case $cross_compiling:$ac_tool_warned in
< yes:)
< { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
< $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
< ac_tool_warned=yes ;;
< esac
<     DLLTOOL=$ac_ct_DLLTOOL
<   fi
< else
<   DLLTOOL="$ac_cv_prog_DLLTOOL"
< fi
< 
< test -z "$DLLTOOL" && DLLTOOL=dlltool
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking how to associate runtime and link libraries" >&5
< $as_echo_n "checking how to associate runtime and link libraries... " >&6; }
< if ${lt_cv_sharedlib_from_linklib_cmd+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   lt_cv_sharedlib_from_linklib_cmd='unknown'
< 
< case $host_os in
< cygwin* | mingw* | pw32* | cegcc*)
<   # two different shell functions defined in ltmain.sh
<   # decide which to use based on capabilities of $DLLTOOL
<   case `$DLLTOOL --help 2>&1` in
<   *--identify-strict*)
<     lt_cv_sharedlib_from_linklib_cmd=func_cygming_dll_for_implib
<     ;;
<   *)
<     lt_cv_sharedlib_from_linklib_cmd=func_cygming_dll_for_implib_fallback
<     ;;
<   esac
<   ;;
< *)
<   # fallback: assume linklib IS sharedlib
<   lt_cv_sharedlib_from_linklib_cmd="$ECHO"
<   ;;
< esac
< 
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_sharedlib_from_linklib_cmd" >&5
< $as_echo "$lt_cv_sharedlib_from_linklib_cmd" >&6; }
< sharedlib_from_linklib_cmd=$lt_cv_sharedlib_from_linklib_cmd
< test -z "$sharedlib_from_linklib_cmd" && sharedlib_from_linklib_cmd=$ECHO
< 
< 
< 
< 
< 
< 
< 
< if test -n "$ac_tool_prefix"; then
<   for ac_prog in ar
<   do
<     # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
< set dummy $ac_tool_prefix$ac_prog; ac_word=$2
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
< $as_echo_n "checking for $ac_word... " >&6; }
< if ${ac_cv_prog_AR+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   if test -n "$AR"; then
<   ac_cv_prog_AR="$AR" # Let the user override the test.
< else
< as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
< for as_dir in $PATH
< do
<   IFS=$as_save_IFS
<   test -z "$as_dir" && as_dir=.
<     for ac_exec_ext in '' $ac_executable_extensions; do
<   if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
<     ac_cv_prog_AR="$ac_tool_prefix$ac_prog"
<     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
<     break 2
<   fi
< done
<   done
< IFS=$as_save_IFS
< 
< fi
< fi
< AR=$ac_cv_prog_AR
< if test -n "$AR"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $AR" >&5
< $as_echo "$AR" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
< $as_echo "no" >&6; }
< fi
< 
< 
<     test -n "$AR" && break
<   done
< fi
< if test -z "$AR"; then
<   ac_ct_AR=$AR
<   for ac_prog in ar
< do
<   # Extract the first word of "$ac_prog", so it can be a program name with args.
< set dummy $ac_prog; ac_word=$2
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
< $as_echo_n "checking for $ac_word... " >&6; }
< if ${ac_cv_prog_ac_ct_AR+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   if test -n "$ac_ct_AR"; then
<   ac_cv_prog_ac_ct_AR="$ac_ct_AR" # Let the user override the test.
< else
< as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
< for as_dir in $PATH
< do
<   IFS=$as_save_IFS
<   test -z "$as_dir" && as_dir=.
<     for ac_exec_ext in '' $ac_executable_extensions; do
<   if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
<     ac_cv_prog_ac_ct_AR="$ac_prog"
<     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
<     break 2
<   fi
< done
<   done
< IFS=$as_save_IFS
< 
< fi
< fi
< ac_ct_AR=$ac_cv_prog_ac_ct_AR
< if test -n "$ac_ct_AR"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_AR" >&5
< $as_echo "$ac_ct_AR" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
< $as_echo "no" >&6; }
< fi
< 
< 
<   test -n "$ac_ct_AR" && break
< done
< 
<   if test "x$ac_ct_AR" = x; then
<     AR="false"
<   else
<     case $cross_compiling:$ac_tool_warned in
< yes:)
< { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
< $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
< ac_tool_warned=yes ;;
< esac
<     AR=$ac_ct_AR
<   fi
< fi
< 
< : ${AR=ar}
< : ${AR_FLAGS=cru}
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for archiver @FILE support" >&5
< $as_echo_n "checking for archiver @FILE support... " >&6; }
< if ${lt_cv_ar_at_file+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   lt_cv_ar_at_file=no
<    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
< /* end confdefs.h.  */
< 
< int
< main ()
< {
< 
<   ;
<   return 0;
< }
< _ACEOF
< if ac_fn_c_try_compile "$LINENO"; then :
<   echo conftest.$ac_objext > conftest.lst
<       lt_ar_try='$AR $AR_FLAGS libconftest.a @conftest.lst >&5'
<       { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$lt_ar_try\""; } >&5
<   (eval $lt_ar_try) 2>&5
<   ac_status=$?
<   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
<   test $ac_status = 0; }
<       if test "$ac_status" -eq 0; then
< 	# Ensure the archiver fails upon bogus file names.
< 	rm -f conftest.$ac_objext libconftest.a
< 	{ { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$lt_ar_try\""; } >&5
<   (eval $lt_ar_try) 2>&5
<   ac_status=$?
<   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
<   test $ac_status = 0; }
< 	if test "$ac_status" -ne 0; then
<           lt_cv_ar_at_file=@
<         fi
<       fi
<       rm -f conftest.* libconftest.a
< 
< fi
< rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
< 
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_ar_at_file" >&5
< $as_echo "$lt_cv_ar_at_file" >&6; }
< 
< if test "x$lt_cv_ar_at_file" = xno; then
<   archiver_list_spec=
< else
<   archiver_list_spec=$lt_cv_ar_at_file
< fi
< 
< 
< 
< 
< 
< 
< 
< if test -n "$ac_tool_prefix"; then
<   # Extract the first word of "${ac_tool_prefix}strip", so it can be a program name with args.
< set dummy ${ac_tool_prefix}strip; ac_word=$2
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
< $as_echo_n "checking for $ac_word... " >&6; }
< if ${ac_cv_prog_STRIP+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   if test -n "$STRIP"; then
<   ac_cv_prog_STRIP="$STRIP" # Let the user override the test.
< else
< as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
< for as_dir in $PATH
< do
<   IFS=$as_save_IFS
<   test -z "$as_dir" && as_dir=.
<     for ac_exec_ext in '' $ac_executable_extensions; do
<   if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
<     ac_cv_prog_STRIP="${ac_tool_prefix}strip"
<     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
<     break 2
<   fi
< done
<   done
< IFS=$as_save_IFS
< 
< fi
< fi
< STRIP=$ac_cv_prog_STRIP
< if test -n "$STRIP"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $STRIP" >&5
< $as_echo "$STRIP" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
< $as_echo "no" >&6; }
< fi
< 
< 
< fi
< if test -z "$ac_cv_prog_STRIP"; then
<   ac_ct_STRIP=$STRIP
<   # Extract the first word of "strip", so it can be a program name with args.
< set dummy strip; ac_word=$2
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
< $as_echo_n "checking for $ac_word... " >&6; }
< if ${ac_cv_prog_ac_ct_STRIP+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   if test -n "$ac_ct_STRIP"; then
<   ac_cv_prog_ac_ct_STRIP="$ac_ct_STRIP" # Let the user override the test.
< else
< as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
< for as_dir in $PATH
< do
<   IFS=$as_save_IFS
<   test -z "$as_dir" && as_dir=.
<     for ac_exec_ext in '' $ac_executable_extensions; do
<   if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
<     ac_cv_prog_ac_ct_STRIP="strip"
<     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
<     break 2
<   fi
< done
<   done
< IFS=$as_save_IFS
< 
< fi
< fi
< ac_ct_STRIP=$ac_cv_prog_ac_ct_STRIP
< if test -n "$ac_ct_STRIP"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_STRIP" >&5
< $as_echo "$ac_ct_STRIP" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
< $as_echo "no" >&6; }
< fi
< 
<   if test "x$ac_ct_STRIP" = x; then
<     STRIP=":"
<   else
<     case $cross_compiling:$ac_tool_warned in
< yes:)
< { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
< $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
< ac_tool_warned=yes ;;
< esac
<     STRIP=$ac_ct_STRIP
<   fi
< else
<   STRIP="$ac_cv_prog_STRIP"
< fi
< 
< test -z "$STRIP" && STRIP=:
< 
< 
< 
< 
< 
< 
< if test -n "$ac_tool_prefix"; then
<   # Extract the first word of "${ac_tool_prefix}ranlib", so it can be a program name with args.
< set dummy ${ac_tool_prefix}ranlib; ac_word=$2
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
< $as_echo_n "checking for $ac_word... " >&6; }
< if ${ac_cv_prog_RANLIB+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   if test -n "$RANLIB"; then
<   ac_cv_prog_RANLIB="$RANLIB" # Let the user override the test.
< else
< as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
< for as_dir in $PATH
< do
<   IFS=$as_save_IFS
<   test -z "$as_dir" && as_dir=.
<     for ac_exec_ext in '' $ac_executable_extensions; do
<   if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
<     ac_cv_prog_RANLIB="${ac_tool_prefix}ranlib"
<     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
<     break 2
<   fi
< done
<   done
< IFS=$as_save_IFS
< 
< fi
< fi
< RANLIB=$ac_cv_prog_RANLIB
< if test -n "$RANLIB"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $RANLIB" >&5
< $as_echo "$RANLIB" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
< $as_echo "no" >&6; }
< fi
< 
< 
< fi
< if test -z "$ac_cv_prog_RANLIB"; then
<   ac_ct_RANLIB=$RANLIB
<   # Extract the first word of "ranlib", so it can be a program name with args.
< set dummy ranlib; ac_word=$2
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
< $as_echo_n "checking for $ac_word... " >&6; }
< if ${ac_cv_prog_ac_ct_RANLIB+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   if test -n "$ac_ct_RANLIB"; then
<   ac_cv_prog_ac_ct_RANLIB="$ac_ct_RANLIB" # Let the user override the test.
< else
< as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
< for as_dir in $PATH
< do
<   IFS=$as_save_IFS
<   test -z "$as_dir" && as_dir=.
<     for ac_exec_ext in '' $ac_executable_extensions; do
<   if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
<     ac_cv_prog_ac_ct_RANLIB="ranlib"
<     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
<     break 2
<   fi
< done
<   done
< IFS=$as_save_IFS
< 
< fi
< fi
< ac_ct_RANLIB=$ac_cv_prog_ac_ct_RANLIB
< if test -n "$ac_ct_RANLIB"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_RANLIB" >&5
< $as_echo "$ac_ct_RANLIB" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
< $as_echo "no" >&6; }
< fi
< 
<   if test "x$ac_ct_RANLIB" = x; then
<     RANLIB=":"
<   else
<     case $cross_compiling:$ac_tool_warned in
< yes:)
< { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
< $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
< ac_tool_warned=yes ;;
< esac
<     RANLIB=$ac_ct_RANLIB
<   fi
< else
<   RANLIB="$ac_cv_prog_RANLIB"
< fi
< 
< test -z "$RANLIB" && RANLIB=:
< 
< 
< 
< 
< 
< 
< # Determine commands to create old-style static archives.
< old_archive_cmds='$AR $AR_FLAGS $oldlib$oldobjs'
< old_postinstall_cmds='chmod 644 $oldlib'
< old_postuninstall_cmds=
< 
< if test -n "$RANLIB"; then
<   case $host_os in
<   openbsd*)
<     old_postinstall_cmds="$old_postinstall_cmds~\$RANLIB -t \$tool_oldlib"
<     ;;
<   *)
<     old_postinstall_cmds="$old_postinstall_cmds~\$RANLIB \$tool_oldlib"
<     ;;
<   esac
<   old_archive_cmds="$old_archive_cmds~\$RANLIB \$tool_oldlib"
< fi
< 
< case $host_os in
<   darwin*)
<     lock_old_archive_extraction=yes ;;
<   *)
<     lock_old_archive_extraction=no ;;
< esac
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< # If no C compiler was specified, use CC.
< LTCC=${LTCC-"$CC"}
< 
< # If no C compiler flags were specified, use CFLAGS.
< LTCFLAGS=${LTCFLAGS-"$CFLAGS"}
< 
< # Allow CC to be a program name with arguments.
< compiler=$CC
< 
< 
< # Check for command to grab the raw symbol name followed by C symbol from nm.
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking command to parse $NM output from $compiler object" >&5
< $as_echo_n "checking command to parse $NM output from $compiler object... " >&6; }
< if ${lt_cv_sys_global_symbol_pipe+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
< 
< # These are sane defaults that work on at least a few old systems.
< # [They come from Ultrix.  What could be older than Ultrix?!! ;)]
< 
< # Character class describing NM global symbol codes.
< symcode='[BCDEGRST]'
< 
< # Regexp to match symbols that can be accessed directly from C.
< sympat='\([_A-Za-z][_A-Za-z0-9]*\)'
< 
< # Define system-specific variables.
< case $host_os in
< aix*)
<   symcode='[BCDT]'
<   ;;
< cygwin* | mingw* | pw32* | cegcc*)
<   symcode='[ABCDGISTW]'
<   ;;
< hpux*)
<   if test "$host_cpu" = ia64; then
<     symcode='[ABCDEGRST]'
<   fi
<   ;;
< irix* | nonstopux*)
<   symcode='[BCDEGRST]'
<   ;;
< osf*)
<   symcode='[BCDEGQRST]'
<   ;;
< solaris*)
<   symcode='[BDRT]'
<   ;;
< sco3.2v5*)
<   symcode='[DT]'
<   ;;
< sysv4.2uw2*)
<   symcode='[DT]'
<   ;;
< sysv5* | sco5v6* | unixware* | OpenUNIX*)
<   symcode='[ABDT]'
<   ;;
< sysv4)
<   symcode='[DFNSTU]'
<   ;;
< esac
< 
< # If we're using GNU nm, then use its standard symbol codes.
< case `$NM -V 2>&1` in
< *GNU* | *'with BFD'*)
<   symcode='[ABCDGIRSTW]' ;;
< esac
< 
< # Transform an extracted symbol line into a proper C declaration.
< # Some systems (esp. on ia64) link data and code symbols differently,
< # so use this general approach.
< lt_cv_sys_global_symbol_to_cdecl="sed -n -e 's/^T .* \(.*\)$/extern int \1();/p' -e 's/^$symcode* .* \(.*\)$/extern char \1;/p'"
< 
< # Transform an extracted symbol line into symbol name and symbol address
< lt_cv_sys_global_symbol_to_c_name_address="sed -n -e 's/^: \([^ ]*\)[ ]*$/  {\\\"\1\\\", (void *) 0},/p' -e 's/^$symcode* \([^ ]*\) \([^ ]*\)$/  {\"\2\", (void *) \&\2},/p'"
< lt_cv_sys_global_symbol_to_c_name_address_lib_prefix="sed -n -e 's/^: \([^ ]*\)[ ]*$/  {\\\"\1\\\", (void *) 0},/p' -e 's/^$symcode* \([^ ]*\) \(lib[^ ]*\)$/  {\"\2\", (void *) \&\2},/p' -e 's/^$symcode* \([^ ]*\) \([^ ]*\)$/  {\"lib\2\", (void *) \&\2},/p'"
< 
< # Handle CRLF in mingw tool chain
< opt_cr=
< case $build_os in
< mingw*)
<   opt_cr=`$ECHO 'x\{0,1\}' | tr x '\015'` # option cr in regexp
<   ;;
< esac
< 
< # Try without a prefix underscore, then with it.
< for ac_symprfx in "" "_"; do
< 
<   # Transform symcode, sympat, and symprfx into a raw symbol and a C symbol.
<   symxfrm="\\1 $ac_symprfx\\2 \\2"
< 
<   # Write the raw and C identifiers.
<   if test "$lt_cv_nm_interface" = "MS dumpbin"; then
<     # Fake it for dumpbin and say T for any non-static function
<     # and D for any global variable.
<     # Also find C++ and __fastcall symbols from MSVC++,
<     # which start with @ or ?.
<     lt_cv_sys_global_symbol_pipe="$AWK '"\
< "     {last_section=section; section=\$ 3};"\
< "     /^COFF SYMBOL TABLE/{for(i in hide) delete hide[i]};"\
< "     /Section length .*#relocs.*(pick any)/{hide[last_section]=1};"\
< "     \$ 0!~/External *\|/{next};"\
< "     / 0+ UNDEF /{next}; / UNDEF \([^|]\)*()/{next};"\
< "     {if(hide[section]) next};"\
< "     {f=0}; \$ 0~/\(\).*\|/{f=1}; {printf f ? \"T \" : \"D \"};"\
< "     {split(\$ 0, a, /\||\r/); split(a[2], s)};"\
< "     s[1]~/^[@?]/{print s[1], s[1]; next};"\
< "     s[1]~prfx {split(s[1],t,\"@\"); print t[1], substr(t[1],length(prfx))}"\
< "     ' prfx=^$ac_symprfx"
<   else
<     lt_cv_sys_global_symbol_pipe="sed -n -e 's/^.*[	 ]\($symcode$symcode*\)[	 ][	 ]*$ac_symprfx$sympat$opt_cr$/$symxfrm/p'"
<   fi
<   lt_cv_sys_global_symbol_pipe="$lt_cv_sys_global_symbol_pipe | sed '/ __gnu_lto/d'"
< 
<   # Check to see that the pipe works correctly.
<   pipe_works=no
< 
<   rm -f conftest*
<   cat > conftest.$ac_ext <<_LT_EOF
< #ifdef __cplusplus
< extern "C" {
< #endif
< char nm_test_var;
< void nm_test_func(void);
< void nm_test_func(void){}
< #ifdef __cplusplus
< }
< #endif
< int main(){nm_test_var='a';nm_test_func();return(0);}
< _LT_EOF
< 
<   if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
<   (eval $ac_compile) 2>&5
<   ac_status=$?
<   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
<   test $ac_status = 0; }; then
<     # Now try to grab the symbols.
<     nlist=conftest.nm
<     if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$NM conftest.$ac_objext \| "$lt_cv_sys_global_symbol_pipe" \> $nlist\""; } >&5
<   (eval $NM conftest.$ac_objext \| "$lt_cv_sys_global_symbol_pipe" \> $nlist) 2>&5
<   ac_status=$?
<   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
<   test $ac_status = 0; } && test -s "$nlist"; then
<       # Try sorting and uniquifying the output.
<       if sort "$nlist" | uniq > "$nlist"T; then
< 	mv -f "$nlist"T "$nlist"
<       else
< 	rm -f "$nlist"T
<       fi
< 
<       # Make sure that we snagged all the symbols we need.
<       if $GREP ' nm_test_var$' "$nlist" >/dev/null; then
< 	if $GREP ' nm_test_func$' "$nlist" >/dev/null; then
< 	  cat <<_LT_EOF > conftest.$ac_ext
< /* Keep this code in sync between libtool.m4, ltmain, lt_system.h, and tests.  */
< #if defined(_WIN32) || defined(__CYGWIN__) || defined(_WIN32_WCE)
< /* DATA imports from DLLs on WIN32 con't be const, because runtime
<    relocations are performed -- see ld's documentation on pseudo-relocs.  */
< # define LT_DLSYM_CONST
< #elif defined(__osf__)
< /* This system does not cope well with relocations in const data.  */
< # define LT_DLSYM_CONST
< #else
< # define LT_DLSYM_CONST const
< #endif
< 
< #ifdef __cplusplus
< extern "C" {
< #endif
< 
< _LT_EOF
< 	  # Now generate the symbol file.
< 	  eval "$lt_cv_sys_global_symbol_to_cdecl"' < "$nlist" | $GREP -v main >> conftest.$ac_ext'
< 
< 	  cat <<_LT_EOF >> conftest.$ac_ext
< 
< /* The mapping between symbol names and symbols.  */
< LT_DLSYM_CONST struct {
<   const char *name;
<   void       *address;
< }
< lt__PROGRAM__LTX_preloaded_symbols[] =
< {
<   { "@PROGRAM@", (void *) 0 },
< _LT_EOF
< 	  $SED "s/^$symcode$symcode* \(.*\) \(.*\)$/  {\"\2\", (void *) \&\2},/" < "$nlist" | $GREP -v main >> conftest.$ac_ext
< 	  cat <<\_LT_EOF >> conftest.$ac_ext
<   {0, (void *) 0}
< };
< 
< /* This works around a problem in FreeBSD linker */
< #ifdef FREEBSD_WORKAROUND
< static const void *lt_preloaded_setup() {
<   return lt__PROGRAM__LTX_preloaded_symbols;
< }
< #endif
< 
< #ifdef __cplusplus
< }
< #endif
< _LT_EOF
< 	  # Now try linking the two files.
< 	  mv conftest.$ac_objext conftstm.$ac_objext
< 	  lt_globsym_save_LIBS=$LIBS
< 	  lt_globsym_save_CFLAGS=$CFLAGS
< 	  LIBS="conftstm.$ac_objext"
< 	  CFLAGS="$CFLAGS$lt_prog_compiler_no_builtin_flag"
< 	  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_link\""; } >&5
<   (eval $ac_link) 2>&5
<   ac_status=$?
<   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
<   test $ac_status = 0; } && test -s conftest${ac_exeext}; then
< 	    pipe_works=yes
< 	  fi
< 	  LIBS=$lt_globsym_save_LIBS
< 	  CFLAGS=$lt_globsym_save_CFLAGS
< 	else
< 	  echo "cannot find nm_test_func in $nlist" >&5
< 	fi
<       else
< 	echo "cannot find nm_test_var in $nlist" >&5
<       fi
<     else
<       echo "cannot run $lt_cv_sys_global_symbol_pipe" >&5
<     fi
<   else
<     echo "$progname: failed program was:" >&5
<     cat conftest.$ac_ext >&5
<   fi
<   rm -rf conftest* conftst*
< 
<   # Do not use the global_symbol_pipe unless it works.
<   if test "$pipe_works" = yes; then
<     break
<   else
<     lt_cv_sys_global_symbol_pipe=
<   fi
< done
< 
< fi
< 
< if test -z "$lt_cv_sys_global_symbol_pipe"; then
<   lt_cv_sys_global_symbol_to_cdecl=
< fi
< if test -z "$lt_cv_sys_global_symbol_pipe$lt_cv_sys_global_symbol_to_cdecl"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: failed" >&5
< $as_echo "failed" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: ok" >&5
< $as_echo "ok" >&6; }
< fi
< 
< # Response file support.
< if test "$lt_cv_nm_interface" = "MS dumpbin"; then
<   nm_file_list_spec='@'
< elif $NM --help 2>/dev/null | grep '[@]FILE' >/dev/null; then
<   nm_file_list_spec='@'
< fi
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for sysroot" >&5
< $as_echo_n "checking for sysroot... " >&6; }
< 
< # Check whether --with-sysroot was given.
< if test "${with_sysroot+set}" = set; then :
<   withval=$with_sysroot;
< else
<   with_sysroot=no
< fi
< 
< 
< lt_sysroot=
< case ${with_sysroot} in #(
<  yes)
<    if test "$GCC" = yes; then
<      lt_sysroot=`$CC --print-sysroot 2>/dev/null`
<    fi
<    ;; #(
<  /*)
<    lt_sysroot=`echo "$with_sysroot" | sed -e "$sed_quote_subst"`
<    ;; #(
<  no|'')
<    ;; #(
<  *)
<    { $as_echo "$as_me:${as_lineno-$LINENO}: result: ${with_sysroot}" >&5
< $as_echo "${with_sysroot}" >&6; }
<    as_fn_error $? "The sysroot must be an absolute path." "$LINENO" 5
<    ;;
< esac
< 
<  { $as_echo "$as_me:${as_lineno-$LINENO}: result: ${lt_sysroot:-no}" >&5
< $as_echo "${lt_sysroot:-no}" >&6; }
< 
< 
< 
< 
< 
< # Check whether --enable-libtool-lock was given.
< if test "${enable_libtool_lock+set}" = set; then :
<   enableval=$enable_libtool_lock;
< fi
< 
< test "x$enable_libtool_lock" != xno && enable_libtool_lock=yes
< 
< # Some flags need to be propagated to the compiler or linker for good
< # libtool support.
< case $host in
< ia64-*-hpux*)
<   # Find out which ABI we are using.
<   echo 'int i;' > conftest.$ac_ext
<   if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
<   (eval $ac_compile) 2>&5
<   ac_status=$?
<   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
<   test $ac_status = 0; }; then
<     case `/usr/bin/file conftest.$ac_objext` in
<       *ELF-32*)
< 	HPUX_IA64_MODE="32"
< 	;;
<       *ELF-64*)
< 	HPUX_IA64_MODE="64"
< 	;;
<     esac
<   fi
<   rm -rf conftest*
<   ;;
< *-*-irix6*)
<   # Find out which ABI we are using.
<   echo '#line '$LINENO' "configure"' > conftest.$ac_ext
<   if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
<   (eval $ac_compile) 2>&5
<   ac_status=$?
<   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
<   test $ac_status = 0; }; then
<     if test "$lt_cv_prog_gnu_ld" = yes; then
<       case `/usr/bin/file conftest.$ac_objext` in
< 	*32-bit*)
< 	  LD="${LD-ld} -melf32bsmip"
< 	  ;;
< 	*N32*)
< 	  LD="${LD-ld} -melf32bmipn32"
< 	  ;;
< 	*64-bit*)
< 	  LD="${LD-ld} -melf64bmip"
< 	;;
<       esac
<     else
<       case `/usr/bin/file conftest.$ac_objext` in
< 	*32-bit*)
< 	  LD="${LD-ld} -32"
< 	  ;;
< 	*N32*)
< 	  LD="${LD-ld} -n32"
< 	  ;;
< 	*64-bit*)
< 	  LD="${LD-ld} -64"
< 	  ;;
<       esac
<     fi
<   fi
<   rm -rf conftest*
<   ;;
< 
< x86_64-*kfreebsd*-gnu|x86_64-*linux*|powerpc*-*linux*| \
< s390*-*linux*|s390*-*tpf*|sparc*-*linux*)
<   # Find out which ABI we are using.
<   echo 'int i;' > conftest.$ac_ext
<   if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
<   (eval $ac_compile) 2>&5
<   ac_status=$?
<   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
<   test $ac_status = 0; }; then
<     case `/usr/bin/file conftest.o` in
<       *32-bit*)
< 	case $host in
< 	  x86_64-*kfreebsd*-gnu)
< 	    LD="${LD-ld} -m elf_i386_fbsd"
< 	    ;;
< 	  x86_64-*linux*)
< 	    case `/usr/bin/file conftest.o` in
< 	      *x86-64*)
< 		LD="${LD-ld} -m elf32_x86_64"
< 		;;
< 	      *)
< 		LD="${LD-ld} -m elf_i386"
< 		;;
< 	    esac
< 	    ;;
< 	  powerpc64le-*)
< 	    LD="${LD-ld} -m elf32lppclinux"
< 	    ;;
< 	  powerpc64-*)
< 	    LD="${LD-ld} -m elf32ppclinux"
< 	    ;;
< 	  s390x-*linux*)
< 	    LD="${LD-ld} -m elf_s390"
< 	    ;;
< 	  sparc64-*linux*)
< 	    LD="${LD-ld} -m elf32_sparc"
< 	    ;;
< 	esac
< 	;;
<       *64-bit*)
< 	case $host in
< 	  x86_64-*kfreebsd*-gnu)
< 	    LD="${LD-ld} -m elf_x86_64_fbsd"
< 	    ;;
< 	  x86_64-*linux*)
< 	    LD="${LD-ld} -m elf_x86_64"
< 	    ;;
< 	  powerpcle-*)
< 	    LD="${LD-ld} -m elf64lppc"
< 	    ;;
< 	  powerpc-*)
< 	    LD="${LD-ld} -m elf64ppc"
< 	    ;;
< 	  s390*-*linux*|s390*-*tpf*)
< 	    LD="${LD-ld} -m elf64_s390"
< 	    ;;
< 	  sparc*-*linux*)
< 	    LD="${LD-ld} -m elf64_sparc"
< 	    ;;
< 	esac
< 	;;
<     esac
<   fi
<   rm -rf conftest*
<   ;;
< 
< *-*-sco3.2v5*)
<   # On SCO OpenServer 5, we need -belf to get full-featured binaries.
<   SAVE_CFLAGS="$CFLAGS"
<   CFLAGS="$CFLAGS -belf"
<   { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the C compiler needs -belf" >&5
< $as_echo_n "checking whether the C compiler needs -belf... " >&6; }
< if ${lt_cv_cc_needs_belf+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   ac_ext=c
< ac_cpp='$CPP $CPPFLAGS'
< ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
< ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
< ac_compiler_gnu=$ac_cv_c_compiler_gnu
< 
<      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
< /* end confdefs.h.  */
< 
< int
< main ()
< {
< 
<   ;
<   return 0;
< }
< _ACEOF
< if ac_fn_c_try_link "$LINENO"; then :
<   lt_cv_cc_needs_belf=yes
< else
<   lt_cv_cc_needs_belf=no
< fi
< rm -f core conftest.err conftest.$ac_objext \
<     conftest$ac_exeext conftest.$ac_ext
<      ac_ext=c
< ac_cpp='$CPP $CPPFLAGS'
< ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
< ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
< ac_compiler_gnu=$ac_cv_c_compiler_gnu
< 
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_cc_needs_belf" >&5
< $as_echo "$lt_cv_cc_needs_belf" >&6; }
<   if test x"$lt_cv_cc_needs_belf" != x"yes"; then
<     # this is probably gcc 2.8.0, egcs 1.0 or newer; no need for -belf
<     CFLAGS="$SAVE_CFLAGS"
<   fi
<   ;;
< *-*solaris*)
<   # Find out which ABI we are using.
<   echo 'int i;' > conftest.$ac_ext
<   if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
<   (eval $ac_compile) 2>&5
<   ac_status=$?
<   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
<   test $ac_status = 0; }; then
<     case `/usr/bin/file conftest.o` in
<     *64-bit*)
<       case $lt_cv_prog_gnu_ld in
<       yes*)
<         case $host in
<         i?86-*-solaris*)
<           LD="${LD-ld} -m elf_x86_64"
<           ;;
<         sparc*-*-solaris*)
<           LD="${LD-ld} -m elf64_sparc"
<           ;;
<         esac
<         # GNU ld 2.21 introduced _sol2 emulations.  Use them if available.
<         if ${LD-ld} -V | grep _sol2 >/dev/null 2>&1; then
<           LD="${LD-ld}_sol2"
<         fi
<         ;;
<       *)
< 	if ${LD-ld} -64 -r -o conftest2.o conftest.o >/dev/null 2>&1; then
< 	  LD="${LD-ld} -64"
< 	fi
< 	;;
<       esac
<       ;;
<     esac
<   fi
<   rm -rf conftest*
<   ;;
< esac
< 
< need_locks="$enable_libtool_lock"
< 
< if test -n "$ac_tool_prefix"; then
<   # Extract the first word of "${ac_tool_prefix}mt", so it can be a program name with args.
< set dummy ${ac_tool_prefix}mt; ac_word=$2
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
< $as_echo_n "checking for $ac_word... " >&6; }
< if ${ac_cv_prog_MANIFEST_TOOL+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   if test -n "$MANIFEST_TOOL"; then
<   ac_cv_prog_MANIFEST_TOOL="$MANIFEST_TOOL" # Let the user override the test.
< else
< as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
< for as_dir in $PATH
< do
<   IFS=$as_save_IFS
<   test -z "$as_dir" && as_dir=.
<     for ac_exec_ext in '' $ac_executable_extensions; do
<   if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
<     ac_cv_prog_MANIFEST_TOOL="${ac_tool_prefix}mt"
<     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
<     break 2
<   fi
< done
<   done
< IFS=$as_save_IFS
< 
< fi
< fi
< MANIFEST_TOOL=$ac_cv_prog_MANIFEST_TOOL
< if test -n "$MANIFEST_TOOL"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $MANIFEST_TOOL" >&5
< $as_echo "$MANIFEST_TOOL" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
< $as_echo "no" >&6; }
< fi
< 
< 
< fi
< if test -z "$ac_cv_prog_MANIFEST_TOOL"; then
<   ac_ct_MANIFEST_TOOL=$MANIFEST_TOOL
<   # Extract the first word of "mt", so it can be a program name with args.
< set dummy mt; ac_word=$2
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
< $as_echo_n "checking for $ac_word... " >&6; }
< if ${ac_cv_prog_ac_ct_MANIFEST_TOOL+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   if test -n "$ac_ct_MANIFEST_TOOL"; then
<   ac_cv_prog_ac_ct_MANIFEST_TOOL="$ac_ct_MANIFEST_TOOL" # Let the user override the test.
< else
< as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
< for as_dir in $PATH
< do
<   IFS=$as_save_IFS
<   test -z "$as_dir" && as_dir=.
<     for ac_exec_ext in '' $ac_executable_extensions; do
<   if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
<     ac_cv_prog_ac_ct_MANIFEST_TOOL="mt"
<     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
<     break 2
<   fi
< done
<   done
< IFS=$as_save_IFS
< 
< fi
< fi
< ac_ct_MANIFEST_TOOL=$ac_cv_prog_ac_ct_MANIFEST_TOOL
< if test -n "$ac_ct_MANIFEST_TOOL"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_MANIFEST_TOOL" >&5
< $as_echo "$ac_ct_MANIFEST_TOOL" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
< $as_echo "no" >&6; }
< fi
< 
<   if test "x$ac_ct_MANIFEST_TOOL" = x; then
<     MANIFEST_TOOL=":"
<   else
<     case $cross_compiling:$ac_tool_warned in
< yes:)
< { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
< $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
< ac_tool_warned=yes ;;
< esac
<     MANIFEST_TOOL=$ac_ct_MANIFEST_TOOL
<   fi
< else
<   MANIFEST_TOOL="$ac_cv_prog_MANIFEST_TOOL"
< fi
< 
< test -z "$MANIFEST_TOOL" && MANIFEST_TOOL=mt
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $MANIFEST_TOOL is a manifest tool" >&5
< $as_echo_n "checking if $MANIFEST_TOOL is a manifest tool... " >&6; }
< if ${lt_cv_path_mainfest_tool+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   lt_cv_path_mainfest_tool=no
<   echo "$as_me:$LINENO: $MANIFEST_TOOL '-?'" >&5
<   $MANIFEST_TOOL '-?' 2>conftest.err > conftest.out
<   cat conftest.err >&5
<   if $GREP 'Manifest Tool' conftest.out > /dev/null; then
<     lt_cv_path_mainfest_tool=yes
<   fi
<   rm -f conftest*
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_path_mainfest_tool" >&5
< $as_echo "$lt_cv_path_mainfest_tool" >&6; }
< if test "x$lt_cv_path_mainfest_tool" != xyes; then
<   MANIFEST_TOOL=:
< fi
< 
< 
< 
< 
< 
< 
<   case $host_os in
<     rhapsody* | darwin*)
<     if test -n "$ac_tool_prefix"; then
<   # Extract the first word of "${ac_tool_prefix}dsymutil", so it can be a program name with args.
< set dummy ${ac_tool_prefix}dsymutil; ac_word=$2
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
< $as_echo_n "checking for $ac_word... " >&6; }
< if ${ac_cv_prog_DSYMUTIL+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   if test -n "$DSYMUTIL"; then
<   ac_cv_prog_DSYMUTIL="$DSYMUTIL" # Let the user override the test.
< else
< as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
< for as_dir in $PATH
< do
<   IFS=$as_save_IFS
<   test -z "$as_dir" && as_dir=.
<     for ac_exec_ext in '' $ac_executable_extensions; do
<   if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
<     ac_cv_prog_DSYMUTIL="${ac_tool_prefix}dsymutil"
<     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
<     break 2
<   fi
< done
<   done
< IFS=$as_save_IFS
< 
< fi
< fi
< DSYMUTIL=$ac_cv_prog_DSYMUTIL
< if test -n "$DSYMUTIL"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $DSYMUTIL" >&5
< $as_echo "$DSYMUTIL" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
< $as_echo "no" >&6; }
< fi
< 
< 
< fi
< if test -z "$ac_cv_prog_DSYMUTIL"; then
<   ac_ct_DSYMUTIL=$DSYMUTIL
<   # Extract the first word of "dsymutil", so it can be a program name with args.
< set dummy dsymutil; ac_word=$2
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
< $as_echo_n "checking for $ac_word... " >&6; }
< if ${ac_cv_prog_ac_ct_DSYMUTIL+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   if test -n "$ac_ct_DSYMUTIL"; then
<   ac_cv_prog_ac_ct_DSYMUTIL="$ac_ct_DSYMUTIL" # Let the user override the test.
< else
< as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
< for as_dir in $PATH
< do
<   IFS=$as_save_IFS
<   test -z "$as_dir" && as_dir=.
<     for ac_exec_ext in '' $ac_executable_extensions; do
<   if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
<     ac_cv_prog_ac_ct_DSYMUTIL="dsymutil"
<     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
<     break 2
<   fi
< done
<   done
< IFS=$as_save_IFS
< 
< fi
< fi
< ac_ct_DSYMUTIL=$ac_cv_prog_ac_ct_DSYMUTIL
< if test -n "$ac_ct_DSYMUTIL"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_DSYMUTIL" >&5
< $as_echo "$ac_ct_DSYMUTIL" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
< $as_echo "no" >&6; }
< fi
< 
<   if test "x$ac_ct_DSYMUTIL" = x; then
<     DSYMUTIL=":"
<   else
<     case $cross_compiling:$ac_tool_warned in
< yes:)
< { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
< $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
< ac_tool_warned=yes ;;
< esac
<     DSYMUTIL=$ac_ct_DSYMUTIL
<   fi
< else
<   DSYMUTIL="$ac_cv_prog_DSYMUTIL"
< fi
< 
<     if test -n "$ac_tool_prefix"; then
<   # Extract the first word of "${ac_tool_prefix}nmedit", so it can be a program name with args.
< set dummy ${ac_tool_prefix}nmedit; ac_word=$2
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
< $as_echo_n "checking for $ac_word... " >&6; }
< if ${ac_cv_prog_NMEDIT+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   if test -n "$NMEDIT"; then
<   ac_cv_prog_NMEDIT="$NMEDIT" # Let the user override the test.
< else
< as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
< for as_dir in $PATH
< do
<   IFS=$as_save_IFS
<   test -z "$as_dir" && as_dir=.
<     for ac_exec_ext in '' $ac_executable_extensions; do
<   if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
<     ac_cv_prog_NMEDIT="${ac_tool_prefix}nmedit"
<     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
<     break 2
<   fi
< done
<   done
< IFS=$as_save_IFS
< 
< fi
< fi
< NMEDIT=$ac_cv_prog_NMEDIT
< if test -n "$NMEDIT"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $NMEDIT" >&5
< $as_echo "$NMEDIT" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
< $as_echo "no" >&6; }
< fi
< 
< 
< fi
< if test -z "$ac_cv_prog_NMEDIT"; then
<   ac_ct_NMEDIT=$NMEDIT
<   # Extract the first word of "nmedit", so it can be a program name with args.
< set dummy nmedit; ac_word=$2
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
< $as_echo_n "checking for $ac_word... " >&6; }
< if ${ac_cv_prog_ac_ct_NMEDIT+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   if test -n "$ac_ct_NMEDIT"; then
<   ac_cv_prog_ac_ct_NMEDIT="$ac_ct_NMEDIT" # Let the user override the test.
< else
< as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
< for as_dir in $PATH
< do
<   IFS=$as_save_IFS
<   test -z "$as_dir" && as_dir=.
<     for ac_exec_ext in '' $ac_executable_extensions; do
<   if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
<     ac_cv_prog_ac_ct_NMEDIT="nmedit"
<     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
<     break 2
<   fi
< done
<   done
< IFS=$as_save_IFS
< 
< fi
< fi
< ac_ct_NMEDIT=$ac_cv_prog_ac_ct_NMEDIT
< if test -n "$ac_ct_NMEDIT"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_NMEDIT" >&5
< $as_echo "$ac_ct_NMEDIT" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
< $as_echo "no" >&6; }
< fi
< 
<   if test "x$ac_ct_NMEDIT" = x; then
<     NMEDIT=":"
<   else
<     case $cross_compiling:$ac_tool_warned in
< yes:)
< { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
< $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
< ac_tool_warned=yes ;;
< esac
<     NMEDIT=$ac_ct_NMEDIT
<   fi
< else
<   NMEDIT="$ac_cv_prog_NMEDIT"
< fi
< 
<     if test -n "$ac_tool_prefix"; then
<   # Extract the first word of "${ac_tool_prefix}lipo", so it can be a program name with args.
< set dummy ${ac_tool_prefix}lipo; ac_word=$2
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
< $as_echo_n "checking for $ac_word... " >&6; }
< if ${ac_cv_prog_LIPO+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   if test -n "$LIPO"; then
<   ac_cv_prog_LIPO="$LIPO" # Let the user override the test.
< else
< as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
< for as_dir in $PATH
< do
<   IFS=$as_save_IFS
<   test -z "$as_dir" && as_dir=.
<     for ac_exec_ext in '' $ac_executable_extensions; do
<   if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
<     ac_cv_prog_LIPO="${ac_tool_prefix}lipo"
<     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
<     break 2
<   fi
< done
<   done
< IFS=$as_save_IFS
< 
< fi
< fi
< LIPO=$ac_cv_prog_LIPO
< if test -n "$LIPO"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $LIPO" >&5
< $as_echo "$LIPO" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
< $as_echo "no" >&6; }
< fi
< 
< 
< fi
< if test -z "$ac_cv_prog_LIPO"; then
<   ac_ct_LIPO=$LIPO
<   # Extract the first word of "lipo", so it can be a program name with args.
< set dummy lipo; ac_word=$2
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
< $as_echo_n "checking for $ac_word... " >&6; }
< if ${ac_cv_prog_ac_ct_LIPO+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   if test -n "$ac_ct_LIPO"; then
<   ac_cv_prog_ac_ct_LIPO="$ac_ct_LIPO" # Let the user override the test.
< else
< as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
< for as_dir in $PATH
< do
<   IFS=$as_save_IFS
<   test -z "$as_dir" && as_dir=.
<     for ac_exec_ext in '' $ac_executable_extensions; do
<   if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
<     ac_cv_prog_ac_ct_LIPO="lipo"
<     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
<     break 2
<   fi
< done
<   done
< IFS=$as_save_IFS
< 
< fi
< fi
< ac_ct_LIPO=$ac_cv_prog_ac_ct_LIPO
< if test -n "$ac_ct_LIPO"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_LIPO" >&5
< $as_echo "$ac_ct_LIPO" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
< $as_echo "no" >&6; }
< fi
< 
<   if test "x$ac_ct_LIPO" = x; then
<     LIPO=":"
<   else
<     case $cross_compiling:$ac_tool_warned in
< yes:)
< { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
< $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
< ac_tool_warned=yes ;;
< esac
<     LIPO=$ac_ct_LIPO
<   fi
< else
<   LIPO="$ac_cv_prog_LIPO"
< fi
< 
<     if test -n "$ac_tool_prefix"; then
<   # Extract the first word of "${ac_tool_prefix}otool", so it can be a program name with args.
< set dummy ${ac_tool_prefix}otool; ac_word=$2
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
< $as_echo_n "checking for $ac_word... " >&6; }
< if ${ac_cv_prog_OTOOL+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   if test -n "$OTOOL"; then
<   ac_cv_prog_OTOOL="$OTOOL" # Let the user override the test.
< else
< as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
< for as_dir in $PATH
< do
<   IFS=$as_save_IFS
<   test -z "$as_dir" && as_dir=.
<     for ac_exec_ext in '' $ac_executable_extensions; do
<   if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
<     ac_cv_prog_OTOOL="${ac_tool_prefix}otool"
<     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
<     break 2
<   fi
< done
<   done
< IFS=$as_save_IFS
< 
< fi
< fi
< OTOOL=$ac_cv_prog_OTOOL
< if test -n "$OTOOL"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $OTOOL" >&5
< $as_echo "$OTOOL" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
< $as_echo "no" >&6; }
< fi
< 
< 
< fi
< if test -z "$ac_cv_prog_OTOOL"; then
<   ac_ct_OTOOL=$OTOOL
<   # Extract the first word of "otool", so it can be a program name with args.
< set dummy otool; ac_word=$2
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
< $as_echo_n "checking for $ac_word... " >&6; }
< if ${ac_cv_prog_ac_ct_OTOOL+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   if test -n "$ac_ct_OTOOL"; then
<   ac_cv_prog_ac_ct_OTOOL="$ac_ct_OTOOL" # Let the user override the test.
< else
< as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
< for as_dir in $PATH
< do
<   IFS=$as_save_IFS
<   test -z "$as_dir" && as_dir=.
<     for ac_exec_ext in '' $ac_executable_extensions; do
<   if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
<     ac_cv_prog_ac_ct_OTOOL="otool"
<     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
<     break 2
<   fi
< done
<   done
< IFS=$as_save_IFS
< 
< fi
< fi
< ac_ct_OTOOL=$ac_cv_prog_ac_ct_OTOOL
< if test -n "$ac_ct_OTOOL"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_OTOOL" >&5
< $as_echo "$ac_ct_OTOOL" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
< $as_echo "no" >&6; }
< fi
< 
<   if test "x$ac_ct_OTOOL" = x; then
<     OTOOL=":"
<   else
<     case $cross_compiling:$ac_tool_warned in
< yes:)
< { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
< $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
< ac_tool_warned=yes ;;
< esac
<     OTOOL=$ac_ct_OTOOL
<   fi
< else
<   OTOOL="$ac_cv_prog_OTOOL"
< fi
< 
<     if test -n "$ac_tool_prefix"; then
<   # Extract the first word of "${ac_tool_prefix}otool64", so it can be a program name with args.
< set dummy ${ac_tool_prefix}otool64; ac_word=$2
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
< $as_echo_n "checking for $ac_word... " >&6; }
< if ${ac_cv_prog_OTOOL64+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   if test -n "$OTOOL64"; then
<   ac_cv_prog_OTOOL64="$OTOOL64" # Let the user override the test.
< else
< as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
< for as_dir in $PATH
< do
<   IFS=$as_save_IFS
<   test -z "$as_dir" && as_dir=.
<     for ac_exec_ext in '' $ac_executable_extensions; do
<   if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
<     ac_cv_prog_OTOOL64="${ac_tool_prefix}otool64"
<     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
<     break 2
<   fi
< done
<   done
< IFS=$as_save_IFS
< 
< fi
< fi
< OTOOL64=$ac_cv_prog_OTOOL64
< if test -n "$OTOOL64"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $OTOOL64" >&5
< $as_echo "$OTOOL64" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
< $as_echo "no" >&6; }
< fi
< 
< 
< fi
< if test -z "$ac_cv_prog_OTOOL64"; then
<   ac_ct_OTOOL64=$OTOOL64
<   # Extract the first word of "otool64", so it can be a program name with args.
< set dummy otool64; ac_word=$2
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
< $as_echo_n "checking for $ac_word... " >&6; }
< if ${ac_cv_prog_ac_ct_OTOOL64+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   if test -n "$ac_ct_OTOOL64"; then
<   ac_cv_prog_ac_ct_OTOOL64="$ac_ct_OTOOL64" # Let the user override the test.
< else
< as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
< for as_dir in $PATH
< do
<   IFS=$as_save_IFS
<   test -z "$as_dir" && as_dir=.
<     for ac_exec_ext in '' $ac_executable_extensions; do
<   if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
<     ac_cv_prog_ac_ct_OTOOL64="otool64"
<     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
<     break 2
<   fi
< done
<   done
< IFS=$as_save_IFS
< 
< fi
< fi
< ac_ct_OTOOL64=$ac_cv_prog_ac_ct_OTOOL64
< if test -n "$ac_ct_OTOOL64"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_OTOOL64" >&5
< $as_echo "$ac_ct_OTOOL64" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
< $as_echo "no" >&6; }
< fi
< 
<   if test "x$ac_ct_OTOOL64" = x; then
<     OTOOL64=":"
<   else
<     case $cross_compiling:$ac_tool_warned in
< yes:)
< { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
< $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
< ac_tool_warned=yes ;;
< esac
<     OTOOL64=$ac_ct_OTOOL64
<   fi
< else
<   OTOOL64="$ac_cv_prog_OTOOL64"
< fi
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
<     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for -single_module linker flag" >&5
< $as_echo_n "checking for -single_module linker flag... " >&6; }
< if ${lt_cv_apple_cc_single_mod+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   lt_cv_apple_cc_single_mod=no
<       if test -z "${LT_MULTI_MODULE}"; then
< 	# By default we will add the -single_module flag. You can override
< 	# by either setting the environment variable LT_MULTI_MODULE
< 	# non-empty at configure time, or by adding -multi_module to the
< 	# link flags.
< 	rm -rf libconftest.dylib*
< 	echo "int foo(void){return 1;}" > conftest.c
< 	echo "$LTCC $LTCFLAGS $LDFLAGS -o libconftest.dylib \
< -dynamiclib -Wl,-single_module conftest.c" >&5
< 	$LTCC $LTCFLAGS $LDFLAGS -o libconftest.dylib \
< 	  -dynamiclib -Wl,-single_module conftest.c 2>conftest.err
<         _lt_result=$?
< 	# If there is a non-empty error log, and "single_module"
< 	# appears in it, assume the flag caused a linker warning
<         if test -s conftest.err && $GREP single_module conftest.err; then
< 	  cat conftest.err >&5
< 	# Otherwise, if the output was created with a 0 exit code from
< 	# the compiler, it worked.
< 	elif test -f libconftest.dylib && test $_lt_result -eq 0; then
< 	  lt_cv_apple_cc_single_mod=yes
< 	else
< 	  cat conftest.err >&5
< 	fi
< 	rm -rf libconftest.dylib*
< 	rm -f conftest.*
<       fi
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_apple_cc_single_mod" >&5
< $as_echo "$lt_cv_apple_cc_single_mod" >&6; }
< 
<     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for -exported_symbols_list linker flag" >&5
< $as_echo_n "checking for -exported_symbols_list linker flag... " >&6; }
< if ${lt_cv_ld_exported_symbols_list+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   lt_cv_ld_exported_symbols_list=no
<       save_LDFLAGS=$LDFLAGS
<       echo "_main" > conftest.sym
<       LDFLAGS="$LDFLAGS -Wl,-exported_symbols_list,conftest.sym"
<       cat confdefs.h - <<_ACEOF >conftest.$ac_ext
< /* end confdefs.h.  */
< 
< int
< main ()
< {
< 
<   ;
<   return 0;
< }
< _ACEOF
< if ac_fn_c_try_link "$LINENO"; then :
<   lt_cv_ld_exported_symbols_list=yes
< else
<   lt_cv_ld_exported_symbols_list=no
< fi
< rm -f core conftest.err conftest.$ac_objext \
<     conftest$ac_exeext conftest.$ac_ext
< 	LDFLAGS="$save_LDFLAGS"
< 
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_ld_exported_symbols_list" >&5
< $as_echo "$lt_cv_ld_exported_symbols_list" >&6; }
< 
<     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for -force_load linker flag" >&5
< $as_echo_n "checking for -force_load linker flag... " >&6; }
< if ${lt_cv_ld_force_load+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   lt_cv_ld_force_load=no
<       cat > conftest.c << _LT_EOF
< int forced_loaded() { return 2;}
< _LT_EOF
<       echo "$LTCC $LTCFLAGS -c -o conftest.o conftest.c" >&5
<       $LTCC $LTCFLAGS -c -o conftest.o conftest.c 2>&5
<       echo "$AR cru libconftest.a conftest.o" >&5
<       $AR cru libconftest.a conftest.o 2>&5
<       echo "$RANLIB libconftest.a" >&5
<       $RANLIB libconftest.a 2>&5
<       cat > conftest.c << _LT_EOF
< int main() { return 0;}
< _LT_EOF
<       echo "$LTCC $LTCFLAGS $LDFLAGS -o conftest conftest.c -Wl,-force_load,./libconftest.a" >&5
<       $LTCC $LTCFLAGS $LDFLAGS -o conftest conftest.c -Wl,-force_load,./libconftest.a 2>conftest.err
<       _lt_result=$?
<       if test -s conftest.err && $GREP force_load conftest.err; then
< 	cat conftest.err >&5
<       elif test -f conftest && test $_lt_result -eq 0 && $GREP forced_load conftest >/dev/null 2>&1 ; then
< 	lt_cv_ld_force_load=yes
<       else
< 	cat conftest.err >&5
<       fi
<         rm -f conftest.err libconftest.a conftest conftest.c
<         rm -rf conftest.dSYM
< 
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_ld_force_load" >&5
< $as_echo "$lt_cv_ld_force_load" >&6; }
<     case $host_os in
<     rhapsody* | darwin1.[012])
<       _lt_dar_allow_undefined='${wl}-undefined ${wl}suppress' ;;
<     darwin1.*)
<       _lt_dar_allow_undefined='${wl}-flat_namespace ${wl}-undefined ${wl}suppress' ;;
<     darwin*) # darwin 5.x on
<       # if running on 10.5 or later, the deployment target defaults
<       # to the OS version, if on x86, and 10.4, the deployment
<       # target defaults to 10.4. Don't you love it?
<       case ${MACOSX_DEPLOYMENT_TARGET-10.0},$host in
< 	10.0,*86*-darwin8*|10.0,*-darwin[91]*)
< 	  _lt_dar_allow_undefined='${wl}-undefined ${wl}dynamic_lookup' ;;
< 	10.[012]*)
< 	  _lt_dar_allow_undefined='${wl}-flat_namespace ${wl}-undefined ${wl}suppress' ;;
< 	10.*)
< 	  _lt_dar_allow_undefined='${wl}-undefined ${wl}dynamic_lookup' ;;
<       esac
<     ;;
<   esac
<     if test "$lt_cv_apple_cc_single_mod" = "yes"; then
<       _lt_dar_single_mod='$single_module'
<     fi
<     if test "$lt_cv_ld_exported_symbols_list" = "yes"; then
<       _lt_dar_export_syms=' ${wl}-exported_symbols_list,$output_objdir/${libname}-symbols.expsym'
<     else
<       _lt_dar_export_syms='~$NMEDIT -s $output_objdir/${libname}-symbols.expsym ${lib}'
<     fi
<     if test "$DSYMUTIL" != ":" && test "$lt_cv_ld_force_load" = "no"; then
<       _lt_dsymutil='~$DSYMUTIL $lib || :'
<     else
<       _lt_dsymutil=
<     fi
<     ;;
<   esac
< 
< for ac_header in dlfcn.h
< do :
<   ac_fn_c_check_header_compile "$LINENO" "dlfcn.h" "ac_cv_header_dlfcn_h" "$ac_includes_default
< "
< if test "x$ac_cv_header_dlfcn_h" = xyes; then :
<   cat >>confdefs.h <<_ACEOF
< #define HAVE_DLFCN_H 1
< _ACEOF
< 
< fi
< 
< done
< 
< 
< 
< 
< 
< # Set options
< # Check whether --enable-shared was given.
< if test "${enable_shared+set}" = set; then :
<   enableval=$enable_shared; p=${PACKAGE-default}
<     case $enableval in
<     yes) enable_shared=yes ;;
<     no) enable_shared=no ;;
<     *)
<       enable_shared=no
<       # Look at the argument we got.  We use all the common list separators.
<       lt_save_ifs="$IFS"; IFS="${IFS}$PATH_SEPARATOR,"
<       for pkg in $enableval; do
< 	IFS="$lt_save_ifs"
< 	if test "X$pkg" = "X$p"; then
< 	  enable_shared=yes
< 	fi
<       done
<       IFS="$lt_save_ifs"
<       ;;
<     esac
< else
<   enable_shared=no
< fi
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
<         enable_dlopen=no
< 
< 
<   enable_win32_dll=no
< 
< 
< 
<   # Check whether --enable-static was given.
< if test "${enable_static+set}" = set; then :
<   enableval=$enable_static; p=${PACKAGE-default}
<     case $enableval in
<     yes) enable_static=yes ;;
<     no) enable_static=no ;;
<     *)
<      enable_static=no
<       # Look at the argument we got.  We use all the common list separators.
<       lt_save_ifs="$IFS"; IFS="${IFS}$PATH_SEPARATOR,"
<       for pkg in $enableval; do
< 	IFS="$lt_save_ifs"
< 	if test "X$pkg" = "X$p"; then
< 	  enable_static=yes
< 	fi
<       done
<       IFS="$lt_save_ifs"
<       ;;
<     esac
< else
<   enable_static=yes
< fi
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< # Check whether --with-pic was given.
< if test "${with_pic+set}" = set; then :
<   withval=$with_pic; lt_p=${PACKAGE-default}
<     case $withval in
<     yes|no) pic_mode=$withval ;;
<     *)
<       pic_mode=default
<       # Look at the argument we got.  We use all the common list separators.
<       lt_save_ifs="$IFS"; IFS="${IFS}$PATH_SEPARATOR,"
<       for lt_pkg in $withval; do
< 	IFS="$lt_save_ifs"
< 	if test "X$lt_pkg" = "X$lt_p"; then
< 	  pic_mode=yes
< 	fi
<       done
<       IFS="$lt_save_ifs"
<       ;;
<     esac
< else
<   pic_mode=default
< fi
< 
< 
< test -z "$pic_mode" && pic_mode=default
< 
< 
< 
< 
< 
< 
< 
<   # Check whether --enable-fast-install was given.
< if test "${enable_fast_install+set}" = set; then :
<   enableval=$enable_fast_install; p=${PACKAGE-default}
<     case $enableval in
<     yes) enable_fast_install=yes ;;
<     no) enable_fast_install=no ;;
<     *)
<       enable_fast_install=no
<       # Look at the argument we got.  We use all the common list separators.
<       lt_save_ifs="$IFS"; IFS="${IFS}$PATH_SEPARATOR,"
<       for pkg in $enableval; do
< 	IFS="$lt_save_ifs"
< 	if test "X$pkg" = "X$p"; then
< 	  enable_fast_install=yes
< 	fi
<       done
<       IFS="$lt_save_ifs"
<       ;;
<     esac
< else
<   enable_fast_install=yes
< fi
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< # This can be used to rebuild libtool when needed
< LIBTOOL_DEPS="$ltmain"
< 
< # Always use our own libtool.
< LIBTOOL='$(SHELL) $(top_builddir)/libtool'
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< test -z "$LN_S" && LN_S="ln -s"
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< if test -n "${ZSH_VERSION+set}" ; then
<    setopt NO_GLOB_SUBST
< fi
< 
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for objdir" >&5
< $as_echo_n "checking for objdir... " >&6; }
< if ${lt_cv_objdir+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   rm -f .libs 2>/dev/null
< mkdir .libs 2>/dev/null
< if test -d .libs; then
<   lt_cv_objdir=.libs
< else
<   # MS-DOS does not allow filenames that begin with a dot.
<   lt_cv_objdir=_libs
< fi
< rmdir .libs 2>/dev/null
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_objdir" >&5
< $as_echo "$lt_cv_objdir" >&6; }
< objdir=$lt_cv_objdir
< 
< 
< 
< 
< 
< cat >>confdefs.h <<_ACEOF
< #define LT_OBJDIR "$lt_cv_objdir/"
< _ACEOF
< 
< 
< 
< 
< case $host_os in
< aix3*)
<   # AIX sometimes has problems with the GCC collect2 program.  For some
<   # reason, if we set the COLLECT_NAMES environment variable, the problems
<   # vanish in a puff of smoke.
<   if test "X${COLLECT_NAMES+set}" != Xset; then
<     COLLECT_NAMES=
<     export COLLECT_NAMES
<   fi
<   ;;
< esac
< 
< # Global variables:
< ofile=libtool
< can_build_shared=yes
< 
< # All known linkers require a `.a' archive for static linking (except MSVC,
< # which needs '.lib').
< libext=a
< 
< with_gnu_ld="$lt_cv_prog_gnu_ld"
< 
< old_CC="$CC"
< old_CFLAGS="$CFLAGS"
< 
< # Set sane defaults for various variables
< test -z "$CC" && CC=cc
< test -z "$LTCC" && LTCC=$CC
< test -z "$LTCFLAGS" && LTCFLAGS=$CFLAGS
< test -z "$LD" && LD=ld
< test -z "$ac_objext" && ac_objext=o
< 
< for cc_temp in $compiler""; do
<   case $cc_temp in
<     compile | *[\\/]compile | ccache | *[\\/]ccache ) ;;
<     distcc | *[\\/]distcc | purify | *[\\/]purify ) ;;
<     \-*) ;;
<     *) break;;
<   esac
< done
< cc_basename=`$ECHO "$cc_temp" | $SED "s%.*/%%; s%^$host_alias-%%"`
< 
< 
< # Only perform the check for file, if the check method requires it
< test -z "$MAGIC_CMD" && MAGIC_CMD=file
< case $deplibs_check_method in
< file_magic*)
<   if test "$file_magic_cmd" = '$MAGIC_CMD'; then
<     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for ${ac_tool_prefix}file" >&5
< $as_echo_n "checking for ${ac_tool_prefix}file... " >&6; }
< if ${lt_cv_path_MAGIC_CMD+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   case $MAGIC_CMD in
< [\\/*] |  ?:[\\/]*)
<   lt_cv_path_MAGIC_CMD="$MAGIC_CMD" # Let the user override the test with a path.
<   ;;
< *)
<   lt_save_MAGIC_CMD="$MAGIC_CMD"
<   lt_save_ifs="$IFS"; IFS=$PATH_SEPARATOR
<   ac_dummy="/usr/bin$PATH_SEPARATOR$PATH"
<   for ac_dir in $ac_dummy; do
<     IFS="$lt_save_ifs"
<     test -z "$ac_dir" && ac_dir=.
<     if test -f $ac_dir/${ac_tool_prefix}file; then
<       lt_cv_path_MAGIC_CMD="$ac_dir/${ac_tool_prefix}file"
<       if test -n "$file_magic_test_file"; then
< 	case $deplibs_check_method in
< 	"file_magic "*)
< 	  file_magic_regex=`expr "$deplibs_check_method" : "file_magic \(.*\)"`
< 	  MAGIC_CMD="$lt_cv_path_MAGIC_CMD"
< 	  if eval $file_magic_cmd \$file_magic_test_file 2> /dev/null |
< 	    $EGREP "$file_magic_regex" > /dev/null; then
< 	    :
< 	  else
< 	    cat <<_LT_EOF 1>&2
< 
< *** Warning: the command libtool uses to detect shared libraries,
< *** $file_magic_cmd, produces output that libtool cannot recognize.
< *** The result is that libtool may fail to recognize shared libraries
< *** as such.  This will affect the creation of libtool libraries that
< *** depend on shared libraries, but programs linked with such libtool
< *** libraries will work regardless of this problem.  Nevertheless, you
< *** may want to report the problem to your system manager and/or to
< *** bug-libtool@gnu.org
< 
< _LT_EOF
< 	  fi ;;
< 	esac
<       fi
<       break
<     fi
<   done
<   IFS="$lt_save_ifs"
<   MAGIC_CMD="$lt_save_MAGIC_CMD"
<   ;;
< esac
< fi
< 
< MAGIC_CMD="$lt_cv_path_MAGIC_CMD"
< if test -n "$MAGIC_CMD"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $MAGIC_CMD" >&5
< $as_echo "$MAGIC_CMD" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
< $as_echo "no" >&6; }
< fi
< 
< 
< 
< 
< 
< if test -z "$lt_cv_path_MAGIC_CMD"; then
<   if test -n "$ac_tool_prefix"; then
<     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for file" >&5
< $as_echo_n "checking for file... " >&6; }
< if ${lt_cv_path_MAGIC_CMD+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   case $MAGIC_CMD in
< [\\/*] |  ?:[\\/]*)
<   lt_cv_path_MAGIC_CMD="$MAGIC_CMD" # Let the user override the test with a path.
<   ;;
< *)
<   lt_save_MAGIC_CMD="$MAGIC_CMD"
<   lt_save_ifs="$IFS"; IFS=$PATH_SEPARATOR
<   ac_dummy="/usr/bin$PATH_SEPARATOR$PATH"
<   for ac_dir in $ac_dummy; do
<     IFS="$lt_save_ifs"
<     test -z "$ac_dir" && ac_dir=.
<     if test -f $ac_dir/file; then
<       lt_cv_path_MAGIC_CMD="$ac_dir/file"
<       if test -n "$file_magic_test_file"; then
< 	case $deplibs_check_method in
< 	"file_magic "*)
< 	  file_magic_regex=`expr "$deplibs_check_method" : "file_magic \(.*\)"`
< 	  MAGIC_CMD="$lt_cv_path_MAGIC_CMD"
< 	  if eval $file_magic_cmd \$file_magic_test_file 2> /dev/null |
< 	    $EGREP "$file_magic_regex" > /dev/null; then
< 	    :
< 	  else
< 	    cat <<_LT_EOF 1>&2
< 
< *** Warning: the command libtool uses to detect shared libraries,
< *** $file_magic_cmd, produces output that libtool cannot recognize.
< *** The result is that libtool may fail to recognize shared libraries
< *** as such.  This will affect the creation of libtool libraries that
< *** depend on shared libraries, but programs linked with such libtool
< *** libraries will work regardless of this problem.  Nevertheless, you
< *** may want to report the problem to your system manager and/or to
< *** bug-libtool@gnu.org
< 
< _LT_EOF
< 	  fi ;;
< 	esac
<       fi
<       break
<     fi
<   done
<   IFS="$lt_save_ifs"
<   MAGIC_CMD="$lt_save_MAGIC_CMD"
<   ;;
< esac
< fi
< 
< MAGIC_CMD="$lt_cv_path_MAGIC_CMD"
< if test -n "$MAGIC_CMD"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $MAGIC_CMD" >&5
< $as_echo "$MAGIC_CMD" >&6; }
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
< $as_echo "no" >&6; }
< fi
< 
< 
<   else
<     MAGIC_CMD=:
<   fi
< fi
< 
<   fi
<   ;;
< esac
< 
< # Use C for the default configuration in the libtool script
< 
< lt_save_CC="$CC"
< ac_ext=c
< ac_cpp='$CPP $CPPFLAGS'
< ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
< ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
< ac_compiler_gnu=$ac_cv_c_compiler_gnu
< 
< 
< # Source file extension for C test sources.
< ac_ext=c
< 
< # Object file extension for compiled C test sources.
< objext=o
< objext=$objext
< 
< # Code to be used in simple compile tests
< lt_simple_compile_test_code="int some_variable = 0;"
< 
< # Code to be used in simple link tests
< lt_simple_link_test_code='int main(){return(0);}'
< 
< 
< 
< 
< 
< 
< 
< # If no C compiler was specified, use CC.
< LTCC=${LTCC-"$CC"}
< 
< # If no C compiler flags were specified, use CFLAGS.
< LTCFLAGS=${LTCFLAGS-"$CFLAGS"}
< 
< # Allow CC to be a program name with arguments.
< compiler=$CC
< 
< # Save the default compiler, since it gets overwritten when the other
< # tags are being tested, and _LT_TAGVAR(compiler, []) is a NOP.
< compiler_DEFAULT=$CC
< 
< # save warnings/boilerplate of simple test code
< ac_outfile=conftest.$ac_objext
< echo "$lt_simple_compile_test_code" >conftest.$ac_ext
< eval "$ac_compile" 2>&1 >/dev/null | $SED '/^$/d; /^ *+/d' >conftest.err
< _lt_compiler_boilerplate=`cat conftest.err`
< $RM conftest*
< 
< ac_outfile=conftest.$ac_objext
< echo "$lt_simple_link_test_code" >conftest.$ac_ext
< eval "$ac_link" 2>&1 >/dev/null | $SED '/^$/d; /^ *+/d' >conftest.err
< _lt_linker_boilerplate=`cat conftest.err`
< $RM -r conftest*
< 
< 
< ## CAVEAT EMPTOR:
< ## There is no encapsulation within the following macros, do not change
< ## the running order or otherwise move them around unless you know exactly
< ## what you are doing...
< if test -n "$compiler"; then
< 
< lt_prog_compiler_no_builtin_flag=
< 
< if test "$GCC" = yes; then
<   case $cc_basename in
<   nvcc*)
<     lt_prog_compiler_no_builtin_flag=' -Xcompiler -fno-builtin' ;;
<   *)
<     lt_prog_compiler_no_builtin_flag=' -fno-builtin' ;;
<   esac
< 
<   { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler supports -fno-rtti -fno-exceptions" >&5
< $as_echo_n "checking if $compiler supports -fno-rtti -fno-exceptions... " >&6; }
< if ${lt_cv_prog_compiler_rtti_exceptions+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   lt_cv_prog_compiler_rtti_exceptions=no
<    ac_outfile=conftest.$ac_objext
<    echo "$lt_simple_compile_test_code" > conftest.$ac_ext
<    lt_compiler_flag="-fno-rtti -fno-exceptions"
<    # Insert the option either (1) after the last *FLAGS variable, or
<    # (2) before a word containing "conftest.", or (3) at the end.
<    # Note that $ac_compile itself does not contain backslashes and begins
<    # with a dollar sign (not a hyphen), so the echo should work correctly.
<    # The option is referenced via a variable to avoid confusing sed.
<    lt_compile=`echo "$ac_compile" | $SED \
<    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
<    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
<    -e 's:$: $lt_compiler_flag:'`
<    (eval echo "\"\$as_me:$LINENO: $lt_compile\"" >&5)
<    (eval "$lt_compile" 2>conftest.err)
<    ac_status=$?
<    cat conftest.err >&5
<    echo "$as_me:$LINENO: \$? = $ac_status" >&5
<    if (exit $ac_status) && test -s "$ac_outfile"; then
<      # The compiler can only warn and ignore the option if not recognized
<      # So say no if there are warnings other than the usual output.
<      $ECHO "$_lt_compiler_boilerplate" | $SED '/^$/d' >conftest.exp
<      $SED '/^$/d; /^ *+/d' conftest.err >conftest.er2
<      if test ! -s conftest.er2 || diff conftest.exp conftest.er2 >/dev/null; then
<        lt_cv_prog_compiler_rtti_exceptions=yes
<      fi
<    fi
<    $RM conftest*
< 
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_rtti_exceptions" >&5
< $as_echo "$lt_cv_prog_compiler_rtti_exceptions" >&6; }
< 
< if test x"$lt_cv_prog_compiler_rtti_exceptions" = xyes; then
<     lt_prog_compiler_no_builtin_flag="$lt_prog_compiler_no_builtin_flag -fno-rtti -fno-exceptions"
< else
<     :
< fi
< 
< fi
< 
< 
< 
< 
< 
< 
<   lt_prog_compiler_wl=
< lt_prog_compiler_pic=
< lt_prog_compiler_static=
< 
< 
<   if test "$GCC" = yes; then
<     lt_prog_compiler_wl='-Wl,'
<     lt_prog_compiler_static='-static'
< 
<     case $host_os in
<       aix*)
<       # All AIX code is PIC.
<       if test "$host_cpu" = ia64; then
< 	# AIX 5 now supports IA64 processor
< 	lt_prog_compiler_static='-Bstatic'
<       fi
<       ;;
< 
<     amigaos*)
<       case $host_cpu in
<       powerpc)
<             # see comment about AmigaOS4 .so support
<             lt_prog_compiler_pic='-fPIC'
<         ;;
<       m68k)
<             # FIXME: we need at least 68020 code to build shared libraries, but
<             # adding the `-m68020' flag to GCC prevents building anything better,
<             # like `-m68040'.
<             lt_prog_compiler_pic='-m68020 -resident32 -malways-restore-a4'
<         ;;
<       esac
<       ;;
< 
<     beos* | irix5* | irix6* | nonstopux* | osf3* | osf4* | osf5*)
<       # PIC is the default for these OSes.
<       ;;
< 
<     mingw* | cygwin* | pw32* | os2* | cegcc*)
<       # This hack is so that the source file can tell whether it is being
<       # built for inclusion in a dll (and should export symbols for example).
<       # Although the cygwin gcc ignores -fPIC, still need this for old-style
<       # (--disable-auto-import) libraries
<       lt_prog_compiler_pic='-DDLL_EXPORT'
<       ;;
< 
<     darwin* | rhapsody*)
<       # PIC is the default on this platform
<       # Common symbols not allowed in MH_DYLIB files
<       lt_prog_compiler_pic='-fno-common'
<       ;;
< 
<     haiku*)
<       # PIC is the default for Haiku.
<       # The "-static" flag exists, but is broken.
<       lt_prog_compiler_static=
<       ;;
< 
<     hpux*)
<       # PIC is the default for 64-bit PA HP-UX, but not for 32-bit
<       # PA HP-UX.  On IA64 HP-UX, PIC is the default but the pic flag
<       # sets the default TLS model and affects inlining.
<       case $host_cpu in
<       hppa*64*)
< 	# +Z the default
< 	;;
<       *)
< 	lt_prog_compiler_pic='-fPIC'
< 	;;
<       esac
<       ;;
< 
<     interix[3-9]*)
<       # Interix 3.x gcc -fpic/-fPIC options generate broken code.
<       # Instead, we relocate shared libraries at runtime.
<       ;;
< 
<     msdosdjgpp*)
<       # Just because we use GCC doesn't mean we suddenly get shared libraries
<       # on systems that don't support them.
<       lt_prog_compiler_can_build_shared=no
<       enable_shared=no
<       ;;
< 
<     *nto* | *qnx*)
<       # QNX uses GNU C++, but need to define -shared option too, otherwise
<       # it will coredump.
<       lt_prog_compiler_pic='-fPIC -shared'
<       ;;
< 
<     sysv4*MP*)
<       if test -d /usr/nec; then
< 	lt_prog_compiler_pic=-Kconform_pic
<       fi
<       ;;
< 
<     *)
<       lt_prog_compiler_pic='-fPIC'
<       ;;
<     esac
< 
<     case $cc_basename in
<     nvcc*) # Cuda Compiler Driver 2.2
<       lt_prog_compiler_wl='-Xlinker '
<       if test -n "$lt_prog_compiler_pic"; then
<         lt_prog_compiler_pic="-Xcompiler $lt_prog_compiler_pic"
<       fi
<       ;;
<     esac
<   else
<     # PORTME Check for flag to pass linker flags through the system compiler.
<     case $host_os in
<     aix*)
<       lt_prog_compiler_wl='-Wl,'
<       if test "$host_cpu" = ia64; then
< 	# AIX 5 now supports IA64 processor
< 	lt_prog_compiler_static='-Bstatic'
<       else
< 	lt_prog_compiler_static='-bnso -bI:/lib/syscalls.exp'
<       fi
<       ;;
< 
<     mingw* | cygwin* | pw32* | os2* | cegcc*)
<       # This hack is so that the source file can tell whether it is being
<       # built for inclusion in a dll (and should export symbols for example).
<       lt_prog_compiler_pic='-DDLL_EXPORT'
<       ;;
< 
<     hpux9* | hpux10* | hpux11*)
<       lt_prog_compiler_wl='-Wl,'
<       # PIC is the default for IA64 HP-UX and 64-bit HP-UX, but
<       # not for PA HP-UX.
<       case $host_cpu in
<       hppa*64*|ia64*)
< 	# +Z the default
< 	;;
<       *)
< 	lt_prog_compiler_pic='+Z'
< 	;;
<       esac
<       # Is there a better lt_prog_compiler_static that works with the bundled CC?
<       lt_prog_compiler_static='${wl}-a ${wl}archive'
<       ;;
< 
<     irix5* | irix6* | nonstopux*)
<       lt_prog_compiler_wl='-Wl,'
<       # PIC (with -KPIC) is the default.
<       lt_prog_compiler_static='-non_shared'
<       ;;
< 
<     linux* | k*bsd*-gnu | kopensolaris*-gnu | gnu*)
<       case $cc_basename in
<       # old Intel for x86_64 which still supported -KPIC.
<       ecc*)
< 	lt_prog_compiler_wl='-Wl,'
< 	lt_prog_compiler_pic='-KPIC'
< 	lt_prog_compiler_static='-static'
<         ;;
<       # icc used to be incompatible with GCC.
<       # ICC 10 doesn't accept -KPIC any more.
<       icc* | ifort*)
< 	lt_prog_compiler_wl='-Wl,'
< 	lt_prog_compiler_pic='-fPIC'
< 	lt_prog_compiler_static='-static'
<         ;;
<       # Lahey Fortran 8.1.
<       lf95*)
< 	lt_prog_compiler_wl='-Wl,'
< 	lt_prog_compiler_pic='--shared'
< 	lt_prog_compiler_static='--static'
< 	;;
<       nagfor*)
< 	# NAG Fortran compiler
< 	lt_prog_compiler_wl='-Wl,-Wl,,'
< 	lt_prog_compiler_pic='-PIC'
< 	lt_prog_compiler_static='-Bstatic'
< 	;;
<       pgcc* | pgf77* | pgf90* | pgf95* | pgfortran*)
<         # Portland Group compilers (*not* the Pentium gcc compiler,
< 	# which looks to be a dead project)
< 	lt_prog_compiler_wl='-Wl,'
< 	lt_prog_compiler_pic='-fpic'
< 	lt_prog_compiler_static='-Bstatic'
<         ;;
<       ccc*)
<         lt_prog_compiler_wl='-Wl,'
<         # All Alpha code is PIC.
<         lt_prog_compiler_static='-non_shared'
<         ;;
<       xl* | bgxl* | bgf* | mpixl*)
< 	# IBM XL C 8.0/Fortran 10.1, 11.1 on PPC and BlueGene
< 	lt_prog_compiler_wl='-Wl,'
< 	lt_prog_compiler_pic='-qpic'
< 	lt_prog_compiler_static='-qstaticlink'
< 	;;
<       *)
< 	case `$CC -V 2>&1 | sed 5q` in
< 	*Sun\ Ceres\ Fortran* | *Sun*Fortran*\ [1-7].* | *Sun*Fortran*\ 8.[0-3]*)
< 	  # Sun Fortran 8.3 passes all unrecognized flags to the linker
< 	  lt_prog_compiler_pic='-KPIC'
< 	  lt_prog_compiler_static='-Bstatic'
< 	  lt_prog_compiler_wl=''
< 	  ;;
< 	*Sun\ F* | *Sun*Fortran*)
< 	  lt_prog_compiler_pic='-KPIC'
< 	  lt_prog_compiler_static='-Bstatic'
< 	  lt_prog_compiler_wl='-Qoption ld '
< 	  ;;
< 	*Sun\ C*)
< 	  # Sun C 5.9
< 	  lt_prog_compiler_pic='-KPIC'
< 	  lt_prog_compiler_static='-Bstatic'
< 	  lt_prog_compiler_wl='-Wl,'
< 	  ;;
<         *Intel*\ [CF]*Compiler*)
< 	  lt_prog_compiler_wl='-Wl,'
< 	  lt_prog_compiler_pic='-fPIC'
< 	  lt_prog_compiler_static='-static'
< 	  ;;
< 	*Portland\ Group*)
< 	  lt_prog_compiler_wl='-Wl,'
< 	  lt_prog_compiler_pic='-fpic'
< 	  lt_prog_compiler_static='-Bstatic'
< 	  ;;
< 	esac
< 	;;
<       esac
<       ;;
< 
<     newsos6)
<       lt_prog_compiler_pic='-KPIC'
<       lt_prog_compiler_static='-Bstatic'
<       ;;
< 
<     *nto* | *qnx*)
<       # QNX uses GNU C++, but need to define -shared option too, otherwise
<       # it will coredump.
<       lt_prog_compiler_pic='-fPIC -shared'
<       ;;
< 
<     osf3* | osf4* | osf5*)
<       lt_prog_compiler_wl='-Wl,'
<       # All OSF/1 code is PIC.
<       lt_prog_compiler_static='-non_shared'
<       ;;
< 
<     rdos*)
<       lt_prog_compiler_static='-non_shared'
<       ;;
< 
<     solaris*)
<       lt_prog_compiler_pic='-KPIC'
<       lt_prog_compiler_static='-Bstatic'
<       case $cc_basename in
<       f77* | f90* | f95* | sunf77* | sunf90* | sunf95*)
< 	lt_prog_compiler_wl='-Qoption ld ';;
<       *)
< 	lt_prog_compiler_wl='-Wl,';;
<       esac
<       ;;
< 
<     sunos4*)
<       lt_prog_compiler_wl='-Qoption ld '
<       lt_prog_compiler_pic='-PIC'
<       lt_prog_compiler_static='-Bstatic'
<       ;;
< 
<     sysv4 | sysv4.2uw2* | sysv4.3*)
<       lt_prog_compiler_wl='-Wl,'
<       lt_prog_compiler_pic='-KPIC'
<       lt_prog_compiler_static='-Bstatic'
<       ;;
< 
<     sysv4*MP*)
<       if test -d /usr/nec ;then
< 	lt_prog_compiler_pic='-Kconform_pic'
< 	lt_prog_compiler_static='-Bstatic'
<       fi
<       ;;
< 
<     sysv5* | unixware* | sco3.2v5* | sco5v6* | OpenUNIX*)
<       lt_prog_compiler_wl='-Wl,'
<       lt_prog_compiler_pic='-KPIC'
<       lt_prog_compiler_static='-Bstatic'
<       ;;
< 
<     unicos*)
<       lt_prog_compiler_wl='-Wl,'
<       lt_prog_compiler_can_build_shared=no
<       ;;
< 
<     uts4*)
<       lt_prog_compiler_pic='-pic'
<       lt_prog_compiler_static='-Bstatic'
<       ;;
< 
<     *)
<       lt_prog_compiler_can_build_shared=no
<       ;;
<     esac
<   fi
< 
< case $host_os in
<   # For platforms which do not support PIC, -DPIC is meaningless:
<   *djgpp*)
<     lt_prog_compiler_pic=
<     ;;
<   *)
<     lt_prog_compiler_pic="$lt_prog_compiler_pic -DPIC"
<     ;;
< esac
< 
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $compiler option to produce PIC" >&5
< $as_echo_n "checking for $compiler option to produce PIC... " >&6; }
< if ${lt_cv_prog_compiler_pic+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   lt_cv_prog_compiler_pic=$lt_prog_compiler_pic
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_pic" >&5
< $as_echo "$lt_cv_prog_compiler_pic" >&6; }
< lt_prog_compiler_pic=$lt_cv_prog_compiler_pic
< 
< #
< # Check to make sure the PIC flag actually works.
< #
< if test -n "$lt_prog_compiler_pic"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler PIC flag $lt_prog_compiler_pic works" >&5
< $as_echo_n "checking if $compiler PIC flag $lt_prog_compiler_pic works... " >&6; }
< if ${lt_cv_prog_compiler_pic_works+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   lt_cv_prog_compiler_pic_works=no
<    ac_outfile=conftest.$ac_objext
<    echo "$lt_simple_compile_test_code" > conftest.$ac_ext
<    lt_compiler_flag="$lt_prog_compiler_pic -DPIC"
<    # Insert the option either (1) after the last *FLAGS variable, or
<    # (2) before a word containing "conftest.", or (3) at the end.
<    # Note that $ac_compile itself does not contain backslashes and begins
<    # with a dollar sign (not a hyphen), so the echo should work correctly.
<    # The option is referenced via a variable to avoid confusing sed.
<    lt_compile=`echo "$ac_compile" | $SED \
<    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
<    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
<    -e 's:$: $lt_compiler_flag:'`
<    (eval echo "\"\$as_me:$LINENO: $lt_compile\"" >&5)
<    (eval "$lt_compile" 2>conftest.err)
<    ac_status=$?
<    cat conftest.err >&5
<    echo "$as_me:$LINENO: \$? = $ac_status" >&5
<    if (exit $ac_status) && test -s "$ac_outfile"; then
<      # The compiler can only warn and ignore the option if not recognized
<      # So say no if there are warnings other than the usual output.
<      $ECHO "$_lt_compiler_boilerplate" | $SED '/^$/d' >conftest.exp
<      $SED '/^$/d; /^ *+/d' conftest.err >conftest.er2
<      if test ! -s conftest.er2 || diff conftest.exp conftest.er2 >/dev/null; then
<        lt_cv_prog_compiler_pic_works=yes
<      fi
<    fi
<    $RM conftest*
< 
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_pic_works" >&5
< $as_echo "$lt_cv_prog_compiler_pic_works" >&6; }
< 
< if test x"$lt_cv_prog_compiler_pic_works" = xyes; then
<     case $lt_prog_compiler_pic in
<      "" | " "*) ;;
<      *) lt_prog_compiler_pic=" $lt_prog_compiler_pic" ;;
<      esac
< else
<     lt_prog_compiler_pic=
<      lt_prog_compiler_can_build_shared=no
< fi
< 
< fi
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< #
< # Check to make sure the static flag actually works.
< #
< wl=$lt_prog_compiler_wl eval lt_tmp_static_flag=\"$lt_prog_compiler_static\"
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler static flag $lt_tmp_static_flag works" >&5
< $as_echo_n "checking if $compiler static flag $lt_tmp_static_flag works... " >&6; }
< if ${lt_cv_prog_compiler_static_works+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   lt_cv_prog_compiler_static_works=no
<    save_LDFLAGS="$LDFLAGS"
<    LDFLAGS="$LDFLAGS $lt_tmp_static_flag"
<    echo "$lt_simple_link_test_code" > conftest.$ac_ext
<    if (eval $ac_link 2>conftest.err) && test -s conftest$ac_exeext; then
<      # The linker can only warn and ignore the option if not recognized
<      # So say no if there are warnings
<      if test -s conftest.err; then
<        # Append any errors to the config.log.
<        cat conftest.err 1>&5
<        $ECHO "$_lt_linker_boilerplate" | $SED '/^$/d' > conftest.exp
<        $SED '/^$/d; /^ *+/d' conftest.err >conftest.er2
<        if diff conftest.exp conftest.er2 >/dev/null; then
<          lt_cv_prog_compiler_static_works=yes
<        fi
<      else
<        lt_cv_prog_compiler_static_works=yes
<      fi
<    fi
<    $RM -r conftest*
<    LDFLAGS="$save_LDFLAGS"
< 
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_static_works" >&5
< $as_echo "$lt_cv_prog_compiler_static_works" >&6; }
< 
< if test x"$lt_cv_prog_compiler_static_works" = xyes; then
<     :
< else
<     lt_prog_compiler_static=
< fi
< 
< 
< 
< 
< 
< 
< 
<   { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler supports -c -o file.$ac_objext" >&5
< $as_echo_n "checking if $compiler supports -c -o file.$ac_objext... " >&6; }
< if ${lt_cv_prog_compiler_c_o+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   lt_cv_prog_compiler_c_o=no
<    $RM -r conftest 2>/dev/null
<    mkdir conftest
<    cd conftest
<    mkdir out
<    echo "$lt_simple_compile_test_code" > conftest.$ac_ext
< 
<    lt_compiler_flag="-o out/conftest2.$ac_objext"
<    # Insert the option either (1) after the last *FLAGS variable, or
<    # (2) before a word containing "conftest.", or (3) at the end.
<    # Note that $ac_compile itself does not contain backslashes and begins
<    # with a dollar sign (not a hyphen), so the echo should work correctly.
<    lt_compile=`echo "$ac_compile" | $SED \
<    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
<    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
<    -e 's:$: $lt_compiler_flag:'`
<    (eval echo "\"\$as_me:$LINENO: $lt_compile\"" >&5)
<    (eval "$lt_compile" 2>out/conftest.err)
<    ac_status=$?
<    cat out/conftest.err >&5
<    echo "$as_me:$LINENO: \$? = $ac_status" >&5
<    if (exit $ac_status) && test -s out/conftest2.$ac_objext
<    then
<      # The compiler can only warn and ignore the option if not recognized
<      # So say no if there are warnings
<      $ECHO "$_lt_compiler_boilerplate" | $SED '/^$/d' > out/conftest.exp
<      $SED '/^$/d; /^ *+/d' out/conftest.err >out/conftest.er2
<      if test ! -s out/conftest.er2 || diff out/conftest.exp out/conftest.er2 >/dev/null; then
<        lt_cv_prog_compiler_c_o=yes
<      fi
<    fi
<    chmod u+w . 2>&5
<    $RM conftest*
<    # SGI C++ compiler will create directory out/ii_files/ for
<    # template instantiation
<    test -d out/ii_files && $RM out/ii_files/* && rmdir out/ii_files
<    $RM out/* && rmdir out
<    cd ..
<    $RM -r conftest
<    $RM conftest*
< 
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_c_o" >&5
< $as_echo "$lt_cv_prog_compiler_c_o" >&6; }
< 
< 
< 
< 
< 
< 
<   { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler supports -c -o file.$ac_objext" >&5
< $as_echo_n "checking if $compiler supports -c -o file.$ac_objext... " >&6; }
< if ${lt_cv_prog_compiler_c_o+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   lt_cv_prog_compiler_c_o=no
<    $RM -r conftest 2>/dev/null
<    mkdir conftest
<    cd conftest
<    mkdir out
<    echo "$lt_simple_compile_test_code" > conftest.$ac_ext
< 
<    lt_compiler_flag="-o out/conftest2.$ac_objext"
<    # Insert the option either (1) after the last *FLAGS variable, or
<    # (2) before a word containing "conftest.", or (3) at the end.
<    # Note that $ac_compile itself does not contain backslashes and begins
<    # with a dollar sign (not a hyphen), so the echo should work correctly.
<    lt_compile=`echo "$ac_compile" | $SED \
<    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
<    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
<    -e 's:$: $lt_compiler_flag:'`
<    (eval echo "\"\$as_me:$LINENO: $lt_compile\"" >&5)
<    (eval "$lt_compile" 2>out/conftest.err)
<    ac_status=$?
<    cat out/conftest.err >&5
<    echo "$as_me:$LINENO: \$? = $ac_status" >&5
<    if (exit $ac_status) && test -s out/conftest2.$ac_objext
<    then
<      # The compiler can only warn and ignore the option if not recognized
<      # So say no if there are warnings
<      $ECHO "$_lt_compiler_boilerplate" | $SED '/^$/d' > out/conftest.exp
<      $SED '/^$/d; /^ *+/d' out/conftest.err >out/conftest.er2
<      if test ! -s out/conftest.er2 || diff out/conftest.exp out/conftest.er2 >/dev/null; then
<        lt_cv_prog_compiler_c_o=yes
<      fi
<    fi
<    chmod u+w . 2>&5
<    $RM conftest*
<    # SGI C++ compiler will create directory out/ii_files/ for
<    # template instantiation
<    test -d out/ii_files && $RM out/ii_files/* && rmdir out/ii_files
<    $RM out/* && rmdir out
<    cd ..
<    $RM -r conftest
<    $RM conftest*
< 
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_c_o" >&5
< $as_echo "$lt_cv_prog_compiler_c_o" >&6; }
< 
< 
< 
< 
< hard_links="nottested"
< if test "$lt_cv_prog_compiler_c_o" = no && test "$need_locks" != no; then
<   # do not overwrite the value of need_locks provided by the user
<   { $as_echo "$as_me:${as_lineno-$LINENO}: checking if we can lock with hard links" >&5
< $as_echo_n "checking if we can lock with hard links... " >&6; }
<   hard_links=yes
<   $RM conftest*
<   ln conftest.a conftest.b 2>/dev/null && hard_links=no
<   touch conftest.a
<   ln conftest.a conftest.b 2>&5 || hard_links=no
<   ln conftest.a conftest.b 2>/dev/null && hard_links=no
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $hard_links" >&5
< $as_echo "$hard_links" >&6; }
<   if test "$hard_links" = no; then
<     { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&5
< $as_echo "$as_me: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&2;}
<     need_locks=warn
<   fi
< else
<   need_locks=no
< fi
< 
< 
< 
< 
< 
< 
<   { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the $compiler linker ($LD) supports shared libraries" >&5
< $as_echo_n "checking whether the $compiler linker ($LD) supports shared libraries... " >&6; }
< 
<   runpath_var=
<   allow_undefined_flag=
<   always_export_symbols=no
<   archive_cmds=
<   archive_expsym_cmds=
<   compiler_needs_object=no
<   enable_shared_with_static_runtimes=no
<   export_dynamic_flag_spec=
<   export_symbols_cmds='$NM $libobjs $convenience | $global_symbol_pipe | $SED '\''s/.* //'\'' | sort | uniq > $export_symbols'
<   hardcode_automatic=no
<   hardcode_direct=no
<   hardcode_direct_absolute=no
<   hardcode_libdir_flag_spec=
<   hardcode_libdir_separator=
<   hardcode_minus_L=no
<   hardcode_shlibpath_var=unsupported
<   inherit_rpath=no
<   link_all_deplibs=unknown
<   module_cmds=
<   module_expsym_cmds=
<   old_archive_from_new_cmds=
<   old_archive_from_expsyms_cmds=
<   thread_safe_flag_spec=
<   whole_archive_flag_spec=
<   # include_expsyms should be a list of space-separated symbols to be *always*
<   # included in the symbol list
<   include_expsyms=
<   # exclude_expsyms can be an extended regexp of symbols to exclude
<   # it will be wrapped by ` (' and `)$', so one must not match beginning or
<   # end of line.  Example: `a|bc|.*d.*' will exclude the symbols `a' and `bc',
<   # as well as any symbol that contains `d'.
<   exclude_expsyms='_GLOBAL_OFFSET_TABLE_|_GLOBAL__F[ID]_.*'
<   # Although _GLOBAL_OFFSET_TABLE_ is a valid symbol C name, most a.out
<   # platforms (ab)use it in PIC code, but their linkers get confused if
<   # the symbol is explicitly referenced.  Since portable code cannot
<   # rely on this symbol name, it's probably fine to never include it in
<   # preloaded symbol tables.
<   # Exclude shared library initialization/finalization symbols.
<   extract_expsyms_cmds=
< 
<   case $host_os in
<   cygwin* | mingw* | pw32* | cegcc*)
<     # FIXME: the MSVC++ port hasn't been tested in a loooong time
<     # When not using gcc, we currently assume that we are using
<     # Microsoft Visual C++.
<     if test "$GCC" != yes; then
<       with_gnu_ld=no
<     fi
<     ;;
<   interix*)
<     # we just hope/assume this is gcc and not c89 (= MSVC++)
<     with_gnu_ld=yes
<     ;;
<   openbsd*)
<     with_gnu_ld=no
<     ;;
<   linux* | k*bsd*-gnu | gnu*)
<     link_all_deplibs=no
<     ;;
<   esac
< 
<   ld_shlibs=yes
< 
<   # On some targets, GNU ld is compatible enough with the native linker
<   # that we're better off using the native interface for both.
<   lt_use_gnu_ld_interface=no
<   if test "$with_gnu_ld" = yes; then
<     case $host_os in
<       aix*)
< 	# The AIX port of GNU ld has always aspired to compatibility
< 	# with the native linker.  However, as the warning in the GNU ld
< 	# block says, versions before 2.19.5* couldn't really create working
< 	# shared libraries, regardless of the interface used.
< 	case `$LD -v 2>&1` in
< 	  *\ \(GNU\ Binutils\)\ 2.19.5*) ;;
< 	  *\ \(GNU\ Binutils\)\ 2.[2-9]*) ;;
< 	  *\ \(GNU\ Binutils\)\ [3-9]*) ;;
< 	  *)
< 	    lt_use_gnu_ld_interface=yes
< 	    ;;
< 	esac
< 	;;
<       *)
< 	lt_use_gnu_ld_interface=yes
< 	;;
<     esac
<   fi
< 
<   if test "$lt_use_gnu_ld_interface" = yes; then
<     # If archive_cmds runs LD, not CC, wlarc should be empty
<     wlarc='${wl}'
< 
<     # Set some defaults for GNU ld with shared library support. These
<     # are reset later if shared libraries are not supported. Putting them
<     # here allows them to be overridden if necessary.
<     runpath_var=LD_RUN_PATH
<     hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
<     export_dynamic_flag_spec='${wl}--export-dynamic'
<     # ancient GNU ld didn't support --whole-archive et. al.
<     if $LD --help 2>&1 | $GREP 'no-whole-archive' > /dev/null; then
<       whole_archive_flag_spec="$wlarc"'--whole-archive$convenience '"$wlarc"'--no-whole-archive'
<     else
<       whole_archive_flag_spec=
<     fi
<     supports_anon_versioning=no
<     case `$LD -v 2>&1` in
<       *GNU\ gold*) supports_anon_versioning=yes ;;
<       *\ [01].* | *\ 2.[0-9].* | *\ 2.10.*) ;; # catch versions < 2.11
<       *\ 2.11.93.0.2\ *) supports_anon_versioning=yes ;; # RH7.3 ...
<       *\ 2.11.92.0.12\ *) supports_anon_versioning=yes ;; # Mandrake 8.2 ...
<       *\ 2.11.*) ;; # other 2.11 versions
<       *) supports_anon_versioning=yes ;;
<     esac
< 
<     # See if GNU ld supports shared libraries.
<     case $host_os in
<     aix[3-9]*)
<       # On AIX/PPC, the GNU linker is very broken
<       if test "$host_cpu" != ia64; then
< 	ld_shlibs=no
< 	cat <<_LT_EOF 1>&2
< 
< *** Warning: the GNU linker, at least up to release 2.19, is reported
< *** to be unable to reliably create shared libraries on AIX.
< *** Therefore, libtool is disabling shared libraries support.  If you
< *** really care for shared libraries, you may want to install binutils
< *** 2.20 or above, or modify your PATH so that a non-GNU linker is found.
< *** You will then need to restart the configuration process.
< 
< _LT_EOF
<       fi
<       ;;
< 
<     amigaos*)
<       case $host_cpu in
<       powerpc)
<             # see comment about AmigaOS4 .so support
<             archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
<             archive_expsym_cmds=''
<         ;;
<       m68k)
<             archive_cmds='$RM $output_objdir/a2ixlibrary.data~$ECHO "#define NAME $libname" > $output_objdir/a2ixlibrary.data~$ECHO "#define LIBRARY_ID 1" >> $output_objdir/a2ixlibrary.data~$ECHO "#define VERSION $major" >> $output_objdir/a2ixlibrary.data~$ECHO "#define REVISION $revision" >> $output_objdir/a2ixlibrary.data~$AR $AR_FLAGS $lib $libobjs~$RANLIB $lib~(cd $output_objdir && a2ixlibrary -32)'
<             hardcode_libdir_flag_spec='-L$libdir'
<             hardcode_minus_L=yes
<         ;;
<       esac
<       ;;
< 
<     beos*)
<       if $LD --help 2>&1 | $GREP ': supported targets:.* elf' > /dev/null; then
< 	allow_undefined_flag=unsupported
< 	# Joseph Beckenbach <jrb3@best.com> says some releases of gcc
< 	# support --undefined.  This deserves some investigation.  FIXME
< 	archive_cmds='$CC -nostart $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
<       else
< 	ld_shlibs=no
<       fi
<       ;;
< 
<     cygwin* | mingw* | pw32* | cegcc*)
<       # _LT_TAGVAR(hardcode_libdir_flag_spec, ) is actually meaningless,
<       # as there is no search path for DLLs.
<       hardcode_libdir_flag_spec='-L$libdir'
<       export_dynamic_flag_spec='${wl}--export-all-symbols'
<       allow_undefined_flag=unsupported
<       always_export_symbols=no
<       enable_shared_with_static_runtimes=yes
<       export_symbols_cmds='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[BCDGRS][ ]/s/.*[ ]\([^ ]*\)/\1 DATA/;s/^.*[ ]__nm__\([^ ]*\)[ ][^ ]*/\1 DATA/;/^I[ ]/d;/^[AITW][ ]/s/.* //'\'' | sort | uniq > $export_symbols'
<       exclude_expsyms='[_]+GLOBAL_OFFSET_TABLE_|[_]+GLOBAL__[FID]_.*|[_]+head_[A-Za-z0-9_]+_dll|[A-Za-z0-9_]+_dll_iname'
< 
<       if $LD --help 2>&1 | $GREP 'auto-import' > /dev/null; then
<         archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags -o $output_objdir/$soname ${wl}--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
< 	# If the export-symbols file already is a .def file (1st line
< 	# is EXPORTS), use it as is; otherwise, prepend...
< 	archive_expsym_cmds='if test "x`$SED 1q $export_symbols`" = xEXPORTS; then
< 	  cp $export_symbols $output_objdir/$soname.def;
< 	else
< 	  echo EXPORTS > $output_objdir/$soname.def;
< 	  cat $export_symbols >> $output_objdir/$soname.def;
< 	fi~
< 	$CC -shared $output_objdir/$soname.def $libobjs $deplibs $compiler_flags -o $output_objdir/$soname ${wl}--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
<       else
< 	ld_shlibs=no
<       fi
<       ;;
< 
<     haiku*)
<       archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
<       link_all_deplibs=yes
<       ;;
< 
<     interix[3-9]*)
<       hardcode_direct=no
<       hardcode_shlibpath_var=no
<       hardcode_libdir_flag_spec='${wl}-rpath,$libdir'
<       export_dynamic_flag_spec='${wl}-E'
<       # Hack: On Interix 3.x, we cannot compile PIC because of a broken gcc.
<       # Instead, shared libraries are loaded at an image base (0x10000000 by
<       # default) and relocated if they conflict, which is a slow very memory
<       # consuming and fragmenting process.  To avoid this, we pick a random,
<       # 256 KiB-aligned image base between 0x50000000 and 0x6FFC0000 at link
<       # time.  Moving up from 0x10000000 also allows more sbrk(2) space.
<       archive_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-h,$soname ${wl}--image-base,`expr ${RANDOM-$$} % 4096 / 2 \* 262144 + 1342177280` -o $lib'
<       archive_expsym_cmds='sed "s,^,_," $export_symbols >$output_objdir/$soname.expsym~$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-h,$soname ${wl}--retain-symbols-file,$output_objdir/$soname.expsym ${wl}--image-base,`expr ${RANDOM-$$} % 4096 / 2 \* 262144 + 1342177280` -o $lib'
<       ;;
< 
<     gnu* | linux* | tpf* | k*bsd*-gnu | kopensolaris*-gnu)
<       tmp_diet=no
<       if test "$host_os" = linux-dietlibc; then
< 	case $cc_basename in
< 	  diet\ *) tmp_diet=yes;;	# linux-dietlibc with static linking (!diet-dyn)
< 	esac
<       fi
<       if $LD --help 2>&1 | $EGREP ': supported targets:.* elf' > /dev/null \
< 	 && test "$tmp_diet" = no
<       then
< 	tmp_addflag=' $pic_flag'
< 	tmp_sharedflag='-shared'
< 	case $cc_basename,$host_cpu in
<         pgcc*)				# Portland Group C compiler
< 	  whole_archive_flag_spec='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
< 	  tmp_addflag=' $pic_flag'
< 	  ;;
< 	pgf77* | pgf90* | pgf95* | pgfortran*)
< 					# Portland Group f77 and f90 compilers
< 	  whole_archive_flag_spec='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
< 	  tmp_addflag=' $pic_flag -Mnomain' ;;
< 	ecc*,ia64* | icc*,ia64*)	# Intel C compiler on ia64
< 	  tmp_addflag=' -i_dynamic' ;;
< 	efc*,ia64* | ifort*,ia64*)	# Intel Fortran compiler on ia64
< 	  tmp_addflag=' -i_dynamic -nofor_main' ;;
< 	ifc* | ifort*)			# Intel Fortran compiler
< 	  tmp_addflag=' -nofor_main' ;;
< 	lf95*)				# Lahey Fortran 8.1
< 	  whole_archive_flag_spec=
< 	  tmp_sharedflag='--shared' ;;
< 	xl[cC]* | bgxl[cC]* | mpixl[cC]*) # IBM XL C 8.0 on PPC (deal with xlf below)
< 	  tmp_sharedflag='-qmkshrobj'
< 	  tmp_addflag= ;;
< 	nvcc*)	# Cuda Compiler Driver 2.2
< 	  whole_archive_flag_spec='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
< 	  compiler_needs_object=yes
< 	  ;;
< 	esac
< 	case `$CC -V 2>&1 | sed 5q` in
< 	*Sun\ C*)			# Sun C 5.9
< 	  whole_archive_flag_spec='${wl}--whole-archive`new_convenience=; for conv in $convenience\"\"; do test -z \"$conv\" || new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
< 	  compiler_needs_object=yes
< 	  tmp_sharedflag='-G' ;;
< 	*Sun\ F*)			# Sun Fortran 8.3
< 	  tmp_sharedflag='-G' ;;
< 	esac
< 	archive_cmds='$CC '"$tmp_sharedflag""$tmp_addflag"' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
< 
<         if test "x$supports_anon_versioning" = xyes; then
<           archive_expsym_cmds='echo "{ global:" > $output_objdir/$libname.ver~
< 	    cat $export_symbols | sed -e "s/\(.*\)/\1;/" >> $output_objdir/$libname.ver~
< 	    echo "local: *; };" >> $output_objdir/$libname.ver~
< 	    $CC '"$tmp_sharedflag""$tmp_addflag"' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-version-script ${wl}$output_objdir/$libname.ver -o $lib'
<         fi
< 
< 	case $cc_basename in
< 	xlf* | bgf* | bgxlf* | mpixlf*)
< 	  # IBM XL Fortran 10.1 on PPC cannot create shared libs itself
< 	  whole_archive_flag_spec='--whole-archive$convenience --no-whole-archive'
< 	  hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
< 	  archive_cmds='$LD -shared $libobjs $deplibs $linker_flags -soname $soname -o $lib'
< 	  if test "x$supports_anon_versioning" = xyes; then
< 	    archive_expsym_cmds='echo "{ global:" > $output_objdir/$libname.ver~
< 	      cat $export_symbols | sed -e "s/\(.*\)/\1;/" >> $output_objdir/$libname.ver~
< 	      echo "local: *; };" >> $output_objdir/$libname.ver~
< 	      $LD -shared $libobjs $deplibs $linker_flags -soname $soname -version-script $output_objdir/$libname.ver -o $lib'
< 	  fi
< 	  ;;
< 	esac
<       else
<         ld_shlibs=no
<       fi
<       ;;
< 
<     netbsd* | netbsdelf*-gnu)
<       if echo __ELF__ | $CC -E - | $GREP __ELF__ >/dev/null; then
< 	archive_cmds='$LD -Bshareable $libobjs $deplibs $linker_flags -o $lib'
< 	wlarc=
<       else
< 	archive_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
< 	archive_expsym_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
<       fi
<       ;;
< 
<     solaris*)
<       if $LD -v 2>&1 | $GREP 'BFD 2\.8' > /dev/null; then
< 	ld_shlibs=no
< 	cat <<_LT_EOF 1>&2
< 
< *** Warning: The releases 2.8.* of the GNU linker cannot reliably
< *** create shared libraries on Solaris systems.  Therefore, libtool
< *** is disabling shared libraries support.  We urge you to upgrade GNU
< *** binutils to release 2.9.1 or newer.  Another option is to modify
< *** your PATH or compiler configuration so that the native linker is
< *** used, and then restart.
< 
< _LT_EOF
<       elif $LD --help 2>&1 | $GREP ': supported targets:.* elf' > /dev/null; then
< 	archive_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
< 	archive_expsym_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
<       else
< 	ld_shlibs=no
<       fi
<       ;;
< 
<     sysv5* | sco3.2v5* | sco5v6* | unixware* | OpenUNIX*)
<       case `$LD -v 2>&1` in
<         *\ [01].* | *\ 2.[0-9].* | *\ 2.1[0-5].*)
< 	ld_shlibs=no
< 	cat <<_LT_EOF 1>&2
< 
< *** Warning: Releases of the GNU linker prior to 2.16.91.0.3 can not
< *** reliably create shared libraries on SCO systems.  Therefore, libtool
< *** is disabling shared libraries support.  We urge you to upgrade GNU
< *** binutils to release 2.16.91.0.3 or newer.  Another option is to modify
< *** your PATH or compiler configuration so that the native linker is
< *** used, and then restart.
< 
< _LT_EOF
< 	;;
< 	*)
< 	  # For security reasons, it is highly recommended that you always
< 	  # use absolute paths for naming shared libraries, and exclude the
< 	  # DT_RUNPATH tag from executables and libraries.  But doing so
< 	  # requires that you compile everything twice, which is a pain.
< 	  if $LD --help 2>&1 | $GREP ': supported targets:.* elf' > /dev/null; then
< 	    hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
< 	    archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
< 	    archive_expsym_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
< 	  else
< 	    ld_shlibs=no
< 	  fi
< 	;;
<       esac
<       ;;
< 
<     sunos4*)
<       archive_cmds='$LD -assert pure-text -Bshareable -o $lib $libobjs $deplibs $linker_flags'
<       wlarc=
<       hardcode_direct=yes
<       hardcode_shlibpath_var=no
<       ;;
< 
<     *)
<       if $LD --help 2>&1 | $GREP ': supported targets:.* elf' > /dev/null; then
< 	archive_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
< 	archive_expsym_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
<       else
< 	ld_shlibs=no
<       fi
<       ;;
<     esac
< 
<     if test "$ld_shlibs" = no; then
<       runpath_var=
<       hardcode_libdir_flag_spec=
<       export_dynamic_flag_spec=
<       whole_archive_flag_spec=
<     fi
<   else
<     # PORTME fill in a description of your system's linker (not GNU ld)
<     case $host_os in
<     aix3*)
<       allow_undefined_flag=unsupported
<       always_export_symbols=yes
<       archive_expsym_cmds='$LD -o $output_objdir/$soname $libobjs $deplibs $linker_flags -bE:$export_symbols -T512 -H512 -bM:SRE~$AR $AR_FLAGS $lib $output_objdir/$soname'
<       # Note: this linker hardcodes the directories in LIBPATH if there
<       # are no directories specified by -L.
<       hardcode_minus_L=yes
<       if test "$GCC" = yes && test -z "$lt_prog_compiler_static"; then
< 	# Neither direct hardcoding nor static linking is supported with a
< 	# broken collect2.
< 	hardcode_direct=unsupported
<       fi
<       ;;
< 
<     aix[4-9]*)
<       if test "$host_cpu" = ia64; then
< 	# On IA64, the linker does run time linking by default, so we don't
< 	# have to do anything special.
< 	aix_use_runtimelinking=no
< 	exp_sym_flag='-Bexport'
< 	no_entry_flag=""
<       else
< 	# If we're using GNU nm, then we don't want the "-C" option.
< 	# -C means demangle to AIX nm, but means don't demangle with GNU nm
< 	# Also, AIX nm treats weak defined symbols like other global
< 	# defined symbols, whereas GNU nm marks them as "W".
< 	if $NM -V 2>&1 | $GREP 'GNU' > /dev/null; then
< 	  export_symbols_cmds='$NM -Bpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B") || (\$ 2 == "W")) && (substr(\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
< 	else
< 	  export_symbols_cmds='$NM -BCpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B")) && (substr(\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
< 	fi
< 	aix_use_runtimelinking=no
< 
< 	# Test if we are trying to use run time linking or normal
< 	# AIX style linking. If -brtl is somewhere in LDFLAGS, we
< 	# need to do runtime linking.
< 	case $host_os in aix4.[23]|aix4.[23].*|aix[5-9]*)
< 	  for ld_flag in $LDFLAGS; do
< 	  if (test $ld_flag = "-brtl" || test $ld_flag = "-Wl,-brtl"); then
< 	    aix_use_runtimelinking=yes
< 	    break
< 	  fi
< 	  done
< 	  ;;
< 	esac
< 
< 	exp_sym_flag='-bexport'
< 	no_entry_flag='-bnoentry'
<       fi
< 
<       # When large executables or shared objects are built, AIX ld can
<       # have problems creating the table of contents.  If linking a library
<       # or program results in "error TOC overflow" add -mminimal-toc to
<       # CXXFLAGS/CFLAGS for g++/gcc.  In the cases where that is not
<       # enough to fix the problem, add -Wl,-bbigtoc to LDFLAGS.
< 
<       archive_cmds=''
<       hardcode_direct=yes
<       hardcode_direct_absolute=yes
<       hardcode_libdir_separator=':'
<       link_all_deplibs=yes
<       file_list_spec='${wl}-f,'
< 
<       if test "$GCC" = yes; then
< 	case $host_os in aix4.[012]|aix4.[012].*)
< 	# We only want to do this on AIX 4.2 and lower, the check
< 	# below for broken collect2 doesn't work under 4.3+
< 	  collect2name=`${CC} -print-prog-name=collect2`
< 	  if test -f "$collect2name" &&
< 	   strings "$collect2name" | $GREP resolve_lib_name >/dev/null
< 	  then
< 	  # We have reworked collect2
< 	  :
< 	  else
< 	  # We have old collect2
< 	  hardcode_direct=unsupported
< 	  # It fails to find uninstalled libraries when the uninstalled
< 	  # path is not listed in the libpath.  Setting hardcode_minus_L
< 	  # to unsupported forces relinking
< 	  hardcode_minus_L=yes
< 	  hardcode_libdir_flag_spec='-L$libdir'
< 	  hardcode_libdir_separator=
< 	  fi
< 	  ;;
< 	esac
< 	shared_flag='-shared'
< 	if test "$aix_use_runtimelinking" = yes; then
< 	  shared_flag="$shared_flag "'${wl}-G'
< 	fi
< 	link_all_deplibs=no
<       else
< 	# not using gcc
< 	if test "$host_cpu" = ia64; then
< 	# VisualAge C++, Version 5.5 for AIX 5L for IA-64, Beta 3 Release
< 	# chokes on -Wl,-G. The following line is correct:
< 	  shared_flag='-G'
< 	else
< 	  if test "$aix_use_runtimelinking" = yes; then
< 	    shared_flag='${wl}-G'
< 	  else
< 	    shared_flag='${wl}-bM:SRE'
< 	  fi
< 	fi
<       fi
< 
<       export_dynamic_flag_spec='${wl}-bexpall'
<       # It seems that -bexpall does not export symbols beginning with
<       # underscore (_), so it is better to generate a list of symbols to export.
<       always_export_symbols=yes
<       if test "$aix_use_runtimelinking" = yes; then
< 	# Warning - without using the other runtime loading flags (-brtl),
< 	# -berok will link without error, but may produce a broken library.
< 	allow_undefined_flag='-berok'
<         # Determine the default libpath from the value encoded in an
<         # empty executable.
<         if test "${lt_cv_aix_libpath+set}" = set; then
<   aix_libpath=$lt_cv_aix_libpath
< else
<   if ${lt_cv_aix_libpath_+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
< /* end confdefs.h.  */
< 
< int
< main ()
< {
< 
<   ;
<   return 0;
< }
< _ACEOF
< if ac_fn_c_try_link "$LINENO"; then :
< 
<   lt_aix_libpath_sed='
<       /Import File Strings/,/^$/ {
< 	  /^0/ {
< 	      s/^0  *\([^ ]*\) *$/\1/
< 	      p
< 	  }
<       }'
<   lt_cv_aix_libpath_=`dump -H conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
<   # Check for a 64-bit object if we didn't find anything.
<   if test -z "$lt_cv_aix_libpath_"; then
<     lt_cv_aix_libpath_=`dump -HX64 conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
<   fi
< fi
< rm -f core conftest.err conftest.$ac_objext \
<     conftest$ac_exeext conftest.$ac_ext
<   if test -z "$lt_cv_aix_libpath_"; then
<     lt_cv_aix_libpath_="/usr/lib:/lib"
<   fi
< 
< fi
< 
<   aix_libpath=$lt_cv_aix_libpath_
< fi
< 
<         hardcode_libdir_flag_spec='${wl}-blibpath:$libdir:'"$aix_libpath"
<         archive_expsym_cmds='$CC -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags `if test "x${allow_undefined_flag}" != "x"; then func_echo_all "${wl}${allow_undefined_flag}"; else :; fi` '"\${wl}$exp_sym_flag:\$export_symbols $shared_flag"
<       else
< 	if test "$host_cpu" = ia64; then
< 	  hardcode_libdir_flag_spec='${wl}-R $libdir:/usr/lib:/lib'
< 	  allow_undefined_flag="-z nodefs"
< 	  archive_expsym_cmds="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags ${wl}${allow_undefined_flag} '"\${wl}$exp_sym_flag:\$export_symbols"
< 	else
< 	 # Determine the default libpath from the value encoded in an
< 	 # empty executable.
< 	 if test "${lt_cv_aix_libpath+set}" = set; then
<   aix_libpath=$lt_cv_aix_libpath
< else
<   if ${lt_cv_aix_libpath_+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
< /* end confdefs.h.  */
< 
< int
< main ()
< {
< 
<   ;
<   return 0;
< }
< _ACEOF
< if ac_fn_c_try_link "$LINENO"; then :
< 
<   lt_aix_libpath_sed='
<       /Import File Strings/,/^$/ {
< 	  /^0/ {
< 	      s/^0  *\([^ ]*\) *$/\1/
< 	      p
< 	  }
<       }'
<   lt_cv_aix_libpath_=`dump -H conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
<   # Check for a 64-bit object if we didn't find anything.
<   if test -z "$lt_cv_aix_libpath_"; then
<     lt_cv_aix_libpath_=`dump -HX64 conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
<   fi
< fi
< rm -f core conftest.err conftest.$ac_objext \
<     conftest$ac_exeext conftest.$ac_ext
<   if test -z "$lt_cv_aix_libpath_"; then
<     lt_cv_aix_libpath_="/usr/lib:/lib"
<   fi
< 
< fi
< 
<   aix_libpath=$lt_cv_aix_libpath_
< fi
< 
< 	 hardcode_libdir_flag_spec='${wl}-blibpath:$libdir:'"$aix_libpath"
< 	  # Warning - without using the other run time loading flags,
< 	  # -berok will link without error, but may produce a broken library.
< 	  no_undefined_flag=' ${wl}-bernotok'
< 	  allow_undefined_flag=' ${wl}-berok'
< 	  if test "$with_gnu_ld" = yes; then
< 	    # We only use this code for GNU lds that support --whole-archive.
< 	    whole_archive_flag_spec='${wl}--whole-archive$convenience ${wl}--no-whole-archive'
< 	  else
< 	    # Exported symbols can be pulled into shared objects from archives
< 	    whole_archive_flag_spec='$convenience'
< 	  fi
< 	  archive_cmds_need_lc=yes
< 	  # This is similar to how AIX traditionally builds its shared libraries.
< 	  archive_expsym_cmds="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs ${wl}-bnoentry $compiler_flags ${wl}-bE:$export_symbols${allow_undefined_flag}~$AR $AR_FLAGS $output_objdir/$libname$release.a $output_objdir/$soname'
< 	fi
<       fi
<       ;;
< 
<     amigaos*)
<       case $host_cpu in
<       powerpc)
<             # see comment about AmigaOS4 .so support
<             archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
<             archive_expsym_cmds=''
<         ;;
<       m68k)
<             archive_cmds='$RM $output_objdir/a2ixlibrary.data~$ECHO "#define NAME $libname" > $output_objdir/a2ixlibrary.data~$ECHO "#define LIBRARY_ID 1" >> $output_objdir/a2ixlibrary.data~$ECHO "#define VERSION $major" >> $output_objdir/a2ixlibrary.data~$ECHO "#define REVISION $revision" >> $output_objdir/a2ixlibrary.data~$AR $AR_FLAGS $lib $libobjs~$RANLIB $lib~(cd $output_objdir && a2ixlibrary -32)'
<             hardcode_libdir_flag_spec='-L$libdir'
<             hardcode_minus_L=yes
<         ;;
<       esac
<       ;;
< 
<     bsdi[45]*)
<       export_dynamic_flag_spec=-rdynamic
<       ;;
< 
<     cygwin* | mingw* | pw32* | cegcc*)
<       # When not using gcc, we currently assume that we are using
<       # Microsoft Visual C++.
<       # hardcode_libdir_flag_spec is actually meaningless, as there is
<       # no search path for DLLs.
<       case $cc_basename in
<       cl*)
< 	# Native MSVC
< 	hardcode_libdir_flag_spec=' '
< 	allow_undefined_flag=unsupported
< 	always_export_symbols=yes
< 	file_list_spec='@'
< 	# Tell ltmain to make .lib files, not .a files.
< 	libext=lib
< 	# Tell ltmain to make .dll files, not .so files.
< 	shrext_cmds=".dll"
< 	# FIXME: Setting linknames here is a bad hack.
< 	archive_cmds='$CC -o $output_objdir/$soname $libobjs $compiler_flags $deplibs -Wl,-dll~linknames='
< 	archive_expsym_cmds='if test "x`$SED 1q $export_symbols`" = xEXPORTS; then
< 	    sed -n -e 's/\\\\\\\(.*\\\\\\\)/-link\\\ -EXPORT:\\\\\\\1/' -e '1\\\!p' < $export_symbols > $output_objdir/$soname.exp;
< 	  else
< 	    sed -e 's/\\\\\\\(.*\\\\\\\)/-link\\\ -EXPORT:\\\\\\\1/' < $export_symbols > $output_objdir/$soname.exp;
< 	  fi~
< 	  $CC -o $tool_output_objdir$soname $libobjs $compiler_flags $deplibs "@$tool_output_objdir$soname.exp" -Wl,-DLL,-IMPLIB:"$tool_output_objdir$libname.dll.lib"~
< 	  linknames='
< 	# The linker will not automatically build a static lib if we build a DLL.
< 	# _LT_TAGVAR(old_archive_from_new_cmds, )='true'
< 	enable_shared_with_static_runtimes=yes
< 	exclude_expsyms='_NULL_IMPORT_DESCRIPTOR|_IMPORT_DESCRIPTOR_.*'
< 	export_symbols_cmds='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[BCDGRS][ ]/s/.*[ ]\([^ ]*\)/\1,DATA/'\'' | $SED -e '\''/^[AITW][ ]/s/.*[ ]//'\'' | sort | uniq > $export_symbols'
< 	# Don't use ranlib
< 	old_postinstall_cmds='chmod 644 $oldlib'
< 	postlink_cmds='lt_outputfile="@OUTPUT@"~
< 	  lt_tool_outputfile="@TOOL_OUTPUT@"~
< 	  case $lt_outputfile in
< 	    *.exe|*.EXE) ;;
< 	    *)
< 	      lt_outputfile="$lt_outputfile.exe"
< 	      lt_tool_outputfile="$lt_tool_outputfile.exe"
< 	      ;;
< 	  esac~
< 	  if test "$MANIFEST_TOOL" != ":" && test -f "$lt_outputfile.manifest"; then
< 	    $MANIFEST_TOOL -manifest "$lt_tool_outputfile.manifest" -outputresource:"$lt_tool_outputfile" || exit 1;
< 	    $RM "$lt_outputfile.manifest";
< 	  fi'
< 	;;
<       *)
< 	# Assume MSVC wrapper
< 	hardcode_libdir_flag_spec=' '
< 	allow_undefined_flag=unsupported
< 	# Tell ltmain to make .lib files, not .a files.
< 	libext=lib
< 	# Tell ltmain to make .dll files, not .so files.
< 	shrext_cmds=".dll"
< 	# FIXME: Setting linknames here is a bad hack.
< 	archive_cmds='$CC -o $lib $libobjs $compiler_flags `func_echo_all "$deplibs" | $SED '\''s/ -lc$//'\''` -link -dll~linknames='
< 	# The linker will automatically build a .lib file if we build a DLL.
< 	old_archive_from_new_cmds='true'
< 	# FIXME: Should let the user specify the lib program.
< 	old_archive_cmds='lib -OUT:$oldlib$oldobjs$old_deplibs'
< 	enable_shared_with_static_runtimes=yes
< 	;;
<       esac
<       ;;
< 
<     darwin* | rhapsody*)
< 
< 
<   archive_cmds_need_lc=no
<   hardcode_direct=no
<   hardcode_automatic=yes
<   hardcode_shlibpath_var=unsupported
<   if test "$lt_cv_ld_force_load" = "yes"; then
<     whole_archive_flag_spec='`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience ${wl}-force_load,$conv\"; done; func_echo_all \"$new_convenience\"`'
< 
<   else
<     whole_archive_flag_spec=''
<   fi
<   link_all_deplibs=yes
<   allow_undefined_flag="$_lt_dar_allow_undefined"
<   case $cc_basename in
<      ifort*) _lt_dar_can_shared=yes ;;
<      *) _lt_dar_can_shared=$GCC ;;
<   esac
<   if test "$_lt_dar_can_shared" = "yes"; then
<     output_verbose_link_cmd=func_echo_all
<     archive_cmds="\$CC -dynamiclib \$allow_undefined_flag -o \$lib \$libobjs \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring $_lt_dar_single_mod${_lt_dsymutil}"
<     module_cmds="\$CC \$allow_undefined_flag -o \$lib -bundle \$libobjs \$deplibs \$compiler_flags${_lt_dsymutil}"
<     archive_expsym_cmds="sed 's,^,_,' < \$export_symbols > \$output_objdir/\${libname}-symbols.expsym~\$CC -dynamiclib \$allow_undefined_flag -o \$lib \$libobjs \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring ${_lt_dar_single_mod}${_lt_dar_export_syms}${_lt_dsymutil}"
<     module_expsym_cmds="sed -e 's,^,_,' < \$export_symbols > \$output_objdir/\${libname}-symbols.expsym~\$CC \$allow_undefined_flag -o \$lib -bundle \$libobjs \$deplibs \$compiler_flags${_lt_dar_export_syms}${_lt_dsymutil}"
< 
<   else
<   ld_shlibs=no
<   fi
< 
<       ;;
< 
<     dgux*)
<       archive_cmds='$LD -G -h $soname -o $lib $libobjs $deplibs $linker_flags'
<       hardcode_libdir_flag_spec='-L$libdir'
<       hardcode_shlibpath_var=no
<       ;;
< 
<     # FreeBSD 2.2.[012] allows us to include c++rt0.o to get C++ constructor
<     # support.  Future versions do this automatically, but an explicit c++rt0.o
<     # does not break anything, and helps significantly (at the cost of a little
<     # extra space).
<     freebsd2.2*)
<       archive_cmds='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags /usr/lib/c++rt0.o'
<       hardcode_libdir_flag_spec='-R$libdir'
<       hardcode_direct=yes
<       hardcode_shlibpath_var=no
<       ;;
< 
<     # Unfortunately, older versions of FreeBSD 2 do not have this feature.
<     freebsd2.*)
<       archive_cmds='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'
<       hardcode_direct=yes
<       hardcode_minus_L=yes
<       hardcode_shlibpath_var=no
<       ;;
< 
<     # FreeBSD 3 and greater uses gcc -shared to do shared libraries.
<     freebsd* | dragonfly*)
<       archive_cmds='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags'
<       hardcode_libdir_flag_spec='-R$libdir'
<       hardcode_direct=yes
<       hardcode_shlibpath_var=no
<       ;;
< 
<     hpux9*)
<       if test "$GCC" = yes; then
< 	archive_cmds='$RM $output_objdir/$soname~$CC -shared $pic_flag ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $libobjs $deplibs $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
<       else
< 	archive_cmds='$RM $output_objdir/$soname~$LD -b +b $install_libdir -o $output_objdir/$soname $libobjs $deplibs $linker_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
<       fi
<       hardcode_libdir_flag_spec='${wl}+b ${wl}$libdir'
<       hardcode_libdir_separator=:
<       hardcode_direct=yes
< 
<       # hardcode_minus_L: Not really in the search PATH,
<       # but as the default location of the library.
<       hardcode_minus_L=yes
<       export_dynamic_flag_spec='${wl}-E'
<       ;;
< 
<     hpux10*)
<       if test "$GCC" = yes && test "$with_gnu_ld" = no; then
< 	archive_cmds='$CC -shared $pic_flag ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
<       else
< 	archive_cmds='$LD -b +h $soname +b $install_libdir -o $lib $libobjs $deplibs $linker_flags'
<       fi
<       if test "$with_gnu_ld" = no; then
< 	hardcode_libdir_flag_spec='${wl}+b ${wl}$libdir'
< 	hardcode_libdir_separator=:
< 	hardcode_direct=yes
< 	hardcode_direct_absolute=yes
< 	export_dynamic_flag_spec='${wl}-E'
< 	# hardcode_minus_L: Not really in the search PATH,
< 	# but as the default location of the library.
< 	hardcode_minus_L=yes
<       fi
<       ;;
< 
<     hpux11*)
<       if test "$GCC" = yes && test "$with_gnu_ld" = no; then
< 	case $host_cpu in
< 	hppa*64*)
< 	  archive_cmds='$CC -shared ${wl}+h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
< 	  ;;
< 	ia64*)
< 	  archive_cmds='$CC -shared $pic_flag ${wl}+h ${wl}$soname ${wl}+nodefaultrpath -o $lib $libobjs $deplibs $compiler_flags'
< 	  ;;
< 	*)
< 	  archive_cmds='$CC -shared $pic_flag ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
< 	  ;;
< 	esac
<       else
< 	case $host_cpu in
< 	hppa*64*)
< 	  archive_cmds='$CC -b ${wl}+h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
< 	  ;;
< 	ia64*)
< 	  archive_cmds='$CC -b ${wl}+h ${wl}$soname ${wl}+nodefaultrpath -o $lib $libobjs $deplibs $compiler_flags'
< 	  ;;
< 	*)
< 
< 	  # Older versions of the 11.00 compiler do not understand -b yet
< 	  # (HP92453-01 A.11.01.20 doesn't, HP92453-01 B.11.X.35175-35176.GP does)
< 	  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $CC understands -b" >&5
< $as_echo_n "checking if $CC understands -b... " >&6; }
< if ${lt_cv_prog_compiler__b+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   lt_cv_prog_compiler__b=no
<    save_LDFLAGS="$LDFLAGS"
<    LDFLAGS="$LDFLAGS -b"
<    echo "$lt_simple_link_test_code" > conftest.$ac_ext
<    if (eval $ac_link 2>conftest.err) && test -s conftest$ac_exeext; then
<      # The linker can only warn and ignore the option if not recognized
<      # So say no if there are warnings
<      if test -s conftest.err; then
<        # Append any errors to the config.log.
<        cat conftest.err 1>&5
<        $ECHO "$_lt_linker_boilerplate" | $SED '/^$/d' > conftest.exp
<        $SED '/^$/d; /^ *+/d' conftest.err >conftest.er2
<        if diff conftest.exp conftest.er2 >/dev/null; then
<          lt_cv_prog_compiler__b=yes
<        fi
<      else
<        lt_cv_prog_compiler__b=yes
<      fi
<    fi
<    $RM -r conftest*
<    LDFLAGS="$save_LDFLAGS"
< 
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler__b" >&5
< $as_echo "$lt_cv_prog_compiler__b" >&6; }
< 
< if test x"$lt_cv_prog_compiler__b" = xyes; then
<     archive_cmds='$CC -b ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
< else
<     archive_cmds='$LD -b +h $soname +b $install_libdir -o $lib $libobjs $deplibs $linker_flags'
< fi
< 
< 	  ;;
< 	esac
<       fi
<       if test "$with_gnu_ld" = no; then
< 	hardcode_libdir_flag_spec='${wl}+b ${wl}$libdir'
< 	hardcode_libdir_separator=:
< 
< 	case $host_cpu in
< 	hppa*64*|ia64*)
< 	  hardcode_direct=no
< 	  hardcode_shlibpath_var=no
< 	  ;;
< 	*)
< 	  hardcode_direct=yes
< 	  hardcode_direct_absolute=yes
< 	  export_dynamic_flag_spec='${wl}-E'
< 
< 	  # hardcode_minus_L: Not really in the search PATH,
< 	  # but as the default location of the library.
< 	  hardcode_minus_L=yes
< 	  ;;
< 	esac
<       fi
<       ;;
< 
<     irix5* | irix6* | nonstopux*)
<       if test "$GCC" = yes; then
< 	archive_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
< 	# Try to use the -exported_symbol ld option, if it does not
< 	# work, assume that -exports_file does not work either and
< 	# implicitly export all symbols.
< 	# This should be the same for all languages, so no per-tag cache variable.
< 	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the $host_os linker accepts -exported_symbol" >&5
< $as_echo_n "checking whether the $host_os linker accepts -exported_symbol... " >&6; }
< if ${lt_cv_irix_exported_symbol+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   save_LDFLAGS="$LDFLAGS"
< 	   LDFLAGS="$LDFLAGS -shared ${wl}-exported_symbol ${wl}foo ${wl}-update_registry ${wl}/dev/null"
< 	   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
< /* end confdefs.h.  */
< int foo (void) { return 0; }
< _ACEOF
< if ac_fn_c_try_link "$LINENO"; then :
<   lt_cv_irix_exported_symbol=yes
< else
<   lt_cv_irix_exported_symbol=no
< fi
< rm -f core conftest.err conftest.$ac_objext \
<     conftest$ac_exeext conftest.$ac_ext
<            LDFLAGS="$save_LDFLAGS"
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_irix_exported_symbol" >&5
< $as_echo "$lt_cv_irix_exported_symbol" >&6; }
< 	if test "$lt_cv_irix_exported_symbol" = yes; then
<           archive_expsym_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations ${wl}-exports_file ${wl}$export_symbols -o $lib'
< 	fi
<       else
< 	archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
< 	archive_expsym_cmds='$CC -shared $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -exports_file $export_symbols -o $lib'
<       fi
<       archive_cmds_need_lc='no'
<       hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
<       hardcode_libdir_separator=:
<       inherit_rpath=yes
<       link_all_deplibs=yes
<       ;;
< 
<     netbsd* | netbsdelf*-gnu)
<       if echo __ELF__ | $CC -E - | $GREP __ELF__ >/dev/null; then
< 	archive_cmds='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'  # a.out
<       else
< 	archive_cmds='$LD -shared -o $lib $libobjs $deplibs $linker_flags'      # ELF
<       fi
<       hardcode_libdir_flag_spec='-R$libdir'
<       hardcode_direct=yes
<       hardcode_shlibpath_var=no
<       ;;
< 
<     newsos6)
<       archive_cmds='$LD -G -h $soname -o $lib $libobjs $deplibs $linker_flags'
<       hardcode_direct=yes
<       hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
<       hardcode_libdir_separator=:
<       hardcode_shlibpath_var=no
<       ;;
< 
<     *nto* | *qnx*)
<       ;;
< 
<     openbsd*)
<       if test -f /usr/libexec/ld.so; then
< 	hardcode_direct=yes
< 	hardcode_shlibpath_var=no
< 	hardcode_direct_absolute=yes
< 	if test -z "`echo __ELF__ | $CC -E - | $GREP __ELF__`" || test "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
< 	  archive_cmds='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags'
< 	  archive_expsym_cmds='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-retain-symbols-file,$export_symbols'
< 	  hardcode_libdir_flag_spec='${wl}-rpath,$libdir'
< 	  export_dynamic_flag_spec='${wl}-E'
< 	else
< 	  case $host_os in
< 	   openbsd[01].* | openbsd2.[0-7] | openbsd2.[0-7].*)
< 	     archive_cmds='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'
< 	     hardcode_libdir_flag_spec='-R$libdir'
< 	     ;;
< 	   *)
< 	     archive_cmds='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags'
< 	     hardcode_libdir_flag_spec='${wl}-rpath,$libdir'
< 	     ;;
< 	  esac
< 	fi
<       else
< 	ld_shlibs=no
<       fi
<       ;;
< 
<     os2*)
<       hardcode_libdir_flag_spec='-L$libdir'
<       hardcode_minus_L=yes
<       allow_undefined_flag=unsupported
<       archive_cmds='$ECHO "LIBRARY $libname INITINSTANCE" > $output_objdir/$libname.def~$ECHO "DESCRIPTION \"$libname\"" >> $output_objdir/$libname.def~echo DATA >> $output_objdir/$libname.def~echo " SINGLE NONSHARED" >> $output_objdir/$libname.def~echo EXPORTS >> $output_objdir/$libname.def~emxexp $libobjs >> $output_objdir/$libname.def~$CC -Zdll -Zcrtdll -o $lib $libobjs $deplibs $compiler_flags $output_objdir/$libname.def'
<       old_archive_from_new_cmds='emximp -o $output_objdir/$libname.a $output_objdir/$libname.def'
<       ;;
< 
<     osf3*)
<       if test "$GCC" = yes; then
< 	allow_undefined_flag=' ${wl}-expect_unresolved ${wl}\*'
< 	archive_cmds='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
<       else
< 	allow_undefined_flag=' -expect_unresolved \*'
< 	archive_cmds='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
<       fi
<       archive_cmds_need_lc='no'
<       hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
<       hardcode_libdir_separator=:
<       ;;
< 
<     osf4* | osf5*)	# as osf3* with the addition of -msym flag
<       if test "$GCC" = yes; then
< 	allow_undefined_flag=' ${wl}-expect_unresolved ${wl}\*'
< 	archive_cmds='$CC -shared${allow_undefined_flag} $pic_flag $libobjs $deplibs $compiler_flags ${wl}-msym ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
< 	hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
<       else
< 	allow_undefined_flag=' -expect_unresolved \*'
< 	archive_cmds='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags -msym -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
< 	archive_expsym_cmds='for i in `cat $export_symbols`; do printf "%s %s\\n" -exported_symbol "\$i" >> $lib.exp; done; printf "%s\\n" "-hidden">> $lib.exp~
< 	$CC -shared${allow_undefined_flag} ${wl}-input ${wl}$lib.exp $compiler_flags $libobjs $deplibs -soname $soname `test -n "$verstring" && $ECHO "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib~$RM $lib.exp'
< 
< 	# Both c and cxx compiler support -rpath directly
< 	hardcode_libdir_flag_spec='-rpath $libdir'
<       fi
<       archive_cmds_need_lc='no'
<       hardcode_libdir_separator=:
<       ;;
< 
<     solaris*)
<       no_undefined_flag=' -z defs'
<       if test "$GCC" = yes; then
< 	wlarc='${wl}'
< 	archive_cmds='$CC -shared $pic_flag ${wl}-z ${wl}text ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
< 	archive_expsym_cmds='echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~echo "local: *; };" >> $lib.exp~
< 	  $CC -shared $pic_flag ${wl}-z ${wl}text ${wl}-M ${wl}$lib.exp ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags~$RM $lib.exp'
<       else
< 	case `$CC -V 2>&1` in
< 	*"Compilers 5.0"*)
< 	  wlarc=''
< 	  archive_cmds='$LD -G${allow_undefined_flag} -h $soname -o $lib $libobjs $deplibs $linker_flags'
< 	  archive_expsym_cmds='echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~echo "local: *; };" >> $lib.exp~
< 	  $LD -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $linker_flags~$RM $lib.exp'
< 	  ;;
< 	*)
< 	  wlarc='${wl}'
< 	  archive_cmds='$CC -G${allow_undefined_flag} -h $soname -o $lib $libobjs $deplibs $compiler_flags'
< 	  archive_expsym_cmds='echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~echo "local: *; };" >> $lib.exp~
< 	  $CC -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $compiler_flags~$RM $lib.exp'
< 	  ;;
< 	esac
<       fi
<       hardcode_libdir_flag_spec='-R$libdir'
<       hardcode_shlibpath_var=no
<       case $host_os in
<       solaris2.[0-5] | solaris2.[0-5].*) ;;
<       *)
< 	# The compiler driver will combine and reorder linker options,
< 	# but understands `-z linker_flag'.  GCC discards it without `$wl',
< 	# but is careful enough not to reorder.
< 	# Supported since Solaris 2.6 (maybe 2.5.1?)
< 	if test "$GCC" = yes; then
< 	  whole_archive_flag_spec='${wl}-z ${wl}allextract$convenience ${wl}-z ${wl}defaultextract'
< 	else
< 	  whole_archive_flag_spec='-z allextract$convenience -z defaultextract'
< 	fi
< 	;;
<       esac
<       link_all_deplibs=yes
<       ;;
< 
<     sunos4*)
<       if test "x$host_vendor" = xsequent; then
< 	# Use $CC to link under sequent, because it throws in some extra .o
< 	# files that make .init and .fini sections work.
< 	archive_cmds='$CC -G ${wl}-h $soname -o $lib $libobjs $deplibs $compiler_flags'
<       else
< 	archive_cmds='$LD -assert pure-text -Bstatic -o $lib $libobjs $deplibs $linker_flags'
<       fi
<       hardcode_libdir_flag_spec='-L$libdir'
<       hardcode_direct=yes
<       hardcode_minus_L=yes
<       hardcode_shlibpath_var=no
<       ;;
< 
<     sysv4)
<       case $host_vendor in
< 	sni)
< 	  archive_cmds='$LD -G -h $soname -o $lib $libobjs $deplibs $linker_flags'
< 	  hardcode_direct=yes # is this really true???
< 	;;
< 	siemens)
< 	  ## LD is ld it makes a PLAMLIB
< 	  ## CC just makes a GrossModule.
< 	  archive_cmds='$LD -G -o $lib $libobjs $deplibs $linker_flags'
< 	  reload_cmds='$CC -r -o $output$reload_objs'
< 	  hardcode_direct=no
<         ;;
< 	motorola)
< 	  archive_cmds='$LD -G -h $soname -o $lib $libobjs $deplibs $linker_flags'
< 	  hardcode_direct=no #Motorola manual says yes, but my tests say they lie
< 	;;
<       esac
<       runpath_var='LD_RUN_PATH'
<       hardcode_shlibpath_var=no
<       ;;
< 
<     sysv4.3*)
<       archive_cmds='$LD -G -h $soname -o $lib $libobjs $deplibs $linker_flags'
<       hardcode_shlibpath_var=no
<       export_dynamic_flag_spec='-Bexport'
<       ;;
< 
<     sysv4*MP*)
<       if test -d /usr/nec; then
< 	archive_cmds='$LD -G -h $soname -o $lib $libobjs $deplibs $linker_flags'
< 	hardcode_shlibpath_var=no
< 	runpath_var=LD_RUN_PATH
< 	hardcode_runpath_var=yes
< 	ld_shlibs=yes
<       fi
<       ;;
< 
<     sysv4*uw2* | sysv5OpenUNIX* | sysv5UnixWare7.[01].[10]* | unixware7* | sco3.2v5.0.[024]*)
<       no_undefined_flag='${wl}-z,text'
<       archive_cmds_need_lc=no
<       hardcode_shlibpath_var=no
<       runpath_var='LD_RUN_PATH'
< 
<       if test "$GCC" = yes; then
< 	archive_cmds='$CC -shared ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
< 	archive_expsym_cmds='$CC -shared ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
<       else
< 	archive_cmds='$CC -G ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
< 	archive_expsym_cmds='$CC -G ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
<       fi
<       ;;
< 
<     sysv5* | sco3.2v5* | sco5v6*)
<       # Note: We can NOT use -z defs as we might desire, because we do not
<       # link with -lc, and that would cause any symbols used from libc to
<       # always be unresolved, which means just about no library would
<       # ever link correctly.  If we're not using GNU ld we use -z text
<       # though, which does catch some bad symbols but isn't as heavy-handed
<       # as -z defs.
<       no_undefined_flag='${wl}-z,text'
<       allow_undefined_flag='${wl}-z,nodefs'
<       archive_cmds_need_lc=no
<       hardcode_shlibpath_var=no
<       hardcode_libdir_flag_spec='${wl}-R,$libdir'
<       hardcode_libdir_separator=':'
<       link_all_deplibs=yes
<       export_dynamic_flag_spec='${wl}-Bexport'
<       runpath_var='LD_RUN_PATH'
< 
<       if test "$GCC" = yes; then
< 	archive_cmds='$CC -shared ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
< 	archive_expsym_cmds='$CC -shared ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
<       else
< 	archive_cmds='$CC -G ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
< 	archive_expsym_cmds='$CC -G ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
<       fi
<       ;;
< 
<     uts4*)
<       archive_cmds='$LD -G -h $soname -o $lib $libobjs $deplibs $linker_flags'
<       hardcode_libdir_flag_spec='-L$libdir'
<       hardcode_shlibpath_var=no
<       ;;
< 
<     *)
<       ld_shlibs=no
<       ;;
<     esac
< 
<     if test x$host_vendor = xsni; then
<       case $host in
<       sysv4 | sysv4.2uw2* | sysv4.3* | sysv5*)
< 	export_dynamic_flag_spec='${wl}-Blargedynsym'
< 	;;
<       esac
<     fi
<   fi
< 
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ld_shlibs" >&5
< $as_echo "$ld_shlibs" >&6; }
< test "$ld_shlibs" = no && can_build_shared=no
< 
< with_gnu_ld=$with_gnu_ld
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< #
< # Do we need to explicitly link libc?
< #
< case "x$archive_cmds_need_lc" in
< x|xyes)
<   # Assume -lc should be added
<   archive_cmds_need_lc=yes
< 
<   if test "$enable_shared" = yes && test "$GCC" = yes; then
<     case $archive_cmds in
<     *'~'*)
<       # FIXME: we may have to deal with multi-command sequences.
<       ;;
<     '$CC '*)
<       # Test whether the compiler implicitly links with -lc since on some
<       # systems, -lgcc has to come before -lc. If gcc already passes -lc
<       # to ld, don't add -lc before -lgcc.
<       { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether -lc should be explicitly linked in" >&5
< $as_echo_n "checking whether -lc should be explicitly linked in... " >&6; }
< if ${lt_cv_archive_cmds_need_lc+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   $RM conftest*
< 	echo "$lt_simple_compile_test_code" > conftest.$ac_ext
< 
< 	if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
<   (eval $ac_compile) 2>&5
<   ac_status=$?
<   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
<   test $ac_status = 0; } 2>conftest.err; then
< 	  soname=conftest
< 	  lib=conftest
< 	  libobjs=conftest.$ac_objext
< 	  deplibs=
< 	  wl=$lt_prog_compiler_wl
< 	  pic_flag=$lt_prog_compiler_pic
< 	  compiler_flags=-v
< 	  linker_flags=-v
< 	  verstring=
< 	  output_objdir=.
< 	  libname=conftest
< 	  lt_save_allow_undefined_flag=$allow_undefined_flag
< 	  allow_undefined_flag=
< 	  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$archive_cmds 2\>\&1 \| $GREP \" -lc \" \>/dev/null 2\>\&1\""; } >&5
<   (eval $archive_cmds 2\>\&1 \| $GREP \" -lc \" \>/dev/null 2\>\&1) 2>&5
<   ac_status=$?
<   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
<   test $ac_status = 0; }
< 	  then
< 	    lt_cv_archive_cmds_need_lc=no
< 	  else
< 	    lt_cv_archive_cmds_need_lc=yes
< 	  fi
< 	  allow_undefined_flag=$lt_save_allow_undefined_flag
< 	else
< 	  cat conftest.err 1>&5
< 	fi
< 	$RM conftest*
< 
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_archive_cmds_need_lc" >&5
< $as_echo "$lt_cv_archive_cmds_need_lc" >&6; }
<       archive_cmds_need_lc=$lt_cv_archive_cmds_need_lc
<       ;;
<     esac
<   fi
<   ;;
< esac
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
<   { $as_echo "$as_me:${as_lineno-$LINENO}: checking dynamic linker characteristics" >&5
< $as_echo_n "checking dynamic linker characteristics... " >&6; }
< 
< if test "$GCC" = yes; then
<   case $host_os in
<     darwin*) lt_awk_arg="/^libraries:/,/LR/" ;;
<     *) lt_awk_arg="/^libraries:/" ;;
<   esac
<   case $host_os in
<     mingw* | cegcc*) lt_sed_strip_eq="s,=\([A-Za-z]:\),\1,g" ;;
<     *) lt_sed_strip_eq="s,=/,/,g" ;;
<   esac
<   lt_search_path_spec=`$CC -print-search-dirs | awk $lt_awk_arg | $SED -e "s/^libraries://" -e $lt_sed_strip_eq`
<   case $lt_search_path_spec in
<   *\;*)
<     # if the path contains ";" then we assume it to be the separator
<     # otherwise default to the standard path separator (i.e. ":") - it is
<     # assumed that no part of a normal pathname contains ";" but that should
<     # okay in the real world where ";" in dirpaths is itself problematic.
<     lt_search_path_spec=`$ECHO "$lt_search_path_spec" | $SED 's/;/ /g'`
<     ;;
<   *)
<     lt_search_path_spec=`$ECHO "$lt_search_path_spec" | $SED "s/$PATH_SEPARATOR/ /g"`
<     ;;
<   esac
<   # Ok, now we have the path, separated by spaces, we can step through it
<   # and add multilib dir if necessary.
<   lt_tmp_lt_search_path_spec=
<   lt_multi_os_dir=`$CC $CPPFLAGS $CFLAGS $LDFLAGS -print-multi-os-directory 2>/dev/null`
<   for lt_sys_path in $lt_search_path_spec; do
<     if test -d "$lt_sys_path/$lt_multi_os_dir"; then
<       lt_tmp_lt_search_path_spec="$lt_tmp_lt_search_path_spec $lt_sys_path/$lt_multi_os_dir"
<     else
<       test -d "$lt_sys_path" && \
< 	lt_tmp_lt_search_path_spec="$lt_tmp_lt_search_path_spec $lt_sys_path"
<     fi
<   done
<   lt_search_path_spec=`$ECHO "$lt_tmp_lt_search_path_spec" | awk '
< BEGIN {RS=" "; FS="/|\n";} {
<   lt_foo="";
<   lt_count=0;
<   for (lt_i = NF; lt_i > 0; lt_i--) {
<     if ($lt_i != "" && $lt_i != ".") {
<       if ($lt_i == "..") {
<         lt_count++;
<       } else {
<         if (lt_count == 0) {
<           lt_foo="/" $lt_i lt_foo;
<         } else {
<           lt_count--;
<         }
<       }
<     }
<   }
<   if (lt_foo != "") { lt_freq[lt_foo]++; }
<   if (lt_freq[lt_foo] == 1) { print lt_foo; }
< }'`
<   # AWK program above erroneously prepends '/' to C:/dos/paths
<   # for these hosts.
<   case $host_os in
<     mingw* | cegcc*) lt_search_path_spec=`$ECHO "$lt_search_path_spec" |\
<       $SED 's,/\([A-Za-z]:\),\1,g'` ;;
<   esac
<   sys_lib_search_path_spec=`$ECHO "$lt_search_path_spec" | $lt_NL2SP`
< else
<   sys_lib_search_path_spec="/lib /usr/lib /usr/local/lib"
< fi
< library_names_spec=
< libname_spec='lib$name'
< soname_spec=
< shrext_cmds=".so"
< postinstall_cmds=
< postuninstall_cmds=
< finish_cmds=
< finish_eval=
< shlibpath_var=
< shlibpath_overrides_runpath=unknown
< version_type=none
< dynamic_linker="$host_os ld.so"
< sys_lib_dlsearch_path_spec="/lib /usr/lib"
< need_lib_prefix=unknown
< hardcode_into_libs=no
< 
< # when you set need_version to no, make sure it does not cause -set_version
< # flags to be left without arguments
< need_version=unknown
< 
< case $host_os in
< aix3*)
<   version_type=linux # correct to gnu/linux during the next big refactor
<   library_names_spec='${libname}${release}${shared_ext}$versuffix $libname.a'
<   shlibpath_var=LIBPATH
< 
<   # AIX 3 has no versioning support, so we append a major version to the name.
<   soname_spec='${libname}${release}${shared_ext}$major'
<   ;;
< 
< aix[4-9]*)
<   version_type=linux # correct to gnu/linux during the next big refactor
<   need_lib_prefix=no
<   need_version=no
<   hardcode_into_libs=yes
<   if test "$host_cpu" = ia64; then
<     # AIX 5 supports IA64
<     library_names_spec='${libname}${release}${shared_ext}$major ${libname}${release}${shared_ext}$versuffix $libname${shared_ext}'
<     shlibpath_var=LD_LIBRARY_PATH
<   else
<     # With GCC up to 2.95.x, collect2 would create an import file
<     # for dependence libraries.  The import file would start with
<     # the line `#! .'.  This would cause the generated library to
<     # depend on `.', always an invalid library.  This was fixed in
<     # development snapshots of GCC prior to 3.0.
<     case $host_os in
<       aix4 | aix4.[01] | aix4.[01].*)
<       if { echo '#if __GNUC__ > 2 || (__GNUC__ == 2 && __GNUC_MINOR__ >= 97)'
< 	   echo ' yes '
< 	   echo '#endif'; } | ${CC} -E - | $GREP yes > /dev/null; then
< 	:
<       else
< 	can_build_shared=no
<       fi
<       ;;
<     esac
<     # AIX (on Power*) has no versioning support, so currently we can not hardcode correct
<     # soname into executable. Probably we can add versioning support to
<     # collect2, so additional links can be useful in future.
<     if test "$aix_use_runtimelinking" = yes; then
<       # If using run time linking (on AIX 4.2 or later) use lib<name>.so
<       # instead of lib<name>.a to let people know that these are not
<       # typical AIX shared libraries.
<       library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
<     else
<       # We preserve .a as extension for shared libraries through AIX4.2
<       # and later when we are not doing run time linking.
<       library_names_spec='${libname}${release}.a $libname.a'
<       soname_spec='${libname}${release}${shared_ext}$major'
<     fi
<     shlibpath_var=LIBPATH
<   fi
<   ;;
< 
< amigaos*)
<   case $host_cpu in
<   powerpc)
<     # Since July 2007 AmigaOS4 officially supports .so libraries.
<     # When compiling the executable, add -use-dynld -Lsobjs: to the compileline.
<     library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
<     ;;
<   m68k)
<     library_names_spec='$libname.ixlibrary $libname.a'
<     # Create ${libname}_ixlibrary.a entries in /sys/libs.
<     finish_eval='for lib in `ls $libdir/*.ixlibrary 2>/dev/null`; do libname=`func_echo_all "$lib" | $SED '\''s%^.*/\([^/]*\)\.ixlibrary$%\1%'\''`; test $RM /sys/libs/${libname}_ixlibrary.a; $show "cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a"; cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a || exit 1; done'
<     ;;
<   esac
<   ;;
< 
< beos*)
<   library_names_spec='${libname}${shared_ext}'
<   dynamic_linker="$host_os ld.so"
<   shlibpath_var=LIBRARY_PATH
<   ;;
< 
< bsdi[45]*)
<   version_type=linux # correct to gnu/linux during the next big refactor
<   need_version=no
<   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
<   soname_spec='${libname}${release}${shared_ext}$major'
<   finish_cmds='PATH="\$PATH:/sbin" ldconfig $libdir'
<   shlibpath_var=LD_LIBRARY_PATH
<   sys_lib_search_path_spec="/shlib /usr/lib /usr/X11/lib /usr/contrib/lib /lib /usr/local/lib"
<   sys_lib_dlsearch_path_spec="/shlib /usr/lib /usr/local/lib"
<   # the default ld.so.conf also contains /usr/contrib/lib and
<   # /usr/X11R6/lib (/usr/X11 is a link to /usr/X11R6), but let us allow
<   # libtool to hard-code these into programs
<   ;;
< 
< cygwin* | mingw* | pw32* | cegcc*)
<   version_type=windows
<   shrext_cmds=".dll"
<   need_version=no
<   need_lib_prefix=no
< 
<   case $GCC,$cc_basename in
<   yes,*)
<     # gcc
<     library_names_spec='$libname.dll.a'
<     # DLL is installed to $(libdir)/../bin by postinstall_cmds
<     postinstall_cmds='base_file=`basename \${file}`~
<       dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\${base_file}'\''i; echo \$dlname'\''`~
<       dldir=$destdir/`dirname \$dlpath`~
<       test -d \$dldir || mkdir -p \$dldir~
<       $install_prog $dir/$dlname \$dldir/$dlname~
<       chmod a+x \$dldir/$dlname~
<       if test -n '\''$stripme'\'' && test -n '\''$striplib'\''; then
<         eval '\''$striplib \$dldir/$dlname'\'' || exit \$?;
<       fi'
<     postuninstall_cmds='dldll=`$SHELL 2>&1 -c '\''. $file; echo \$dlname'\''`~
<       dlpath=$dir/\$dldll~
<        $RM \$dlpath'
<     shlibpath_overrides_runpath=yes
< 
<     case $host_os in
<     cygwin*)
<       # Cygwin DLLs use 'cyg' prefix rather than 'lib'
<       soname_spec='`echo ${libname} | sed -e 's/^lib/cyg/'``echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
< 
<       sys_lib_search_path_spec="$sys_lib_search_path_spec /usr/lib/w32api"
<       ;;
<     mingw* | cegcc*)
<       # MinGW DLLs use traditional 'lib' prefix
<       soname_spec='${libname}`echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
<       ;;
<     pw32*)
<       # pw32 DLLs use 'pw' prefix rather than 'lib'
<       library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
<       ;;
<     esac
<     dynamic_linker='Win32 ld.exe'
<     ;;
< 
<   *,cl*)
<     # Native MSVC
<     libname_spec='$name'
<     soname_spec='${libname}`echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
<     library_names_spec='${libname}.dll.lib'
< 
<     case $build_os in
<     mingw*)
<       sys_lib_search_path_spec=
<       lt_save_ifs=$IFS
<       IFS=';'
<       for lt_path in $LIB
<       do
<         IFS=$lt_save_ifs
<         # Let DOS variable expansion print the short 8.3 style file name.
<         lt_path=`cd "$lt_path" 2>/dev/null && cmd //C "for %i in (".") do @echo %~si"`
<         sys_lib_search_path_spec="$sys_lib_search_path_spec $lt_path"
<       done
<       IFS=$lt_save_ifs
<       # Convert to MSYS style.
<       sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | sed -e 's|\\\\|/|g' -e 's| \\([a-zA-Z]\\):| /\\1|g' -e 's|^ ||'`
<       ;;
<     cygwin*)
<       # Convert to unix form, then to dos form, then back to unix form
<       # but this time dos style (no spaces!) so that the unix form looks
<       # like /cygdrive/c/PROGRA~1:/cygdr...
<       sys_lib_search_path_spec=`cygpath --path --unix "$LIB"`
<       sys_lib_search_path_spec=`cygpath --path --dos "$sys_lib_search_path_spec" 2>/dev/null`
<       sys_lib_search_path_spec=`cygpath --path --unix "$sys_lib_search_path_spec" | $SED -e "s/$PATH_SEPARATOR/ /g"`
<       ;;
<     *)
<       sys_lib_search_path_spec="$LIB"
<       if $ECHO "$sys_lib_search_path_spec" | $GREP ';[c-zC-Z]:/' >/dev/null; then
<         # It is most probably a Windows format PATH.
<         sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | $SED -e 's/;/ /g'`
<       else
<         sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | $SED -e "s/$PATH_SEPARATOR/ /g"`
<       fi
<       # FIXME: find the short name or the path components, as spaces are
<       # common. (e.g. "Program Files" -> "PROGRA~1")
<       ;;
<     esac
< 
<     # DLL is installed to $(libdir)/../bin by postinstall_cmds
<     postinstall_cmds='base_file=`basename \${file}`~
<       dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\${base_file}'\''i; echo \$dlname'\''`~
<       dldir=$destdir/`dirname \$dlpath`~
<       test -d \$dldir || mkdir -p \$dldir~
<       $install_prog $dir/$dlname \$dldir/$dlname'
<     postuninstall_cmds='dldll=`$SHELL 2>&1 -c '\''. $file; echo \$dlname'\''`~
<       dlpath=$dir/\$dldll~
<        $RM \$dlpath'
<     shlibpath_overrides_runpath=yes
<     dynamic_linker='Win32 link.exe'
<     ;;
< 
<   *)
<     # Assume MSVC wrapper
<     library_names_spec='${libname}`echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext} $libname.lib'
<     dynamic_linker='Win32 ld.exe'
<     ;;
<   esac
<   # FIXME: first we should search . and the directory the executable is in
<   shlibpath_var=PATH
<   ;;
< 
< darwin* | rhapsody*)
<   dynamic_linker="$host_os dyld"
<   version_type=darwin
<   need_lib_prefix=no
<   need_version=no
<   library_names_spec='${libname}${release}${major}$shared_ext ${libname}$shared_ext'
<   soname_spec='${libname}${release}${major}$shared_ext'
<   shlibpath_overrides_runpath=yes
<   shlibpath_var=DYLD_LIBRARY_PATH
<   shrext_cmds='`test .$module = .yes && echo .so || echo .dylib`'
< 
<   sys_lib_search_path_spec="$sys_lib_search_path_spec /usr/local/lib"
<   sys_lib_dlsearch_path_spec='/usr/local/lib /lib /usr/lib'
<   ;;
< 
< dgux*)
<   version_type=linux # correct to gnu/linux during the next big refactor
<   need_lib_prefix=no
<   need_version=no
<   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname$shared_ext'
<   soname_spec='${libname}${release}${shared_ext}$major'
<   shlibpath_var=LD_LIBRARY_PATH
<   ;;
< 
< freebsd* | dragonfly*)
<   # DragonFly does not have aout.  When/if they implement a new
<   # versioning mechanism, adjust this.
<   if test -x /usr/bin/objformat; then
<     objformat=`/usr/bin/objformat`
<   else
<     case $host_os in
<     freebsd[23].*) objformat=aout ;;
<     *) objformat=elf ;;
<     esac
<   fi
<   version_type=freebsd-$objformat
<   case $version_type in
<     freebsd-elf*)
<       library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext} $libname${shared_ext}'
<       need_version=no
<       need_lib_prefix=no
<       ;;
<     freebsd-*)
<       library_names_spec='${libname}${release}${shared_ext}$versuffix $libname${shared_ext}$versuffix'
<       need_version=yes
<       ;;
<   esac
<   shlibpath_var=LD_LIBRARY_PATH
<   case $host_os in
<   freebsd2.*)
<     shlibpath_overrides_runpath=yes
<     ;;
<   freebsd3.[01]* | freebsdelf3.[01]*)
<     shlibpath_overrides_runpath=yes
<     hardcode_into_libs=yes
<     ;;
<   freebsd3.[2-9]* | freebsdelf3.[2-9]* | \
<   freebsd4.[0-5] | freebsdelf4.[0-5] | freebsd4.1.1 | freebsdelf4.1.1)
<     shlibpath_overrides_runpath=no
<     hardcode_into_libs=yes
<     ;;
<   *) # from 4.6 on, and DragonFly
<     shlibpath_overrides_runpath=yes
<     hardcode_into_libs=yes
<     ;;
<   esac
<   ;;
< 
< haiku*)
<   version_type=linux # correct to gnu/linux during the next big refactor
<   need_lib_prefix=no
<   need_version=no
<   dynamic_linker="$host_os runtime_loader"
<   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}${major} ${libname}${shared_ext}'
<   soname_spec='${libname}${release}${shared_ext}$major'
<   shlibpath_var=LIBRARY_PATH
<   shlibpath_overrides_runpath=yes
<   sys_lib_dlsearch_path_spec='/boot/home/config/lib /boot/common/lib /boot/system/lib'
<   hardcode_into_libs=yes
<   ;;
< 
< hpux9* | hpux10* | hpux11*)
<   # Give a soname corresponding to the major version so that dld.sl refuses to
<   # link against other versions.
<   version_type=sunos
<   need_lib_prefix=no
<   need_version=no
<   case $host_cpu in
<   ia64*)
<     shrext_cmds='.so'
<     hardcode_into_libs=yes
<     dynamic_linker="$host_os dld.so"
<     shlibpath_var=LD_LIBRARY_PATH
<     shlibpath_overrides_runpath=yes # Unless +noenvvar is specified.
<     library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
<     soname_spec='${libname}${release}${shared_ext}$major'
<     if test "X$HPUX_IA64_MODE" = X32; then
<       sys_lib_search_path_spec="/usr/lib/hpux32 /usr/local/lib/hpux32 /usr/local/lib"
<     else
<       sys_lib_search_path_spec="/usr/lib/hpux64 /usr/local/lib/hpux64"
<     fi
<     sys_lib_dlsearch_path_spec=$sys_lib_search_path_spec
<     ;;
<   hppa*64*)
<     shrext_cmds='.sl'
<     hardcode_into_libs=yes
<     dynamic_linker="$host_os dld.sl"
<     shlibpath_var=LD_LIBRARY_PATH # How should we handle SHLIB_PATH
<     shlibpath_overrides_runpath=yes # Unless +noenvvar is specified.
<     library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
<     soname_spec='${libname}${release}${shared_ext}$major'
<     sys_lib_search_path_spec="/usr/lib/pa20_64 /usr/ccs/lib/pa20_64"
<     sys_lib_dlsearch_path_spec=$sys_lib_search_path_spec
<     ;;
<   *)
<     shrext_cmds='.sl'
<     dynamic_linker="$host_os dld.sl"
<     shlibpath_var=SHLIB_PATH
<     shlibpath_overrides_runpath=no # +s is required to enable SHLIB_PATH
<     library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
<     soname_spec='${libname}${release}${shared_ext}$major'
<     ;;
<   esac
<   # HP-UX runs *really* slowly unless shared libraries are mode 555, ...
<   postinstall_cmds='chmod 555 $lib'
<   # or fails outright, so override atomically:
<   install_override_mode=555
<   ;;
< 
< interix[3-9]*)
<   version_type=linux # correct to gnu/linux during the next big refactor
<   need_lib_prefix=no
<   need_version=no
<   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
<   soname_spec='${libname}${release}${shared_ext}$major'
<   dynamic_linker='Interix 3.x ld.so.1 (PE, like ELF)'
<   shlibpath_var=LD_LIBRARY_PATH
<   shlibpath_overrides_runpath=no
<   hardcode_into_libs=yes
<   ;;
< 
< irix5* | irix6* | nonstopux*)
<   case $host_os in
<     nonstopux*) version_type=nonstopux ;;
<     *)
< 	if test "$lt_cv_prog_gnu_ld" = yes; then
< 		version_type=linux # correct to gnu/linux during the next big refactor
< 	else
< 		version_type=irix
< 	fi ;;
<   esac
<   need_lib_prefix=no
<   need_version=no
<   soname_spec='${libname}${release}${shared_ext}$major'
<   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${release}${shared_ext} $libname${shared_ext}'
<   case $host_os in
<   irix5* | nonstopux*)
<     libsuff= shlibsuff=
<     ;;
<   *)
<     case $LD in # libtool.m4 will add one of these switches to LD
<     *-32|*"-32 "|*-melf32bsmip|*"-melf32bsmip ")
<       libsuff= shlibsuff= libmagic=32-bit;;
<     *-n32|*"-n32 "|*-melf32bmipn32|*"-melf32bmipn32 ")
<       libsuff=32 shlibsuff=N32 libmagic=N32;;
<     *-64|*"-64 "|*-melf64bmip|*"-melf64bmip ")
<       libsuff=64 shlibsuff=64 libmagic=64-bit;;
<     *) libsuff= shlibsuff= libmagic=never-match;;
<     esac
<     ;;
<   esac
<   shlibpath_var=LD_LIBRARY${shlibsuff}_PATH
<   shlibpath_overrides_runpath=no
<   sys_lib_search_path_spec="/usr/lib${libsuff} /lib${libsuff} /usr/local/lib${libsuff}"
<   sys_lib_dlsearch_path_spec="/usr/lib${libsuff} /lib${libsuff}"
<   hardcode_into_libs=yes
<   ;;
< 
< # No shared lib support for Linux oldld, aout, or coff.
< linux*oldld* | linux*aout* | linux*coff*)
<   dynamic_linker=no
<   ;;
< 
< # This must be glibc/ELF.
< linux* | k*bsd*-gnu | kopensolaris*-gnu | gnu*)
<   version_type=linux # correct to gnu/linux during the next big refactor
<   need_lib_prefix=no
<   need_version=no
<   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
<   soname_spec='${libname}${release}${shared_ext}$major'
<   finish_cmds='PATH="\$PATH:/sbin" ldconfig -n $libdir'
<   shlibpath_var=LD_LIBRARY_PATH
<   shlibpath_overrides_runpath=no
< 
<   # Some binutils ld are patched to set DT_RUNPATH
<   if ${lt_cv_shlibpath_overrides_runpath+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   lt_cv_shlibpath_overrides_runpath=no
<     save_LDFLAGS=$LDFLAGS
<     save_libdir=$libdir
<     eval "libdir=/foo; wl=\"$lt_prog_compiler_wl\"; \
< 	 LDFLAGS=\"\$LDFLAGS $hardcode_libdir_flag_spec\""
<     cat confdefs.h - <<_ACEOF >conftest.$ac_ext
< /* end confdefs.h.  */
< 
< int
< main ()
< {
< 
<   ;
<   return 0;
< }
< _ACEOF
< if ac_fn_c_try_link "$LINENO"; then :
<   if  ($OBJDUMP -p conftest$ac_exeext) 2>/dev/null | grep "RUNPATH.*$libdir" >/dev/null; then :
<   lt_cv_shlibpath_overrides_runpath=yes
< fi
< fi
< rm -f core conftest.err conftest.$ac_objext \
<     conftest$ac_exeext conftest.$ac_ext
<     LDFLAGS=$save_LDFLAGS
<     libdir=$save_libdir
< 
< fi
< 
<   shlibpath_overrides_runpath=$lt_cv_shlibpath_overrides_runpath
< 
<   # This implies no fast_install, which is unacceptable.
<   # Some rework will be needed to allow for fast_install
<   # before this can be enabled.
<   hardcode_into_libs=yes
< 
<   # Append ld.so.conf contents to the search path
<   if test -f /etc/ld.so.conf; then
<     lt_ld_extra=`awk '/^include / { system(sprintf("cd /etc; cat %s 2>/dev/null", \$2)); skip = 1; } { if (!skip) print \$0; skip = 0; }' < /etc/ld.so.conf | $SED -e 's/#.*//;/^[	 ]*hwcap[	 ]/d;s/[:,	]/ /g;s/=[^=]*$//;s/=[^= ]* / /g;s/"//g;/^$/d' | tr '\n' ' '`
<     sys_lib_dlsearch_path_spec="/lib /usr/lib $lt_ld_extra"
<   fi
< 
<   # We used to test for /lib/ld.so.1 and disable shared libraries on
<   # powerpc, because MkLinux only supported shared libraries with the
<   # GNU dynamic linker.  Since this was broken with cross compilers,
<   # most powerpc-linux boxes support dynamic linking these days and
<   # people can always --disable-shared, the test was removed, and we
<   # assume the GNU/Linux dynamic linker is in use.
<   dynamic_linker='GNU/Linux ld.so'
<   ;;
< 
< netbsdelf*-gnu)
<   version_type=linux
<   need_lib_prefix=no
<   need_version=no
<   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
<   soname_spec='${libname}${release}${shared_ext}$major'
<   shlibpath_var=LD_LIBRARY_PATH
<   shlibpath_overrides_runpath=no
<   hardcode_into_libs=yes
<   dynamic_linker='NetBSD ld.elf_so'
<   ;;
< 
< netbsd*)
<   version_type=sunos
<   need_lib_prefix=no
<   need_version=no
<   if echo __ELF__ | $CC -E - | $GREP __ELF__ >/dev/null; then
<     library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
<     finish_cmds='PATH="\$PATH:/sbin" ldconfig -m $libdir'
<     dynamic_linker='NetBSD (a.out) ld.so'
<   else
<     library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
<     soname_spec='${libname}${release}${shared_ext}$major'
<     dynamic_linker='NetBSD ld.elf_so'
<   fi
<   shlibpath_var=LD_LIBRARY_PATH
<   shlibpath_overrides_runpath=yes
<   hardcode_into_libs=yes
<   ;;
< 
< newsos6)
<   version_type=linux # correct to gnu/linux during the next big refactor
<   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
<   shlibpath_var=LD_LIBRARY_PATH
<   shlibpath_overrides_runpath=yes
<   ;;
< 
< *nto* | *qnx*)
<   version_type=qnx
<   need_lib_prefix=no
<   need_version=no
<   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
<   soname_spec='${libname}${release}${shared_ext}$major'
<   shlibpath_var=LD_LIBRARY_PATH
<   shlibpath_overrides_runpath=no
<   hardcode_into_libs=yes
<   dynamic_linker='ldqnx.so'
<   ;;
< 
< openbsd*)
<   version_type=sunos
<   sys_lib_dlsearch_path_spec="/usr/lib"
<   need_lib_prefix=no
<   # Some older versions of OpenBSD (3.3 at least) *do* need versioned libs.
<   case $host_os in
<     openbsd3.3 | openbsd3.3.*)	need_version=yes ;;
<     *)				need_version=no  ;;
<   esac
<   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
<   finish_cmds='PATH="\$PATH:/sbin" ldconfig -m $libdir'
<   shlibpath_var=LD_LIBRARY_PATH
<   if test -z "`echo __ELF__ | $CC -E - | $GREP __ELF__`" || test "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
<     case $host_os in
<       openbsd2.[89] | openbsd2.[89].*)
< 	shlibpath_overrides_runpath=no
< 	;;
<       *)
< 	shlibpath_overrides_runpath=yes
< 	;;
<       esac
<   else
<     shlibpath_overrides_runpath=yes
<   fi
<   ;;
< 
< os2*)
<   libname_spec='$name'
<   shrext_cmds=".dll"
<   need_lib_prefix=no
<   library_names_spec='$libname${shared_ext} $libname.a'
<   dynamic_linker='OS/2 ld.exe'
<   shlibpath_var=LIBPATH
<   ;;
< 
< osf3* | osf4* | osf5*)
<   version_type=osf
<   need_lib_prefix=no
<   need_version=no
<   soname_spec='${libname}${release}${shared_ext}$major'
<   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
<   shlibpath_var=LD_LIBRARY_PATH
<   sys_lib_search_path_spec="/usr/shlib /usr/ccs/lib /usr/lib/cmplrs/cc /usr/lib /usr/local/lib /var/shlib"
<   sys_lib_dlsearch_path_spec="$sys_lib_search_path_spec"
<   ;;
< 
< rdos*)
<   dynamic_linker=no
<   ;;
< 
< solaris*)
<   version_type=linux # correct to gnu/linux during the next big refactor
<   need_lib_prefix=no
<   need_version=no
<   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
<   soname_spec='${libname}${release}${shared_ext}$major'
<   shlibpath_var=LD_LIBRARY_PATH
<   shlibpath_overrides_runpath=yes
<   hardcode_into_libs=yes
<   # ldd complains unless libraries are executable
<   postinstall_cmds='chmod +x $lib'
<   ;;
< 
< sunos4*)
<   version_type=sunos
<   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
<   finish_cmds='PATH="\$PATH:/usr/etc" ldconfig $libdir'
<   shlibpath_var=LD_LIBRARY_PATH
<   shlibpath_overrides_runpath=yes
<   if test "$with_gnu_ld" = yes; then
<     need_lib_prefix=no
<   fi
<   need_version=yes
<   ;;
< 
< sysv4 | sysv4.3*)
<   version_type=linux # correct to gnu/linux during the next big refactor
<   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
<   soname_spec='${libname}${release}${shared_ext}$major'
<   shlibpath_var=LD_LIBRARY_PATH
<   case $host_vendor in
<     sni)
<       shlibpath_overrides_runpath=no
<       need_lib_prefix=no
<       runpath_var=LD_RUN_PATH
<       ;;
<     siemens)
<       need_lib_prefix=no
<       ;;
<     motorola)
<       need_lib_prefix=no
<       need_version=no
<       shlibpath_overrides_runpath=no
<       sys_lib_search_path_spec='/lib /usr/lib /usr/ccs/lib'
<       ;;
<   esac
<   ;;
< 
< sysv4*MP*)
<   if test -d /usr/nec ;then
<     version_type=linux # correct to gnu/linux during the next big refactor
<     library_names_spec='$libname${shared_ext}.$versuffix $libname${shared_ext}.$major $libname${shared_ext}'
<     soname_spec='$libname${shared_ext}.$major'
<     shlibpath_var=LD_LIBRARY_PATH
<   fi
<   ;;
< 
< sysv5* | sco3.2v5* | sco5v6* | unixware* | OpenUNIX* | sysv4*uw2*)
<   version_type=freebsd-elf
<   need_lib_prefix=no
<   need_version=no
<   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext} $libname${shared_ext}'
<   soname_spec='${libname}${release}${shared_ext}$major'
<   shlibpath_var=LD_LIBRARY_PATH
<   shlibpath_overrides_runpath=yes
<   hardcode_into_libs=yes
<   if test "$with_gnu_ld" = yes; then
<     sys_lib_search_path_spec='/usr/local/lib /usr/gnu/lib /usr/ccs/lib /usr/lib /lib'
<   else
<     sys_lib_search_path_spec='/usr/ccs/lib /usr/lib'
<     case $host_os in
<       sco3.2v5*)
<         sys_lib_search_path_spec="$sys_lib_search_path_spec /lib"
< 	;;
<     esac
<   fi
<   sys_lib_dlsearch_path_spec='/usr/lib'
<   ;;
< 
< tpf*)
<   # TPF is a cross-target only.  Preferred cross-host = GNU/Linux.
<   version_type=linux # correct to gnu/linux during the next big refactor
<   need_lib_prefix=no
<   need_version=no
<   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
<   shlibpath_var=LD_LIBRARY_PATH
<   shlibpath_overrides_runpath=no
<   hardcode_into_libs=yes
<   ;;
< 
< uts4*)
<   version_type=linux # correct to gnu/linux during the next big refactor
<   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
<   soname_spec='${libname}${release}${shared_ext}$major'
<   shlibpath_var=LD_LIBRARY_PATH
<   ;;
< 
< *)
<   dynamic_linker=no
<   ;;
< esac
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $dynamic_linker" >&5
< $as_echo "$dynamic_linker" >&6; }
< test "$dynamic_linker" = no && can_build_shared=no
< 
< variables_saved_for_relink="PATH $shlibpath_var $runpath_var"
< if test "$GCC" = yes; then
<   variables_saved_for_relink="$variables_saved_for_relink GCC_EXEC_PREFIX COMPILER_PATH LIBRARY_PATH"
< fi
< 
< if test "${lt_cv_sys_lib_search_path_spec+set}" = set; then
<   sys_lib_search_path_spec="$lt_cv_sys_lib_search_path_spec"
< fi
< if test "${lt_cv_sys_lib_dlsearch_path_spec+set}" = set; then
<   sys_lib_dlsearch_path_spec="$lt_cv_sys_lib_dlsearch_path_spec"
< fi
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
<   { $as_echo "$as_me:${as_lineno-$LINENO}: checking how to hardcode library paths into programs" >&5
< $as_echo_n "checking how to hardcode library paths into programs... " >&6; }
< hardcode_action=
< if test -n "$hardcode_libdir_flag_spec" ||
<    test -n "$runpath_var" ||
<    test "X$hardcode_automatic" = "Xyes" ; then
< 
<   # We can hardcode non-existent directories.
<   if test "$hardcode_direct" != no &&
<      # If the only mechanism to avoid hardcoding is shlibpath_var, we
<      # have to relink, otherwise we might link with an installed library
<      # when we should be linking with a yet-to-be-installed one
<      ## test "$_LT_TAGVAR(hardcode_shlibpath_var, )" != no &&
<      test "$hardcode_minus_L" != no; then
<     # Linking always hardcodes the temporary library directory.
<     hardcode_action=relink
<   else
<     # We can link without hardcoding, and we can hardcode nonexisting dirs.
<     hardcode_action=immediate
<   fi
< else
<   # We cannot hardcode anything, or else we can only hardcode existing
<   # directories.
<   hardcode_action=unsupported
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $hardcode_action" >&5
< $as_echo "$hardcode_action" >&6; }
< 
< if test "$hardcode_action" = relink ||
<    test "$inherit_rpath" = yes; then
<   # Fast installation is not supported
<   enable_fast_install=no
< elif test "$shlibpath_overrides_runpath" = yes ||
<      test "$enable_shared" = no; then
<   # Fast installation is not necessary
<   enable_fast_install=needless
< fi
< 
< 
< 
< 
< 
< 
<   if test "x$enable_dlopen" != xyes; then
<   enable_dlopen=unknown
<   enable_dlopen_self=unknown
<   enable_dlopen_self_static=unknown
< else
<   lt_cv_dlopen=no
<   lt_cv_dlopen_libs=
< 
<   case $host_os in
<   beos*)
<     lt_cv_dlopen="load_add_on"
<     lt_cv_dlopen_libs=
<     lt_cv_dlopen_self=yes
<     ;;
< 
<   mingw* | pw32* | cegcc*)
<     lt_cv_dlopen="LoadLibrary"
<     lt_cv_dlopen_libs=
<     ;;
< 
<   cygwin*)
<     lt_cv_dlopen="dlopen"
<     lt_cv_dlopen_libs=
<     ;;
< 
<   darwin*)
<   # if libdl is installed we need to link against it
<     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dlopen in -ldl" >&5
< $as_echo_n "checking for dlopen in -ldl... " >&6; }
< if ${ac_cv_lib_dl_dlopen+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   ac_check_lib_save_LIBS=$LIBS
< LIBS="-ldl  $LIBS"
< cat confdefs.h - <<_ACEOF >conftest.$ac_ext
< /* end confdefs.h.  */
< 
< /* Override any GCC internal prototype to avoid an error.
<    Use char because int might match the return type of a GCC
<    builtin and then its argument prototype would still apply.  */
< #ifdef __cplusplus
< extern "C"
< #endif
< char dlopen ();
< int
< main ()
< {
< return dlopen ();
<   ;
<   return 0;
< }
< _ACEOF
< if ac_fn_c_try_link "$LINENO"; then :
<   ac_cv_lib_dl_dlopen=yes
< else
<   ac_cv_lib_dl_dlopen=no
< fi
< rm -f core conftest.err conftest.$ac_objext \
<     conftest$ac_exeext conftest.$ac_ext
< LIBS=$ac_check_lib_save_LIBS
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dl_dlopen" >&5
< $as_echo "$ac_cv_lib_dl_dlopen" >&6; }
< if test "x$ac_cv_lib_dl_dlopen" = xyes; then :
<   lt_cv_dlopen="dlopen" lt_cv_dlopen_libs="-ldl"
< else
< 
<     lt_cv_dlopen="dyld"
<     lt_cv_dlopen_libs=
<     lt_cv_dlopen_self=yes
< 
< fi
< 
<     ;;
< 
<   *)
<     ac_fn_c_check_func "$LINENO" "shl_load" "ac_cv_func_shl_load"
< if test "x$ac_cv_func_shl_load" = xyes; then :
<   lt_cv_dlopen="shl_load"
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for shl_load in -ldld" >&5
< $as_echo_n "checking for shl_load in -ldld... " >&6; }
< if ${ac_cv_lib_dld_shl_load+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   ac_check_lib_save_LIBS=$LIBS
< LIBS="-ldld  $LIBS"
< cat confdefs.h - <<_ACEOF >conftest.$ac_ext
< /* end confdefs.h.  */
< 
< /* Override any GCC internal prototype to avoid an error.
<    Use char because int might match the return type of a GCC
<    builtin and then its argument prototype would still apply.  */
< #ifdef __cplusplus
< extern "C"
< #endif
< char shl_load ();
< int
< main ()
< {
< return shl_load ();
<   ;
<   return 0;
< }
< _ACEOF
< if ac_fn_c_try_link "$LINENO"; then :
<   ac_cv_lib_dld_shl_load=yes
< else
<   ac_cv_lib_dld_shl_load=no
< fi
< rm -f core conftest.err conftest.$ac_objext \
<     conftest$ac_exeext conftest.$ac_ext
< LIBS=$ac_check_lib_save_LIBS
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dld_shl_load" >&5
< $as_echo "$ac_cv_lib_dld_shl_load" >&6; }
< if test "x$ac_cv_lib_dld_shl_load" = xyes; then :
<   lt_cv_dlopen="shl_load" lt_cv_dlopen_libs="-ldld"
< else
<   ac_fn_c_check_func "$LINENO" "dlopen" "ac_cv_func_dlopen"
< if test "x$ac_cv_func_dlopen" = xyes; then :
<   lt_cv_dlopen="dlopen"
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dlopen in -ldl" >&5
< $as_echo_n "checking for dlopen in -ldl... " >&6; }
< if ${ac_cv_lib_dl_dlopen+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   ac_check_lib_save_LIBS=$LIBS
< LIBS="-ldl  $LIBS"
< cat confdefs.h - <<_ACEOF >conftest.$ac_ext
< /* end confdefs.h.  */
< 
< /* Override any GCC internal prototype to avoid an error.
<    Use char because int might match the return type of a GCC
<    builtin and then its argument prototype would still apply.  */
< #ifdef __cplusplus
< extern "C"
< #endif
< char dlopen ();
< int
< main ()
< {
< return dlopen ();
<   ;
<   return 0;
< }
< _ACEOF
< if ac_fn_c_try_link "$LINENO"; then :
<   ac_cv_lib_dl_dlopen=yes
< else
<   ac_cv_lib_dl_dlopen=no
< fi
< rm -f core conftest.err conftest.$ac_objext \
<     conftest$ac_exeext conftest.$ac_ext
< LIBS=$ac_check_lib_save_LIBS
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dl_dlopen" >&5
< $as_echo "$ac_cv_lib_dl_dlopen" >&6; }
< if test "x$ac_cv_lib_dl_dlopen" = xyes; then :
<   lt_cv_dlopen="dlopen" lt_cv_dlopen_libs="-ldl"
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dlopen in -lsvld" >&5
< $as_echo_n "checking for dlopen in -lsvld... " >&6; }
< if ${ac_cv_lib_svld_dlopen+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   ac_check_lib_save_LIBS=$LIBS
< LIBS="-lsvld  $LIBS"
< cat confdefs.h - <<_ACEOF >conftest.$ac_ext
< /* end confdefs.h.  */
< 
< /* Override any GCC internal prototype to avoid an error.
<    Use char because int might match the return type of a GCC
<    builtin and then its argument prototype would still apply.  */
< #ifdef __cplusplus
< extern "C"
< #endif
< char dlopen ();
< int
< main ()
< {
< return dlopen ();
<   ;
<   return 0;
< }
< _ACEOF
< if ac_fn_c_try_link "$LINENO"; then :
<   ac_cv_lib_svld_dlopen=yes
< else
<   ac_cv_lib_svld_dlopen=no
< fi
< rm -f core conftest.err conftest.$ac_objext \
<     conftest$ac_exeext conftest.$ac_ext
< LIBS=$ac_check_lib_save_LIBS
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_svld_dlopen" >&5
< $as_echo "$ac_cv_lib_svld_dlopen" >&6; }
< if test "x$ac_cv_lib_svld_dlopen" = xyes; then :
<   lt_cv_dlopen="dlopen" lt_cv_dlopen_libs="-lsvld"
< else
<   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dld_link in -ldld" >&5
< $as_echo_n "checking for dld_link in -ldld... " >&6; }
< if ${ac_cv_lib_dld_dld_link+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   ac_check_lib_save_LIBS=$LIBS
< LIBS="-ldld  $LIBS"
< cat confdefs.h - <<_ACEOF >conftest.$ac_ext
< /* end confdefs.h.  */
< 
< /* Override any GCC internal prototype to avoid an error.
<    Use char because int might match the return type of a GCC
<    builtin and then its argument prototype would still apply.  */
< #ifdef __cplusplus
< extern "C"
< #endif
< char dld_link ();
< int
< main ()
< {
< return dld_link ();
<   ;
<   return 0;
< }
< _ACEOF
< if ac_fn_c_try_link "$LINENO"; then :
<   ac_cv_lib_dld_dld_link=yes
< else
<   ac_cv_lib_dld_dld_link=no
< fi
< rm -f core conftest.err conftest.$ac_objext \
<     conftest$ac_exeext conftest.$ac_ext
< LIBS=$ac_check_lib_save_LIBS
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dld_dld_link" >&5
< $as_echo "$ac_cv_lib_dld_dld_link" >&6; }
< if test "x$ac_cv_lib_dld_dld_link" = xyes; then :
<   lt_cv_dlopen="dld_link" lt_cv_dlopen_libs="-ldld"
< fi
< 
< 
< fi
< 
< 
< fi
< 
< 
< fi
< 
< 
< fi
< 
< 
< fi
< 
<     ;;
<   esac
< 
<   if test "x$lt_cv_dlopen" != xno; then
<     enable_dlopen=yes
<   else
<     enable_dlopen=no
<   fi
< 
<   case $lt_cv_dlopen in
<   dlopen)
<     save_CPPFLAGS="$CPPFLAGS"
<     test "x$ac_cv_header_dlfcn_h" = xyes && CPPFLAGS="$CPPFLAGS -DHAVE_DLFCN_H"
< 
<     save_LDFLAGS="$LDFLAGS"
<     wl=$lt_prog_compiler_wl eval LDFLAGS=\"\$LDFLAGS $export_dynamic_flag_spec\"
< 
<     save_LIBS="$LIBS"
<     LIBS="$lt_cv_dlopen_libs $LIBS"
< 
<     { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether a program can dlopen itself" >&5
< $as_echo_n "checking whether a program can dlopen itself... " >&6; }
< if ${lt_cv_dlopen_self+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   	  if test "$cross_compiling" = yes; then :
<   lt_cv_dlopen_self=cross
< else
<   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
<   lt_status=$lt_dlunknown
<   cat > conftest.$ac_ext <<_LT_EOF
< #line $LINENO "configure"
< #include "confdefs.h"
< 
< #if HAVE_DLFCN_H
< #include <dlfcn.h>
< #endif
< 
< #include <stdio.h>
< 
< #ifdef RTLD_GLOBAL
< #  define LT_DLGLOBAL		RTLD_GLOBAL
< #else
< #  ifdef DL_GLOBAL
< #    define LT_DLGLOBAL		DL_GLOBAL
< #  else
< #    define LT_DLGLOBAL		0
< #  endif
< #endif
< 
< /* We may have to define LT_DLLAZY_OR_NOW in the command line if we
<    find out it does not work in some platform. */
< #ifndef LT_DLLAZY_OR_NOW
< #  ifdef RTLD_LAZY
< #    define LT_DLLAZY_OR_NOW		RTLD_LAZY
< #  else
< #    ifdef DL_LAZY
< #      define LT_DLLAZY_OR_NOW		DL_LAZY
< #    else
< #      ifdef RTLD_NOW
< #        define LT_DLLAZY_OR_NOW	RTLD_NOW
< #      else
< #        ifdef DL_NOW
< #          define LT_DLLAZY_OR_NOW	DL_NOW
< #        else
< #          define LT_DLLAZY_OR_NOW	0
< #        endif
< #      endif
< #    endif
< #  endif
< #endif
< 
< /* When -fvisbility=hidden is used, assume the code has been annotated
<    correspondingly for the symbols needed.  */
< #if defined(__GNUC__) && (((__GNUC__ == 3) && (__GNUC_MINOR__ >= 3)) || (__GNUC__ > 3))
< int fnord () __attribute__((visibility("default")));
< #endif
< 
< int fnord () { return 42; }
< int main ()
< {
<   void *self = dlopen (0, LT_DLGLOBAL|LT_DLLAZY_OR_NOW);
<   int status = $lt_dlunknown;
< 
<   if (self)
<     {
<       if (dlsym (self,"fnord"))       status = $lt_dlno_uscore;
<       else
<         {
< 	  if (dlsym( self,"_fnord"))  status = $lt_dlneed_uscore;
<           else puts (dlerror ());
< 	}
<       /* dlclose (self); */
<     }
<   else
<     puts (dlerror ());
< 
<   return status;
< }
< _LT_EOF
<   if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_link\""; } >&5
<   (eval $ac_link) 2>&5
<   ac_status=$?
<   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
<   test $ac_status = 0; } && test -s conftest${ac_exeext} 2>/dev/null; then
<     (./conftest; exit; ) >&5 2>/dev/null
<     lt_status=$?
<     case x$lt_status in
<       x$lt_dlno_uscore) lt_cv_dlopen_self=yes ;;
<       x$lt_dlneed_uscore) lt_cv_dlopen_self=yes ;;
<       x$lt_dlunknown|x*) lt_cv_dlopen_self=no ;;
<     esac
<   else :
<     # compilation failed
<     lt_cv_dlopen_self=no
<   fi
< fi
< rm -fr conftest*
< 
< 
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_dlopen_self" >&5
< $as_echo "$lt_cv_dlopen_self" >&6; }
< 
<     if test "x$lt_cv_dlopen_self" = xyes; then
<       wl=$lt_prog_compiler_wl eval LDFLAGS=\"\$LDFLAGS $lt_prog_compiler_static\"
<       { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether a statically linked program can dlopen itself" >&5
< $as_echo_n "checking whether a statically linked program can dlopen itself... " >&6; }
< if ${lt_cv_dlopen_self_static+:} false; then :
<   $as_echo_n "(cached) " >&6
< else
<   	  if test "$cross_compiling" = yes; then :
<   lt_cv_dlopen_self_static=cross
< else
<   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
<   lt_status=$lt_dlunknown
<   cat > conftest.$ac_ext <<_LT_EOF
< #line $LINENO "configure"
< #include "confdefs.h"
< 
< #if HAVE_DLFCN_H
< #include <dlfcn.h>
< #endif
< 
< #include <stdio.h>
< 
< #ifdef RTLD_GLOBAL
< #  define LT_DLGLOBAL		RTLD_GLOBAL
< #else
< #  ifdef DL_GLOBAL
< #    define LT_DLGLOBAL		DL_GLOBAL
< #  else
< #    define LT_DLGLOBAL		0
< #  endif
< #endif
< 
< /* We may have to define LT_DLLAZY_OR_NOW in the command line if we
<    find out it does not work in some platform. */
< #ifndef LT_DLLAZY_OR_NOW
< #  ifdef RTLD_LAZY
< #    define LT_DLLAZY_OR_NOW		RTLD_LAZY
< #  else
< #    ifdef DL_LAZY
< #      define LT_DLLAZY_OR_NOW		DL_LAZY
< #    else
< #      ifdef RTLD_NOW
< #        define LT_DLLAZY_OR_NOW	RTLD_NOW
< #      else
< #        ifdef DL_NOW
< #          define LT_DLLAZY_OR_NOW	DL_NOW
< #        else
< #          define LT_DLLAZY_OR_NOW	0
< #        endif
< #      endif
< #    endif
< #  endif
< #endif
< 
< /* When -fvisbility=hidden is used, assume the code has been annotated
<    correspondingly for the symbols needed.  */
< #if defined(__GNUC__) && (((__GNUC__ == 3) && (__GNUC_MINOR__ >= 3)) || (__GNUC__ > 3))
< int fnord () __attribute__((visibility("default")));
< #endif
< 
< int fnord () { return 42; }
< int main ()
< {
<   void *self = dlopen (0, LT_DLGLOBAL|LT_DLLAZY_OR_NOW);
<   int status = $lt_dlunknown;
< 
<   if (self)
<     {
<       if (dlsym (self,"fnord"))       status = $lt_dlno_uscore;
<       else
<         {
< 	  if (dlsym( self,"_fnord"))  status = $lt_dlneed_uscore;
<           else puts (dlerror ());
< 	}
<       /* dlclose (self); */
<     }
<   else
<     puts (dlerror ());
< 
<   return status;
< }
< _LT_EOF
<   if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_link\""; } >&5
<   (eval $ac_link) 2>&5
<   ac_status=$?
<   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
<   test $ac_status = 0; } && test -s conftest${ac_exeext} 2>/dev/null; then
<     (./conftest; exit; ) >&5 2>/dev/null
<     lt_status=$?
<     case x$lt_status in
<       x$lt_dlno_uscore) lt_cv_dlopen_self_static=yes ;;
<       x$lt_dlneed_uscore) lt_cv_dlopen_self_static=yes ;;
<       x$lt_dlunknown|x*) lt_cv_dlopen_self_static=no ;;
<     esac
<   else :
<     # compilation failed
<     lt_cv_dlopen_self_static=no
<   fi
< fi
< rm -fr conftest*
< 
< 
< fi
< { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_dlopen_self_static" >&5
< $as_echo "$lt_cv_dlopen_self_static" >&6; }
<     fi
< 
<     CPPFLAGS="$save_CPPFLAGS"
<     LDFLAGS="$save_LDFLAGS"
<     LIBS="$save_LIBS"
<     ;;
<   esac
< 
<   case $lt_cv_dlopen_self in
<   yes|no) enable_dlopen_self=$lt_cv_dlopen_self ;;
<   *) enable_dlopen_self=unknown ;;
<   esac
< 
<   case $lt_cv_dlopen_self_static in
<   yes|no) enable_dlopen_self_static=$lt_cv_dlopen_self_static ;;
<   *) enable_dlopen_self_static=unknown ;;
<   esac
< fi
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< striplib=
< old_striplib=
< { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether stripping libraries is possible" >&5
< $as_echo_n "checking whether stripping libraries is possible... " >&6; }
< if test -n "$STRIP" && $STRIP -V 2>&1 | $GREP "GNU strip" >/dev/null; then
<   test -z "$old_striplib" && old_striplib="$STRIP --strip-debug"
<   test -z "$striplib" && striplib="$STRIP --strip-unneeded"
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
< $as_echo "yes" >&6; }
< else
< # FIXME - insert some real tests, host_os isn't really good enough
<   case $host_os in
<   darwin*)
<     if test -n "$STRIP" ; then
<       striplib="$STRIP -x"
<       old_striplib="$STRIP -S"
<       { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
< $as_echo "yes" >&6; }
<     else
<       { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
< $as_echo "no" >&6; }
<     fi
<     ;;
<   *)
<     { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
< $as_echo "no" >&6; }
<     ;;
<   esac
< fi
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
<   # Report which library types will actually be built
<   { $as_echo "$as_me:${as_lineno-$LINENO}: checking if libtool supports shared libraries" >&5
< $as_echo_n "checking if libtool supports shared libraries... " >&6; }
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $can_build_shared" >&5
< $as_echo "$can_build_shared" >&6; }
< 
<   { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether to build shared libraries" >&5
< $as_echo_n "checking whether to build shared libraries... " >&6; }
<   test "$can_build_shared" = "no" && enable_shared=no
< 
<   # On AIX, shared libraries and static libraries use the same namespace, and
<   # are all built from PIC.
<   case $host_os in
<   aix3*)
<     test "$enable_shared" = yes && enable_static=no
<     if test -n "$RANLIB"; then
<       archive_cmds="$archive_cmds~\$RANLIB \$lib"
<       postinstall_cmds='$RANLIB $lib'
<     fi
<     ;;
< 
<   aix[4-9]*)
<     if test "$host_cpu" != ia64 && test "$aix_use_runtimelinking" = no ; then
<       test "$enable_shared" = yes && enable_static=no
<     fi
<     ;;
<   esac
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $enable_shared" >&5
< $as_echo "$enable_shared" >&6; }
< 
<   { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether to build static libraries" >&5
< $as_echo_n "checking whether to build static libraries... " >&6; }
<   # Make sure either enable_shared or enable_static is yes.
<   test "$enable_shared" = yes || enable_static=yes
<   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $enable_static" >&5
< $as_echo "$enable_static" >&6; }
< 
< 
< 
< 
< fi
< ac_ext=c
< ac_cpp='$CPP $CPPFLAGS'
< ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
< ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
< ac_compiler_gnu=$ac_cv_c_compiler_gnu
< 
< CC="$lt_save_CC"
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
< 
<         ac_config_commands="$ac_config_commands libtool"
< 
< 
< 
< 
< # Only expand once:
< 
13208a6083,6084
> # This breaks autoreconf so disable it
> # LT_INIT([disable-shared])
16014,16016c8890
< 
< $as_echo "#define _WIN32_WINNT 0x0501" >>confdefs.h
< 
---
>     #AC_DEFINE([_WIN32_WINNT], [0x0501], "WinNT version for XP+ support")
16028a8903,8907
>   *-*-freebsd*)
>     PTHREAD_FLAGS=""
>     DLOPEN_FLAGS=""
>     RT_LIBS=""
>     ;;
16139d9017
< ants1="no"
16141a9020,9021
> ants1="no"
> 
16164d9043
< 
16188a9068,9091
> ants3="no"
> 
> # Check whether --enable-ants3 was given.
> if test "${enable_ants3+set}" = set; then :
>   enableval=$enable_ants3; ants3=$enableval
> 
> fi
> 
> if test "x$ants3" = xyes; then
> 
> $as_echo "#define USE_ANT_S3 1" >>confdefs.h
> 
> 	drivercount=x$drivercount
> 	standalone="yes"
> fi
>  if test x$ants3 = xyes; then
>   HAS_ANT_S3_TRUE=
>   HAS_ANT_S3_FALSE='#'
> else
>   HAS_ANT_S3_TRUE='#'
>   HAS_ANT_S3_FALSE=
> fi
> 
> 
16258a9162,9204
> avalon7="no"
> 
> # Check whether --enable-avalon7 was given.
> if test "${enable_avalon7+set}" = set; then :
>   enableval=$enable_avalon7; avalon7=$enableval
> 
> fi
> 
> if test "x$avalon7" = xyes; then
> 
> $as_echo "#define USE_AVALON7 1" >>confdefs.h
> 
> fi
>  if test x$avalon7 = xyes; then
>   HAS_AVALON7_TRUE=
>   HAS_AVALON7_FALSE='#'
> else
>   HAS_AVALON7_TRUE='#'
>   HAS_AVALON7_FALSE=
> fi
> 
> 
> avalon_miner="no"
> 
> # Check whether --enable-avalon_miner was given.
> if test "${enable_avalon_miner+set}" = set; then :
>   enableval=$enable_avalon_miner; avalon_miner=$enableval
> 
> fi
> 
> if test "x$avalon_miner" = xyes; then
> 
> $as_echo "#define USE_AVALON_MINER 1" >>confdefs.h
> 
> fi
>  if test x$avalon_miner = xyes; then
>   HAS_AVALON_MINER_TRUE=
>   HAS_AVALON_MINER_FALSE='#'
> else
>   HAS_AVALON_MINER_TRUE='#'
>   HAS_AVALON_MINER_FALSE=
> fi
> 
16723c9669
< for ac_lib in '' ncurses pdcurses; do
---
> for ac_lib in '' pdcurses ncurses pdcurses; do
16776c9722
< if test x$avalon$avalon2$avalon4$bitforce$bitfury$blockerupter$modminer$bflsc$icarus$hashfast$hashratio$klondike$drillbit$cointerra$ants1$ants2 != xnononononononononononononononono; then
---
> if test x$avalon$avalon2$avalon4$avalon7$avalon_miner$bitforce$bitfury$blockerupter$modminer$bflsc$icarus$hashfast$hashratio$klondike$drillbit$cointerra$ants1$ants3 != xnononononononononononononononononono; then
16788c9734
< if test x$avalon2$avalon4$hashratio != xnonono; then
---
> if test x$avalon2$avalon4$avalon7$avalon_miner$hashratio != xnonononono; then
16849a9796,9803
>  if test x$avalon4$avalon7 != xnono; then
>   NEED_I2C_CONTEXT_TRUE=
>   NEED_I2C_CONTEXT_FALSE='#'
> else
>   NEED_I2C_CONTEXT_TRUE='#'
>   NEED_I2C_CONTEXT_FALSE=
> fi
> 
16852d9805
< 	dlibusb="no"
16856,16868c9809,9812
< 
< # Check whether --with-system-libusb was given.
< if test "${with_system_libusb+set}" = set; then :
<   withval=$with_system_libusb; dlibusb=$withval
< 
< fi
< 
< 
< 	if test "x$dlibusb" != xno; then
< 		case $target in
< 			*-*-freebsd*)
< 				LIBUSB_LIBS="-lusb"
< 				LIBUSB_CFLAGS=""
---
> 	case $target in
> 		*-*-freebsd*)
> 			LIBUSB_LIBS="-lusb"
> 			LIBUSB_CFLAGS=""
16872,16873c9816,9817
< 				;;
< 			*)
---
> 			;;
> 		*)
17067,17069c10011,10030
< 				;;
< 		esac
< 	else
---
> 			;;
> 	esac
> else
> 	LIBUSB_LIBS=""
> fi
> 
> djansson="no"
> 
> # Check whether --with-system-jansson was given.
> if test "${with_system_jansson+set}" = set; then :
>   withval=$with_system_jansson; djansson=$withval
> 
> fi
> 
> 
> if test "x$djansson" != xno; then
> 	case $target in
> 		*-*-freebsd*)
> 			JANSSON_LIBS="-ljansson"
> 			JANSSON_CFLAGS=""
17070a10032
> $as_echo "#define HAVE_JANSSON 1" >>confdefs.h
17072c10034,10035
< subdirs="$subdirs compat/libusb-1.0"
---
> 			;;
> 		*)
17074,17078c10037,10039
< 		LIBUSB_LIBS="compat/libusb-1.0/libusb/.libs/libusb-1.0.a"
< 		if test "x$have_linux" = "xtrue"; then
< 			# Check whether --enable-udev was given.
< if test "${enable_udev+set}" = set; then :
<   enableval=$enable_udev; udev=$enableval
---
> pkg_failed=no
> { $as_echo "$as_me:${as_lineno-$LINENO}: checking for JANSSON" >&5
> $as_echo_n "checking for JANSSON... " >&6; }
17079a10041,10073
> if test -n "$JANSSON_CFLAGS"; then
>     pkg_cv_JANSSON_CFLAGS="$JANSSON_CFLAGS"
>  elif test -n "$PKG_CONFIG"; then
>     if test -n "$PKG_CONFIG" && \
>     { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"jansson >= 2.6\""; } >&5
>   ($PKG_CONFIG --exists --print-errors "jansson >= 2.6") 2>&5
>   ac_status=$?
>   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
>   test $ac_status = 0; }; then
>   pkg_cv_JANSSON_CFLAGS=`$PKG_CONFIG --cflags "jansson >= 2.6" 2>/dev/null`
> 		      test "x$?" != "x0" && pkg_failed=yes
> else
>   pkg_failed=yes
> fi
>  else
>     pkg_failed=untried
> fi
> if test -n "$JANSSON_LIBS"; then
>     pkg_cv_JANSSON_LIBS="$JANSSON_LIBS"
>  elif test -n "$PKG_CONFIG"; then
>     if test -n "$PKG_CONFIG" && \
>     { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"jansson >= 2.6\""; } >&5
>   ($PKG_CONFIG --exists --print-errors "jansson >= 2.6") 2>&5
>   ac_status=$?
>   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
>   test $ac_status = 0; }; then
>   pkg_cv_JANSSON_LIBS=`$PKG_CONFIG --libs "jansson >= 2.6" 2>/dev/null`
> 		      test "x$?" != "x0" && pkg_failed=yes
> else
>   pkg_failed=yes
> fi
>  else
>     pkg_failed=untried
17083,17091c10077,10083
< 			if test "x$udev" != xno; then
< 				LIBUSB_LIBS+=" -ludev"
< 			fi
< 		fi
< 		if test "x$have_darwin" = "xtrue"; then
< 			LIBUSB_LIBS+=" -lobjc"
< 			LDFLAGS+=" -framework CoreFoundation -framework IOKit"
< 		fi
< 	fi
---
> 
> if test $pkg_failed = yes; then
>    	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
> $as_echo "no" >&6; }
> 
> if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
>         _pkg_short_errors_supported=yes
17093c10085
< 	LIBUSB_LIBS=""
---
>         _pkg_short_errors_supported=no
17094a10087,10093
>         if test $_pkg_short_errors_supported = yes; then
> 	        JANSSON_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "jansson >= 2.6" 2>&1`
>         else
> 	        JANSSON_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "jansson >= 2.6" 2>&1`
>         fi
> 	# Put the nasty error message in config.log where it belongs
> 	echo "$JANSSON_PKG_ERRORS" >&5
17096,17098c10095,10099
<  if test x$dlibusb = xno; then
<   WANT_STATIC_LIBUSB_TRUE=
<   WANT_STATIC_LIBUSB_FALSE='#'
---
> 	as_fn_error $? "Could not find jansson library - please install jansson >= 2.6" "$LINENO" 5
> elif test $pkg_failed = untried; then
>      	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
> $as_echo "no" >&6; }
> 	as_fn_error $? "Could not find jansson library - please install jansson >= 2.6" "$LINENO" 5
17100,17101c10101,10107
<   WANT_STATIC_LIBUSB_TRUE='#'
<   WANT_STATIC_LIBUSB_FALSE=
---
> 	JANSSON_CFLAGS=$pkg_cv_JANSSON_CFLAGS
> 	JANSSON_LIBS=$pkg_cv_JANSSON_LIBS
>         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
> $as_echo "yes" >&6; }
> 
> $as_echo "#define HAVE_JANSSON 1" >>confdefs.h
> 
17102a10109,10112
> 			;;
> 	esac
> else
> 
17103a10114
> subdirs="$subdirs compat/jansson-2.9"
17105c10116,10125
< subdirs="$subdirs compat/jansson-2.6"
---
> 	JANSSON_LIBS="compat/jansson-2.9/src/.libs/libjansson.a"
> fi
> 
>  if test x$djansson = xno; then
>   WANT_STATIC_JANSSON_TRUE=
>   WANT_STATIC_JANSSON_FALSE='#'
> else
>   WANT_STATIC_JANSSON_TRUE='#'
>   WANT_STATIC_JANSSON_FALSE=
> fi
17107d10126
< JANSSON_LIBS="compat/jansson-2.6/src/.libs/libjansson.a"
17249a10269
> static_curl="no"
17538a10559
> 		static_curl="yes"
17546a10568,10663
>  if test x$static_curl = xyes; then
>   STATIC_CURL_TRUE=
>   STATIC_CURL_FALSE='#'
> else
>   STATIC_CURL_TRUE='#'
>   STATIC_CURL_FALSE=
> fi
> 
> 
> libsystemd="no"
> 
> # Check whether --enable-libsystemd was given.
> if test "${enable_libsystemd+set}" = set; then :
>   enableval=$enable_libsystemd; libsystemd=$enableval
> 
> fi
> 
> 
> if test "x$libsystemd" != xno; then
> 	if test "x$have_linux" != xtrue; then
> 		as_fn_error $? "libsystemd is only supported on Linux platforms" "$LINENO" 5
> 	fi
> 
> 
> pkg_failed=no
> { $as_echo "$as_me:${as_lineno-$LINENO}: checking for LIBSYSTEMD" >&5
> $as_echo_n "checking for LIBSYSTEMD... " >&6; }
> 
> if test -n "$LIBSYSTEMD_CFLAGS"; then
>     pkg_cv_LIBSYSTEMD_CFLAGS="$LIBSYSTEMD_CFLAGS"
>  elif test -n "$PKG_CONFIG"; then
>     if test -n "$PKG_CONFIG" && \
>     { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libsystemd\""; } >&5
>   ($PKG_CONFIG --exists --print-errors "libsystemd") 2>&5
>   ac_status=$?
>   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
>   test $ac_status = 0; }; then
>   pkg_cv_LIBSYSTEMD_CFLAGS=`$PKG_CONFIG --cflags "libsystemd" 2>/dev/null`
> 		      test "x$?" != "x0" && pkg_failed=yes
> else
>   pkg_failed=yes
> fi
>  else
>     pkg_failed=untried
> fi
> if test -n "$LIBSYSTEMD_LIBS"; then
>     pkg_cv_LIBSYSTEMD_LIBS="$LIBSYSTEMD_LIBS"
>  elif test -n "$PKG_CONFIG"; then
>     if test -n "$PKG_CONFIG" && \
>     { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libsystemd\""; } >&5
>   ($PKG_CONFIG --exists --print-errors "libsystemd") 2>&5
>   ac_status=$?
>   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
>   test $ac_status = 0; }; then
>   pkg_cv_LIBSYSTEMD_LIBS=`$PKG_CONFIG --libs "libsystemd" 2>/dev/null`
> 		      test "x$?" != "x0" && pkg_failed=yes
> else
>   pkg_failed=yes
> fi
>  else
>     pkg_failed=untried
> fi
> 
> 
> 
> if test $pkg_failed = yes; then
>    	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
> $as_echo "no" >&6; }
> 
> if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
>         _pkg_short_errors_supported=yes
> else
>         _pkg_short_errors_supported=no
> fi
>         if test $_pkg_short_errors_supported = yes; then
> 	        LIBSYSTEMD_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "libsystemd" 2>&1`
>         else
> 	        LIBSYSTEMD_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "libsystemd" 2>&1`
>         fi
> 	# Put the nasty error message in config.log where it belongs
> 	echo "$LIBSYSTEMD_PKG_ERRORS" >&5
> 
> 	as_fn_error $? "Could not find libsystemd dev" "$LINENO" 5
> elif test $pkg_failed = untried; then
>      	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
> $as_echo "no" >&6; }
> 	as_fn_error $? "Could not find libsystemd dev" "$LINENO" 5
> else
> 	LIBSYSTEMD_CFLAGS=$pkg_cv_LIBSYSTEMD_CFLAGS
> 	LIBSYSTEMD_LIBS=$pkg_cv_LIBSYSTEMD_LIBS
>         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
> $as_echo "yes" >&6; }
> 
> fi
> 
> $as_echo "#define USE_LIBSYSTEMD 1" >>confdefs.h
17547a10665,10667
> else
> 	LIBSYSTEMD_LIBS=""
> fi
17879a11000,11003
> if test -z "${HAS_ANT_S3_TRUE}" && test -z "${HAS_ANT_S3_FALSE}"; then
>   as_fn_error $? "conditional \"HAS_ANT_S3\" was never defined.
> Usually this means the macro was only invoked conditionally." "$LINENO" 5
> fi
17891a11016,11023
> if test -z "${HAS_AVALON7_TRUE}" && test -z "${HAS_AVALON7_FALSE}"; then
>   as_fn_error $? "conditional \"HAS_AVALON7\" was never defined.
> Usually this means the macro was only invoked conditionally." "$LINENO" 5
> fi
> if test -z "${HAS_AVALON_MINER_TRUE}" && test -z "${HAS_AVALON_MINER_FALSE}"; then
>   as_fn_error $? "conditional \"HAS_AVALON_MINER\" was never defined.
> Usually this means the macro was only invoked conditionally." "$LINENO" 5
> fi
17988,17989c11120,11129
< if test -z "${WANT_STATIC_LIBUSB_TRUE}" && test -z "${WANT_STATIC_LIBUSB_FALSE}"; then
<   as_fn_error $? "conditional \"WANT_STATIC_LIBUSB\" was never defined.
---
> if test -z "${NEED_I2C_CONTEXT_TRUE}" && test -z "${NEED_I2C_CONTEXT_FALSE}"; then
>   as_fn_error $? "conditional \"NEED_I2C_CONTEXT\" was never defined.
> Usually this means the macro was only invoked conditionally." "$LINENO" 5
> fi
> if test -z "${WANT_STATIC_JANSSON_TRUE}" && test -z "${WANT_STATIC_JANSSON_FALSE}"; then
>   as_fn_error $? "conditional \"WANT_STATIC_JANSSON\" was never defined.
> Usually this means the macro was only invoked conditionally." "$LINENO" 5
> fi
> if test -z "${STATIC_CURL_TRUE}" && test -z "${STATIC_CURL_FALSE}"; then
>   as_fn_error $? "conditional \"STATIC_CURL\" was never defined.
18389c11529
< This file was extended by cgminer $as_me 4.9.0, which was
---
> This file was extended by cgminer $as_me 4.10.0, which was
18455c11595
< cgminer config.status 4.9.0
---
> cgminer config.status 4.10.0
18576,18852d11715
< 
< # The HP-UX ksh and POSIX shell print the target directory to stdout
< # if CDPATH is set.
< (unset CDPATH) >/dev/null 2>&1 && unset CDPATH
< 
< sed_quote_subst='$sed_quote_subst'
< double_quote_subst='$double_quote_subst'
< delay_variable_subst='$delay_variable_subst'
< macro_version='`$ECHO "$macro_version" | $SED "$delay_single_quote_subst"`'
< macro_revision='`$ECHO "$macro_revision" | $SED "$delay_single_quote_subst"`'
< enable_shared='`$ECHO "$enable_shared" | $SED "$delay_single_quote_subst"`'
< enable_static='`$ECHO "$enable_static" | $SED "$delay_single_quote_subst"`'
< pic_mode='`$ECHO "$pic_mode" | $SED "$delay_single_quote_subst"`'
< enable_fast_install='`$ECHO "$enable_fast_install" | $SED "$delay_single_quote_subst"`'
< SHELL='`$ECHO "$SHELL" | $SED "$delay_single_quote_subst"`'
< ECHO='`$ECHO "$ECHO" | $SED "$delay_single_quote_subst"`'
< PATH_SEPARATOR='`$ECHO "$PATH_SEPARATOR" | $SED "$delay_single_quote_subst"`'
< host_alias='`$ECHO "$host_alias" | $SED "$delay_single_quote_subst"`'
< host='`$ECHO "$host" | $SED "$delay_single_quote_subst"`'
< host_os='`$ECHO "$host_os" | $SED "$delay_single_quote_subst"`'
< build_alias='`$ECHO "$build_alias" | $SED "$delay_single_quote_subst"`'
< build='`$ECHO "$build" | $SED "$delay_single_quote_subst"`'
< build_os='`$ECHO "$build_os" | $SED "$delay_single_quote_subst"`'
< SED='`$ECHO "$SED" | $SED "$delay_single_quote_subst"`'
< Xsed='`$ECHO "$Xsed" | $SED "$delay_single_quote_subst"`'
< GREP='`$ECHO "$GREP" | $SED "$delay_single_quote_subst"`'
< EGREP='`$ECHO "$EGREP" | $SED "$delay_single_quote_subst"`'
< FGREP='`$ECHO "$FGREP" | $SED "$delay_single_quote_subst"`'
< LD='`$ECHO "$LD" | $SED "$delay_single_quote_subst"`'
< NM='`$ECHO "$NM" | $SED "$delay_single_quote_subst"`'
< LN_S='`$ECHO "$LN_S" | $SED "$delay_single_quote_subst"`'
< max_cmd_len='`$ECHO "$max_cmd_len" | $SED "$delay_single_quote_subst"`'
< ac_objext='`$ECHO "$ac_objext" | $SED "$delay_single_quote_subst"`'
< exeext='`$ECHO "$exeext" | $SED "$delay_single_quote_subst"`'
< lt_unset='`$ECHO "$lt_unset" | $SED "$delay_single_quote_subst"`'
< lt_SP2NL='`$ECHO "$lt_SP2NL" | $SED "$delay_single_quote_subst"`'
< lt_NL2SP='`$ECHO "$lt_NL2SP" | $SED "$delay_single_quote_subst"`'
< lt_cv_to_host_file_cmd='`$ECHO "$lt_cv_to_host_file_cmd" | $SED "$delay_single_quote_subst"`'
< lt_cv_to_tool_file_cmd='`$ECHO "$lt_cv_to_tool_file_cmd" | $SED "$delay_single_quote_subst"`'
< reload_flag='`$ECHO "$reload_flag" | $SED "$delay_single_quote_subst"`'
< reload_cmds='`$ECHO "$reload_cmds" | $SED "$delay_single_quote_subst"`'
< OBJDUMP='`$ECHO "$OBJDUMP" | $SED "$delay_single_quote_subst"`'
< deplibs_check_method='`$ECHO "$deplibs_check_method" | $SED "$delay_single_quote_subst"`'
< file_magic_cmd='`$ECHO "$file_magic_cmd" | $SED "$delay_single_quote_subst"`'
< file_magic_glob='`$ECHO "$file_magic_glob" | $SED "$delay_single_quote_subst"`'
< want_nocaseglob='`$ECHO "$want_nocaseglob" | $SED "$delay_single_quote_subst"`'
< DLLTOOL='`$ECHO "$DLLTOOL" | $SED "$delay_single_quote_subst"`'
< sharedlib_from_linklib_cmd='`$ECHO "$sharedlib_from_linklib_cmd" | $SED "$delay_single_quote_subst"`'
< AR='`$ECHO "$AR" | $SED "$delay_single_quote_subst"`'
< AR_FLAGS='`$ECHO "$AR_FLAGS" | $SED "$delay_single_quote_subst"`'
< archiver_list_spec='`$ECHO "$archiver_list_spec" | $SED "$delay_single_quote_subst"`'
< STRIP='`$ECHO "$STRIP" | $SED "$delay_single_quote_subst"`'
< RANLIB='`$ECHO "$RANLIB" | $SED "$delay_single_quote_subst"`'
< old_postinstall_cmds='`$ECHO "$old_postinstall_cmds" | $SED "$delay_single_quote_subst"`'
< old_postuninstall_cmds='`$ECHO "$old_postuninstall_cmds" | $SED "$delay_single_quote_subst"`'
< old_archive_cmds='`$ECHO "$old_archive_cmds" | $SED "$delay_single_quote_subst"`'
< lock_old_archive_extraction='`$ECHO "$lock_old_archive_extraction" | $SED "$delay_single_quote_subst"`'
< CC='`$ECHO "$CC" | $SED "$delay_single_quote_subst"`'
< CFLAGS='`$ECHO "$CFLAGS" | $SED "$delay_single_quote_subst"`'
< compiler='`$ECHO "$compiler" | $SED "$delay_single_quote_subst"`'
< GCC='`$ECHO "$GCC" | $SED "$delay_single_quote_subst"`'
< lt_cv_sys_global_symbol_pipe='`$ECHO "$lt_cv_sys_global_symbol_pipe" | $SED "$delay_single_quote_subst"`'
< lt_cv_sys_global_symbol_to_cdecl='`$ECHO "$lt_cv_sys_global_symbol_to_cdecl" | $SED "$delay_single_quote_subst"`'
< lt_cv_sys_global_symbol_to_c_name_address='`$ECHO "$lt_cv_sys_global_symbol_to_c_name_address" | $SED "$delay_single_quote_subst"`'
< lt_cv_sys_global_symbol_to_c_name_address_lib_prefix='`$ECHO "$lt_cv_sys_global_symbol_to_c_name_address_lib_prefix" | $SED "$delay_single_quote_subst"`'
< nm_file_list_spec='`$ECHO "$nm_file_list_spec" | $SED "$delay_single_quote_subst"`'
< lt_sysroot='`$ECHO "$lt_sysroot" | $SED "$delay_single_quote_subst"`'
< objdir='`$ECHO "$objdir" | $SED "$delay_single_quote_subst"`'
< MAGIC_CMD='`$ECHO "$MAGIC_CMD" | $SED "$delay_single_quote_subst"`'
< lt_prog_compiler_no_builtin_flag='`$ECHO "$lt_prog_compiler_no_builtin_flag" | $SED "$delay_single_quote_subst"`'
< lt_prog_compiler_pic='`$ECHO "$lt_prog_compiler_pic" | $SED "$delay_single_quote_subst"`'
< lt_prog_compiler_wl='`$ECHO "$lt_prog_compiler_wl" | $SED "$delay_single_quote_subst"`'
< lt_prog_compiler_static='`$ECHO "$lt_prog_compiler_static" | $SED "$delay_single_quote_subst"`'
< lt_cv_prog_compiler_c_o='`$ECHO "$lt_cv_prog_compiler_c_o" | $SED "$delay_single_quote_subst"`'
< need_locks='`$ECHO "$need_locks" | $SED "$delay_single_quote_subst"`'
< MANIFEST_TOOL='`$ECHO "$MANIFEST_TOOL" | $SED "$delay_single_quote_subst"`'
< DSYMUTIL='`$ECHO "$DSYMUTIL" | $SED "$delay_single_quote_subst"`'
< NMEDIT='`$ECHO "$NMEDIT" | $SED "$delay_single_quote_subst"`'
< LIPO='`$ECHO "$LIPO" | $SED "$delay_single_quote_subst"`'
< OTOOL='`$ECHO "$OTOOL" | $SED "$delay_single_quote_subst"`'
< OTOOL64='`$ECHO "$OTOOL64" | $SED "$delay_single_quote_subst"`'
< libext='`$ECHO "$libext" | $SED "$delay_single_quote_subst"`'
< shrext_cmds='`$ECHO "$shrext_cmds" | $SED "$delay_single_quote_subst"`'
< extract_expsyms_cmds='`$ECHO "$extract_expsyms_cmds" | $SED "$delay_single_quote_subst"`'
< archive_cmds_need_lc='`$ECHO "$archive_cmds_need_lc" | $SED "$delay_single_quote_subst"`'
< enable_shared_with_static_runtimes='`$ECHO "$enable_shared_with_static_runtimes" | $SED "$delay_single_quote_subst"`'
< export_dynamic_flag_spec='`$ECHO "$export_dynamic_flag_spec" | $SED "$delay_single_quote_subst"`'
< whole_archive_flag_spec='`$ECHO "$whole_archive_flag_spec" | $SED "$delay_single_quote_subst"`'
< compiler_needs_object='`$ECHO "$compiler_needs_object" | $SED "$delay_single_quote_subst"`'
< old_archive_from_new_cmds='`$ECHO "$old_archive_from_new_cmds" | $SED "$delay_single_quote_subst"`'
< old_archive_from_expsyms_cmds='`$ECHO "$old_archive_from_expsyms_cmds" | $SED "$delay_single_quote_subst"`'
< archive_cmds='`$ECHO "$archive_cmds" | $SED "$delay_single_quote_subst"`'
< archive_expsym_cmds='`$ECHO "$archive_expsym_cmds" | $SED "$delay_single_quote_subst"`'
< module_cmds='`$ECHO "$module_cmds" | $SED "$delay_single_quote_subst"`'
< module_expsym_cmds='`$ECHO "$module_expsym_cmds" | $SED "$delay_single_quote_subst"`'
< with_gnu_ld='`$ECHO "$with_gnu_ld" | $SED "$delay_single_quote_subst"`'
< allow_undefined_flag='`$ECHO "$allow_undefined_flag" | $SED "$delay_single_quote_subst"`'
< no_undefined_flag='`$ECHO "$no_undefined_flag" | $SED "$delay_single_quote_subst"`'
< hardcode_libdir_flag_spec='`$ECHO "$hardcode_libdir_flag_spec" | $SED "$delay_single_quote_subst"`'
< hardcode_libdir_separator='`$ECHO "$hardcode_libdir_separator" | $SED "$delay_single_quote_subst"`'
< hardcode_direct='`$ECHO "$hardcode_direct" | $SED "$delay_single_quote_subst"`'
< hardcode_direct_absolute='`$ECHO "$hardcode_direct_absolute" | $SED "$delay_single_quote_subst"`'
< hardcode_minus_L='`$ECHO "$hardcode_minus_L" | $SED "$delay_single_quote_subst"`'
< hardcode_shlibpath_var='`$ECHO "$hardcode_shlibpath_var" | $SED "$delay_single_quote_subst"`'
< hardcode_automatic='`$ECHO "$hardcode_automatic" | $SED "$delay_single_quote_subst"`'
< inherit_rpath='`$ECHO "$inherit_rpath" | $SED "$delay_single_quote_subst"`'
< link_all_deplibs='`$ECHO "$link_all_deplibs" | $SED "$delay_single_quote_subst"`'
< always_export_symbols='`$ECHO "$always_export_symbols" | $SED "$delay_single_quote_subst"`'
< export_symbols_cmds='`$ECHO "$export_symbols_cmds" | $SED "$delay_single_quote_subst"`'
< exclude_expsyms='`$ECHO "$exclude_expsyms" | $SED "$delay_single_quote_subst"`'
< include_expsyms='`$ECHO "$include_expsyms" | $SED "$delay_single_quote_subst"`'
< prelink_cmds='`$ECHO "$prelink_cmds" | $SED "$delay_single_quote_subst"`'
< postlink_cmds='`$ECHO "$postlink_cmds" | $SED "$delay_single_quote_subst"`'
< file_list_spec='`$ECHO "$file_list_spec" | $SED "$delay_single_quote_subst"`'
< variables_saved_for_relink='`$ECHO "$variables_saved_for_relink" | $SED "$delay_single_quote_subst"`'
< need_lib_prefix='`$ECHO "$need_lib_prefix" | $SED "$delay_single_quote_subst"`'
< need_version='`$ECHO "$need_version" | $SED "$delay_single_quote_subst"`'
< version_type='`$ECHO "$version_type" | $SED "$delay_single_quote_subst"`'
< runpath_var='`$ECHO "$runpath_var" | $SED "$delay_single_quote_subst"`'
< shlibpath_var='`$ECHO "$shlibpath_var" | $SED "$delay_single_quote_subst"`'
< shlibpath_overrides_runpath='`$ECHO "$shlibpath_overrides_runpath" | $SED "$delay_single_quote_subst"`'
< libname_spec='`$ECHO "$libname_spec" | $SED "$delay_single_quote_subst"`'
< library_names_spec='`$ECHO "$library_names_spec" | $SED "$delay_single_quote_subst"`'
< soname_spec='`$ECHO "$soname_spec" | $SED "$delay_single_quote_subst"`'
< install_override_mode='`$ECHO "$install_override_mode" | $SED "$delay_single_quote_subst"`'
< postinstall_cmds='`$ECHO "$postinstall_cmds" | $SED "$delay_single_quote_subst"`'
< postuninstall_cmds='`$ECHO "$postuninstall_cmds" | $SED "$delay_single_quote_subst"`'
< finish_cmds='`$ECHO "$finish_cmds" | $SED "$delay_single_quote_subst"`'
< finish_eval='`$ECHO "$finish_eval" | $SED "$delay_single_quote_subst"`'
< hardcode_into_libs='`$ECHO "$hardcode_into_libs" | $SED "$delay_single_quote_subst"`'
< sys_lib_search_path_spec='`$ECHO "$sys_lib_search_path_spec" | $SED "$delay_single_quote_subst"`'
< sys_lib_dlsearch_path_spec='`$ECHO "$sys_lib_dlsearch_path_spec" | $SED "$delay_single_quote_subst"`'
< hardcode_action='`$ECHO "$hardcode_action" | $SED "$delay_single_quote_subst"`'
< enable_dlopen='`$ECHO "$enable_dlopen" | $SED "$delay_single_quote_subst"`'
< enable_dlopen_self='`$ECHO "$enable_dlopen_self" | $SED "$delay_single_quote_subst"`'
< enable_dlopen_self_static='`$ECHO "$enable_dlopen_self_static" | $SED "$delay_single_quote_subst"`'
< old_striplib='`$ECHO "$old_striplib" | $SED "$delay_single_quote_subst"`'
< striplib='`$ECHO "$striplib" | $SED "$delay_single_quote_subst"`'
< 
< LTCC='$LTCC'
< LTCFLAGS='$LTCFLAGS'
< compiler='$compiler_DEFAULT'
< 
< # A function that is used when there is no print builtin or printf.
< func_fallback_echo ()
< {
<   eval 'cat <<_LTECHO_EOF
< \$1
< _LTECHO_EOF'
< }
< 
< # Quote evaled strings.
< for var in SHELL \
< ECHO \
< PATH_SEPARATOR \
< SED \
< GREP \
< EGREP \
< FGREP \
< LD \
< NM \
< LN_S \
< lt_SP2NL \
< lt_NL2SP \
< reload_flag \
< OBJDUMP \
< deplibs_check_method \
< file_magic_cmd \
< file_magic_glob \
< want_nocaseglob \
< DLLTOOL \
< sharedlib_from_linklib_cmd \
< AR \
< AR_FLAGS \
< archiver_list_spec \
< STRIP \
< RANLIB \
< CC \
< CFLAGS \
< compiler \
< lt_cv_sys_global_symbol_pipe \
< lt_cv_sys_global_symbol_to_cdecl \
< lt_cv_sys_global_symbol_to_c_name_address \
< lt_cv_sys_global_symbol_to_c_name_address_lib_prefix \
< nm_file_list_spec \
< lt_prog_compiler_no_builtin_flag \
< lt_prog_compiler_pic \
< lt_prog_compiler_wl \
< lt_prog_compiler_static \
< lt_cv_prog_compiler_c_o \
< need_locks \
< MANIFEST_TOOL \
< DSYMUTIL \
< NMEDIT \
< LIPO \
< OTOOL \
< OTOOL64 \
< shrext_cmds \
< export_dynamic_flag_spec \
< whole_archive_flag_spec \
< compiler_needs_object \
< with_gnu_ld \
< allow_undefined_flag \
< no_undefined_flag \
< hardcode_libdir_flag_spec \
< hardcode_libdir_separator \
< exclude_expsyms \
< include_expsyms \
< file_list_spec \
< variables_saved_for_relink \
< libname_spec \
< library_names_spec \
< soname_spec \
< install_override_mode \
< finish_eval \
< old_striplib \
< striplib; do
<     case \`eval \\\\\$ECHO \\\\""\\\\\$\$var"\\\\"\` in
<     *[\\\\\\\`\\"\\\$]*)
<       eval "lt_\$var=\\\\\\"\\\`\\\$ECHO \\"\\\$\$var\\" | \\\$SED \\"\\\$sed_quote_subst\\"\\\`\\\\\\""
<       ;;
<     *)
<       eval "lt_\$var=\\\\\\"\\\$\$var\\\\\\""
<       ;;
<     esac
< done
< 
< # Double-quote double-evaled strings.
< for var in reload_cmds \
< old_postinstall_cmds \
< old_postuninstall_cmds \
< old_archive_cmds \
< extract_expsyms_cmds \
< old_archive_from_new_cmds \
< old_archive_from_expsyms_cmds \
< archive_cmds \
< archive_expsym_cmds \
< module_cmds \
< module_expsym_cmds \
< export_symbols_cmds \
< prelink_cmds \
< postlink_cmds \
< postinstall_cmds \
< postuninstall_cmds \
< finish_cmds \
< sys_lib_search_path_spec \
< sys_lib_dlsearch_path_spec; do
<     case \`eval \\\\\$ECHO \\\\""\\\\\$\$var"\\\\"\` in
<     *[\\\\\\\`\\"\\\$]*)
<       eval "lt_\$var=\\\\\\"\\\`\\\$ECHO \\"\\\$\$var\\" | \\\$SED -e \\"\\\$double_quote_subst\\" -e \\"\\\$sed_quote_subst\\" -e \\"\\\$delay_variable_subst\\"\\\`\\\\\\""
<       ;;
<     *)
<       eval "lt_\$var=\\\\\\"\\\$\$var\\\\\\""
<       ;;
<     esac
< done
< 
< ac_aux_dir='$ac_aux_dir'
< xsi_shell='$xsi_shell'
< lt_shell_append='$lt_shell_append'
< 
< # See if we are running on zsh, and set the options which allow our
< # commands through without removal of \ escapes INIT.
< if test -n "\${ZSH_VERSION+set}" ; then
<    setopt NO_GLOB_SUBST
< fi
< 
< 
<     PACKAGE='$PACKAGE'
<     VERSION='$VERSION'
<     TIMESTAMP='$TIMESTAMP'
<     RM='$RM'
<     ofile='$ofile'
< 
< 
< 
< 
18863d11725
<     "libtool") CONFIG_COMMANDS="$CONFIG_COMMANDS libtool" ;;
19556,20185d12417
<     "libtool":C)
< 
<     # See if we are running on zsh, and set the options which allow our
<     # commands through without removal of \ escapes.
<     if test -n "${ZSH_VERSION+set}" ; then
<       setopt NO_GLOB_SUBST
<     fi
< 
<     cfgfile="${ofile}T"
<     trap "$RM \"$cfgfile\"; exit 1" 1 2 15
<     $RM "$cfgfile"
< 
<     cat <<_LT_EOF >> "$cfgfile"
< #! $SHELL
< 
< # `$ECHO "$ofile" | sed 's%^.*/%%'` - Provide generalized library-building support services.
< # Generated automatically by $as_me ($PACKAGE$TIMESTAMP) $VERSION
< # Libtool was configured on host `(hostname || uname -n) 2>/dev/null | sed 1q`:
< # NOTE: Changes made to this file will be lost: look at ltmain.sh.
< #
< #   Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2003, 2004, 2005,
< #                 2006, 2007, 2008, 2009, 2010, 2011 Free Software
< #                 Foundation, Inc.
< #   Written by Gordon Matzigkeit, 1996
< #
< #   This file is part of GNU Libtool.
< #
< # GNU Libtool is free software; you can redistribute it and/or
< # modify it under the terms of the GNU General Public License as
< # published by the Free Software Foundation; either version 2 of
< # the License, or (at your option) any later version.
< #
< # As a special exception to the GNU General Public License,
< # if you distribute this file as part of a program or library that
< # is built using GNU Libtool, you may include this file under the
< # same distribution terms that you use for the rest of that program.
< #
< # GNU Libtool is distributed in the hope that it will be useful,
< # but WITHOUT ANY WARRANTY; without even the implied warranty of
< # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
< # GNU General Public License for more details.
< #
< # You should have received a copy of the GNU General Public License
< # along with GNU Libtool; see the file COPYING.  If not, a copy
< # can be downloaded from http://www.gnu.org/licenses/gpl.html, or
< # obtained by writing to the Free Software Foundation, Inc.,
< # 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
< 
< 
< # The names of the tagged configurations supported by this script.
< available_tags=""
< 
< # ### BEGIN LIBTOOL CONFIG
< 
< # Which release of libtool.m4 was used?
< macro_version=$macro_version
< macro_revision=$macro_revision
< 
< # Whether or not to build shared libraries.
< build_libtool_libs=$enable_shared
< 
< # Whether or not to build static libraries.
< build_old_libs=$enable_static
< 
< # What type of objects to build.
< pic_mode=$pic_mode
< 
< # Whether or not to optimize for fast installation.
< fast_install=$enable_fast_install
< 
< # Shell to use when invoking shell scripts.
< SHELL=$lt_SHELL
< 
< # An echo program that protects backslashes.
< ECHO=$lt_ECHO
< 
< # The PATH separator for the build system.
< PATH_SEPARATOR=$lt_PATH_SEPARATOR
< 
< # The host system.
< host_alias=$host_alias
< host=$host
< host_os=$host_os
< 
< # The build system.
< build_alias=$build_alias
< build=$build
< build_os=$build_os
< 
< # A sed program that does not truncate output.
< SED=$lt_SED
< 
< # Sed that helps us avoid accidentally triggering echo(1) options like -n.
< Xsed="\$SED -e 1s/^X//"
< 
< # A grep program that handles long lines.
< GREP=$lt_GREP
< 
< # An ERE matcher.
< EGREP=$lt_EGREP
< 
< # A literal string matcher.
< FGREP=$lt_FGREP
< 
< # A BSD- or MS-compatible name lister.
< NM=$lt_NM
< 
< # Whether we need soft or hard links.
< LN_S=$lt_LN_S
< 
< # What is the maximum length of a command?
< max_cmd_len=$max_cmd_len
< 
< # Object file suffix (normally "o").
< objext=$ac_objext
< 
< # Executable file suffix (normally "").
< exeext=$exeext
< 
< # whether the shell understands "unset".
< lt_unset=$lt_unset
< 
< # turn spaces into newlines.
< SP2NL=$lt_lt_SP2NL
< 
< # turn newlines into spaces.
< NL2SP=$lt_lt_NL2SP
< 
< # convert \$build file names to \$host format.
< to_host_file_cmd=$lt_cv_to_host_file_cmd
< 
< # convert \$build files to toolchain format.
< to_tool_file_cmd=$lt_cv_to_tool_file_cmd
< 
< # An object symbol dumper.
< OBJDUMP=$lt_OBJDUMP
< 
< # Method to check whether dependent libraries are shared objects.
< deplibs_check_method=$lt_deplibs_check_method
< 
< # Command to use when deplibs_check_method = "file_magic".
< file_magic_cmd=$lt_file_magic_cmd
< 
< # How to find potential files when deplibs_check_method = "file_magic".
< file_magic_glob=$lt_file_magic_glob
< 
< # Find potential files using nocaseglob when deplibs_check_method = "file_magic".
< want_nocaseglob=$lt_want_nocaseglob
< 
< # DLL creation program.
< DLLTOOL=$lt_DLLTOOL
< 
< # Command to associate shared and link libraries.
< sharedlib_from_linklib_cmd=$lt_sharedlib_from_linklib_cmd
< 
< # The archiver.
< AR=$lt_AR
< 
< # Flags to create an archive.
< AR_FLAGS=$lt_AR_FLAGS
< 
< # How to feed a file listing to the archiver.
< archiver_list_spec=$lt_archiver_list_spec
< 
< # A symbol stripping program.
< STRIP=$lt_STRIP
< 
< # Commands used to install an old-style archive.
< RANLIB=$lt_RANLIB
< old_postinstall_cmds=$lt_old_postinstall_cmds
< old_postuninstall_cmds=$lt_old_postuninstall_cmds
< 
< # Whether to use a lock for old archive extraction.
< lock_old_archive_extraction=$lock_old_archive_extraction
< 
< # A C compiler.
< LTCC=$lt_CC
< 
< # LTCC compiler flags.
< LTCFLAGS=$lt_CFLAGS
< 
< # Take the output of nm and produce a listing of raw symbols and C names.
< global_symbol_pipe=$lt_lt_cv_sys_global_symbol_pipe
< 
< # Transform the output of nm in a proper C declaration.
< global_symbol_to_cdecl=$lt_lt_cv_sys_global_symbol_to_cdecl
< 
< # Transform the output of nm in a C name address pair.
< global_symbol_to_c_name_address=$lt_lt_cv_sys_global_symbol_to_c_name_address
< 
< # Transform the output of nm in a C name address pair when lib prefix is needed.
< global_symbol_to_c_name_address_lib_prefix=$lt_lt_cv_sys_global_symbol_to_c_name_address_lib_prefix
< 
< # Specify filename containing input files for \$NM.
< nm_file_list_spec=$lt_nm_file_list_spec
< 
< # The root where to search for dependent libraries,and in which our libraries should be installed.
< lt_sysroot=$lt_sysroot
< 
< # The name of the directory that contains temporary libtool files.
< objdir=$objdir
< 
< # Used to examine libraries when file_magic_cmd begins with "file".
< MAGIC_CMD=$MAGIC_CMD
< 
< # Must we lock files when doing compilation?
< need_locks=$lt_need_locks
< 
< # Manifest tool.
< MANIFEST_TOOL=$lt_MANIFEST_TOOL
< 
< # Tool to manipulate archived DWARF debug symbol files on Mac OS X.
< DSYMUTIL=$lt_DSYMUTIL
< 
< # Tool to change global to local symbols on Mac OS X.
< NMEDIT=$lt_NMEDIT
< 
< # Tool to manipulate fat objects and archives on Mac OS X.
< LIPO=$lt_LIPO
< 
< # ldd/readelf like tool for Mach-O binaries on Mac OS X.
< OTOOL=$lt_OTOOL
< 
< # ldd/readelf like tool for 64 bit Mach-O binaries on Mac OS X 10.4.
< OTOOL64=$lt_OTOOL64
< 
< # Old archive suffix (normally "a").
< libext=$libext
< 
< # Shared library suffix (normally ".so").
< shrext_cmds=$lt_shrext_cmds
< 
< # The commands to extract the exported symbol list from a shared archive.
< extract_expsyms_cmds=$lt_extract_expsyms_cmds
< 
< # Variables whose values should be saved in libtool wrapper scripts and
< # restored at link time.
< variables_saved_for_relink=$lt_variables_saved_for_relink
< 
< # Do we need the "lib" prefix for modules?
< need_lib_prefix=$need_lib_prefix
< 
< # Do we need a version for libraries?
< need_version=$need_version
< 
< # Library versioning type.
< version_type=$version_type
< 
< # Shared library runtime path variable.
< runpath_var=$runpath_var
< 
< # Shared library path variable.
< shlibpath_var=$shlibpath_var
< 
< # Is shlibpath searched before the hard-coded library search path?
< shlibpath_overrides_runpath=$shlibpath_overrides_runpath
< 
< # Format of library name prefix.
< libname_spec=$lt_libname_spec
< 
< # List of archive names.  First name is the real one, the rest are links.
< # The last name is the one that the linker finds with -lNAME
< library_names_spec=$lt_library_names_spec
< 
< # The coded name of the library, if different from the real name.
< soname_spec=$lt_soname_spec
< 
< # Permission mode override for installation of shared libraries.
< install_override_mode=$lt_install_override_mode
< 
< # Command to use after installation of a shared archive.
< postinstall_cmds=$lt_postinstall_cmds
< 
< # Command to use after uninstallation of a shared archive.
< postuninstall_cmds=$lt_postuninstall_cmds
< 
< # Commands used to finish a libtool library installation in a directory.
< finish_cmds=$lt_finish_cmds
< 
< # As "finish_cmds", except a single script fragment to be evaled but
< # not shown.
< finish_eval=$lt_finish_eval
< 
< # Whether we should hardcode library paths into libraries.
< hardcode_into_libs=$hardcode_into_libs
< 
< # Compile-time system search path for libraries.
< sys_lib_search_path_spec=$lt_sys_lib_search_path_spec
< 
< # Run-time system search path for libraries.
< sys_lib_dlsearch_path_spec=$lt_sys_lib_dlsearch_path_spec
< 
< # Whether dlopen is supported.
< dlopen_support=$enable_dlopen
< 
< # Whether dlopen of programs is supported.
< dlopen_self=$enable_dlopen_self
< 
< # Whether dlopen of statically linked programs is supported.
< dlopen_self_static=$enable_dlopen_self_static
< 
< # Commands to strip libraries.
< old_striplib=$lt_old_striplib
< striplib=$lt_striplib
< 
< 
< # The linker used to build libraries.
< LD=$lt_LD
< 
< # How to create reloadable object files.
< reload_flag=$lt_reload_flag
< reload_cmds=$lt_reload_cmds
< 
< # Commands used to build an old-style archive.
< old_archive_cmds=$lt_old_archive_cmds
< 
< # A language specific compiler.
< CC=$lt_compiler
< 
< # Is the compiler the GNU compiler?
< with_gcc=$GCC
< 
< # Compiler flag to turn off builtin functions.
< no_builtin_flag=$lt_lt_prog_compiler_no_builtin_flag
< 
< # Additional compiler flags for building library objects.
< pic_flag=$lt_lt_prog_compiler_pic
< 
< # How to pass a linker flag through the compiler.
< wl=$lt_lt_prog_compiler_wl
< 
< # Compiler flag to prevent dynamic linking.
< link_static_flag=$lt_lt_prog_compiler_static
< 
< # Does compiler simultaneously support -c and -o options?
< compiler_c_o=$lt_lt_cv_prog_compiler_c_o
< 
< # Whether or not to add -lc for building shared libraries.
< build_libtool_need_lc=$archive_cmds_need_lc
< 
< # Whether or not to disallow shared libs when runtime libs are static.
< allow_libtool_libs_with_static_runtimes=$enable_shared_with_static_runtimes
< 
< # Compiler flag to allow reflexive dlopens.
< export_dynamic_flag_spec=$lt_export_dynamic_flag_spec
< 
< # Compiler flag to generate shared objects directly from archives.
< whole_archive_flag_spec=$lt_whole_archive_flag_spec
< 
< # Whether the compiler copes with passing no objects directly.
< compiler_needs_object=$lt_compiler_needs_object
< 
< # Create an old-style archive from a shared archive.
< old_archive_from_new_cmds=$lt_old_archive_from_new_cmds
< 
< # Create a temporary old-style archive to link instead of a shared archive.
< old_archive_from_expsyms_cmds=$lt_old_archive_from_expsyms_cmds
< 
< # Commands used to build a shared archive.
< archive_cmds=$lt_archive_cmds
< archive_expsym_cmds=$lt_archive_expsym_cmds
< 
< # Commands used to build a loadable module if different from building
< # a shared archive.
< module_cmds=$lt_module_cmds
< module_expsym_cmds=$lt_module_expsym_cmds
< 
< # Whether we are building with GNU ld or not.
< with_gnu_ld=$lt_with_gnu_ld
< 
< # Flag that allows shared libraries with undefined symbols to be built.
< allow_undefined_flag=$lt_allow_undefined_flag
< 
< # Flag that enforces no undefined symbols.
< no_undefined_flag=$lt_no_undefined_flag
< 
< # Flag to hardcode \$libdir into a binary during linking.
< # This must work even if \$libdir does not exist
< hardcode_libdir_flag_spec=$lt_hardcode_libdir_flag_spec
< 
< # Whether we need a single "-rpath" flag with a separated argument.
< hardcode_libdir_separator=$lt_hardcode_libdir_separator
< 
< # Set to "yes" if using DIR/libNAME\${shared_ext} during linking hardcodes
< # DIR into the resulting binary.
< hardcode_direct=$hardcode_direct
< 
< # Set to "yes" if using DIR/libNAME\${shared_ext} during linking hardcodes
< # DIR into the resulting binary and the resulting library dependency is
< # "absolute",i.e impossible to change by setting \${shlibpath_var} if the
< # library is relocated.
< hardcode_direct_absolute=$hardcode_direct_absolute
< 
< # Set to "yes" if using the -LDIR flag during linking hardcodes DIR
< # into the resulting binary.
< hardcode_minus_L=$hardcode_minus_L
< 
< # Set to "yes" if using SHLIBPATH_VAR=DIR during linking hardcodes DIR
< # into the resulting binary.
< hardcode_shlibpath_var=$hardcode_shlibpath_var
< 
< # Set to "yes" if building a shared library automatically hardcodes DIR
< # into the library and all subsequent libraries and executables linked
< # against it.
< hardcode_automatic=$hardcode_automatic
< 
< # Set to yes if linker adds runtime paths of dependent libraries
< # to runtime path list.
< inherit_rpath=$inherit_rpath
< 
< # Whether libtool must link a program against all its dependency libraries.
< link_all_deplibs=$link_all_deplibs
< 
< # Set to "yes" if exported symbols are required.
< always_export_symbols=$always_export_symbols
< 
< # The commands to list exported symbols.
< export_symbols_cmds=$lt_export_symbols_cmds
< 
< # Symbols that should not be listed in the preloaded symbols.
< exclude_expsyms=$lt_exclude_expsyms
< 
< # Symbols that must always be exported.
< include_expsyms=$lt_include_expsyms
< 
< # Commands necessary for linking programs (against libraries) with templates.
< prelink_cmds=$lt_prelink_cmds
< 
< # Commands necessary for finishing linking programs.
< postlink_cmds=$lt_postlink_cmds
< 
< # Specify filename containing input files.
< file_list_spec=$lt_file_list_spec
< 
< # How to hardcode a shared library path into an executable.
< hardcode_action=$hardcode_action
< 
< # ### END LIBTOOL CONFIG
< 
< _LT_EOF
< 
<   case $host_os in
<   aix3*)
<     cat <<\_LT_EOF >> "$cfgfile"
< # AIX sometimes has problems with the GCC collect2 program.  For some
< # reason, if we set the COLLECT_NAMES environment variable, the problems
< # vanish in a puff of smoke.
< if test "X${COLLECT_NAMES+set}" != Xset; then
<   COLLECT_NAMES=
<   export COLLECT_NAMES
< fi
< _LT_EOF
<     ;;
<   esac
< 
< 
< ltmain="$ac_aux_dir/ltmain.sh"
< 
< 
<   # We use sed instead of cat because bash on DJGPP gets confused if
<   # if finds mixed CR/LF and LF-only lines.  Since sed operates in
<   # text mode, it properly converts lines to CR/LF.  This bash problem
<   # is reportedly fixed, but why not run on old versions too?
<   sed '$q' "$ltmain" >> "$cfgfile" \
<      || (rm -f "$cfgfile"; exit 1)
< 
<   if test x"$xsi_shell" = xyes; then
<   sed -e '/^func_dirname ()$/,/^} # func_dirname /c\
< func_dirname ()\
< {\
< \    case ${1} in\
< \      */*) func_dirname_result="${1%/*}${2}" ;;\
< \      *  ) func_dirname_result="${3}" ;;\
< \    esac\
< } # Extended-shell func_dirname implementation' "$cfgfile" > $cfgfile.tmp \
<   && mv -f "$cfgfile.tmp" "$cfgfile" \
<     || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
< test 0 -eq $? || _lt_function_replace_fail=:
< 
< 
<   sed -e '/^func_basename ()$/,/^} # func_basename /c\
< func_basename ()\
< {\
< \    func_basename_result="${1##*/}"\
< } # Extended-shell func_basename implementation' "$cfgfile" > $cfgfile.tmp \
<   && mv -f "$cfgfile.tmp" "$cfgfile" \
<     || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
< test 0 -eq $? || _lt_function_replace_fail=:
< 
< 
<   sed -e '/^func_dirname_and_basename ()$/,/^} # func_dirname_and_basename /c\
< func_dirname_and_basename ()\
< {\
< \    case ${1} in\
< \      */*) func_dirname_result="${1%/*}${2}" ;;\
< \      *  ) func_dirname_result="${3}" ;;\
< \    esac\
< \    func_basename_result="${1##*/}"\
< } # Extended-shell func_dirname_and_basename implementation' "$cfgfile" > $cfgfile.tmp \
<   && mv -f "$cfgfile.tmp" "$cfgfile" \
<     || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
< test 0 -eq $? || _lt_function_replace_fail=:
< 
< 
<   sed -e '/^func_stripname ()$/,/^} # func_stripname /c\
< func_stripname ()\
< {\
< \    # pdksh 5.2.14 does not do ${X%$Y} correctly if both X and Y are\
< \    # positional parameters, so assign one to ordinary parameter first.\
< \    func_stripname_result=${3}\
< \    func_stripname_result=${func_stripname_result#"${1}"}\
< \    func_stripname_result=${func_stripname_result%"${2}"}\
< } # Extended-shell func_stripname implementation' "$cfgfile" > $cfgfile.tmp \
<   && mv -f "$cfgfile.tmp" "$cfgfile" \
<     || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
< test 0 -eq $? || _lt_function_replace_fail=:
< 
< 
<   sed -e '/^func_split_long_opt ()$/,/^} # func_split_long_opt /c\
< func_split_long_opt ()\
< {\
< \    func_split_long_opt_name=${1%%=*}\
< \    func_split_long_opt_arg=${1#*=}\
< } # Extended-shell func_split_long_opt implementation' "$cfgfile" > $cfgfile.tmp \
<   && mv -f "$cfgfile.tmp" "$cfgfile" \
<     || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
< test 0 -eq $? || _lt_function_replace_fail=:
< 
< 
<   sed -e '/^func_split_short_opt ()$/,/^} # func_split_short_opt /c\
< func_split_short_opt ()\
< {\
< \    func_split_short_opt_arg=${1#??}\
< \    func_split_short_opt_name=${1%"$func_split_short_opt_arg"}\
< } # Extended-shell func_split_short_opt implementation' "$cfgfile" > $cfgfile.tmp \
<   && mv -f "$cfgfile.tmp" "$cfgfile" \
<     || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
< test 0 -eq $? || _lt_function_replace_fail=:
< 
< 
<   sed -e '/^func_lo2o ()$/,/^} # func_lo2o /c\
< func_lo2o ()\
< {\
< \    case ${1} in\
< \      *.lo) func_lo2o_result=${1%.lo}.${objext} ;;\
< \      *)    func_lo2o_result=${1} ;;\
< \    esac\
< } # Extended-shell func_lo2o implementation' "$cfgfile" > $cfgfile.tmp \
<   && mv -f "$cfgfile.tmp" "$cfgfile" \
<     || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
< test 0 -eq $? || _lt_function_replace_fail=:
< 
< 
<   sed -e '/^func_xform ()$/,/^} # func_xform /c\
< func_xform ()\
< {\
<     func_xform_result=${1%.*}.lo\
< } # Extended-shell func_xform implementation' "$cfgfile" > $cfgfile.tmp \
<   && mv -f "$cfgfile.tmp" "$cfgfile" \
<     || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
< test 0 -eq $? || _lt_function_replace_fail=:
< 
< 
<   sed -e '/^func_arith ()$/,/^} # func_arith /c\
< func_arith ()\
< {\
<     func_arith_result=$(( $* ))\
< } # Extended-shell func_arith implementation' "$cfgfile" > $cfgfile.tmp \
<   && mv -f "$cfgfile.tmp" "$cfgfile" \
<     || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
< test 0 -eq $? || _lt_function_replace_fail=:
< 
< 
<   sed -e '/^func_len ()$/,/^} # func_len /c\
< func_len ()\
< {\
<     func_len_result=${#1}\
< } # Extended-shell func_len implementation' "$cfgfile" > $cfgfile.tmp \
<   && mv -f "$cfgfile.tmp" "$cfgfile" \
<     || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
< test 0 -eq $? || _lt_function_replace_fail=:
< 
< fi
< 
< if test x"$lt_shell_append" = xyes; then
<   sed -e '/^func_append ()$/,/^} # func_append /c\
< func_append ()\
< {\
<     eval "${1}+=\\${2}"\
< } # Extended-shell func_append implementation' "$cfgfile" > $cfgfile.tmp \
<   && mv -f "$cfgfile.tmp" "$cfgfile" \
<     || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
< test 0 -eq $? || _lt_function_replace_fail=:
< 
< 
<   sed -e '/^func_append_quoted ()$/,/^} # func_append_quoted /c\
< func_append_quoted ()\
< {\
< \    func_quote_for_eval "${2}"\
< \    eval "${1}+=\\\\ \\$func_quote_for_eval_result"\
< } # Extended-shell func_append_quoted implementation' "$cfgfile" > $cfgfile.tmp \
<   && mv -f "$cfgfile.tmp" "$cfgfile" \
<     || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
< test 0 -eq $? || _lt_function_replace_fail=:
< 
< 
<   # Save a `func_append' function call where possible by direct use of '+='
<   sed -e 's%func_append \([a-zA-Z_]\{1,\}\) "%\1+="%g' $cfgfile > $cfgfile.tmp \
<     && mv -f "$cfgfile.tmp" "$cfgfile" \
<       || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
<   test 0 -eq $? || _lt_function_replace_fail=:
< else
<   # Save a `func_append' function call even when '+=' is not available
<   sed -e 's%func_append \([a-zA-Z_]\{1,\}\) "%\1="$\1%g' $cfgfile > $cfgfile.tmp \
<     && mv -f "$cfgfile.tmp" "$cfgfile" \
<       || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
<   test 0 -eq $? || _lt_function_replace_fail=:
< fi
< 
< if test x"$_lt_function_replace_fail" = x":"; then
<   { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: Unable to substitute extended shell functions in $ofile" >&5
< $as_echo "$as_me: WARNING: Unable to substitute extended shell functions in $ofile" >&2;}
< fi
< 
< 
<    mv -f "$cfgfile" "$ofile" ||
<     (rm -f "$ofile" && cp "$cfgfile" "$ofile" && rm -f "$cfgfile")
<   chmod +x "$ofile"
< 
<  ;;
20383c12615,12621
< 	echo "  libcurl(GBT+getwork).: Enabled: $LIBCURL_LIBS"
---
> 	echo "  libcurl(GBT).: Enabled: $LIBCURL_LIBS"
> else
> 	echo "  libcurl(GBT).: Disabled"
> fi
> 
> if test "x$libsystemd" != xno; then
> 	echo "  libsystemd...........: Enabled: $LIBSYSTEMD_LIBS"
20385c12623
< 	echo "  libcurl(GBT+getwork).: Disabled"
---
> 	echo "  libsystemd...........: Disabled"
20403a12642,12647
> if test "x$ants3" = xyes; then
> 	echo "  Antminer.S3.Bitmain..: Enabled"
> else
> 	echo "  Antminer.S3.Bitmain..: Disabled"
> fi
> 
20421a12666,12677
> if test "x$avalon7" = xyes; then
> 	echo "  Avalon7.ASICs........: Enabled"
> else
> 	echo "  Avalon7.ASICs........: Disabled"
> fi
> 
> if test "x$avalon_miner" = xyes; then
> 	echo "  Avalon miner.ASICs...: Enabled"
> else
> 	echo "  Avalon miner.ASICs...: Disabled"
> fi
> 
20527c12783
< if test "x$avalon$avalon2$bab$bflsc$bitforce$bitfury$blockerupter$hashfast$hashratio$icarus$klondike$knc$modminer$drillbit$minion$cointerra$bitmine_A1$ants1$ants2$sp10$sp30" = xnononononononononononononononononononononono; then
---
> if test "x$avalon$avalon2$avalon4$avalon7$avalon_miner$bab$bflsc$bitforce$bitfury$blockerupter$hashfast$hashratio$icarus$klondike$knc$modminer$drillbit$minion$cointerra$bitmine_A1$ants1$ants2$ants3$sp10$sp30" = xnonononononononononononononononononononononononono; then
20546c12802
< echo "  LDADD................: $DLOPEN_FLAGS $LIBCURL_LIBS $JANSSON_LIBS $PTHREAD_LIBS $NCURSES_LIBS $PDCURSES_LIBS $WS2_LIBS $MATH_LIBS $LIBUSB_LIBS $RT_LIBS"
---
> echo "  LDADD................: $DLOPEN_FLAGS $LIBCURL_LIBS $LIBSYSTEMD_LIBS $JANSSON_LIBS $PTHREAD_LIBS $NCURSES_LIBS $PDCURSES_LIBS $WS2_LIBS $MATH_LIBS $LIBUSB_LIBS $RT_LIBS"
20551,20554c12807
< if test "x$want_usbutils$dlibusb" = xyesyes; then
< echo "*** SYSTEM LIBUSB BEING ADDED - NOT RECOMMENDED UNLESS YOU ARE UNABLE TO COMPILE THE INCLUDED LIBUSB ***"
< echo
< fi
---
> 
diff '--color=auto' cgminer-4.9.0/configure.ac cgminer-4.10.0/configure.ac
4c4
< m4_define([v_min], [9])
---
> m4_define([v_min], [10])
53c53,55
< LT_INIT([disable-shared])
---
> 
> # This breaks autoreconf so disable it
> # LT_INIT([disable-shared])
94c96
<     AC_DEFINE([_WIN32_WINNT], [0x0501], "WinNT version for XP+ support")
---
>     #AC_DEFINE([_WIN32_WINNT], [0x0501], "WinNT version for XP+ support")
106a109,113
>   *-*-freebsd*)
>     PTHREAD_FLAGS=""
>     DLOPEN_FLAGS=""
>     RT_LIBS=""
>     ;;
126d132
< ants1="no"
128a135,136
> ants1="no"
> 
140d147
< 
153a161,173
> ants3="no"
> 
> AC_ARG_ENABLE([ants3],
> 	[AC_HELP_STRING([--enable-ants3],[Compile support for Antminer S3 Bitmain STANDALONE(default disabled)])],
> 	[ants3=$enableval]
> 	)
> if test "x$ants3" = xyes; then
> 	AC_DEFINE([USE_ANT_S3], [1], [Defined to 1 if Antminer S3 Bitmain support is wanted])
> 	drivercount=x$drivercount
> 	standalone="yes"
> fi
> AM_CONDITIONAL([HAS_ANT_S3], [test x$ants3 = xyes])
> 
190a211,231
> avalon7="no"
> 
> AC_ARG_ENABLE([avalon7],
> 	[AC_HELP_STRING([--enable-avalon7],[Compile support for Avalon7 (default disabled)])],
> 	[avalon7=$enableval]
> 	)
> if test "x$avalon7" = xyes; then
> 	AC_DEFINE([USE_AVALON7], [1], [Defined to 1 if Avalon7 support is wanted])
> fi
> AM_CONDITIONAL([HAS_AVALON7], [test x$avalon7 = xyes])
> 
> avalon_miner="no"
> 
> AC_ARG_ENABLE([avalon_miner],
> 	[AC_HELP_STRING([--enable-avalon-miner],[Compile support for Avalon miner(default disabled)])],
> 	[avalon_miner=$enableval]
> 	)
> if test "x$avalon_miner" = xyes; then
> 	AC_DEFINE([USE_AVALON_MINER], [1], [Defined to 1 if Avalon miner support is wanted])
> fi
> AM_CONDITIONAL([HAS_AVALON_MINER], [test x$avalon_miner = xyes])
262c303
< 	[AC_HELP_STRING([--enable-blockerupter],[Compile support for BlockErupter (default disabled)])],
---
> 	[AC_HELP_STRING([--enable-blockerupter],[Compile support for BlockErupter BROKEN DRIVER (default disabled)])],
439c480
< 	AC_SEARCH_LIBS(addstr, ncurses pdcurses, [
---
> 	AC_SEARCH_LIBS(addstr, pdcurses ncurses pdcurses, [
456c497
< if test x$avalon$avalon2$avalon4$bitforce$bitfury$blockerupter$modminer$bflsc$icarus$hashfast$hashratio$klondike$drillbit$cointerra$ants1$ants2 != xnononononononononononononononono; then
---
> if test x$avalon$avalon2$avalon4$avalon7$avalon_miner$bitforce$bitfury$blockerupter$modminer$bflsc$icarus$hashfast$hashratio$klondike$drillbit$cointerra$ants1$ants3 != xnononononononononononononononononono; then
468c509
< if test x$avalon2$avalon4$hashratio != xnonono; then
---
> if test x$avalon2$avalon4$avalon7$avalon_miner$hashratio != xnonononono; then
480a522
> AM_CONDITIONAL([NEED_I2C_CONTEXT], [test x$avalon4$avalon7 != xnono])
483d524
< 	dlibusb="no"
485,518c526,535
< 	AC_ARG_WITH([system-libusb],
< 		[AC_HELP_STRING([--with-system-libusb],[NOT RECOMMENDED! Compile against dynamic system libusb. (Default use included static libusb)])],
< 		[dlibusb=$withval]
< 	)
< 
< 	if test "x$dlibusb" != xno; then
< 		case $target in
< 			*-*-freebsd*)
< 				LIBUSB_LIBS="-lusb"
< 				LIBUSB_CFLAGS=""
< 				AC_DEFINE(HAVE_LIBUSB, 1, [Define if you have libusb-1.0])
< 				;;
< 			*)
< 				PKG_CHECK_MODULES(LIBUSB, libusb-1.0, [AC_DEFINE(HAVE_LIBUSB, 1, [Define if you have libusb-1.0])], [AC_MSG_ERROR([Could not find usb library - please install libusb-1.0])])
< 				;;
< 		esac
< 	else
< 		AC_CONFIG_SUBDIRS([compat/libusb-1.0])
< 		LIBUSB_LIBS="compat/libusb-1.0/libusb/.libs/libusb-1.0.a"
< 		if test "x$have_linux" = "xtrue"; then
< 			AC_ARG_ENABLE([udev],
< 				[AC_HELP_STRING([--disable-udev],[Disable building libusb with udev])],
< 				[udev=$enableval]
< 				)
< 
< 			if test "x$udev" != xno; then
< 				LIBUSB_LIBS+=" -ludev"
< 			fi
< 		fi
< 		if test "x$have_darwin" = "xtrue"; then
< 			LIBUSB_LIBS+=" -lobjc"
< 			LDFLAGS+=" -framework CoreFoundation -framework IOKit"
< 		fi
< 	fi
---
> 	case $target in
> 		*-*-freebsd*)
> 			LIBUSB_LIBS="-lusb"
> 			LIBUSB_CFLAGS=""
> 			AC_DEFINE(HAVE_LIBUSB, 1, [Define if you have libusb-1.0])
> 			;;
> 		*)
> 			PKG_CHECK_MODULES(LIBUSB, libusb-1.0, [AC_DEFINE(HAVE_LIBUSB, 1, [Define if you have libusb-1.0])], [AC_MSG_ERROR([Could not find usb library - please install libusb-1.0])])
> 			;;
> 	esac
523c540,560
< AM_CONDITIONAL([WANT_STATIC_LIBUSB], [test x$dlibusb = xno])
---
> djansson="no"
> AC_ARG_WITH([system-jansson],
> 	[AC_HELP_STRING([--with-system-jansson],[NOT RECOMMENDED! Compile against dynamic system jansson. (Default use included static jansson)])],
> 	[djansson=$withval]
> )
> 
> if test "x$djansson" != xno; then
> 	case $target in
> 		*-*-freebsd*)
> 			JANSSON_LIBS="-ljansson"
> 			JANSSON_CFLAGS=""
> 			AC_DEFINE(HAVE_JANSSON, 1, [Define if you have jansson >= 2.6])
> 			;;
> 		*)
> 			PKG_CHECK_MODULES(JANSSON, jansson >= 2.6, [AC_DEFINE(HAVE_JANSSON, 1, [Define if you have jansson >= 2.6])], [AC_MSG_ERROR([Could not find jansson library - please install jansson >= 2.6])])
> 			;;
> 	esac
> else
> 	AC_CONFIG_SUBDIRS([compat/jansson-2.9])
> 	JANSSON_LIBS="compat/jansson-2.9/src/.libs/libjansson.a"
> fi
525,526c562
< AC_CONFIG_SUBDIRS([compat/jansson-2.6])
< JANSSON_LIBS="compat/jansson-2.6/src/.libs/libjansson.a"
---
> AM_CONDITIONAL([WANT_STATIC_JANSSON], [test x$djansson = xno])
544c580
< 	[AC_HELP_STRING([--disable-libcurl],[Disable building with libcurl for getwork and GBT support])],
---
> 	[AC_HELP_STRING([--disable-libcurl],[Disable building with libcurl for GBT support])],
547a584
> static_curl="no"
554a592
> 		static_curl="yes"
560a599,611
> AM_CONDITIONAL([STATIC_CURL], [test x$static_curl = xyes])
> 
> libsystemd="no"
> 
> AC_ARG_ENABLE([libsystemd],
> 	[AC_HELP_STRING([--enable-libsystemd],[Enable building with libsystemd for watchdog and status notification support])],
> 	[libsystemd=$enableval]
> )
> 
> if test "x$libsystemd" != xno; then
> 	if test "x$have_linux" != xtrue; then
> 		AC_MSG_ERROR([libsystemd is only supported on Linux platforms])
> 	fi
561a613,617
> 	PKG_CHECK_MODULES(LIBSYSTEMD, libsystemd, , AC_MSG_ERROR(Could not find libsystemd dev))
> 	AC_DEFINE([USE_LIBSYSTEMD], [1], [Defined to 1 if libsystemd support is wanted])
> else
> 	LIBSYSTEMD_LIBS=""
> fi
641c697,703
< 	echo "  libcurl(GBT+getwork).: Enabled: $LIBCURL_LIBS"
---
> 	echo "  libcurl(GBT).: Enabled: $LIBCURL_LIBS"
> else
> 	echo "  libcurl(GBT).: Disabled"
> fi
> 
> if test "x$libsystemd" != xno; then
> 	echo "  libsystemd...........: Enabled: $LIBSYSTEMD_LIBS"
643c705
< 	echo "  libcurl(GBT+getwork).: Disabled"
---
> 	echo "  libsystemd...........: Disabled"
661a724,729
> if test "x$ants3" = xyes; then
> 	echo "  Antminer.S3.Bitmain..: Enabled"
> else
> 	echo "  Antminer.S3.Bitmain..: Disabled"
> fi
> 
679a748,759
> if test "x$avalon7" = xyes; then
> 	echo "  Avalon7.ASICs........: Enabled"
> else
> 	echo "  Avalon7.ASICs........: Disabled"
> fi
> 
> if test "x$avalon_miner" = xyes; then
> 	echo "  Avalon miner.ASICs...: Enabled"
> else
> 	echo "  Avalon miner.ASICs...: Disabled"
> fi
> 
785c865
< if test "x$avalon$avalon2$bab$bflsc$bitforce$bitfury$blockerupter$hashfast$hashratio$icarus$klondike$knc$modminer$drillbit$minion$cointerra$bitmine_A1$ants1$ants2$sp10$sp30" = xnononononononononononononononononononononono; then
---
> if test "x$avalon$avalon2$avalon4$avalon7$avalon_miner$bab$bflsc$bitforce$bitfury$blockerupter$hashfast$hashratio$icarus$klondike$knc$modminer$drillbit$minion$cointerra$bitmine_A1$ants1$ants2$ants3$sp10$sp30" = xnonononononononononononononononononononononononono; then
804c884
< echo "  LDADD................: $DLOPEN_FLAGS $LIBCURL_LIBS $JANSSON_LIBS $PTHREAD_LIBS $NCURSES_LIBS $PDCURSES_LIBS $WS2_LIBS $MATH_LIBS $LIBUSB_LIBS $RT_LIBS"
---
> echo "  LDADD................: $DLOPEN_FLAGS $LIBCURL_LIBS $LIBSYSTEMD_LIBS $JANSSON_LIBS $PTHREAD_LIBS $NCURSES_LIBS $PDCURSES_LIBS $WS2_LIBS $MATH_LIBS $LIBUSB_LIBS $RT_LIBS"
809,812c889
< if test "x$want_usbutils$dlibusb" = xyesyes; then
< echo "*** SYSTEM LIBUSB BEING ADDED - NOT RECOMMENDED UNLESS YOU ARE UNABLE TO COMPILE THE INCLUDED LIBUSB ***"
< echo
< fi
---
> 
diff '--color=auto' cgminer-4.9.0/depcomp cgminer-4.10.0/depcomp
6c6
< # Copyright (C) 1999-2013 Free Software Foundation, Inc.
---
> # Copyright (C) 1999-2014 Free Software Foundation, Inc.
diff '--color=auto' cgminer-4.9.0/driver-avalon2.c cgminer-4.10.0/driver-avalon2.c
2c2
<  * Copyright 2013-2014 Con Kolivas <kernel@kolivas.org>
---
>  * Copyright 2013-2015 Con Kolivas <kernel@kolivas.org>
30d29
<   #include <windows.h>
696,698c695
< 	avalon2->device_data = calloc(sizeof(struct avalon2_info), 1);
< 	if (unlikely(!(avalon2->device_data)))
< 		quit(1, "Failed to calloc avalon2_info");
---
> 	avalon2->device_data = cgcalloc(sizeof(struct avalon2_info), 1);
798,801c795
< 	align_len(&coinbase_len);
< 	pool_stratum->coinbase = calloc(coinbase_len, 1);
< 	if (unlikely(!pool_stratum->coinbase))
< 		quit(1, "Failed to calloc pool_stratum coinbase in avalon2");
---
> 	pool_stratum->coinbase = cgcalloc(coinbase_len, 1);
804d797
< 
808,809c801,802
< 		pool_stratum->swork.merkle_bin = realloc(pool_stratum->swork.merkle_bin,
< 						 sizeof(char *) * merkles + 1);
---
> 		pool_stratum->swork.merkle_bin = cgrealloc(pool_stratum->swork.merkle_bin,
> 							   sizeof(char *) * merkles + 1);
811,813c804
< 			pool_stratum->swork.merkle_bin[i] = malloc(32);
< 			if (unlikely(!pool_stratum->swork.merkle_bin[i]))
< 				quit(1, "Failed to malloc pool_stratum swork merkle_bin");
---
> 			pool_stratum->swork.merkle_bin[i] = cgmalloc(32);
diff '--color=auto' cgminer-4.9.0/driver-avalon4.c cgminer-4.10.0/driver-avalon4.c
2,4c2,4
<  * Copyright 2014 Mikeqin <Fengling.Qin@gmail.com>
<  * Copyright 2013-2014 Con Kolivas <kernel@kolivas.org>
<  * Copyright 2012-2014 Xiangfu <xiangfu@openmobilefree.com>
---
>  * Copyright 2014-2015 Mikeqin <Fengling.Qin@gmail.com>
>  * Copyright 2013-2015 Con Kolivas <kernel@kolivas.org>
>  * Copyright 2012-2015 Xiangfu <xiangfu@openmobilefree.com>
13c13
< 
---
> #include <math.h>
30a31
> bool opt_avalon4_freezesafe;
33c34
< int opt_avalon4_freq[3] = {AVA4_DEFAULT_FREQUENCY,
---
> unsigned int opt_avalon4_freq[3] = {AVA4_DEFAULT_FREQUENCY,
42c43,144
< int opt_avalon4_ntime_offset = AVA4_DEFAULT_ASIC_COUNT;
---
> int opt_avalon4_ntime_offset = AVA4_DEFAULT_ASIC_MAX;
> int opt_avalon4_miningmode = AVA4_MOD_CUSTOM;
> 
> int opt_avalon4_ntcb = AVA4_DEFAULT_NTCB;
> int opt_avalon4_freq_min = AVA4_DEFAULT_FREQUENCY_MIN;
> int opt_avalon4_freq_max = AVA4_DEFAULT_FREQUENCY_MAX;
> bool opt_avalon4_noncecheck = AVA4_DEFAULT_NCHECK;
> int opt_avalon4_smart_speed = AVA4_DEFAULT_SMART_SPEED;
> /*
>  * smart speed have 3 modes
>  * 1. auto speed by A3218 chips
>  * 2. option 1 + adjust by least pll count
>  *    option 1 + adjust by most pll count
>  * 3. option 1 + adjust by average frequency
>  */
> int opt_avalon4_least_pll_check = AVA4_DEFAULT_LEAST_PLL;
> int opt_avalon4_most_pll_check = AVA4_DEFAULT_MOST_PLL;
> int opt_avalon4_speed_bingo = AVA4_DEFAULT_SPEED_BINGO;
> int opt_avalon4_speed_error = AVA4_DEFAULT_SPEED_ERROR;
> bool opt_avalon4_iic_detect = AVA4_DEFAULT_IIC_DETECT;
> int opt_avalon4_freqadj_time = AVA4_DEFAULT_FREQADJ_TIME;
> int opt_avalon4_delta_temp = AVA4_DEFAULT_DELTA_T;
> int opt_avalon4_delta_freq = AVA4_DEFAULT_DELTA_FREQ;
> int opt_avalon4_freqadj_temp = AVA4_MM60_TEMP_FREQADJ;
> 
> static uint8_t avalon4_freezsafemode = 0;
> /* Only for Avalon4 */
> static uint32_t g_freq_array[][2] = {
> 	{100, 0x1e678447},
> 	{113, 0x22688447},
> 	{125, 0x1c470447},
> 	{138, 0x2a6a8447},
> 	{150, 0x22488447},
> 	{163, 0x326c8447},
> 	{175, 0x1a268447},
> 	{188, 0x1c270447},
> 	{200, 0x1e278447},
> 	{213, 0x20280447},
> 	{225, 0x22288447},
> 	{238, 0x24290447},
> 	{250, 0x26298447},
> 	{263, 0x282a0447},
> 	{275, 0x2a2a8447},
> 	{288, 0x2c2b0447},
> 	{300, 0x2e2b8447},
> 	{313, 0x302c0447},
> 	{325, 0x322c8447},
> 	{338, 0x342d0447},
> 	{350, 0x1a068447},
> 	{363, 0x382e0447},
> 	{375, 0x1c070447},
> 	{388, 0x3c2f0447},
> 	{400, 0x1e078447},
> 	{413, 0x40300447},
> 	{425, 0x20080447},
> 	{438, 0x44310447},
> 	{450, 0x22088447},
> 	{463, 0x48320447},
> 	{475, 0x24090447},
> 	{488, 0x4c330447},
> 	{500, 0x26098447},
> 	{513, 0x50340447},
> 	{525, 0x280a0447},
> 	{538, 0x54350447},
> 	{550, 0x2a0a8447},
> 	{563, 0x58360447},
> 	{575, 0x2c0b0447},
> 	{588, 0x5c370447},
> 	{600, 0x2e0b8447},
> 	{613, 0x60380447},
> 	{625, 0x300c0447},
> 	{638, 0x64390447},
> 	{650, 0x320c8447},
> 	{663, 0x683a0447},
> 	{675, 0x340d0447},
> 	{688, 0x6c3b0447},
> 	{700, 0x360d8447},
> 	{713, 0x703c0447},
> 	{725, 0x380e0447},
> 	{738, 0x743d0447},
> 	{750, 0x3a0e8447},
> 	{763, 0x783e0447},
> 	{775, 0x3c0f0447},
> 	{788, 0x7c3f0447},
> 	{800, 0x3e0f8447},
> 	{813, 0x3e0f8447},
> 	{825, 0x40100447},
> 	{838, 0x40100447},
> 	{850, 0x42108447},
> 	{863, 0x42108447},
> 	{875, 0x44110447},
> 	{888, 0x44110447},
> 	{900, 0x46118447},
> 	{913, 0x46118447},
> 	{925, 0x48120447},
> 	{938, 0x48120447},
> 	{950, 0x4a128447},
> 	{963, 0x4a128447},
> 	{975, 0x4c130447},
> 	{988, 0x4c130447},
> 	{1000, 0x4e138447}
> };
76a179,209
> #define R_REF	10000
> #define R0	10000
> #define T0	25
> static float convert_temp(uint16_t adc)
> {
> 	float ret, resistance;
> 
> 	if (!adc || adc >= AVA4_ADC_MAX)
> 		return -273.15;
> 
> 	resistance = (AVA4_ADC_MAX * 1.0 / adc) - 1;
> 	resistance = R_REF / resistance;
> 	ret = resistance / R0;
> 	ret = logf(ret);
> 	ret /= opt_avalon4_ntcb;
> 	ret += 1.0 / (T0 + 273.15);
> 	ret = 1.0 / ret;
> 	ret -= 273.15;
> 
> 	return ret;
> }
> 
> #define V_REF	3.3
> static float convert_voltage(uint16_t adc, float percent)
> {
> 	float voltage;
> 
> 	voltage = adc * V_REF * 1.0 / AVA4_ADC_MAX / percent;
> 	return voltage + 0.4;
> }
> 
216c349
< 		if (info->temp[i] > t)
---
> 		if (info->enable[i] && info->temp[i] > t)
221a355,371
> static inline int get_temp_max(struct avalon4_info *info, int addr)
> {
> 	int i;
> 	int t = -273, t1 = -273;
> 
> 	if (info->enable[addr]) {
> 		t = info->temp[addr];
> 
> 		for (i = 0; i < 2; i++) {
> 			t1 = convert_temp(info->adc[addr][i]);
> 			if (t1 > t)
> 				t = t1;
> 		}
> 	}
> 	return t;
> }
> 
253c403
< 	int t = info->temp[id];
---
> 	int t = info->temp[id], diff, fandiff = opt_avalon4_fan_max - opt_avalon4_fan_min;;
255,267c405,429
< 	if (t < opt_avalon4_temp_target - 10)
< 		info->fan_pct[id] = opt_avalon4_fan_min;
< 	else if (t > opt_avalon4_temp_target + 10 || t > opt_avalon4_overheat - 3)
< 		info->fan_pct[id] = opt_avalon4_fan_max;
< 	else if (t > opt_avalon4_temp_target + 1)
< 		info->fan_pct[id] += 2;
< 	else if (t < opt_avalon4_temp_target - 1)
< 		info->fan_pct[id] -= 2;
< 
< 	if (info->fan_pct[id] < opt_avalon4_fan_min)
< 		info->fan_pct[id] = opt_avalon4_fan_min;
< 	if (info->fan_pct[id] > opt_avalon4_fan_max)
< 		info->fan_pct[id] = opt_avalon4_fan_max;
---
> 	if (info->mod_type[id] == AVA4_TYPE_MM60) {
> 		int t1, t2;
> 		t1 = (int)convert_temp(info->adc[id][0]),
> 		t2 = (int)convert_temp(info->adc[id][1]),
> 
> 		t = t > t1 ? t : t1;
> 		t = t > t2 ? t : t2;
> 	}
> 
> 	if (avalon4_freezsafemode) {
> 		pwm = get_fan_pwm(AVA4_FREEZESAFE_FAN);
> 		return pwm;
> 	}
> 
> 	/* Scale fan% non linearly relatively to target temperature. It will
> 	 * not try to keep the temperature at temp_target that accurately but
> 	 * avoids temperature overshoot in both directions. */
> 	diff = t - opt_avalon4_temp_target + 30;
> 	if (diff > 32)
> 		diff = 32;
> 	else if (diff < 0)
> 		diff = 0;
> 	diff *= diff;
> 	fandiff = fandiff * diff / 1024;
> 	info->fan_pct[id] = opt_avalon4_fan_min + fandiff;
269a432,439
> 
> 	if ((info->mod_type[id] == AVA4_TYPE_MM60) &&
> 		(info->freq_mode[id] == AVA4_FREQ_TEMPADJ_MODE))
> 		pwm = get_fan_pwm(opt_avalon4_fan_max);
> 
> 	if (info->cutoff[id])
> 		pwm = get_fan_pwm(opt_avalon4_fan_max);
> 
288c458,459
< 	int pool_no;
---
> 	int pool_no, i;
> 	uint32_t val[AVA4_DEFAULT_MINER_MAX];
291c462,464
< 		applog(LOG_DEBUG, "Avalon4: H1 %02x, H2 %02x", ar->head[0], ar->head[1]);
---
> 		applog(LOG_DEBUG, "%s-%d-%d: H1 %02x, H2 %02x",
> 				avalon4->drv->name, avalon4->device_id, modular_id,
> 				ar->head[0], ar->head[1]);
299c472,473
< 		applog(LOG_DEBUG, "Avalon4: %02x: expected crc(%04x), actual_crc(%04x)",
---
> 		applog(LOG_DEBUG, "%s-%d-%d: %02x: expected crc(%04x), actual_crc(%04x)",
> 		       avalon4->drv->name, avalon4->device_id, modular_id,
306c480
< 		applog(LOG_DEBUG, "Avalon4: AVA4_P_NONCE");
---
> 		applog(LOG_DEBUG, "%s-%d-%d: AVA4_P_NONCE", avalon4->drv->name, avalon4->device_id, modular_id);
319c493
< 		if (miner >= AVA4_DEFAULT_MINERS ||
---
> 		if (miner >= info->miner_count[modular_id] ||
321c495,497
< 			applog(LOG_DEBUG, "Avalon4: Wrong miner/pool_no %d/%d", miner, pool_no);
---
> 			applog(LOG_DEBUG, "%s-%d-%d: Wrong miner/pool_no %d/%d",
> 					avalon4->drv->name, avalon4->device_id, modular_id,
> 					miner, pool_no);
323,325d498
< 		} else {
< 			info->matching_work[modular_id][miner]++;
< 			info->chipmatching_work[modular_id][miner][chip_id]++;
329c502,506
< 		nonce -= 0x4000;
---
> 
> 		if ((info->mod_type[modular_id] == AVA4_TYPE_MM40) ||
> 			(info->mod_type[modular_id] == AVA4_TYPE_MM41) ||
> 			(info->mod_type[modular_id] == AVA4_TYPE_MM50))
> 			nonce -= 0x4000;
343c520,522
< 				applog(LOG_DEBUG, "Avalon4: Match to previous stratum0! (%s)", pool_stratum0->swork.job_id);
---
> 				applog(LOG_DEBUG, "%s-%d-%d: Match to previous stratum0! (%s)",
> 						avalon4->drv->name, avalon4->device_id, modular_id,
> 						pool_stratum0->swork.job_id);
346c525,527
< 				applog(LOG_DEBUG, "Avalon4: Match to previous stratum1! (%s)", pool_stratum1->swork.job_id);
---
> 				applog(LOG_DEBUG, "%s-%d-%d: Match to previous stratum1! (%s)",
> 						avalon4->drv->name, avalon4->device_id, modular_id,
> 						pool_stratum1->swork.job_id);
349c530,532
< 				applog(LOG_DEBUG, "Avalon4: Match to previous stratum2! (%s)", pool_stratum2->swork.job_id);
---
> 				applog(LOG_DEBUG, "%s-%d-%d: Match to previous stratum2! (%s)",
> 						avalon4->drv->name, avalon4->device_id, modular_id,
> 						pool_stratum2->swork.job_id);
352c535,537
< 				applog(LOG_ERR, "Avalon4: Cannot match to any stratum! (%s)", pool->swork.job_id);
---
> 				applog(LOG_ERR, "%s-%d-%d: Cannot match to any stratum! (%s)",
> 						avalon4->drv->name, avalon4->device_id, modular_id,
> 						pool->swork.job_id);
353a539,542
> 				if (info->mod_type[modular_id] == AVA4_TYPE_MM60) {
> 					info->hw_works_i[modular_id][miner]++;
> 					info->hw5_i[modular_id][miner][info->i_5s]++;
> 				}
358c547,555
< 		submit_nonce2_nonce(thr, pool, real_pool, nonce2, nonce, ntime);
---
> 		if (!submit_nonce2_nonce(thr, pool, real_pool, nonce2, nonce, ntime)) {
> 			if (info->mod_type[modular_id] == AVA4_TYPE_MM60) {
> 				info->hw_works_i[modular_id][miner]++;
> 				info->hw5_i[modular_id][miner][info->i_5s]++;
> 			}
> 		} else {
> 			info->matching_work[modular_id][miner]++;
> 			info->chipmatching_work[modular_id][miner][chip_id]++;
> 		}
361c558
< 		applog(LOG_DEBUG, "Avalon4: AVA4_P_STATUS");
---
> 		applog(LOG_DEBUG, "%s-%d-%d: AVA4_P_STATUS", avalon4->drv->name, avalon4->device_id, modular_id);
375a573
> 		memcpy(&(info->error_code[modular_id]), ar->data + 28, 4);
377c575,579
< 		info->get_frequency[modular_id] = be32toh(info->get_frequency[modular_id]) * 3968 / 65;
---
> 		if (info->mod_type[modular_id] == AVA4_TYPE_MM60) {
> 			if (info->total_asics[modular_id])
> 				info->get_frequency[modular_id] = be32toh(info->get_frequency[modular_id]) / info->total_asics[modular_id];
> 		} else
> 			info->get_frequency[modular_id] = be32toh(info->get_frequency[modular_id]) * 3968 / 65;
381a584
> 		info->error_code[modular_id] = be32toh(info->error_code[modular_id]);
387a591,596
> 		if (info->mod_type[modular_id] == AVA4_TYPE_MM50)
> 			tmp = decode_voltage_ncp5392p(volt);
> 		/* TODO: fix it with the actual board */
> 		if (info->mod_type[modular_id] == AVA4_TYPE_MM60)
> 			tmp = decode_voltage_ncp5392p(volt);
> 
393,394c602,603
< 		info->lw5[modular_id][info->i_1m] += info->local_work[modular_id];
< 		info->hw5[modular_id][info->i_1m] += info->hw_work[modular_id];
---
> 		info->lw5[modular_id][info->i_5s] += info->local_work[modular_id];
> 		info->hw5[modular_id][info->i_5s] += info->hw_work[modular_id];
397a607,633
> 	case AVA4_P_STATUS_LW:
> 		applog(LOG_DEBUG, "%s-%d-%d: AVA4_P_STATUS_LW", avalon4->drv->name, avalon4->device_id, modular_id);
> 		for (i = 0; i < info->miner_count[modular_id]; i++) {
> 			info->local_works_i[modular_id][i] += ((ar->data[i * 3] << 16) |
> 							    (ar->data[i * 3 + 1] << 8) |
> 							    (ar->data[i * 3 + 2]));
> 			info->lw5_i[modular_id][i][info->i_5s] += ((ar->data[i * 3] << 16) |
> 							    (ar->data[i * 3 + 1] << 8) |
> 							    (ar->data[i * 3 + 2]));
> 		}
> 		break;
> 	case AVA4_P_STATUS_HW:
> 		applog(LOG_DEBUG, "%s-%d-%d: AVA4_P_STATUS_HW", avalon4->drv->name, avalon4->device_id, modular_id);
> 		if (info->mod_type[modular_id] == AVA4_TYPE_MM60) {
> 			applog(LOG_NOTICE, "%s-%d-%d: AVA4_P_STATUS_HW found on Avalon6!", avalon4->drv->name, avalon4->device_id, modular_id);
> 			break;
> 		}
> 
> 		for (i = 0; i < info->miner_count[modular_id]; i++) {
> 			info->hw_works_i[modular_id][i] += ((ar->data[i * 3] << 16) |
> 							    (ar->data[i * 3 + 1] << 8) |
> 							    (ar->data[i * 3 + 2]));
> 			info->hw5_i[modular_id][i][info->i_5s] += ((ar->data[i * 3] << 16) |
> 							    (ar->data[i * 3 + 1] << 8) |
> 							    (ar->data[i * 3 + 2]));
> 		}
> 		break;
399c635,679
< 		applog(LOG_DEBUG, "Avalon4: AVA4_P_ACKDETECT");
---
> 		applog(LOG_DEBUG, "%s-%d-%d: AVA4_P_ACKDETECT", avalon4->drv->name, avalon4->device_id, modular_id);
> 		break;
> 	case AVA4_P_STATUS_VOLT:
> 		applog(LOG_DEBUG, "%s-%d-%d: AVA4_P_STATUS_VOLT", avalon4->drv->name, avalon4->device_id, modular_id);
> 		hexdump(ar->data, 32);
> 		for(i = 0; i < info->miner_count[modular_id]; i++) {
> 			tmp = (ar->data[i * 2] << 8) + ar->data[i * 2 + 1];
> 
> 			if (info->mod_type[modular_id] == AVA4_TYPE_MM40)
> 				tmp = decode_voltage_adp3208d(tmp);
> 			if (info->mod_type[modular_id] == AVA4_TYPE_MM41)
> 				tmp = decode_voltage_ncp5392p(tmp);
> 			if (info->mod_type[modular_id] == AVA4_TYPE_MM50)
> 				tmp = decode_voltage_ncp5392p(tmp);
> 			/* TODO: fix it with the actual board */
> 			if (info->mod_type[modular_id] == AVA4_TYPE_MM60)
> 				tmp = decode_voltage_ncp5392p(tmp);
> 
> 			if (tmp < AVA4_DEFAULT_VOLTAGE_MIN || tmp > AVA4_DEFAULT_VOLTAGE_MAX) {
> 				applog(LOG_DEBUG, "%s-%d-%d: AVA4_P_STATUS_VOLT invalid voltage %d", avalon4->drv->name, avalon4->device_id, modular_id, tmp);
> 				return 1;
> 			}
> 			val[((4 + i / 5 * 5) - i + (i / 5 * 5))] = tmp;
> 		}
> 
> 		if (i == info->miner_count[modular_id]) {
> 			for (i = 0; i < info->miner_count[modular_id]; i++) {
> 				info->get_voltage_i[modular_id][i] = val[i];
> 			}
> 		}
> 		break;
> 	case AVA4_P_STATUS_MA:
> 		applog(LOG_DEBUG, "%s-%d-%d: AVA4_P_STATUS_MA", avalon4->drv->name, avalon4->device_id, modular_id);
> 		for (i = 0; i < info->asic_count[modular_id]; i++)
> 			info->ma_sum[modular_id][ar->opt][i] = ar->data[i];
> 		break;
> 	case AVA4_P_STATUS_M:
> 		applog(LOG_DEBUG, "%s-%d-%d: AVA4_P_STATUS_M", avalon4->drv->name, avalon4->device_id, modular_id);
> 		for (i = 0; i < AVA4_DEFAULT_ADC_MAX; i++)
> 			info->adc[modular_id][i] = (ar->data[2 * i] << 8) | ar->data[(2 * i) + 1];
> 
> 		/* MCU LED status --> data[2 * AVA4_DEFAULT_ADC : 2 * AVA4_DEFAULT_ADC_MAX + 3] */
> 		for (i = 0; i < AVA4_DEFAULT_PLL_MAX; i++)
> 			info->pll_sel[modular_id][i] = (ar->data[2 * (AVA4_DEFAULT_ADC_MAX + 2 + i)] << 8) |
> 				ar->data[(2 * (AVA4_DEFAULT_ADC_MAX + 2 + i)) + 1];
402c682
< 		applog(LOG_DEBUG, "Avalon4: Unknown response");
---
> 		applog(LOG_DEBUG, "%s-%d-%d: Unknown response", avalon4->drv->name, avalon4->device_id, modular_id);
418c698
< static int avalon4_iic_init_pkg(uint8_t *iic_pkg, struct avalon4_iic_info *iic_info, uint8_t *buf, int wlen, int rlen)
---
> static int avalon4_auc_init_pkg(uint8_t *iic_pkg, struct avalon4_iic_info *iic_info, uint8_t *buf, int wlen, int rlen)
458c738,777
< static int avalon4_iic_xfer(struct cgpu_info *avalon4,
---
> static int avalon4_iic_xfer(struct cgpu_info *avalon4, uint8_t slave_addr,
> 			    uint8_t *wbuf, int wlen,
> 			    uint8_t *rbuf, int rlen)
> {
> 	struct avalon4_info *info = avalon4->device_data;
> 	struct i2c_ctx *pctx = NULL;
> 	int err = 1;
> 	bool ret = false;
> 
> 	pctx = info->i2c_slaves[slave_addr];
> 	if (!pctx) {
> 		applog(LOG_ERR, "%s-%d: IIC xfer i2c slaves null!", avalon4->drv->name, avalon4->device_id);
> 		goto out;
> 	}
> 
> 	if (wbuf) {
> 		ret = pctx->write_raw(pctx, wbuf, wlen);
> 		if (!ret) {
> 			applog(LOG_DEBUG, "%s-%d: IIC xfer write raw failed!", avalon4->drv->name, avalon4->device_id);
> 			goto out;
> 		}
> 	}
> 
> 	cgsleep_ms(5);
> 
> 	if (rbuf) {
> 		ret = pctx->read_raw(pctx, rbuf, rlen);
> 		if (!ret) {
> 			applog(LOG_DEBUG, "%s-%d: IIC xfer read raw failed!", avalon4->drv->name, avalon4->device_id);
> 			hexdump(rbuf, rlen);
> 			goto out;
> 		}
> 	}
> 
> 	return 0;
> out:
> 	return err;
> }
> 
> static int avalon4_auc_xfer(struct cgpu_info *avalon4,
466a786
> 	usb_buffer_clear(avalon4);
469c789
< 		applog(LOG_DEBUG, "Avalon4: AUC xfer %d, w(%d-%d)!", err, wlen, *write);
---
> 		applog(LOG_DEBUG, "%s-%d: AUC xfer %d, w(%d-%d)!", avalon4->drv->name, avalon4->device_id, err, wlen, *write);
478,479c798,799
< 	if (err || *read != rlen) {
< 		applog(LOG_DEBUG, "Avalon4: AUC xfer %d, r(%d-%d)!", err, rlen - 4, *read);
---
> 	if (err || *read != rlen || *read != rbuf[0]) {
> 		applog(LOG_DEBUG, "%s-%d: AUC xfer %d, r(%d-%d-%d)!", avalon4->drv->name, avalon4->device_id, err, rlen - 4, *read, rbuf[0]);
480a801
> 		return -1;
482d802
< 
498a819
> 	usb_buffer_clear(avalon4);
500c821
< 	applog(LOG_DEBUG, "Avalon4: AUC usb_read %d, %d!", err, rlen);
---
> 	applog(LOG_DEBUG, "%s-%d: AUC usb_read %d, %d!", avalon4->drv->name, avalon4->device_id, err, rlen);
506c827
< 	avalon4_iic_init_pkg(wbuf, &iic_info, NULL, 0, rlen);
---
> 	avalon4_auc_init_pkg(wbuf, &iic_info, NULL, 0, rlen);
509c830
< 	err = avalon4_iic_xfer(avalon4, wbuf, AVA4_AUC_P_SIZE, &wlen, rbuf, rlen, &rlen);
---
> 	err = avalon4_auc_xfer(avalon4, wbuf, AVA4_AUC_P_SIZE, &wlen, rbuf, rlen, &rlen);
511c832
< 		applog(LOG_ERR, "Avalon4: Failed to reset Avalon USB2IIC Converter");
---
> 		applog(LOG_ERR, "%s-%d: Failed to reset Avalon USB2IIC Converter", avalon4->drv->name, avalon4->device_id);
518c839
< 	avalon4_iic_init_pkg(wbuf, &iic_info, NULL, 0, rlen);
---
> 	avalon4_auc_init_pkg(wbuf, &iic_info, NULL, 0, rlen);
521c842
< 	err = avalon4_iic_xfer(avalon4, wbuf, AVA4_AUC_P_SIZE, &wlen, rbuf, rlen, &rlen);
---
> 	err = avalon4_auc_xfer(avalon4, wbuf, AVA4_AUC_P_SIZE, &wlen, rbuf, rlen, &rlen);
523c844
< 		applog(LOG_ERR, "Avalon4: Failed to deinit Avalon USB2IIC Converter");
---
> 		applog(LOG_ERR, "%s-%d: Failed to deinit Avalon USB2IIC Converter", avalon4->drv->name, avalon4->device_id);
532c853
< 	avalon4_iic_init_pkg(wbuf, &iic_info, NULL, 0, rlen);
---
> 	avalon4_auc_init_pkg(wbuf, &iic_info, NULL, 0, rlen);
535c856
< 	err = avalon4_iic_xfer(avalon4, wbuf, AVA4_AUC_P_SIZE, &wlen, rbuf, rlen, &rlen);
---
> 	err = avalon4_auc_xfer(avalon4, wbuf, AVA4_AUC_P_SIZE, &wlen, rbuf, rlen, &rlen);
537c858
< 		applog(LOG_ERR, "Avalon4: Failed to init Avalon USB2IIC Converter");
---
> 		applog(LOG_ERR, "%s-%d: Failed to init Avalon USB2IIC Converter", avalon4->drv->name, avalon4->device_id);
546c867
< 	applog(LOG_DEBUG, "Avalon4: USB2IIC Converter version: %s!", ver);
---
> 	applog(LOG_DEBUG, "%s-%d: USB2IIC Converter version: %s!", avalon4->drv->name, avalon4->device_id, ver);
566c887
< 	avalon4_iic_init_pkg(wbuf, &iic_info, NULL, 0, rlen);
---
> 	avalon4_auc_init_pkg(wbuf, &iic_info, NULL, 0, rlen);
569c890
< 	err = avalon4_iic_xfer(avalon4, wbuf, AVA4_AUC_P_SIZE, &wlen, rbuf, rlen, &rlen);
---
> 	err = avalon4_auc_xfer(avalon4, wbuf, AVA4_AUC_P_SIZE, &wlen, rbuf, rlen, &rlen);
571c892
< 		applog(LOG_ERR, "Avalon4: AUC Failed to get info ");
---
> 		applog(LOG_ERR, "%s-%d: AUC Failed to get info ", avalon4->drv->name, avalon4->device_id);
575c896,897
< 	applog(LOG_DEBUG, "Avalon4: AUC tempADC(%03d), reqcnt(%d), respcnt(%d), txflag(%d), state(%d)",
---
> 	applog(LOG_DEBUG, "%s-%d: AUC tempADC(%03d), reqcnt(%d), respcnt(%d), txflag(%d), state(%d)",
> 			avalon4->drv->name, avalon4->device_id,
598,599d919
< 	iic_info.iic_op = AVA4_IIC_XFER;
< 	iic_info.iic_param.slave_addr = slave_addr;
603,612c923,941
< 	avalon4_iic_init_pkg(wbuf, &iic_info, (uint8_t *)pkg, AVA4_WRITE_SIZE, rlen);
< 	err = avalon4_iic_xfer(avalon4, wbuf, wbuf[0], &wcnt, rbuf, rlen, &rcnt);
< 	if ((pkg->type != AVA4_P_DETECT) && err == -7 && !rcnt && rlen) {
< 		avalon4_iic_init_pkg(wbuf, &iic_info, NULL, 0, rlen);
< 		err = avalon4_iic_xfer(avalon4, wbuf, wbuf[0], &wcnt, rbuf, rlen, &rcnt);
< 		applog(LOG_DEBUG, "Avalon4: IIC read again!(err:%d)", err);
< 	}
< 	if (err || rcnt != rlen) {
< 		if (info->xfer_err_cnt++ == 100) {
< 			applog(LOG_DEBUG, "Avalon4: AUC xfer_err_cnt reach err = %d, rcnt = %d, rlen = %d", err, rcnt, rlen);
---
> 	if (info->connecter == AVA4_CONNECTER_AUC) {
> 		if (unlikely(avalon4->usbinfo.nodev))
> 			return AVA4_SEND_ERROR;
> 
> 		iic_info.iic_op = AVA4_IIC_XFER;
> 		iic_info.iic_param.slave_addr = slave_addr;
> 
> 		avalon4_auc_init_pkg(wbuf, &iic_info, (uint8_t *)pkg, AVA4_WRITE_SIZE, rlen);
> 		err = avalon4_auc_xfer(avalon4, wbuf, wbuf[0], &wcnt, rbuf, rlen, &rcnt);
> 		if ((pkg->type != AVA4_P_DETECT) && err == -7 && !rcnt && rlen) {
> 			avalon4_auc_init_pkg(wbuf, &iic_info, NULL, 0, rlen);
> 			err = avalon4_auc_xfer(avalon4, wbuf, wbuf[0], &wcnt, rbuf, rlen, &rcnt);
> 			applog(LOG_DEBUG, "%s-%d-%d: AUC read again!(type:0x%x, err:%d)", avalon4->drv->name, avalon4->device_id, slave_addr, pkg->type, err);
> 		}
> 		if (err || rcnt != rlen) {
> 			if (info->xfer_err_cnt++ == 100) {
> 				applog(LOG_DEBUG, "%s-%d-%d: AUC xfer_err_cnt reach err = %d, rcnt = %d, rlen = %d",
> 						avalon4->drv->name, avalon4->device_id, slave_addr,
> 						err, rcnt, rlen);
614,615c943,946
< 			cgsleep_ms(5 * 1000); /* Wait MM reset */
< 			avalon4_auc_init(avalon4, info->auc_version);
---
> 				cgsleep_ms(5 * 1000); /* Wait MM reset */
> 				avalon4_auc_init(avalon4, info->auc_version);
> 			}
> 			return AVA4_SEND_ERROR;
617c948,952
< 		return AVA4_SEND_ERROR;
---
> 
> 		if (ret)
> 			memcpy((char *)ret, rbuf + 4, AVA4_READ_SIZE);
> 
> 		info->xfer_err_cnt = 0;
620,621c955,964
< 	if (ret)
< 		memcpy((char *)ret, rbuf + 4, AVA4_READ_SIZE);
---
> 	if (info->connecter == AVA4_CONNECTER_IIC) {
> 		err = avalon4_iic_xfer(avalon4, slave_addr, (uint8_t *)pkg, AVA4_WRITE_SIZE, (uint8_t *)ret, AVA4_READ_SIZE);
> 		if ((pkg->type != AVA4_P_DETECT) && err) {
> 			err = avalon4_iic_xfer(avalon4, slave_addr, (uint8_t *)pkg, AVA4_WRITE_SIZE, (uint8_t *)ret, AVA4_READ_SIZE);
> 			applog(LOG_DEBUG, "%s-%d-%d: IIC read again!(type:0x%x, err:%d)", avalon4->drv->name, avalon4->device_id, slave_addr, pkg->type, err);
> 		}
> 		if (err) {
> 			/* FIXME: Don't care broadcast message with no reply, or it will block other thread when called by avalon4_send_bc_pkgs */
> 			if ((pkg->type != AVA4_P_DETECT) && (slave_addr == AVA4_MODULE_BROADCAST))
> 				return AVA4_SEND_OK;
623c966,978
< 	info->xfer_err_cnt = 0;
---
> 			if (info->xfer_err_cnt++ == 100) {
> 				info->xfer_err_cnt = 0;
> 				applog(LOG_DEBUG, "%s-%d-%d: IIC xfer_err_cnt reach err = %d, rcnt = %d, rlen = %d",
> 						avalon4->drv->name, avalon4->device_id, slave_addr,
> 						err, rcnt, rlen);
> 
> 				cgsleep_ms(5 * 1000); /* Wait MM reset */
> 			}
> 			return AVA4_SEND_ERROR;
> 		}
> 
> 		info->xfer_err_cnt = 0;
> 	}
632,633d986
< 		if (unlikely(avalon4->usbinfo.nodev))
< 			return -1;
641a995
> 	struct avalon4_info *info = avalon4->device_data;
653c1007,1008
< 	applog(LOG_DEBUG, "Avalon4: Pool stratum message STATIC: %d, %d, %d, %d, %d",
---
> 	applog(LOG_DEBUG, "%s-%d: Pool stratum message STATIC: %d, %d, %d, %d, %d",
> 	       avalon4->drv->name, avalon4->device_id,
686c1041,1045
< 	set_target(target, pool->sdiff);
---
> 	if (pool->sdiff <= AVA4_DRV_DIFFMAX)
> 		set_target(target, pool->sdiff);
> 	else
> 		set_target(target, AVA4_DRV_DIFFMAX);
> 
691c1050
< 		applog(LOG_DEBUG, "Avalon4: Pool stratum target: %s", target_str);
---
> 		applog(LOG_DEBUG, "%s-%d: Pool stratum target: %s", avalon4->drv->name, avalon4->device_id, target_str);
702c1061,1062
< 	applog(LOG_DEBUG, "Avalon4: Pool stratum message JOBS_ID[%04x]: %s",
---
> 	applog(LOG_DEBUG, "%s-%d: Pool stratum message JOBS_ID[%04x]: %s",
> 	       avalon4->drv->name, avalon4->device_id,
721c1081,1083
< 	applog(LOG_DEBUG, "Avalon4: Pool stratum message modified COINBASE: %d %d", a, b);
---
> 	applog(LOG_DEBUG, "%s-%d: Pool stratum message modified COINBASE: %d %d",
> 			avalon4->drv->name, avalon4->device_id,
> 			a, b);
737c1099
< 	applog(LOG_DEBUG, "Avalon4: Pool stratum message MERKLES: %d", b);
---
> 	applog(LOG_DEBUG, "%s-%d: Pool stratum message MERKLES: %d", avalon4->drv->name, avalon4->device_id, b);
746c1108
< 	applog(LOG_DEBUG, "Avalon4: Pool stratum message HEADER: 4");
---
> 	applog(LOG_DEBUG, "%s-%d: Pool stratum message HEADER: 4", avalon4->drv->name, avalon4->device_id);
755c1117,1178
< 	avalon4_auc_getinfo(avalon4);
---
> 	if (info->connecter == AVA4_CONNECTER_AUC)
> 		avalon4_auc_getinfo(avalon4);
> }
> 
> static struct cgpu_info *avalon4_iic_detect(void)
> {
> 	int i;
> 	struct avalon4_info *info;
> 	struct cgpu_info *avalon4 = NULL;
> 	struct i2c_ctx *i2c_slave = NULL;
> 
> 	i2c_slave = i2c_slave_open(I2C_BUS, 0);
> 	if (!i2c_slave) {
> 		applog(LOG_ERR, "Avalon4 init iic failed\n");
> 		return NULL;
> 	}
> 
> 	i2c_slave->exit(i2c_slave);
> 	i2c_slave = NULL;
> 
> 	avalon4 = cgcalloc(1, sizeof(*avalon4));
> 	avalon4->drv = &avalon4_drv;
> 	avalon4->deven = DEV_ENABLED;
> 	avalon4->threads = 1;
> 	add_cgpu(avalon4);
> 
> 	applog(LOG_INFO, "%s-%d: Found at %s", avalon4->drv->name, avalon4->device_id,
> 	       I2C_BUS);
> 
> 	avalon4->device_data = cgcalloc(sizeof(struct avalon4_info), 1);
> 	info = avalon4->device_data;
> 
> 	info->polling_first = 1;
> 	info->newnonce = 0;
> 
> 	for (i = 0; i < AVA4_DEFAULT_MODULARS; i++) {
> 		info->enable[i] = 0;
> 		info->mod_type[i] = AVA4_TYPE_NULL;
> 		info->fan_pct[i] = AVA4_DEFAULT_FAN_START;
> 		info->set_voltage[i] = opt_avalon4_voltage_min;
> 		memcpy(info->set_smart_frequency[i], opt_avalon4_freq, sizeof(opt_avalon4_freq));
> 		memcpy(info->set_frequency[i], opt_avalon4_freq, sizeof(opt_avalon4_freq));
> 		info->i2c_slaves[i] = i2c_slave_open(I2C_BUS, i);
> 		if (!info->i2c_slaves[i]) {
> 			applog(LOG_ERR, "Avalon4 init i2c slaves failed\n");
> 			free(avalon4->device_data);
> 			avalon4->device_data = NULL;
> 			free(avalon4);
> 			avalon4 = NULL;
> 			return NULL;
> 		}
> 	}
> 
> 	info->enable[0] = 1;
> 	info->mod_type[0] = AVA4_TYPE_MM40;
> 	info->temp[0] = -273;
> 
> 	info->speed_bingo[0] = opt_avalon4_speed_bingo;
> 	info->speed_error[0] = opt_avalon4_speed_error;
> 	info->connecter = AVA4_CONNECTER_IIC;
> 
> 	return avalon4;
786,789c1209
< 	avalon4->device_data = calloc(sizeof(struct avalon4_info), 1);
< 	if (unlikely(!(avalon4->device_data)))
< 		quit(1, "Failed to calloc avalon4_info");
< 
---
> 	avalon4->device_data = cgcalloc(sizeof(struct avalon4_info), 1);
797,798c1217
< 
< 	info->set_voltage_broadcat = 1;
---
> 	info->newnonce = 0;
804a1224,1225
> 		memcpy(info->set_smart_frequency[i], opt_avalon4_freq, sizeof(opt_avalon4_freq));
> 		memcpy(info->set_frequency[i], opt_avalon4_freq, sizeof(opt_avalon4_freq));
808a1230
> 	info->temp[0] = -273;
810,813c1232,1234
< 	info->set_frequency[0] = opt_avalon4_freq[0];
< 	info->set_frequency[1] = opt_avalon4_freq[1];
< 	info->set_frequency[2] = opt_avalon4_freq[2];
< 
---
> 	info->speed_bingo[0] = opt_avalon4_speed_bingo;
> 	info->speed_error[0] = opt_avalon4_speed_error;
> 	info->connecter = AVA4_CONNECTER_AUC;
819a1241,1242
> 	if (!hotplug && opt_avalon4_iic_detect)
> 		avalon4_iic_detect();
829a1253
> 	memset(&(info->firsthash), 0, sizeof(info->firsthash));
831,832c1255,1259
< 	cgtime(&(info->last_5m));
< 	cgtime(&(info->last_1m));
---
> 	cgtime(&(info->last_30s));
> 	cgtime(&(info->last_5s));
> 	cgtime(&info->last_stratum);
> 	cgtime(&info->last_fadj);
> 	cgtime(&info->last_tcheck);
839,840d1265
< 	info->set_voltage_broadcat = 1;
< 
843a1269,1284
> 	switch (opt_avalon4_miningmode) {
> 		case AVA4_MOD_ECO:
> 			opt_avalon4_fan_min = 20;
> 			opt_avalon4_overheat = 60;
> 			break;
> 		case AVA4_MOD_NORMAL:
> 			opt_avalon4_fan_min = 30;
> 			opt_avalon4_overheat = 50;
> 			break;
> 		case AVA4_MOD_TURBO:
> 			opt_avalon4_fan_min = 60;
> 			opt_avalon4_overheat = 49;
> 			break;
> 		default:
> 			break;
> 	}
847a1289,1304
> static int check_module_exits(struct cgpu_info *avalon4, uint8_t mm_dna[AVA4_MM_DNA_LEN + 1])
> {
> 	struct avalon4_info *info = avalon4->device_data;
> 	int i;
> 
> 	for (i = 0; i < AVA4_DEFAULT_MODULARS; i++) {
> 		if (info->enable[i]) {
> 			/* last byte is \0 */
> 			if (!memcmp(info->mm_dna[i], mm_dna, AVA4_MM_DNA_LEN))
> 				return 1;
> 		}
> 	}
> 
> 	return 0;
> }
> 
853c1310
< 	struct avalon4_pkg detect_pkg;
---
> 	struct avalon4_pkg send_pkg;
856c1313
< 	int i, err;
---
> 	int i, j, k, err;
864c1321
< 		applog(LOG_DEBUG, "%s %d: AVA4_P_DETECT ID[%d]",
---
> 		applog(LOG_DEBUG, "%s-%d: AVA4_P_DETECT ID[%d]",
866c1323,1329
< 		memset(detect_pkg.data, 0, AVA4_P_DATA_LEN);
---
> 		memset(send_pkg.data, 0, AVA4_P_DATA_LEN);
> 		tmp = be32toh(opt_avalon4_freq_min);
> 		memcpy(send_pkg.data, &tmp, 4);
> 		tmp = be32toh(opt_avalon4_freq_max);
> 		memcpy(send_pkg.data + 4, &tmp, 4);
> 		send_pkg.data[8] = opt_avalon4_ntcb >> 8;
> 		send_pkg.data[9] = opt_avalon4_ntcb & 0xff;
868,870c1331,1333
< 		memcpy(detect_pkg.data + 28, &tmp, 4);
< 		avalon4_init_pkg(&detect_pkg, AVA4_P_DETECT, 1, 1);
< 		err = avalon4_iic_xfer_pkg(avalon4, AVA4_MODULE_BROADCAST, &detect_pkg, &ret_pkg);
---
> 		memcpy(send_pkg.data + 28, &tmp, 4);
> 		avalon4_init_pkg(&send_pkg, AVA4_P_DETECT, 1, 1);
> 		err = avalon4_iic_xfer_pkg(avalon4, AVA4_MODULE_BROADCAST, &send_pkg, &ret_pkg);
873c1336
< 				applog(LOG_DEBUG, "%s %d: Should be AVA4_P_ACKDETECT(%d), but %d",
---
> 				applog(LOG_DEBUG, "%s-%d: Should be AVA4_P_ACKDETECT(%d), but %d",
880c1343
< 			applog(LOG_DEBUG, "%s %d: AVA4_P_DETECT: Failed AUC xfer data with err %d",
---
> 			applog(LOG_DEBUG, "%s-%d: AVA4_P_DETECT: Failed AUC xfer data with err %d",
885c1348
< 		applog(LOG_DEBUG, "%s %d: Module detect ID[%d]: %d",
---
> 		applog(LOG_DEBUG, "%s-%d: Module detect ID[%d]: %d",
889a1353,1355
> 		if (check_module_exits(avalon4, ret_pkg.data))
> 			continue;
> 
890a1357,1359
> 		cgtime(&info->last_finc[i]);
> 		cgtime(&info->last_fdec[i]);
> 		cgtime(&info->last_favg[i]);
894a1364,1365
> 		memcpy(&tmp, ret_pkg.data + AVA4_MM_DNA_LEN + AVA4_MM_VER_LEN, 4);
> 		tmp = be32toh(tmp);
895a1367,1377
> 		info->miner_count[i] = AVA4_DEFAULT_MINER_CNT;
> 		info->asic_count[i] = AVA4_DEFAULT_ASIC_CNT;
> 		info->total_asics[i] = tmp;
> 		info->autov[i] = opt_avalon4_autov;
> 		info->toverheat[i] = opt_avalon4_overheat;
> 		if (info->toverheat[i] > AVA4_MM40_TEMP_OVERHEAT)
> 			info->toverheat[i] = AVA4_MM40_TEMP_OVERHEAT;
> 		info->temp_target[i] = opt_avalon4_temp_target;
> 		if (info->temp_target[i] > AVA4_MM40_TEMP_TARGET)
> 			info->temp_target[i] = AVA4_MM40_TEMP_TARGET;
> 
900c1382,1407
< 
---
> 		if (!strncmp((char *)&(info->mm_version[i]), AVA4_MM50_PREFIXSTR, 2)) {
> 			info->miner_count[i] = AVA4_MM50_MINER_CNT;
> 			info->asic_count[i] = AVA4_MM50_ASIC_CNT;
> 			if (opt_avalon4_autov)
> 				applog(LOG_NOTICE, "%s-%d-%d: Module do not support autov",
> 				       avalon4->drv->name, avalon4->device_id, i);
> 			info->autov[i] = false;
> 			info->mod_type[i] = AVA4_TYPE_MM50;
> 		}
> 		if (!strncmp((char *)&(info->mm_version[i]), AVA4_MM60_PREFIXSTR, 2)) {
> 			info->miner_count[i] = AVA4_MM60_MINER_CNT;
> 			info->asic_count[i] = AVA4_MM60_ASIC_CNT;
> 			if (opt_avalon4_autov)
> 				applog(LOG_NOTICE, "%s-%d-%d: Module do not support autov",
> 				       avalon4->drv->name, avalon4->device_id, i);
> 			info->autov[i] = false;
> 			info->toverheat[i] = opt_avalon4_overheat;
> 			if (info->toverheat[i] > AVA4_DEFAULT_TEMP_OVERHEAT)
> 				info->toverheat[i] = AVA4_DEFAULT_TEMP_OVERHEAT;
> 
> 			info->temp_target[i] = opt_avalon4_temp_target;
> 			if (info->temp_target[i] > AVA4_DEFAULT_TEMP_TARGET)
> 				info->temp_target[i] = AVA4_DEFAULT_TEMP_TARGET;
> 			info->mod_type[i] = AVA4_TYPE_MM60;
> 		}
> 		info->ntime_offset[i] = (opt_avalon4_ntime_offset > info->asic_count[i]) ? info->asic_count[i] : opt_avalon4_ntime_offset;
902a1410,1418
> 		for (j = 0; j < info->miner_count[i]; j++) {
> 			info->set_voltage_i[i][j] = opt_avalon4_voltage_min;
> 			info->set_voltage_offset[i][j] = 0;
> 			info->adjflag[i][j] = 0;
> 			memset(info->ma_sum[i][j], 0, sizeof(uint8_t) * info->asic_count[i]);
> 
> 			for (k = 0; k < info->asic_count[i]; k++)
> 				memset(info->set_frequency_i[i][j][k], 0, sizeof(int) * 3);
> 		}
904c1420,1430
< 		applog(LOG_NOTICE, "%s %d: New module detect! ID[%d]",
---
> 		for (j = 0; j < AVA4_DEFAULT_ADC_MAX; j++)
> 			info->adc[i][j] = AVA4_ADC_MAX;
> 		memset(info->pll_sel, 0, sizeof(info->pll_sel));
> 		info->saved[i] = 0;
> 		info->cutoff[i] = 0;
> 		info->get_frequency[i] = 0;
> 		memcpy(info->set_smart_frequency[i], opt_avalon4_freq, sizeof(opt_avalon4_freq));
> 		info->speed_bingo[i] = opt_avalon4_speed_bingo;
> 		info->speed_error[i] = opt_avalon4_speed_error;
> 		info->freq_mode[i] = AVA4_FREQ_INIT_MODE;
> 		applog(LOG_NOTICE, "%s-%d: New module detect! ID[%d]",
905a1432,1463
> 
> 		if (opt_avalon4_miningmode != AVA4_MOD_CUSTOM) {
> 			applog(LOG_DEBUG, "%s-%d-%d: Load mm config",
> 					avalon4->drv->name, avalon4->device_id, i);
> 
> 			memset(send_pkg.data, 0, AVA4_P_DATA_LEN);
> 			avalon4_init_pkg(&send_pkg, AVA4_P_GET_VOLT, 1, 1);
> 			send_pkg.opt = ((1 << 4) | opt_avalon4_miningmode);
> 			err = avalon4_iic_xfer_pkg(avalon4, i, &send_pkg, &ret_pkg);
> 			if (err == AVA4_SEND_OK) {
> 				err = decode_pkg(thr, &ret_pkg, i);
> 				if (err == 0 && ret_pkg.type == AVA4_P_STATUS_VOLT) {
> 					applog(LOG_DEBUG, "%s-%d-%d: Load mm config success",
> 							avalon4->drv->name, avalon4->device_id, i);
> 
> 					for (j = 0; j < info->miner_count[i]; j++) {
> 						applog(LOG_DEBUG, "%s-%d-%d: vol-%d = %d",
> 							avalon4->drv->name, avalon4->device_id, i,
> 							j, info->get_voltage_i[i][j]);
> 
> 						info->set_voltage_i[i][j] = info->get_voltage_i[i][j];
> 					}
> 				} else {
> 					applog(LOG_DEBUG, "%s-%d-%d: Load mm config invalid! err = %d, ret_pkg.type 0x%x",
> 							avalon4->drv->name, avalon4->device_id, i,
> 							err, ret_pkg.type);
> 				}
> 			} else {
> 				applog(LOG_DEBUG, "%s-%d-%d: Load mm config failed!",
> 						avalon4->drv->name, avalon4->device_id, i);
> 			}
> 		}
909c1467
< static int polling(struct thr_info *thr, struct cgpu_info *avalon4, struct avalon4_info *info)
---
> static void detach_module(struct cgpu_info *avalon4, int addr)
910a1469,1513
> 	struct avalon4_info *info = avalon4->device_data;
> 	int i, j;
> 
> 	info->polling_err_cnt[addr] = 0;
> 	info->mod_type[addr] = AVA4_TYPE_NULL;
> 	info->enable[addr] = 0;
> 	info->get_voltage[addr] = 0;
> 	info->get_frequency[addr] = 0;
> 	info->power_good[addr] = 0;
> 	info->error_code[addr] = 0;
> 	info->local_work[addr] = 0;
> 	info->local_works[addr] = 0;
> 	info->hw_work[addr] = 0;
> 	info->hw_works[addr] = 0;
> 	info->total_asics[addr] = 0;
> 	info->toverheat[addr] = opt_avalon4_overheat;
> 	info->temp_target[addr] = opt_avalon4_temp_target;
> 	info->speed_bingo[addr] = opt_avalon4_speed_bingo;
> 	info->speed_error[addr] = opt_avalon4_speed_error;
> 	memset(info->set_frequency[addr], 0, sizeof(int) * 3);
> 	for (i = 0; i < AVA4_DEFAULT_ADJ_TIMES; i++) {
> 		info->lw5[addr][i] = 0;
> 		info->hw5[addr][i] = 0;
> 	}
> 
> 	for (i = 0; i < info->miner_count[addr]; i++) {
> 		info->matching_work[addr][i] = 0;
> 		memset(info->chipmatching_work[addr][i], 0, sizeof(int) * info->asic_count[addr]);
> 		info->local_works_i[addr][i] = 0;
> 		info->hw_works_i[addr][i] = 0;
> 		memset(info->lw5_i[addr][i], 0, AVA4_DEFAULT_ADJ_TIMES * sizeof(uint32_t));
> 		memset(info->hw5_i[addr][i], 0, AVA4_DEFAULT_ADJ_TIMES * sizeof(uint32_t));
> 		memset(info->ma_sum[addr][i], 0, sizeof(uint8_t) * info->asic_count[addr]);
> 		for (j = 0; j < info->asic_count[addr]; j++)
> 			memset(info->set_frequency_i[addr][i][j], 0, sizeof(int) * 3);
> 	}
> 	info->freq_mode[addr] = AVA4_FREQ_INIT_MODE;
> 	applog(LOG_NOTICE, "%s-%d: Module detached! ID[%d]",
> 			avalon4->drv->name, avalon4->device_id, addr);
> }
> 
> static int polling(struct cgpu_info *avalon4)
> {
> 	struct avalon4_info *info = avalon4->device_data;
> 	struct thr_info *thr = avalon4->thr[0];
913c1516
< 	int i, j, tmp, ret, decode_err = 0, do_polling = 0;
---
> 	int i, tmp, ret, decode_err = 0, do_polling = 0;
920c1523
< 		cgsleep_ms(300);
---
> 		cgsleep_ms(600);
926c1529
< 	if (device_tdiff > 5.0 || device_tdiff < 0) {
---
> 	if (device_tdiff > 2.0 || device_tdiff < 0) {
954c1557
< 			decode_err =  decode_pkg(thr, &ar, i);
---
> 			decode_err = decode_pkg(thr, &ar, i);
958,983c1561,1565
< 			if (info->polling_err_cnt[i] >= 4) {
< 				info->polling_err_cnt[i] = 0;
< 				info->mod_type[i] = AVA4_TYPE_NULL;
< 				info->enable[i] = 0;
< 				info->get_voltage[i] = 0;
< 				info->get_frequency[i] = 0;
< 				info->power_good[i] = 0;
< 				info->local_work[i] = 0;
< 				info->local_works[i] = 0;
< 				info->hw_work[i] = 0;
< 				info->hw_works[i] = 0;
< 				for (j = 0; j < 6; j++) {
< 					info->lw5[i][j] = 0;
< 					info->hw5[i][j] = 0;
< 				}
< 
< 				for (j = 0; j < AVA4_DEFAULT_MINERS; j++) {
< 					info->matching_work[i][j] = 0;
< 					info->chipmatching_work[i][j][0] = 0;
< 					info->chipmatching_work[i][j][1] = 0;
< 					info->chipmatching_work[i][j][2] = 0;
< 					info->chipmatching_work[i][j][3] = 0;
< 				}
< 				applog(LOG_NOTICE, "%s %d: Module detached! ID[%d]",
< 				       avalon4->drv->name, avalon4->device_id, i);
< 			}
---
> 			memset(send_pkg.data, 0, AVA4_P_DATA_LEN);
> 			avalon4_init_pkg(&send_pkg, AVA4_P_RSTMMTX, 1, 1);
> 			avalon4_iic_xfer_pkg(avalon4, i, &send_pkg, NULL);
> 			if (info->polling_err_cnt[i] >= 4)
> 				detach_module(avalon4, i);
986c1568
< 		if (ret == AVA4_SEND_OK && !decode_err)
---
> 		if (ret == AVA4_SEND_OK && !decode_err) {
987a1570,1578
> 
> 			if (info->mm_dna[i][AVA4_MM_DNA_LEN - 1] != ar.opt) {
> 				applog(LOG_ERR, "%s-%d-%d: Dup address found %d-%d",
> 						avalon4->drv->name, avalon4->device_id, i,
> 						info->mm_dna[i][AVA4_MM_DNA_LEN - 1], ar.opt);
> 				hexdump((uint8_t *)&ar, sizeof(ar));
> 				detach_module(avalon4, i);
> 			}
> 		}
999c1590
< 	int merkles = pool->merkles;
---
> 	int merkles = pool->merkles, job_id_len;
1000a1592
> 	unsigned short crc;
1005,1006c1597,1604
< 	if (!job_idcmp((unsigned char *)pool->swork.job_id, pool_stratum->swork.job_id))
< 		return;
---
> 	if (pool_stratum->swork.job_id) {
> 		job_id_len = strlen(pool->swork.job_id);
> 		crc = crc16((unsigned char *)pool->swork.job_id, job_id_len);
> 		job_id_len = strlen(pool_stratum->swork.job_id);
> 
> 		if (crc16((unsigned char *)pool_stratum->swork.job_id, job_id_len) == crc)
> 			return;
> 	}
1013,1016c1611
< 	align_len(&coinbase_len);
< 	pool_stratum->coinbase = calloc(coinbase_len, 1);
< 	if (unlikely(!pool_stratum->coinbase))
< 		quit(1, "Failed to calloc pool_stratum coinbase in avalon4");
---
> 	pool_stratum->coinbase = cgcalloc(coinbase_len, 1);
1019d1613
< 
1023,1024c1617,1618
< 		pool_stratum->swork.merkle_bin = realloc(pool_stratum->swork.merkle_bin,
< 						 sizeof(char *) * merkles + 1);
---
> 		pool_stratum->swork.merkle_bin = cgrealloc(pool_stratum->swork.merkle_bin,
> 							   sizeof(char *) * merkles + 1);
1026,1028c1620
< 			pool_stratum->swork.merkle_bin[i] = malloc(32);
< 			if (unlikely(!pool_stratum->swork.merkle_bin[i]))
< 				quit(1, "Failed to malloc pool_stratum swork merkle_bin");
---
> 			pool_stratum->swork.merkle_bin[i] = cgmalloc(32);
1047c1639,1657
< static void avalon4_stratum_set(struct cgpu_info *avalon4, struct pool *pool, int addr, int cutoff)
---
> static inline int mm_cmp_1512(struct avalon4_info *info, int addr)
> {
> 	/* >= 1512 return 1 */
> 	return strncmp(info->mm_version[addr] + 2, "1512", 4) >= 0 ? 1 : 0;
> }
> 
> static inline int mm_cmp_1501(struct avalon4_info *info, int addr)
> {
> 	/* >= 1501 return 1 */
> 	return strncmp(info->mm_version[addr] + 2, "1501", 4) >= 0 ? 1 : 0;
> }
> 
> static inline int mm_cmp_d17f4a(struct avalon4_info *info, int addr)
> {
> 	/* == d17f4a return 1 */
> 	return strncmp(info->mm_version[addr] + 7, "d17f4a", 6) == 0 ? 1 : 0;
> }
> 
> static void avalon4_set_voltage(struct cgpu_info *avalon4, int addr, int opt)
1051c1661,1716
< 	uint32_t tmp = 0, range, start, volt;
---
> 	uint16_t tmp;
> 	uint8_t i;
> 
> 	memset(send_pkg.data, 0, AVA4_P_DATA_LEN);
> 
> 	/* Use shifter to set voltage */
> 	for (i = 0; i < info->miner_count[addr]; i++) {
> 		tmp = info->set_voltage_i[addr][i] + info->set_voltage_offset[addr][i];
> 		if (avalon4_freezsafemode)
> 			tmp = AVA4_FREEZESAFE_VOLTAGE;
> 
> 		if (info->cutoff[addr])
> 			tmp = 0;
> 
> 		if (info->mod_type[addr] == AVA4_TYPE_MM40)
> 			tmp = encode_voltage_adp3208d(tmp);
> 		if (info->mod_type[addr] == AVA4_TYPE_MM41)
> 			tmp = encode_voltage_ncp5392p(tmp);
> 		if (info->mod_type[addr] == AVA4_TYPE_MM50)
> 			tmp = encode_voltage_ncp5392p(tmp);
> 		/* TODO: fix it with the actual board */
> 		if (info->mod_type[addr] == AVA4_TYPE_MM60)
> 			tmp = encode_voltage_ncp5392p(tmp);
> 
> 		tmp = htobe16(tmp);
> 		memcpy(send_pkg.data + 2 * ((4 + i / 5 * 5) - i + (i / 5 * 5)), &tmp, 2);
> 	}
> 
> 	/* Package the data */
> 	avalon4_init_pkg(&send_pkg, AVA4_P_SET_VOLT, 1, 1);
> 	send_pkg.opt = opt;
> 	if (addr == AVA4_MODULE_BROADCAST)
> 		avalon4_send_bc_pkgs(avalon4, &send_pkg);
> 	else
> 		avalon4_iic_xfer_pkg(avalon4, addr, &send_pkg, NULL);
> }
> 
> static uint32_t avalon4_get_cpm(unsigned int freq)
> {
> 	unsigned int i;
> 
> 	for (i = 0; i < sizeof(g_freq_array) / sizeof(g_freq_array[0]); i++)
> 		if (freq >= g_freq_array[i][0] && freq < g_freq_array[i+1][0])
> 			return g_freq_array[i][1];
> 
> 	/* return the lowest freq if not found */
> 	return g_freq_array[0][1];
> }
> 
> static void avalon4_set_freq(struct cgpu_info *avalon4, int addr, uint8_t miner_id, uint8_t chip_id, unsigned int freq[])
> {
> 	struct avalon4_info *info = avalon4->device_data;
> 	struct avalon4_pkg send_pkg;
> 	uint32_t tmp;
> 	uint8_t set = 0;
> 	int i, j;
1053,1055c1718,1796
< 	info->set_frequency[0] = opt_avalon4_freq[0];
< 	info->set_frequency[1] = opt_avalon4_freq[1];
< 	info->set_frequency[2] = opt_avalon4_freq[2];
---
> 	/* Note: 0 (miner_id and chip_id) is reserved for all devices */
> 	if (!miner_id || !chip_id) {
> 		if (memcmp(freq, info->set_frequency[addr], sizeof(int) * 3) || !info->get_frequency[addr]) {
> 			memcpy(info->set_frequency[addr], freq, sizeof(int) * 3);
> 			for (i = 0; i < info->miner_count[addr]; i++) {
> 				for (j = 0; j < info->asic_count[addr]; j++)
> 					memcpy(info->set_frequency_i[addr][i][j], info->set_frequency[addr], sizeof(int) * 3);
> 			}
> 			set = 1;
> 		}
> 	} else {
> 		if (memcmp(freq, info->set_frequency_i[addr][miner_id - 1][chip_id - 1], sizeof(int) * 3)) {
> 			memcpy(info->set_frequency_i[addr][miner_id - 1][chip_id - 1], freq, sizeof(int) * 3);
> 			set = 1;
> 		}
> 	}
> 
> 	if (avalon4_freezsafemode) {
> 		info->set_frequency[addr][0] = info->set_frequency[addr][1] = info->set_frequency[addr][2] = AVA4_FREEZESAFE_FREQUENCY;
> 		memcpy(freq, info->set_frequency[addr], sizeof(int) * 3);
> 		miner_id = 0;
> 		chip_id = 0;
> 		set = 1;
> 	}
> 
> 	if (info->cutoff[addr]) {
> 		info->set_frequency[addr][0] = AVA4_DEFAULT_FREQUENCY_MIN;
> 		info->set_frequency[addr][1] = AVA4_DEFAULT_FREQUENCY_MIN;
> 		info->set_frequency[addr][2] = AVA4_DEFAULT_FREQUENCY_MIN;
> 		memcpy(freq, info->set_frequency[addr], sizeof(int) * 3);
> 		miner_id = 0;
> 		chip_id = 0;
> 		set = 1;
> 	}
> 
> 	if (!set)
> 		return;
> 
> 	memset(send_pkg.data, 0, AVA4_P_DATA_LEN);
> 	if (info->mod_type[addr] == AVA4_TYPE_MM60) {
> 		tmp = be32toh(freq[0]);
> 		memcpy(send_pkg.data, &tmp, 4);
> 		tmp = be32toh(freq[1]);
> 		memcpy(send_pkg.data + 4, &tmp, 4);
> 		tmp = be32toh(freq[2]);
> 		memcpy(send_pkg.data + 8, &tmp, 4);
> 	} else {
> 		tmp = avalon4_get_cpm(freq[0]);
> 		tmp = be32toh(tmp);
> 		memcpy(send_pkg.data, &tmp, 4);
> 		tmp = avalon4_get_cpm(freq[1]);
> 		tmp = be32toh(tmp);
> 		memcpy(send_pkg.data + 4, &tmp, 4);
> 		tmp = avalon4_get_cpm(freq[2]);
> 		tmp = be32toh(tmp);
> 		memcpy(send_pkg.data + 8, &tmp, 4);
> 	}
> 	applog(LOG_DEBUG, "%s-%d-%d: avalon4 set freq (%d-%d-%d)",
> 			avalon4->drv->name, avalon4->device_id, addr,
> 			freq[0],
> 			freq[1],
> 			freq[2]);
> 	send_pkg.data[12] = miner_id;
> 
> 	/* Package the data */
> 	avalon4_init_pkg(&send_pkg, AVA4_P_SET_FREQ, 1, 1);
> 	send_pkg.opt = chip_id;
> 
> 	if (addr == AVA4_MODULE_BROADCAST)
> 		avalon4_send_bc_pkgs(avalon4, &send_pkg);
> 	else
> 		avalon4_iic_xfer_pkg(avalon4, addr, &send_pkg, NULL);
> }
> 
> static void avalon4_stratum_set(struct cgpu_info *avalon4, struct pool *pool, int addr)
> {
> 	struct avalon4_info *info = avalon4->device_data;
> 	struct avalon4_pkg send_pkg;
> 	uint32_t tmp = 0, range, start, volt;
1060,1061c1801,1802
< 	if (opt_avalon4_ntime_offset != AVA4_DEFAULT_ASIC_COUNT) {
< 		tmp = opt_avalon4_ntime_offset | 0x80000000;
---
> 	if (info->ntime_offset[addr] != info->asic_count[addr]) {
> 		tmp = info->ntime_offset[addr] | 0x80000000;
1067c1808,1811
< 	if (cutoff)
---
> 	if (avalon4_freezsafemode)
> 		volt = AVA4_FREEZESAFE_VOLTAGE;
> 
> 	if (info->cutoff[addr])
1068a1813
> 
1072a1818,1822
> 	if (info->mod_type[addr] == AVA4_TYPE_MM50)
> 		tmp = encode_voltage_ncp5392p(volt);
> 	/* TODO: fix it with the actual board */
> 	if (info->mod_type[addr] == AVA4_TYPE_MM60)
> 		tmp = encode_voltage_ncp5392p(volt);
1076c1826,1832
< 	tmp = info->set_frequency[0] | (info->set_frequency[1] << 10) | (info->set_frequency[2] << 20);
---
> 	tmp = info->set_frequency[addr][0] | (info->set_frequency[addr][1] << 10) | (info->set_frequency[addr][2] << 20);
> 	if (avalon4_freezsafemode)
> 		tmp = AVA4_FREEZESAFE_FREQUENCY | (AVA4_FREEZESAFE_FREQUENCY << 10) | (AVA4_FREEZESAFE_FREQUENCY << 20);
> 
> 	if (info->cutoff[addr])
> 		tmp = AVA4_DEFAULT_FREQUENCY_MIN | (AVA4_DEFAULT_FREQUENCY_MIN << 10) | (AVA4_DEFAULT_FREQUENCY_MIN << 20);
> 
1082c1838
< 		range = 0xffffff / (total_devices + 1);
---
> 		range = 0xffffff / (total_devices ? total_devices : 1);
1084,1085c1840,1841
< 		range = 0xffffffff / (total_devices + 1);
< 	start = range * (avalon4->device_id + 1);
---
> 		range = 0xffffffff / (total_devices ? total_devices : 1);
> 	start = range * avalon4->device_id;
1092a1849,1858
> 	/* adjust flag [0-5]: reserved, 6: nonce check, 7: autof*/
> 	tmp = 1;
> 	if (!opt_avalon4_smart_speed)
> 		tmp = 0;
> 	if (opt_avalon4_noncecheck)
> 		tmp |= 2;
> 	send_pkg.data[20] = tmp & 0xff;
> 	send_pkg.data[21] = info->speed_bingo[addr];
> 	send_pkg.data[22] = info->speed_error[addr];
> 
1109a1876,1934
> static void avalon4_adjust_vf(struct cgpu_info *avalon4, int addr, uint8_t save)
> {
> 	struct avalon4_info *info = avalon4->device_data;
> 
> 	if (info->mod_type[addr] == AVA4_TYPE_MM50) {
> 		avalon4_set_voltage(avalon4, addr, ((save << 4) | opt_avalon4_miningmode));
> 		avalon4_set_freq(avalon4, addr, 0, 0, opt_avalon4_freq);
> 	}
> 
> 	if ((info->mod_type[addr] == AVA4_TYPE_MM41) &&
> 			mm_cmp_1501(info, addr)) {
> 		avalon4_set_voltage(avalon4, addr, ((save << 4) | opt_avalon4_miningmode));
> 		avalon4_set_freq(avalon4, addr, 0, 0, opt_avalon4_freq);
> 	}
> 
> 	if ((info->mod_type[addr] == AVA4_TYPE_MM40) &&
> 			mm_cmp_1501(info, addr)) {
> 		if (!mm_cmp_d17f4a(info, addr)) {
> 			avalon4_set_voltage(avalon4, addr, ((save << 4) | opt_avalon4_miningmode));
> 			avalon4_set_freq(avalon4, addr, 0, 0, opt_avalon4_freq);
> 		}
> 	}
> }
> 
> static void avalon4_freq_inc(struct cgpu_info *avalon4, int addr, unsigned int freq[], unsigned int val)
> {
> 	struct avalon4_info *info = avalon4->device_data;
> 	int i;
> 
> 	if (info->mod_type[addr] == AVA4_TYPE_MM60) {
> 		for (i = 0; i < 3; i++) {
> 		if ((freq[i] + val) < AVA4_MM60_FREQUENCY_MAX)
> 			freq[i] += val;
> 		else
> 			freq[i] = AVA4_MM60_FREQUENCY_MAX;
> 		}
> 	}
> }
> 
> static void avalon4_freq_dec(struct cgpu_info *avalon4, int addr, unsigned int freq[], unsigned int val)
> {
> 	struct avalon4_info *info = avalon4->device_data;
> 	int i;
> 
> 	if (info->mod_type[addr] == AVA4_TYPE_MM60) {
> 		for (i = 0; i < 3; i++) {
> 			if (freq[i] <= val) {
> 				freq[i] = AVA4_DEFAULT_FREQUENCY_MIN;
> 				continue;
> 			}
> 
> 			if ((freq[i] - val) >= AVA4_DEFAULT_FREQUENCY_MIN)
> 				freq[i] -= val;
> 			else
> 				freq[i] = AVA4_DEFAULT_FREQUENCY_MIN;
> 		}
> 	}
> }
> 
1117c1942,1943
< 	int i, count = 0;
---
> 	int i;
> 	int max_temp;
1119c1945,1946
< 	applog(LOG_DEBUG, "Avalon4: New stratum: restart: %d, update: %d",
---
> 	applog(LOG_DEBUG, "%s-%d: New stratum: restart: %d, update: %d",
> 	       avalon4->drv->name, avalon4->device_id,
1131c1958
< 		quit(1, "Avalon4: MM has to use stratum pools");
---
> 		quit(1, "%s-%d: MM has to use stratum pools", avalon4->drv->name, avalon4->device_id);
1137c1964,1965
< 		applog(LOG_ERR, "Avalon4: MM pool modified coinbase length(%d) is more than %d",
---
> 		applog(LOG_ERR, "%s-%d: MM pool modified coinbase length(%d) is more than %d",
> 		       avalon4->drv->name, avalon4->device_id,
1142c1970
< 		applog(LOG_ERR, "Avalon4: MM merkles has to be less then %d", AVA4_P_MERKLES_COUNT);
---
> 		applog(LOG_ERR, "%s-%d: MM merkles has to be less then %d", avalon4->drv->name, avalon4->device_id, AVA4_P_MERKLES_COUNT);
1146c1974
< 		applog(LOG_ERR, "Avalon4: MM nonce2 size has to be >= 3 (%d)", pool->n2size);
---
> 		applog(LOG_ERR, "%s-%d: MM nonce2 size has to be >= 3 (%d)", avalon4->drv->name, avalon4->device_id, pool->n2size);
1150d1977
< 	/* Step 3: Send out stratum pkgs */
1152c1979,1980
< 	cg_rlock(&pool->data_lock);
---
> 	/* Step 3: Try to detect new modules */
> 	detect_modules(avalon4);
1153a1982,1983
> 	/* Step 4: Send out stratum pkgs */
> 	cg_rlock(&pool->data_lock);
1159d1988
< 	avalon4_stratum_pkgs(avalon4, pool);
1160a1990
> 	avalon4_stratum_pkgs(avalon4, pool);
1162,1165d1991
< 	cg_wunlock(&info->update_lock);
< 
< 	/* Step 4: Try to detect new modules */
< 	detect_modules(avalon4);
1168,1189d1993
< 	avalon4_stratum_set(avalon4, pool, AVA4_MODULE_BROADCAST, 0);
< 
< 	if (!info->set_voltage_broadcat) {
< 		for (i = 1; i < AVA4_DEFAULT_MODULARS; i++) {
< 			if (!info->enable[i])
< 				continue;
< 			if (info->set_voltage[i] == info->set_voltage[0])
< 				continue;
< 
< 			avalon4_stratum_set(avalon4, pool, i, 0);
< 		}
< 	} else {
< 		for (i = 1; i < AVA4_DEFAULT_MODULARS; i++) {
< 			if (!info->enable[i])
< 				continue;
< 			if (info->mod_type[i] == AVA4_TYPE_MM40)
< 				continue;
< 
< 			avalon4_stratum_set(avalon4, pool, i, 0);
< 		}
< 	}
< 
1194,1198c1998,2069
< 		count++;
< 		if (info->temp[i] < opt_avalon4_overheat)
< 			continue;
< 
< 		avalon4_stratum_set(avalon4, pool, i, 1);
---
> 		max_temp = get_temp_max(info, i);
> 		if (max_temp >= info->toverheat[i])
> 			info->cutoff[i] = 1;
> 
> 		if (info->cutoff[i] && (max_temp <= (info->toverheat[i] - 10)))
> 			info->cutoff[i] = 0;
> 
> 		if (info->cutoff[i])
> 			info->polling_first = 1;
> 
> 		if (info->mod_type[i] == AVA4_TYPE_MM60) {
> 			switch (info->freq_mode[i]) {
> 				case AVA4_FREQ_INIT_MODE:
> 					memcpy(info->set_frequency[i], opt_avalon4_freq, sizeof(opt_avalon4_freq));
> 					memcpy(info->set_smart_frequency[i], info->set_frequency[i], sizeof(info->set_frequency[i]));
> 					if (info->cutoff[i]) {
> 						info->set_frequency[i][0] = AVA4_DEFAULT_FREQUENCY_MIN;
> 						info->set_frequency[i][1] = AVA4_DEFAULT_FREQUENCY_MIN;
> 						info->set_frequency[i][2] = AVA4_DEFAULT_FREQUENCY_MIN;
> 						info->freq_mode[i] = AVA4_FREQ_CUTOFF_MODE;
> 						break;
> 					}
> 					if (mm_cmp_1512(info, i) && (opt_avalon4_smart_speed != AVA4_DEFAULT_SMARTSPEED_OFF))
> 						info->freq_mode[i] = AVA4_FREQ_PLLADJ_MODE;
> 					break;
> 				case AVA4_FREQ_CUTOFF_MODE:
> 					info->set_frequency[i][0] = AVA4_DEFAULT_FREQUENCY_MIN;
> 					info->set_frequency[i][1] = AVA4_DEFAULT_FREQUENCY_MIN;
> 					info->set_frequency[i][2] = AVA4_DEFAULT_FREQUENCY_MIN;
> 					if (!info->cutoff[i]) {
> 						memcpy(info->set_frequency[i], opt_avalon4_freq, sizeof(opt_avalon4_freq));
> 						memcpy(info->set_smart_frequency[i], info->set_frequency[i], sizeof(info->set_frequency[i]));
> 						info->freq_mode[i] = AVA4_FREQ_INIT_MODE;
> 					}
> 					break;
> 				case AVA4_FREQ_TEMPADJ_MODE:
> 					if (info->cutoff[i]) {
> 						info->set_frequency[i][0] = AVA4_DEFAULT_FREQUENCY_MIN;
> 						info->set_frequency[i][1] = AVA4_DEFAULT_FREQUENCY_MIN;
> 						info->set_frequency[i][2] = AVA4_DEFAULT_FREQUENCY_MIN;
> 						info->freq_mode[i] = AVA4_FREQ_CUTOFF_MODE;
> 						break;
> 					}
> 
> 					if (get_temp_max(info, i) <= (info->temp_target[i] - opt_avalon4_delta_temp)) {
> 						memcpy(info->set_frequency[i], opt_avalon4_freq, sizeof(opt_avalon4_freq));
> 						memcpy(info->set_smart_frequency[i], info->set_frequency[i], sizeof(info->set_frequency[i]));
> 						info->freq_mode[i] = AVA4_FREQ_INIT_MODE;
> 						break;
> 					}
> 					/* Adjust frequency when scanhash */
> 					break;
> 				case AVA4_FREQ_PLLADJ_MODE:
> 					if (info->cutoff[i]) {
> 						info->set_frequency[i][0] = AVA4_DEFAULT_FREQUENCY_MIN;
> 						info->set_frequency[i][1] = AVA4_DEFAULT_FREQUENCY_MIN;
> 						info->set_frequency[i][2] = AVA4_DEFAULT_FREQUENCY_MIN;
> 						info->freq_mode[i] = AVA4_FREQ_CUTOFF_MODE;
> 						break;
> 					}
> 
> 					break;
> 				default:
> 					applog(LOG_ERR, "%s-%d-%d: Invalid frequency mode %d",
> 							avalon4->drv->name, avalon4->device_id, i, info->freq_mode[i]);
> 					break;
> 			}
> 			avalon4_stratum_set(avalon4, pool, i);
> 		} else {
> 			avalon4_stratum_set(avalon4, pool, i);
> 			avalon4_adjust_vf(avalon4, i, 0);
> 		}
1200d2070
< 	info->mm_count = count;
1203a2074
> 	cg_wunlock(&info->update_lock);
1213,1214c2084,2087
< 	uint64_t h;
< 	int i, j;
---
> 	int64_t h;
> 	int i, j, k, count = 0;
> 	uint32_t tmp;
> 	int max_temp;
1216c2089,2090
< 	if (unlikely(avalon4->usbinfo.nodev)) {
---
> 	if ((info->connecter == AVA4_CONNECTER_AUC) &&
> 		(unlikely(avalon4->usbinfo.nodev))) {
1218c2092
< 		       avalon4->drv->name, avalon4->device_id);
---
> 				avalon4->drv->name, avalon4->device_id);
1222c2096
< 	/* Stop polling the device if there is no stratum in 3 minutes, network is down */
---
> 	/* Step 1: Stop polling the device if there is no stratum in 3 minutes, network is down */
1224,1225c2098,2101
< 	if (tdiff(&current, &(info->last_stratum)) > 180.0)
< 		return 0;
---
> 	avalon4_freezsafemode = 0;
> 	if (tdiff(&current, &(info->last_stratum)) > 180.0) {
> 		if(!opt_avalon4_freezesafe)
> 			return 0;
1226a2103,2107
> 		if(opt_avalon4_freezesafe)
> 			avalon4_freezsafemode = 1;
> 	}
> 
> 	/* Step 2: Polling  */
1228c2109
< 	polling(thr, avalon4, info);
---
> 	polling(avalon4);
1230a2112
> 	/* Step 3: Adjust voltage */
1232,1236c2114,2118
< 	device_tdiff = tdiff(&current, &(info->last_1m));
< 	if (device_tdiff >= 60.0 || device_tdiff < 0) {
< 		copy_time(&info->last_1m, &current);
< 		if (info->i_1m++ >= 6)
< 			info->i_1m = 0;
---
> 	device_tdiff = tdiff(&current, &(info->last_5s));
> 	if (device_tdiff >= 5.0 || device_tdiff < 0) {
> 		copy_time(&info->last_5s, &current);
> 		if (++info->i_5s >= AVA4_DEFAULT_ADJ_TIMES)
> 			info->i_5s = 0;
1242,1243c2124,2130
< 			info->lw5[i][info->i_1m] = 0;
< 			info->hw5[i][info->i_1m] = 0;
---
> 			info->lw5[i][info->i_5s] = 0;
> 			info->hw5[i][info->i_5s] = 0;
> 
> 			for(j = 0; j < info->miner_count[i]; j++) {
> 				info->lw5_i[i][j][info->i_5s] = 0;
> 				info->hw5_i[i][j][info->i_5s] = 0;
> 			}
1248,1250c2135,2137
< 	device_tdiff = tdiff(&current, &(info->last_5m));
< 	if (opt_avalon4_autov && (device_tdiff > 480.0 || device_tdiff < 0)) {
< 		copy_time(&info->last_5m, &current);
---
> 	device_tdiff = tdiff(&current, &(info->last_30s));
> 	if (opt_avalon4_autov && (device_tdiff > 30.0 || device_tdiff < 0)) {
> 		copy_time(&info->last_30s, &current);
1252a2140,2141
> 			uint8_t individual = 0;
> 
1256,1260c2145,2159
< 			a = 0;
< 			b = 0;
< 			for (j = 0; j < 6; j++) {
< 				a += info->lw5[i][j];
< 				b += info->hw5[i][j];
---
> 			if (!info->autov[i])
> 				continue;
> 
> 			if (info->mod_type[i] == AVA4_TYPE_MM60)
> 				continue;
> 
> 			if (info->mod_type[i] == AVA4_TYPE_MM50)
> 				individual = 1;
> 
> 			if ((info->mod_type[i] == AVA4_TYPE_MM41) && mm_cmp_1501(info, i))
> 				individual = 1;
> 
> 			if ((info->mod_type[i] == AVA4_TYPE_MM40) && mm_cmp_1501(info, i)) {
> 				if (!mm_cmp_d17f4a(info, i))
> 					individual = 1;
1263,1267c2162,2165
< 			hwp = a ? (double)b / (double)a : 0;
< 			if (hwp > AVA4_DH_INC && (info->set_voltage[i] < info->set_voltage[0] + 125)) {
< 				info->set_voltage[i] += 125;
< 				applog(LOG_NOTICE, "%s %d: Automatic increase module[%d] voltage to %d",
< 				       avalon4->drv->name, avalon4->device_id, i, info->set_voltage[i]);
---
> 			if (info->cutoff[i]) {
> 				for (j = 0; j < info->miner_count[i]; j++)
> 					info->adjflag[i][j] = 0;
> 				continue;
1269,1272c2167,2220
< 			if (hwp < AVA4_DH_DEC && (info->set_voltage[i] > info->set_voltage[0] - (4 * 125))) {
< 				info->set_voltage[i] -= 125;
< 				applog(LOG_NOTICE, "%s %d: Automatic decrease module[%d] voltage to %d",
< 				       avalon4->drv->name, avalon4->device_id, i, info->set_voltage[i]);
---
> 
> 			if (!individual) {
> 				a = 0;
> 				b = 0;
> 				for (j = 0; j < AVA4_DEFAULT_ADJ_TIMES; j++) {
> 					a += info->lw5[i][j];
> 					b += info->hw5[i][j];
> 				}
> 
> 				hwp = a ? (double)b / (double)a : 0;
> 				if (hwp > AVA4_DH_INC && (info->set_voltage[i] < info->set_voltage[0] + 125)) {
> 					info->set_voltage[i] += 125;
> 					for (j = 0; j < info->miner_count[i]; j++) {
> 						info->set_voltage_i[i][j] += 125;
> 					}
> 					info->adjflag[i][0] = 1;
> 					applog(LOG_NOTICE, "%s-%d: Automatic increase module[%d] voltage to %d",
> 							avalon4->drv->name, avalon4->device_id, i, info->set_voltage[i]);
> 				}
> 				if (!info->adjflag[i][0] && hwp < AVA4_DH_DEC && (info->set_voltage[i] > info->set_voltage[0] - (4 * 125))) {
> 					info->set_voltage[i] -= 125;
> 					for (j = 0; j < info->miner_count[i]; j++) {
> 						info->set_voltage_i[i][j] -= 125;
> 					}
> 
> 					applog(LOG_NOTICE, "%s-%d: Automatic decrease module[%d] voltage to %d",
> 							avalon4->drv->name, avalon4->device_id, i, info->set_voltage[i]);
> 				}
> 			} else {
> 				for (j = 0; j < info->miner_count[i]; j++) {
> 					a = 0;
> 					b = 0;
> 
> 					for (k = 0; k < AVA4_DEFAULT_ADJ_TIMES; k++) {
> 						a += info->lw5_i[i][j][k];
> 						b += info->hw5_i[i][j][k];
> 					}
> 
> 					hwp = a ? (double)b / (double)a : 0;
> 					if (hwp > AVA4_DH_INC && (info->set_voltage_i[i][j] < info->set_voltage[0] + (2 * 125))) {
> 						//FIX ME: How to deal with set_voltage ?
> 						info->set_voltage_i[i][j] += 125;
> 						info->adjflag[i][j] = 1;
> 						applog(LOG_NOTICE, "%s-%d: Automatic increase module[%d-%d] voltage to %d",
> 							avalon4->drv->name, avalon4->device_id, i, j, info->set_voltage_i[i][j]);
> 
> 					}
> 					if (!info->adjflag[i][j] && hwp < AVA4_DH_DEC && (info->set_voltage_i[i][j] > info->set_voltage[0] - (12 * 125))) {
> 						//FIX ME: How to deal with set_voltage ?
> 						info->set_voltage_i[i][j] -= 125;
> 						applog(LOG_NOTICE, "%s-%d: Automatic decrease module[%d-%d] voltage to %d",
> 								avalon4->drv->name, avalon4->device_id, i, j, info->set_voltage_i[i][j]);
> 					}
> 				}
1274a2223,2241
> 			/* Save config when run 10m */
> 			cgtime(&current);
> 			device_tdiff = tdiff(&current, &(info->elapsed[i]));
> 			if (device_tdiff >= 600.0) {
> 				if (!info->saved[i]) {
> 					applog(LOG_NOTICE, "%s-%d-%d: Avalon4 saved voltage !",
> 						avalon4->drv->name, avalon4->device_id, i);
> 					avalon4_adjust_vf(avalon4, i, 1);
> 					info->saved[i] = 1;
> 				} else
> 					avalon4_adjust_vf(avalon4, i, 0);
> 
> 			} else
> 				avalon4_adjust_vf(avalon4, i, 0);
> 
> 			if (((int)device_tdiff % 3600) >= 0 || ((int)device_tdiff % 3600) < 3) {
> 				for (j = 0; j < info->miner_count[i]; j++)
> 					info->adjflag[i][j] = 0;
> 			}
1278,1280c2245,2274
< 	for (i = 1; i < AVA4_DEFAULT_MODULARS; i++) {
< 		if (info->set_voltage[i] != info->set_voltage[0])
< 			break;
---
> 	/* Step 4: Adjust frequency */
> 	cgtime(&current);
> 	device_tdiff = tdiff(&current, &(info->last_tcheck));
> 	if (device_tdiff > 3.0 || device_tdiff < 0) {
> 		copy_time(&info->last_tcheck, &current);
> 		for (i = 1; i < AVA4_DEFAULT_MODULARS; i++) {
> 			if (!info->enable[i])
> 				continue;
> 
> 			if (info->mod_type[i] == AVA4_TYPE_MM60) {
> 				max_temp = get_temp_max(info, i);
> 				if (info->freq_mode[i] != AVA4_FREQ_TEMPADJ_MODE) {
> 					if (max_temp >= opt_avalon4_freqadj_temp) {
> 						info->last_maxtemp[i] = max_temp;
> 						cg_wlock(&info->update_lock);
> 						avalon4_freq_dec(avalon4, i, info->set_smart_frequency[i], opt_avalon4_delta_freq + 50);
> 						avalon4_set_freq(avalon4, i, 0, 0, info->set_smart_frequency[i]);
> 						applog(LOG_DEBUG, "%s-%d-%d: set freq after temp check (%d-%d-%d)",
> 								avalon4->drv->name, avalon4->device_id, i,
> 								info->set_smart_frequency[i][0],
> 								info->set_smart_frequency[i][1],
> 								info->set_smart_frequency[i][2]);
> 						info->freq_mode[i] = AVA4_FREQ_TEMPADJ_MODE;
> 						/* Update time for frequency adjustment */
> 						copy_time(&info->last_fadj, &current);
> 						cg_wunlock(&info->update_lock);
> 					}
> 				}
> 			}
> 		}
1283,1286c2277,2282
< 	if (i < AVA4_DEFAULT_MODULARS)
< 		info->set_voltage_broadcat = 0;
< 	else
< 		info->set_voltage_broadcat = 1;
---
> 	device_tdiff = tdiff(&current, &(info->last_fadj));
> 	if (device_tdiff > opt_avalon4_freqadj_time || device_tdiff < 0) {
> 		copy_time(&info->last_fadj, &current);
> 		for (i = 1; i < AVA4_DEFAULT_MODULARS; i++) {
> 			if (!info->enable[i])
> 				continue;
1287a2284,2366
> 			if (info->mod_type[i] == AVA4_TYPE_MM60) {
> 				switch (info->freq_mode[i]) {
> 					case AVA4_FREQ_TEMPADJ_MODE:
> 						if (info->cutoff[i])
> 							break;
> 
> 						max_temp = get_temp_max(info, i);
> 						if (max_temp <= info->temp_target[i]) {
> 							applog(LOG_DEBUG, "AVA4_FREQ_TEMPADJ_MODE -> AVA4_FREQ_INIT_MODE");
> 							break;
> 						}
> 						/* if max_temp goes down ,then we don't need adjust frequency */
> 						if (info->last_maxtemp[i] > max_temp) {
> 							applog(LOG_DEBUG, "AVA4_FREQ_TEMPADJ_MODE temp goes down");
> 							info->last_maxtemp[i] = get_temp_max(info, i);
> 							break;
> 						}
> 
> 						info->last_maxtemp[i] = get_temp_max(info, i);
> 						cg_wlock(&info->update_lock);
> 						avalon4_freq_dec(avalon4, i, info->set_smart_frequency[i], opt_avalon4_delta_freq);
> 						avalon4_set_freq(avalon4, i, 0, 0, info->set_smart_frequency[i]);
> 						applog(LOG_DEBUG, "%s-%d-%d: update freq (%d-%d-%d) AVA4_FREQ_PLLADJ_MODE",
> 								avalon4->drv->name, avalon4->device_id, i,
> 								info->set_smart_frequency[i][0],
> 								info->set_smart_frequency[i][1],
> 								info->set_smart_frequency[i][2]);
> 						cg_wunlock(&info->update_lock);
> 						break;
> 					case AVA4_FREQ_PLLADJ_MODE:
> 						/* AVA4_DEFAULT_SMARTSPEED_MODE1: auto speed by A3218 chips */
> 						cgtime(&current);
> 						if (opt_avalon4_smart_speed == AVA4_DEFAULT_SMARTSPEED_MODE2) {
> 							device_tdiff = tdiff(&current, &(info->last_fdec[i]));
> 							if ((device_tdiff >= AVA4_DEFAULT_FDEC_TIME) ||
> 									(device_tdiff < 0)) {
> 								copy_time(&info->last_fdec[i], &current);
> 								if ((opt_avalon4_least_pll_check && (info->pll_sel[i][0] >= opt_avalon4_least_pll_check)) ||
> 										(opt_avalon4_most_pll_check && (info->pll_sel[i][AVA4_DEFAULT_PLL_MAX - 1] <= opt_avalon4_most_pll_check)))
> 									avalon4_freq_dec(avalon4, i, info->set_smart_frequency[i], 25);
> 							}
> 
> 							device_tdiff = tdiff(&current, &(info->last_finc[i]));
> 							if ((device_tdiff >= AVA4_DEFAULT_FINC_TIME) ||
> 									(device_tdiff < 0)) {
> 								copy_time(&info->last_finc[i], &current);
> 								if ((opt_avalon4_least_pll_check && (info->pll_sel[i][0] < opt_avalon4_least_pll_check)) ||
> 										(opt_avalon4_most_pll_check && (info->pll_sel[i][AVA4_DEFAULT_PLL_MAX - 1] > opt_avalon4_most_pll_check)))
> 									avalon4_freq_inc(avalon4, i, info->set_smart_frequency[i], 25);
> 							}
> 						}
> 
> 						if (opt_avalon4_smart_speed == AVA4_DEFAULT_SMARTSPEED_MODE3) {
> 							device_tdiff = tdiff(&current, &(info->last_favg[i]));
> 							if ((device_tdiff >= AVA4_DEFAULT_FAVG_TIME) ||
> 									(device_tdiff < 0)) {
> 								copy_time(&info->last_favg[i], &current);
> 								tmp = (info->get_frequency[i] / 96);
> 								tmp = (uint32_t)ceil(tmp / 25.0) * 25 + 25;
> 								if (tmp < AVA4_DEFAULT_FREQUENCY_MIN)
> 									tmp = AVA4_DEFAULT_FREQUENCY_MIN;
> 								if (tmp > AVA4_MM60_FREQUENCY_MAX)
> 									tmp = AVA4_MM60_FREQUENCY_MAX;
> 								info->set_smart_frequency[i][0] = info->set_smart_frequency[i][1] = info->set_smart_frequency[i][2] = tmp;
> 							}
> 						}
> 						cg_wlock(&info->update_lock);
> 						avalon4_set_freq(avalon4, i, 0, 0, info->set_smart_frequency[i]);
> 						applog(LOG_DEBUG, "%s-%d-%d: update freq (%d-%d-%d) AVA4_FREQ_PLLADJ_MODE",
> 								avalon4->drv->name, avalon4->device_id, i,
> 								info->set_smart_frequency[i][0],
> 								info->set_smart_frequency[i][1],
> 								info->set_smart_frequency[i][2]);
> 						cg_wunlock(&info->update_lock);
> 						break;
> 					default:
> 						break;
> 				}
> 			}
> 		}
> 	}
> 
> 	/* Step 5: Calculate mm count and hash */
1290,1292c2369,2387
< 		h += info->enable[i] ? (info->local_work[i] - info->hw_work[i]) : 0;
< 		info->local_work[i] = 0;
< 		info->hw_work[i] = 0;
---
> 		if (info->enable[i]) {
> 			count++;
> 			if (info->local_work[i] > info->hw_work[i]) {
> 				if (info->mod_type[i] == AVA4_TYPE_MM60) {
> 					h += avalon4->diff1 - info->newnonce;
> 					info->newnonce = avalon4->diff1;
> 				} else {
> 					h += (info->local_work[i] - info->hw_work[i]);
> 					info->local_work[i] = 0;
> 					info->hw_work[i] = 0;
> 				}
> 			}
> 		}
> 	}
> 	info->mm_count = count;
> 
> 	if (h && !info->firsthash.tv_sec) {
> 		cgtime(&info->firsthash);
> 		copy_time(&(avalon4->dev_start_tv), &(info->firsthash));
1293a2389
> 
1297c2393
< #define STATBUFLEN 512
---
> #define STATBUFLEN (6 * 1024)
1302,1303c2398,2399
< 	int i, j;
< 	uint32_t a,b ;
---
> 	int i, j, k;
> 	uint32_t a, b, lw5_i[AVA4_DEFAULT_MINER_MAX], hw5_i[AVA4_DEFAULT_MINER_MAX];
1307a2404
> 	bool has_a6 = false;
1312c2409
< 		if(info->mod_type[i] == AVA4_TYPE_NULL)
---
> 		if (info->mod_type[i] == AVA4_TYPE_NULL)
1313a2411,2414
> 
> 		if (info->mod_type[i] == AVA4_TYPE_MM60)
> 			has_a6 = true;
> 
1317d2417
< 
1319c2419
< 		if(info->mod_type[i] == AVA4_TYPE_NULL)
---
> 		if (info->mod_type[i] == AVA4_TYPE_NULL)
1320a2421
> 
1332d2432
< 
1342,1343d2441
< 
< #if 0
1344a2443,2444
> 		uint8_t show = 0;
> 
1347a2448,2461
> 		if (info->mod_type[i] == AVA4_TYPE_MM60)
> 			show = 1;
> 
> 		if (info->mod_type[i] == AVA4_TYPE_MM50)
> 			show = 1;
> 
> 		if ((info->mod_type[i] == AVA4_TYPE_MM41) && mm_cmp_1501(info, i))
> 			show = 1;
> 
> 		if ((info->mod_type[i] == AVA4_TYPE_MM40) && mm_cmp_1501(info, i)) {
> 			if (!mm_cmp_d17f4a(info, i))
> 				show = 1;
> 		}
> 
1349,1350c2463,2468
< 		for (j = 0; j < AVA4_DEFAULT_MINERS; j++) {
< 			sprintf(buf, "%d ", info->matching_work[i][j]);
---
> 		for (j = 0; j < info->miner_count[i]; j++) {
> 			if (show)
> 				sprintf(buf, "%"PRIu64" ", info->local_works_i[i][j]);
> 			else
> 				sprintf(buf, "%d ", info->matching_work[i][j]);
> 
1355,1356d2472
< #endif
< 
1358c2474
< 		if(info->mod_type[i] == AVA4_TYPE_NULL)
---
> 		if (info->mod_type[i] == AVA4_TYPE_NULL)
1359a2476
> 
1364c2481,2483
< 		if(info->mod_type[i] == AVA4_TYPE_NULL)
---
> 		uint8_t show = 0;
> 
> 		if (info->mod_type[i] == AVA4_TYPE_NULL)
1365a2485,2512
> 
> 		if (info->mod_type[i] == AVA4_TYPE_MM60)
> 			show = 1;
> 
> 		if (info->mod_type[i] == AVA4_TYPE_MM50)
> 			show = 1;
> 
> 		if ((info->mod_type[i] == AVA4_TYPE_MM41) && mm_cmp_1501(info, i))
> 			show = 1;
> 
> 		if ((info->mod_type[i] == AVA4_TYPE_MM40) && mm_cmp_1501(info, i)) {
> 			if (!mm_cmp_d17f4a(info, i))
> 				show = 1;
> 		}
> 
> 		if (show) {
> 			strcat(statbuf[i], " MH[");
> 			for (j = 0; j < info->miner_count[i]; j++) {
> 				sprintf(buf, "%"PRIu64" ", info->hw_works_i[i][j]);
> 				strcat(statbuf[i], buf);
> 			}
> 			statbuf[i][strlen(statbuf[i]) - 1] = ']';
> 		}
> 	}
> 	for (i = 1; i < AVA4_DEFAULT_MODULARS; i++) {
> 		if (info->mod_type[i] == AVA4_TYPE_NULL)
> 			continue;
> 
1370c2517
< 		if(info->mod_type[i] == AVA4_TYPE_NULL)
---
> 		if (info->mod_type[i] == AVA4_TYPE_NULL)
1371a2519
> 
1380c2528,2530
< 		if(info->mod_type[i] == AVA4_TYPE_NULL)
---
> 		uint8_t show = 0;
> 
> 		if (info->mod_type[i] == AVA4_TYPE_NULL)
1385c2535,2538
< 		for (j = 0; j < 6; j++) {
---
> 		memset(lw5_i, 0, info->miner_count[i] * sizeof(uint32_t));
> 		memset(hw5_i, 0, info->miner_count[i] * sizeof(uint32_t));
> 
> 		for (j = 0; j < AVA4_DEFAULT_ADJ_TIMES; j++) {
1387a2541,2545
> 
> 			for (k = 0; k < info->miner_count[i]; k++) {
> 				lw5_i[k] += info->lw5_i[i][k][j];
> 				hw5_i[k] += info->hw5_i[i][k][j];
> 			}
1391c2549
< 		diff = tdiff(&current, &(info->last_1m)) + 300.0;
---
> 		diff = tdiff(&current, &(info->last_5s)) + 25.0;
1394a2553,2563
> 		if (info->mod_type[i] == AVA4_TYPE_MM50)
> 			show = 1;
> 
> 		if ((info->mod_type[i] == AVA4_TYPE_MM41) && mm_cmp_1501(info, i))
> 			show = 1;
> 
> 		if ((info->mod_type[i] == AVA4_TYPE_MM40) && mm_cmp_1501(info, i)) {
> 			if (!mm_cmp_d17f4a(info, i))
> 				show = 1;
> 		}
> 
1396a2566,2575
> 
> 		if (opt_debug && show) {
> 			strcat(statbuf[i], " MDH5m[");
> 			for (k = 0; k < info->miner_count[i]; k++) {
> 				hwp = lw5_i[k] ? (double)hw5_i[k] / (double)lw5_i[k] * 100 : 0;
> 				sprintf(buf, "%.3f%% ", hwp);
> 				strcat(statbuf[i], buf);
> 			}
> 			statbuf[i][strlen(statbuf[i]) - 1] = ']';
> 		}
1399c2578
< 		if(info->mod_type[i] == AVA4_TYPE_NULL)
---
> 		if (info->mod_type[i] == AVA4_TYPE_NULL)
1401c2580,2588
< 		sprintf(buf, " Temp[%d]", info->temp[i]);
---
> 
> 		if (info->mod_type[i] == AVA4_TYPE_MM60) {
> 			sprintf(buf, " Temp[%d] Temp0[%d] Temp1[%d]",
> 					info->temp[i],
> 					(int)convert_temp(info->adc[i][0]),
> 					(int)convert_temp(info->adc[i][1]));
> 		} else
> 			sprintf(buf, " Temp[%d]", info->temp[i]);
> 
1405c2592
< 		if(info->mod_type[i] == AVA4_TYPE_NULL)
---
> 		if (info->mod_type[i] == AVA4_TYPE_NULL)
1406a2594
> 
1411c2599
< 		if(info->mod_type[i] == AVA4_TYPE_NULL)
---
> 		if (info->mod_type[i] == AVA4_TYPE_NULL)
1413c2601,2604
< 		sprintf(buf, " Vol[%.4f]", (float)info->get_voltage[i] / 10000);
---
> 		if (info->mod_type[i] == AVA4_TYPE_MM60)
> 			sprintf(buf, " Vol[%.1f]", convert_voltage(info->adc[i][4], 1 / 11.0));
> 		else
> 			sprintf(buf, " Vol[%.4f]", (float)info->get_voltage[i] / 10000);
1417c2608,2611
< 		if(info->mod_type[i] == AVA4_TYPE_NULL)
---
> 		uint8_t show = 0;
> 		int32_t vref = 0;
> 
> 		if (info->mod_type[i] == AVA4_TYPE_NULL)
1419c2613,2647
< 		sprintf(buf, " Freq[%.2f]", (float)info->get_frequency[i] / 1000);
---
> 
> 		if (info->mod_type[i] == AVA4_TYPE_MM50)
> 			show = 1;
> 
> 		if ((info->mod_type[i] == AVA4_TYPE_MM41) && mm_cmp_1501(info, i))
> 			show = 1;
> 
> 		if ((info->mod_type[i] == AVA4_TYPE_MM40) && mm_cmp_1501(info, i)) {
> 			if (!mm_cmp_d17f4a(info, i))
> 				show = 1;
> 		}
> 
> 		if (opt_debug && show) {
> 			strcat(statbuf[i], " MVol[");
> 			for (j = 0; j < info->miner_count[i]; j++) {
> 				sprintf(buf, "%.4f ", (float)info->set_voltage_i[i][j] / 10000);
> 				vref += ((info->set_voltage_i[i][j] - opt_avalon4_voltage_min) / 125);
> 				strcat(statbuf[i], buf);
> 			}
> 			statbuf[i][strlen(statbuf[i]) - 1] = ']';
> 
> 			strcat(statbuf[i], " VREF[");
> 			sprintf(buf, "%d ", vref);
> 			strcat(statbuf[i], buf);
> 			statbuf[i][strlen(statbuf[i]) - 1] = ']';
> 		}
> 	}
> 	for (i = 1; i < AVA4_DEFAULT_MODULARS; i++) {
> 		if (info->mod_type[i] == AVA4_TYPE_NULL)
> 			continue;
> 
> 		if (info->mod_type[i] == AVA4_TYPE_MM60)
> 			sprintf(buf, " GHSmm[%.2f] Freq[%.2f]", (float)info->get_frequency[i] / 1000 * info->total_asics[i], (float)info->get_frequency[i] / 1000);
> 		else
> 			sprintf(buf, " Freq[%.2f]", (float)info->get_frequency[i] / 1000);
1421a2650,2670
> 	if (opt_debug) {
> 		for (i = 1; i < AVA4_DEFAULT_MODULARS; i++) {
> 			if (info->mod_type[i] == AVA4_TYPE_NULL)
> 				continue;
> 
> 			if (info->mod_type[i] == AVA4_TYPE_MM50) {
> 				for (j = 0; j < info->miner_count[i]; j++) {
> 					sprintf(buf, " MFreq%d[", j);
> 					strcat(statbuf[i], buf);
> 					for (k = 0; k < info->asic_count[i]; k++) {
> 						sprintf(buf, "%d %d %d ",
> 								info->set_frequency_i[i][j][k][0],
> 								info->set_frequency_i[i][j][k][1],
> 								info->set_frequency_i[i][j][k][2]);
> 						strcat(statbuf[i], buf);
> 					}
> 					statbuf[i][strlen(statbuf[i]) - 1] = ']';
> 				}
> 			}
> 		}
> 	}
1423c2672
< 		if(info->mod_type[i] == AVA4_TYPE_NULL)
---
> 		if (info->mod_type[i] == AVA4_TYPE_NULL)
1424a2674
> 
1429c2679
< 		if(info->mod_type[i] == AVA4_TYPE_NULL)
---
> 		if (info->mod_type[i] == AVA4_TYPE_NULL)
1430a2681
> 
1433a2685,2696
> 	for (i = 1; i < AVA4_DEFAULT_MODULARS; i++) {
> 		if (info->mod_type[i] == AVA4_TYPE_NULL)
> 			continue;
> 
> 		if (info->mod_type[i] == AVA4_TYPE_MM50 || info->mod_type[i] == AVA4_TYPE_MM60) {
> 			for (j = 0; j < info->miner_count[i]; j++) {
> 				sprintf(buf, " MW%d[", j);
> 				strcat(statbuf[i], buf);
> 				for (k = 0; k < info->asic_count[i]; k++) {
> 					sprintf(buf, "%d ", info->chipmatching_work[i][j][k]);
> 					strcat(statbuf[i], buf);
> 				}
1434a2698,2701
> 				statbuf[i][strlen(statbuf[i]) - 1] = ']';
> 			}
> 		}
> 	}
1436c2703
< 		if(info->mod_type[i] == AVA4_TYPE_NULL)
---
> 		if (info->mod_type[i] == AVA4_TYPE_NULL)
1437a2705,2780
> 
> 		if (info->mod_type[i] == AVA4_TYPE_MM50) {
> 			for (j = 0; j < info->miner_count[i]; j++) {
> 				sprintf(buf, " MA%d[", j);
> 				strcat(statbuf[i], buf);
> 				for (k = 0; k < info->asic_count[i]; k++) {
> 					sprintf(buf, "%d ", info->ma_sum[i][j][k]);
> 					strcat(statbuf[i], buf);
> 				}
> 
> 				statbuf[i][strlen(statbuf[i]) - 1] = ']';
> 			}
> 		}
> 	}
> 	if (opt_debug) {
> 		for (i = 1; i < AVA4_DEFAULT_MODULARS; i++) {
> 			if (info->mod_type[i] == AVA4_TYPE_NULL)
> 				continue;
> 
> 			if (info->mod_type[i] == AVA4_TYPE_MM60) {
> 				sprintf(buf, " PLL[");
> 				strcat(statbuf[i], buf);
> 				for (j = 0; j < AVA4_DEFAULT_PLL_MAX; j++) {
> 					sprintf(buf, "%d ", info->pll_sel[i][j]);
> 					strcat(statbuf[i], buf);
> 				}
> 				statbuf[i][strlen(statbuf[i]) - 1] = ']';
> 			}
> 		}
> 	}
> 	for (i = 1; i < AVA4_DEFAULT_MODULARS; i++) {
> 		if (info->mod_type[i] == AVA4_TYPE_NULL)
> 			continue;
> 
> 		if (info->mod_type[i] == AVA4_TYPE_MM60) {
> 			sprintf(buf, " TA[%d]", info->total_asics[i]);
> 			strcat(statbuf[i], buf);
> 		}
> 	}
> 	for (i = 1; i < AVA4_DEFAULT_MODULARS; i++) {
> 		if (info->mod_type[i] == AVA4_TYPE_NULL)
> 			continue;
> 
> 		if (info->mod_type[i] == AVA4_TYPE_MM60) {
> 			sprintf(buf, " EC[%d]", info->error_code[i]);
> 			strcat(statbuf[i], buf);
> 		}
> 	}
> 	if (opt_debug) {
> 		for (i = 1; i < AVA4_DEFAULT_MODULARS; i++) {
> 			if (info->mod_type[i] == AVA4_TYPE_NULL)
> 				continue;
> 
> 			if (info->mod_type[i] == AVA4_TYPE_MM60) {
> 				sprintf(buf, " SF[%d %d %d]",
> 					info->set_smart_frequency[i][0],
> 					info->set_smart_frequency[i][1],
> 					info->set_smart_frequency[i][2]);
> 				strcat(statbuf[i], buf);
> 			}
> 		}
> 
> 		for (i = 1; i < AVA4_DEFAULT_MODULARS; i++) {
> 			if (info->mod_type[i] == AVA4_TYPE_NULL)
> 				continue;
> 
> 			if (info->mod_type[i] == AVA4_TYPE_MM60) {
> 				sprintf(buf, " FM[%d]", info->freq_mode[i]);
> 				strcat(statbuf[i], buf);
> 			}
> 		}
> 	}
> 	for (i = 1; i < AVA4_DEFAULT_MODULARS; i++) {
> 		if (info->mod_type[i] == AVA4_TYPE_NULL)
> 			continue;
> 
1443,1447c2786,2799
< 	root = api_add_bool(root, "Automatic Voltage", &opt_avalon4_autov, true);
< 	root = api_add_string(root, "AUC VER", info->auc_version, false);
< 	root = api_add_int(root, "AUC I2C Speed", &(info->auc_speed), true);
< 	root = api_add_int(root, "AUC I2C XDelay", &(info->auc_xdelay), true);
< 	root = api_add_int(root, "AUC ADC", &(info->auc_temp), true);
---
> 	if (!has_a6)
> 		root = api_add_bool(root, "Automatic Voltage", &opt_avalon4_autov, true);
> 	root = api_add_int(root, "Smart Speed", &opt_avalon4_smart_speed, true);
> 	root = api_add_bool(root, "Nonce check", &opt_avalon4_noncecheck, true);
> 	if (info->connecter == AVA4_CONNECTER_IIC)
> 		root = api_add_string(root, "Connecter", "IIC", true);
> 
> 	if (info->connecter == AVA4_CONNECTER_AUC) {
> 		root = api_add_string(root, "Connecter", "AUC", true);
> 		root = api_add_string(root, "AUC VER", info->auc_version, false);
> 		root = api_add_int(root, "AUC I2C Speed", &(info->auc_speed), true);
> 		root = api_add_int(root, "AUC I2C XDelay", &(info->auc_xdelay), true);
> 		root = api_add_int(root, "AUC ADC", &(info->auc_temp), true);
> 	}
1451a2804,2893
> /* format: freq[-addr[-miner[-chip]]] add4[0, 63], miner[1, miner_count], chip[1, asic_count] */
> char *set_avalon4_device_freq(struct cgpu_info *avalon4, char *arg)
> {
> 	struct avalon4_info *info = avalon4->device_data;
> 	char *colon1, *colon2, *param = arg;
> 	unsigned int val[3], addr = 0, i;
> 	uint32_t miner_id = 0, chip_id = 0;
> 
> 	if (!(*arg))
> 		return NULL;
> 
> 	colon1 = strchr(arg, ':');
> 	if (colon1) {
> 		*(colon1++) = '\0';
> 		param = colon1;
> 	}
> 
> 	if (*arg) {
> 		val[0] = atoi(arg);
> 		if (val[0] < AVA4_DEFAULT_FREQUENCY_MIN || val[0] > AVA4_DEFAULT_FREQUENCY_MAX)
> 			return "Invalid value1 passed to set_avalon4_device_freq";
> 	}
> 
> 	if (colon1 && *colon1) {
> 		colon2 = strchr(colon1, ':');
> 		if (colon2) {
> 			*(colon2++) = '\0';
> 			param = colon2;
> 		}
> 
> 		if (*colon1) {
> 			val[1] = atoi(colon1);
> 			if (val[1] < AVA4_DEFAULT_FREQUENCY_MIN || val[1] > AVA4_DEFAULT_FREQUENCY_MAX)
> 				return "Invalid value2 passed to set_avalon4_device_freq";
> 		}
> 
> 		if (colon2 && *colon2) {
> 			val[2] = atoi(colon2);
> 			if (val[2] < AVA4_DEFAULT_FREQUENCY_MIN || val[2] > AVA4_DEFAULT_FREQUENCY_MAX)
> 				return "Invalid value3 passed to set_avalon4_device_freq";
> 		}
> 	}
> 
> 	if (!val[0])
> 		val[2] = val[1] = val[0] = AVA4_DEFAULT_FREQUENCY;
> 
> 	if (!val[1])
> 		val[2] = val[1] = val[0];
> 
> 	if (!val[2])
> 		val[2] = val[1];
> 
> 	colon1 = strchr(param, '-');
> 	if (colon1) {
> 		sscanf(colon1, "-%d-%d-%d", &addr, &miner_id, &chip_id);
> 		if (miner_id >= AVA4_DEFAULT_MODULARS) {
> 			applog(LOG_ERR, "invalid dev index: %d, valid range 0-%d", addr, (AVA4_DEFAULT_MODULARS - 1));
> 			return "Invalid dev index to set_avalon4_device_freq";
> 		}
> 		if (!info->enable[addr]) {
> 			applog(LOG_ERR, "Disabled dev:%d", addr);
> 			return "Disabled dev to set_avalon4_device_freq";
> 		}
> 		if (miner_id > info->miner_count[addr]) {
> 			applog(LOG_ERR, "invalid miner index: %d, valid range 0-%d", chip_id, info->miner_count[addr]);
> 			return "Invalid miner index to set_avalon4_device_freq";
> 		}
> 		if (chip_id > info->asic_count[addr]) {
> 			applog(LOG_ERR, "invalid asic index: %d, valid range 0-%d", chip_id, info->asic_count[addr]);
> 			return "Invalid asic index to set_avalon4_device_freq";
> 		}
> 	}
> 
> 	if (!miner_id || !chip_id) {
> 		memcpy(opt_avalon4_freq, val, sizeof(int) * 3);
> 		if (!addr) {
> 			for (i = 1; i < AVA4_DEFAULT_MODULARS; i++) {
> 				if (!info->enable[i])
> 					continue;
> 
> 				avalon4_set_freq(avalon4, i, 0, 0, val);
> 			}
> 		} else
> 			avalon4_set_freq(avalon4, addr, 0, 0, val);
> 	} else
> 		avalon4_set_freq(avalon4, addr, miner_id, chip_id, val);
> 
> 	return NULL;
> }
> 
1454c2896
< 	int val, i;
---
> 	int val, i, j;
1458c2900
< 		sprintf(replybuf, "led|fan|voltage|frequency|pdelay");
---
> 		sprintf(replybuf, "led|fan|voltage|frequency|pdelay|freezesafe");
1461a2904,2919
> 	if (strcasecmp(option, "freezesafe") == 0) {
> 		if (!setting || !*setting) {
> 			sprintf(replybuf, "missing freezesafe mode setting");
> 			return replybuf;
> 		}
> 
> 		val = atoi(setting);
> 
> 		opt_avalon4_freezesafe = val ? 1 : 0;
> 
> 		applog(LOG_NOTICE, "%s-%d: update freezesafe mode: %d",
> 			avalon4->drv->name, avalon4->device_id, opt_avalon4_freezesafe);
> 
> 		return NULL;
> 	}
> 
1476c2934
< 		applog(LOG_NOTICE, "%s %d: Update polling delay to: %d",
---
> 		applog(LOG_NOTICE, "%s-%d: Update polling delay to: %d",
1493c2951
< 		applog(LOG_NOTICE, "%s %d: Update fan to %d-%d",
---
> 		applog(LOG_NOTICE, "%s-%d: Update fan to %d-%d",
1506c2964
< 		if (set_avalon4_freq(setting)) {
---
> 		if (set_avalon4_device_freq(avalon4, setting)) {
1512c2970
< 		applog(LOG_NOTICE, "%s %d: Update frequency to %d",
---
> 		applog(LOG_NOTICE, "%s-%d: Update frequency to %d",
1519a2978,2979
> 		int val_led = -1;
> 
1525c2985
< 		val = atoi(setting);
---
> 		sscanf(setting, "%d-%d", &val, &val_led);
1536c2996,3002
< 		info->led_red[val] = !info->led_red[val];
---
> 		if (val_led == -1)
> 			info->led_red[val] = !info->led_red[val];
> 		else {
> 			if (val_led < 0 || val_led > 1) {
> 				sprintf(replybuf, "invalid LED status: %d, valid value 0|1", val_led);
> 				return replybuf;
> 			}
1538,1540c3004,3010
< 		applog(LOG_NOTICE, "%s %d: Module:%d, LED: %s",
< 		       avalon4->drv->name, avalon4->device_id,
< 		       val, info->led_red[val] ? "on" : "off");
---
> 			if (val_led != info->led_red[val])
> 				info->led_red[val] = val_led;
> 		}
> 
> 		applog(LOG_NOTICE, "%s-%d: Module:%d, LED: %s",
> 				avalon4->drv->name, avalon4->device_id,
> 				val, info->led_red[val] ? "on" : "off");
1546c3016
< 		int val_mod, val_volt, ret;
---
> 		int val_mod, val_volt, val_ch = -1, val_offset = -1;
1553,1558c3023
< 		ret = sscanf(setting, "%d-%d", &val_mod, &val_volt);
< 		if (ret != 2) {
< 			sprintf(replybuf, "invalid voltage parameter, format: moduleid-voltage");
< 			return replybuf;
< 		}
< 
---
> 		sscanf(setting, "%d-%d-%d-%d", &val_mod, &val_volt, &val_ch, &val_offset);
1566a3032,3045
> 		if ((val_ch != -1) && (val_ch < -1 || val_ch >= AVA4_DEFAULT_MINER_MAX)) {
> 			sprintf(replybuf, "invalid miner_id,  valid miner_id range %d-%d",
> 				0, AVA4_DEFAULT_MINER_MAX - 1);
> 			return replybuf;
> 		}
> 
> 		if ((val_offset != -1) && ((val_volt + val_offset) < AVA4_DEFAULT_VOLTAGE_MIN ||
> 					((val_volt + val_offset) > AVA4_DEFAULT_VOLTAGE_MAX))) {
> 			sprintf(replybuf, "invalid val_offset,  valid val_offset range %d-%d",
> 					AVA4_DEFAULT_VOLTAGE_MIN - val_volt,
> 					AVA4_DEFAULT_VOLTAGE_MAX - val_volt);
> 			return replybuf;
> 		}
> 
1572a3052,3063
> 		if (val_ch == -1) {
> 			for (i = 0; i < info->miner_count[val_mod]; i++) {
> 				info->set_voltage_i[val_mod][i] = val_volt;
> 				info->set_voltage_offset[val_mod][i] = 0;
> 			}
> 		} else {
> 			info->set_voltage_i[val_mod][val_ch] = val_volt;
> 			if (val_offset == -1)
> 				info->set_voltage_offset[val_mod][val_ch] = 0;
> 			else
> 				info->set_voltage_offset[val_mod][val_ch] = val_offset;
> 		}
1575c3066
< 			for (i = 1; i < AVA4_DEFAULT_MODULARS; i++)
---
> 			for (i = 1; i < AVA4_DEFAULT_MODULARS; i++) {
1577,1579c3068,3081
< 			info->set_voltage_broadcat = 1;
< 		} else
< 			info->set_voltage_broadcat = 0;
---
> 				if (val_ch == -1) {
> 					for (j = 0; j < info->miner_count[i]; j++) {
> 						info->set_voltage_i[i][j] = val_volt;
> 						info->set_voltage_offset[i][j] = 0;
> 					}
> 				} else {
> 					info->set_voltage_i[i][val_ch] = val_volt;
> 					if (val_offset == -1)
> 						info->set_voltage_offset[i][val_ch] = 0;
> 					else
> 						info->set_voltage_offset[i][val_ch] = val_offset;
> 				}
> 			}
> 		}
1581,1582c3083,3084
< 		applog(LOG_NOTICE, "%s %d: Update module[%d] voltage to %d",
< 		       avalon4->drv->name, avalon4->device_id, val_mod, val_volt);
---
> 		applog(LOG_NOTICE, "%s-%d: Update module[%d] voltage to %d, val_ch:%d, val_offset:%d",
> 		       avalon4->drv->name, avalon4->device_id, val_mod, val_volt, val_ch, val_offset);
1597c3099,3102
< 	int i, frequency;
---
> 	int i, j, tempadcmin = AVA4_ADC_MAX, vcc12adcmin = AVA4_ADC_MAX;
> 	int has_a6 = 0;
> 	uint32_t frequency = 0;
> 	float ghs_sum = 0.0;
1602a3108,3110
> 		if (info->mod_type[i] == AVA4_TYPE_MM60)
> 			has_a6 = 1;
> 
1611a3120,3140
> 
> 		for (j = 0; j < AVA4_DEFAULT_ADC_MAX - 2; j++) {
> 			if (info->adc[i][j] < tempadcmin)
> 				tempadcmin = info->adc[i][j];
> 		}
> 		if (info->adc[i][4] < vcc12adcmin)
> 			vcc12adcmin = info->adc[i][4];
> 		frequency += info->get_frequency[i];
> 		ghs_sum += ((float)info->get_frequency[i] / 1000 * info->total_asics[i]);
> 	}
> 
> 	if (has_a6) {
> 		if (info->mm_count)
> 			frequency /= info->mm_count;
> 		tailsprintf(buf, bufsiz, "%4dMhz %.2fGHS %2dC-%2dC %3d%% %.1fV", frequency / 96,
> 				ghs_sum, temp, (int)convert_temp(tempadcmin), fanmin,
> 				(vcc12adcmin == AVA4_ADC_MAX) ? 0 : convert_voltage(vcc12adcmin, 1 / 11.0));
> 	} else {
> 		frequency = (opt_avalon4_freq[0] * 4 + opt_avalon4_freq[1] * 4 + opt_avalon4_freq[2]) / 9;
> 		tailsprintf(buf, bufsiz, "%4dMhz %2dC %3d%% %.3fV", frequency,
> 				temp, fanmin, (float)voltsmax / 10000);
1613,1621d3141
< #if 0
< 	tailsprintf(buf, bufsiz, "%2dMMs %.4fV-%.4fV %4dMhz %2dC %3d%%-%3d%%",
< 		    info->mm_count, (float)voltsmin / 10000, (float)voltsmax / 10000,
< 		    (info->set_frequency[0] * 4 + info->set_frequency[1] * 4 + info->set_frequency[2]) / 9,
< 		    temp, fanmin, fanmax);
< #endif
< 	frequency = (info->set_frequency[0] * 4 + info->set_frequency[1] * 4 + info->set_frequency[2]) / 9;
< 	tailsprintf(buf, bufsiz, "%4dMhz %2dC %3d%% %.3fV", frequency,
< 		    temp, fanmin, (float)voltsmax / 10000);
1636a3157
> 	.max_diff = AVA4_DRV_DIFFMAX,
diff '--color=auto' cgminer-4.9.0/driver-avalon4.h cgminer-4.10.0/driver-avalon4.h
2c2
<  * Copyright 2013-2014 Con Kolivas <kernel@kolivas.org>
---
>  * Copyright 2013-2015 Con Kolivas <kernel@kolivas.org>
14a15
> #include "i2c-context.h"
18,19c19,20
< #define AVA4_DEFAULT_FAN_MIN	5 /* % */
< #define AVA4_DEFAULT_FAN_MAX	85
---
> #define AVA4_DEFAULT_FAN_MIN	10 /* % */
> #define AVA4_DEFAULT_FAN_MAX	100
21a23
> #define AVA4_FREEZESAFE_FAN	10
23,24c25,29
< #define AVA4_DEFAULT_TEMP_TARGET	42
< #define AVA4_DEFAULT_TEMP_OVERHEAT	65
---
> #define AVA4_DEFAULT_TEMP_TARGET	65
> #define AVA4_DEFAULT_TEMP_OVERHEAT	85
> #define AVA4_MM40_TEMP_TARGET	42
> #define AVA4_MM40_TEMP_OVERHEAT	65
> #define AVA4_MM60_TEMP_FREQADJ	70
27a33
> #define AVA4_FREEZESAFE_VOLTAGE		4000
30a37,38
> #define AVA4_FREEZESAFE_FREQUENCY	100
> #define AVA4_MM60_FREQUENCY_MAX	500
32,34c40,51
< #define AVA4_DEFAULT_MODULARS	64
< #define AVA4_DEFAULT_MINERS	10
< #define AVA4_DEFAULT_ASIC_COUNT	4
---
> #define AVA4_DEFAULT_MODULARS	7	/* Only support 6 modules maximum with one AUC */
> #define AVA4_DEFAULT_MINER_MAX	10
> #define AVA4_DEFAULT_ASIC_MAX	40
> #define AVA4_DEFAULT_ADC_MAX	6 /* RNTC1-4, VCC12, VCC3VC */
> #define AVA4_DEFAULT_PLL_MAX	7
> 
> #define AVA4_DEFAULT_MINER_CNT	10
> #define AVA4_DEFAULT_ASIC_CNT	4
> #define AVA4_MM50_MINER_CNT	2
> #define AVA4_MM50_ASIC_CNT	16
> #define AVA4_MM60_MINER_CNT	2
> #define AVA4_MM60_ASIC_CNT	40
39a57,70
> #define AVA4_DEFAULT_ADJ_TIMES	6
> #define AVA4_DEFAULT_NTCB	3450
> #define AVA4_DEFAULT_NCHECK	true
> #define AVA4_DEFAULT_SPEED_BINGO	255
> #define AVA4_DEFAULT_SPEED_ERROR	3
> 
> #define AVA4_DEFAULT_SMARTSPEED_OFF 0
> #define AVA4_DEFAULT_SMARTSPEED_MODE1 1
> #define AVA4_DEFAULT_SMARTSPEED_MODE2 2
> #define AVA4_DEFAULT_SMARTSPEED_MODE3 3
> #define AVA4_DEFAULT_SMART_SPEED	(AVA4_DEFAULT_SMARTSPEED_MODE3)
> 
> #define AVA4_DEFAULT_IIC_DETECT	false
> 
41c72
< #define AVA4_DH_DEC	0.001
---
> #define AVA4_DH_DEC	0.002
43c74,76
< #define AVA4_PWM_MAX		0x3FF
---
> #define AVA4_PWM_MAX	0x3FF
> #define AVA4_ADC_MAX	0x3FF
> #define AVA4_DRV_DIFFMAX	1024
47c80
< #define AVA4_AUC_XDELAY  	9600	/* 4800 = 1ms in AUC (11U14)  */
---
> #define AVA4_AUC_XDELAY  	19200	/* 4800 = 1ms in AUC (11U14)  */
49a83,89
> #define AVA4_MOD_CUSTOM 0x0
> #define AVA4_MOD_ECO    0x1
> #define AVA4_MOD_NORMAL 0x2
> #define AVA4_MOD_TURBO  0x3
> 
> #define AVA4_CONNECTER_AUC	1
> #define AVA4_CONNECTER_IIC	2
77a118,119
> #define AVA4_P_SET_VOLT 0x22
> #define AVA4_P_SET_FREQ 0x23
82a125,126
> #define AVA4_P_RSTMMTX	0x33
> #define AVA4_P_GET_VOLT 0x34
88a133,137
> #define AVA4_P_STATUS_LW        0x44
> #define AVA4_P_STATUS_HW        0x45
> #define AVA4_P_STATUS_VOLT	0x46
> #define AVA4_P_STATUS_MA	0x47
> #define AVA4_P_STATUS_M	0x48
94a144,145
> #define AVA4_MM50_PREFIXSTR	"50"
> #define AVA4_MM60_PREFIXSTR	"60"
98a150,151
> #define AVA4_TYPE_MM50		50
> #define AVA4_TYPE_MM60		60
106a160,177
> #define AVA4_FREQ_INIT_MODE	0x0
> #define AVA4_FREQ_CUTOFF_MODE	0x1
> #define AVA4_FREQ_TEMPADJ_MODE	0x2
> #define AVA4_FREQ_PLLADJ_MODE	0x3
> 
> /* pll check range [0, 7680], 0 means turn off check */
> #define AVA4_DEFAULT_LEAST_PLL	768
> #define AVA4_DEFAULT_MOST_PLL	256
> 
> /* seconds */
> #define AVA4_DEFAULT_FDEC_TIME	60.0
> #define AVA4_DEFAULT_FINC_TIME	1200.0
> #define AVA4_DEFAULT_FAVG_TIME	(15 * 60.0)
> #define AVA4_DEFAULT_FREQADJ_TIME	60
> 
> #define AVA4_DEFAULT_DELTA_T	0
> #define AVA4_DEFAULT_DELTA_FREQ	100
> 
138a210
> 	uint8_t connecter;
140c212,214
< 	int set_frequency[3];
---
> 	unsigned int set_frequency[AVA4_DEFAULT_MODULARS][3];
> 	unsigned int set_smart_frequency[AVA4_DEFAULT_MODULARS][3];
> 	int set_frequency_i[AVA4_DEFAULT_MODULARS][AVA4_DEFAULT_MINER_MAX][AVA4_DEFAULT_ASIC_MAX][3];
142c216,217
< 	int set_voltage_broadcat;
---
> 	uint16_t set_voltage_i[AVA4_DEFAULT_MODULARS][AVA4_DEFAULT_MINER_MAX];
> 	int8_t set_voltage_offset[AVA4_DEFAULT_MODULARS][AVA4_DEFAULT_MINER_MAX];
147a223
> 	struct timeval firsthash;
150a227
> 	int get_voltage_i[AVA4_DEFAULT_MODULARS][AVA4_DEFAULT_MINER_MAX];
152a230
> 	int error_code[AVA4_DEFAULT_MODULARS];
156a235,236
> 	uint16_t adc[AVA4_DEFAULT_MODULARS][AVA4_DEFAULT_ADC_MAX];
> 	uint16_t pll_sel[AVA4_DEFAULT_MODULARS][AVA4_DEFAULT_PLL_MAX];
158a239
> 	uint64_t local_works_i[AVA4_DEFAULT_MODULARS][AVA4_DEFAULT_MINER_MAX];
159a241
> 	uint64_t hw_works_i[AVA4_DEFAULT_MODULARS][AVA4_DEFAULT_MINER_MAX];
164,171c246,277
< 	uint32_t lw5[AVA4_DEFAULT_MODULARS][6];
< 	uint32_t hw5[AVA4_DEFAULT_MODULARS][6];
< 	int i_1m;
< 	struct timeval last_5m;
< 	struct timeval last_1m;
< 
< 	int matching_work[AVA4_DEFAULT_MODULARS][AVA4_DEFAULT_MINERS];
< 	int chipmatching_work[AVA4_DEFAULT_MODULARS][AVA4_DEFAULT_MINERS][4];
---
> 	uint32_t lw5[AVA4_DEFAULT_MODULARS][AVA4_DEFAULT_ADJ_TIMES];
> 	uint32_t lw5_i[AVA4_DEFAULT_MODULARS][AVA4_DEFAULT_MINER_MAX][AVA4_DEFAULT_ADJ_TIMES];
> 	uint32_t hw5[AVA4_DEFAULT_MODULARS][AVA4_DEFAULT_ADJ_TIMES];
> 	uint32_t hw5_i[AVA4_DEFAULT_MODULARS][AVA4_DEFAULT_MINER_MAX][AVA4_DEFAULT_ADJ_TIMES];
> 	int i_5s;
> 	struct timeval last_30s;
> 	struct timeval last_5s;
> 	struct timeval last_finc[AVA4_DEFAULT_MODULARS];
> 	struct timeval last_fdec[AVA4_DEFAULT_MODULARS];
> 	struct timeval last_favg[AVA4_DEFAULT_MODULARS];
> 	struct timeval last_fadj;
> 	struct timeval last_tcheck;
> 
> 	int matching_work[AVA4_DEFAULT_MODULARS][AVA4_DEFAULT_MINER_MAX];
> 	int chipmatching_work[AVA4_DEFAULT_MODULARS][AVA4_DEFAULT_MINER_MAX][AVA4_DEFAULT_ASIC_MAX];
> 	uint8_t saved[AVA4_DEFAULT_MODULARS];
> 	uint8_t adjflag[AVA4_DEFAULT_MODULARS][AVA4_DEFAULT_MINER_MAX];
> 	uint8_t cutoff[AVA4_DEFAULT_MODULARS];
> 	uint8_t miner_count[AVA4_DEFAULT_MODULARS];
> 	uint8_t asic_count[AVA4_DEFAULT_MODULARS];
> 	int ntime_offset[AVA4_DEFAULT_MODULARS];
> 	bool autov[AVA4_DEFAULT_MODULARS];
> 	uint8_t ma_sum[AVA4_DEFAULT_MODULARS][AVA4_DEFAULT_MINER_MAX][AVA4_DEFAULT_ASIC_MAX];
> 	uint32_t newnonce;
> 	uint32_t total_asics[AVA4_DEFAULT_MODULARS];
> 	int toverheat[AVA4_DEFAULT_MODULARS];
> 	int temp_target[AVA4_DEFAULT_MODULARS];
> 	uint8_t speed_bingo[AVA4_DEFAULT_MODULARS];
> 	uint8_t speed_error[AVA4_DEFAULT_MODULARS];
> 	uint32_t freq_mode[AVA4_DEFAULT_MODULARS];
> 	struct i2c_ctx *i2c_slaves[AVA4_DEFAULT_MODULARS];
> 	int last_maxtemp[AVA4_DEFAULT_MODULARS];
192a299
> extern bool opt_avalon4_freezesafe;
198a306,320
> extern int opt_avalon4_miningmode;
> extern int opt_avalon4_ntcb;
> extern int opt_avalon4_freq_min;
> extern int opt_avalon4_freq_max;
> extern bool opt_avalon4_noncecheck;
> extern int opt_avalon4_smart_speed;
> extern int opt_avalon4_speed_bingo;
> extern int opt_avalon4_speed_error;
> extern int opt_avalon4_least_pll_check;
> extern int opt_avalon4_most_pll_check;
> extern bool opt_avalon4_iic_detect;
> extern int opt_avalon4_freqadj_time;
> extern int opt_avalon4_delta_temp;
> extern int opt_avalon4_delta_freq;
> extern int opt_avalon4_freqadj_temp;
Only in cgminer-4.10.0: driver-avalon7.c
Only in cgminer-4.10.0: driver-avalon7.h
diff '--color=auto' cgminer-4.9.0/driver-avalon.c cgminer-4.10.0/driver-avalon.c
2c2
<  * Copyright 2013-2014 Con Kolivas <kernel@kolivas.org>
---
>  * Copyright 2013-2015 Con Kolivas <kernel@kolivas.org>
34d33
<   #include <windows.h>
293,299d291
< #define AVALON_CTS    (1 << 4)
< 
< static inline bool avalon_cts(char c)
< {
< 	return (c & AVALON_CTS);
< }
< 
1706a1699
> 
1710a1704
> 
Only in cgminer-4.10.0: driver-avalon-miner.c
Only in cgminer-4.10.0: driver-avalon-miner.h
diff '--color=auto' cgminer-4.9.0/driver-bflsc.c cgminer-4.10.0/driver-bflsc.c
3c3
<  * Copyright 2013-2014 Con Kolivas
---
>  * Copyright 2013-2015 Con Kolivas
23,26d22
< #ifdef WIN32
< #include <windows.h>
< #endif
< 
104,106c100
< 		p_items = realloc(p_items, ++p_lines * sizeof(*p_items));
< 		if (unlikely(!p_items))
< 			quit(1, "Failed to realloc p_items in tolines");
---
> 		p_items = cgrealloc(p_items, ++p_lines * sizeof(*p_items));
183,185c177
< 		p_fields = realloc(p_fields, ++p_count * sizeof(*p_fields));
< 		if (unlikely(!p_fields))
< 			quit(1, "Failed to realloc p_fields in breakdown");
---
> 		p_fields = cgrealloc(p_fields, ++p_count * sizeof(*p_fields));
678,680c670
< 	sc_info->sc_devs = calloc(sc_info->sc_count, sizeof(struct bflsc_dev));
< 	if (unlikely(!sc_info->sc_devs))
< 		quit(1, "Failed to calloc in getinfo");
---
> 	sc_info->sc_devs = cgcalloc(sc_info->sc_count, sizeof(struct bflsc_dev));
710,712c700
< 	sc_info = calloc(1, sizeof(*sc_info));
< 	if (unlikely(!sc_info))
< 		quit(1, "Failed to calloc sc_info in bflsc_detect_one");
---
> 	sc_info = cgcalloc(1, sizeof(*sc_info));
842c830
< 	sc_info->default_ms_work = BAS_WORK_TIME;
---
> 	sc_info->default_ms_work = (unsigned int)BAS_WORK_TIME;
852c840
< 		sc_info->default_ms_work = BAM_WORK_TIME;
---
> 		sc_info->default_ms_work = (unsigned int)BAM_WORK_TIME;
859c847
< 			sc_info->default_ms_work = BAJ_WORK_TIME;
---
> 			sc_info->default_ms_work = (unsigned int)BAJ_WORK_TIME;
865c853
< 			sc_info->default_ms_work = BAL_WORK_TIME;
---
> 			sc_info->default_ms_work = (unsigned int)BAL_WORK_TIME;
875c863
< 		sc_info->default_ms_work = BMA_WORK_TIME;
---
> 		sc_info->default_ms_work = (unsigned int)BMA_WORK_TIME;
1907c1895
< 			queued = i - 1;
---
> 			queued = i;
1911c1899
< 		bwork = calloc(sizeof(struct bflsc_work), 1);
---
> 		bwork = cgcalloc(sizeof(struct bflsc_work), 1);
diff '--color=auto' cgminer-4.9.0/driver-bflsc.h cgminer-4.10.0/driver-bflsc.h
390c390
< int opt_bflsc_overheat;
---
> extern int opt_bflsc_overheat;
diff '--color=auto' cgminer-4.9.0/driver-bitforce.c cgminer-4.10.0/driver-bitforce.c
27,30d26
< #ifdef WIN32
< #include <windows.h>
< #endif /* WIN32 */
< 
diff '--color=auto' cgminer-4.9.0/driver-bitfury.c cgminer-4.10.0/driver-bitfury.c
166,167c166,167
< 	memcpy(&info->product, buf + 2, 8);
< 	memcpy(&info->serial, buf + 10, 4);
---
> 	cg_memcpy(&info->product, buf + 2, 8);
> 	cg_memcpy(&info->serial, buf + 10, 4);
328,332c328,330
< 	info->filtered_hw = calloc(sizeof(int), info->chips);
< 	info->job = calloc(sizeof(int), info->chips);
< 	info->submits = calloc(sizeof(int), info->chips);
< 	if (!info->filtered_hw || !info->job || !info->submits)
< 		quit(1, "Failed to calloc bxf chip arrays");
---
> 	info->filtered_hw = cgcalloc(sizeof(int), info->chips);
> 	info->job = cgcalloc(sizeof(int), info->chips);
> 	info->submits = cgcalloc(sizeof(int), info->chips);
420,426c418,424
< 	info->payload = calloc(sizeof(struct bitfury_payload), info->chips);
< 	info->oldbuf = calloc(sizeof(unsigned int) * 17, info->chips);
< 	info->job_switched = calloc(sizeof(bool), info->chips);
< 	info->second_run = calloc(sizeof(bool), info->chips);
< 	info->work = calloc(sizeof(struct work *), info->chips);
< 	info->owork = calloc(sizeof(struct work *), info->chips);
< 	info->submits = calloc(sizeof(int *), info->chips);
---
> 	info->payload = cgcalloc(sizeof(struct bitfury_payload), info->chips);
> 	info->oldbuf = cgcalloc(sizeof(unsigned int) * 17, info->chips);
> 	info->job_switched = cgcalloc(sizeof(bool), info->chips);
> 	info->second_run = cgcalloc(sizeof(bool), info->chips);
> 	info->work = cgcalloc(sizeof(struct work *), info->chips);
> 	info->owork = cgcalloc(sizeof(struct work *), info->chips);
> 	info->submits = cgcalloc(sizeof(int *), info->chips);
736,737c734,735
< 	memcpy(&buf[3], rst_buf, 8);
< 	memcpy(&buf[11], rst_buf, 8);
---
> 	cg_memcpy(&buf[3], rst_buf, 8);
> 	cg_memcpy(&buf[11], rst_buf, 8);
829,831c827
< 	info = calloc(sizeof(struct bitfury_info), 1);
< 	if (!info)
< 		quit(1, "Failed to calloc info in bitfury_detect_one");
---
> 	info = cgcalloc(sizeof(struct bitfury_info), 1);
1211,1212c1207,1208
< 	memcpy(buf + 1, work->midstate, 32);
< 	memcpy(buf + 33, work->data + 64, 12);
---
> 	cg_memcpy(buf + 1, work->midstate, 32);
> 	cg_memcpy(buf + 33, work->data + 64, 12);
1261c1257
< 		memcpy(&nonce, readbuf + i + 3, 4);
---
> 		cg_memcpy(&nonce, readbuf + i + 3, 4);
diff '--color=auto' cgminer-4.9.0/driver-bitmain.c cgminer-4.10.0/driver-bitmain.c
3c3
<  * Copyright 2014 Andrew Smith
---
>  * Copyright 2014-2015 Andrew Smith
22a23,27
> #ifdef USE_ANT_S3
> static void ants3_detect(__maybe_unused bool hotplug)
> {
> }
> #else
26a32
> #endif
30a37
> #if (defined(USE_ANT_S1) || defined(USE_ANT_S3))
31a39,42
> #else
> #define C_BITMAIN_READ 0
> #define C_BITMAIN_DATA_RXSTATUS 0
> #endif
41a53,55
> #ifdef USE_ANT_S3
> #define ANTDRV ants3_drv
> #else
43a58
> #endif
52c67
< bool opt_bitmain_tempoverctrl = true;
---
> bool opt_bitmain_tempoverctrl = false;
54a70
> int opt_bitmain_workdelay = BITMAIN_WORK_DELAY;
58,59d73
< int opt_bitmain_freq_min = BITMAIN_MIN_FREQUENCY;
< int opt_bitmain_freq_max = BITMAIN_MAX_FREQUENCY;
62,63d75
< static bool is_usb;
< 
66c78
< #ifdef USE_ANT_S1
---
> #if (defined(USE_ANT_S1) || defined(USE_ANT_S3))
183a196
> #ifdef USE_ANT_S1
185c198,199
< 			int *asic_num, int *timeout, int *frequency, uint8_t * reg_data)
---
> 			int *asic_num, int *timeout, int *frequency,
> 			uint8_t *reg_data)
190c204
< 	int i, tmp;
---
> 	int tmp;
194a209
> 		// Always use the first set if more than one
196,202d210
< 		for (i = 0; i < this_option_offset; i++) {
< 			comma = strchr(ptr, ',');
< 			if (comma == NULL)
< 				break;
< 			ptr = comma + 1;
< 		}
< 
204,208c212,214
< 		if (comma == NULL)
< 			max = strlen(ptr);
< 		else
< 			max = comma - ptr;
< 
---
> 		if (comma)
> 			*comma = '\0';
> 		max = strlen(ptr);
319a326,409
> #else
> static bool get_options(__maybe_unused int this_option_offset, int *baud,
> 			int *chain_num, int *asic_num)
> {
> 	char buf[BUFSIZ+1];
> 	char *ptr, *comma, *colon, *colon2, *colon3;
> 	size_t max;
> 	int tmp;
> 
> 	if (opt_bitmain_options == NULL)
> 		buf[0] = '\0';
> 	else {
> 		// Always use the first set if more than one
> 		ptr = opt_bitmain_options;
> 		comma = strchr(ptr, ',');
> 		if (comma)
> 			*comma = '\0';
> 		max = strlen(ptr);
> 		if (max > BUFSIZ)
> 			max = BUFSIZ;
> 		strncpy(buf, ptr, max);
> 		buf[max] = '\0';
> 	}
> 
> 	if (!(*buf))
> 		return false;
> 
> 	colon = strchr(buf, ':');
> 	if (colon)
> 		*(colon++) = '\0';
> 
> 	tmp = atoi(buf);
> 	switch (tmp) {
> 		case 115200:
> 			*baud = 115200;
> 			break;
> 		case 57600:
> 			*baud = 57600;
> 			break;
> 		case 38400:
> 			*baud = 38400;
> 			break;
> 		case 19200:
> 			*baud = 19200;
> 				break;
> 		default:
> 			quit(1, "Invalid bitmain-options for baud (%s) "
> 				"must be 115200, 57600, 38400 or 19200", buf);
> 	}
> 
> 	if (colon && *colon) {
> 		colon2 = strchr(colon, ':');
> 		if (colon2)
> 			*(colon2++) = '\0';
> 
> 		if (*colon) {
> 			tmp = atoi(colon);
> 			if (tmp > 0)
> 				*chain_num = tmp;
> 			else {
> 				quit(1, "Invalid bitmain-options for "
> 					"chain_num (%s) must be 1 ~ %d",
> 					colon, BITMAIN_DEFAULT_CHAIN_NUM);
> 			}
> 		}
> 
> 		if (colon2 && *colon2) {
> 			colon3 = strchr(colon2, ':');
> 			if (colon3)
> 				*(colon3++) = '\0';
> 
> 			tmp = atoi(colon2);
> 			if (tmp > 0 && tmp <= BITMAIN_DEFAULT_ASIC_NUM)
> 				*asic_num = tmp;
> 			else {
> 				quit(1, "Invalid bitmain-options for "
> 					"asic_num (%s) must be 1 ~ %d",
> 					colon2, BITMAIN_DEFAULT_ASIC_NUM);
> 			}
> 		}
> 	}
> 	return true;
> }
> #endif
336c426
< 				uint16_t frequency, uint8_t voltage, uint8_t chain_check_time,
---
> 				uint16_t frequency, uint8_t *voltage, uint8_t chain_check_time,
394a485
> #ifdef USE_ANT_S1
395a487,490
> #else
> 	bm->voltage[0] = voltage[0];
> 	bm->voltage[1] = voltage[1];
> #endif
422c517
< 			" anum(%d) fanpwmdata(%d) toutdata(%d) freq(%d) volt(%d)"
---
> 			" anum(%d) fanpwmdata(%d) toutdata(%d) freq(%d) volt(%02x%02x)"
430,432c525,528
< 			(int)timeout_data, (int)frequency, (int)voltage, (int)chain_check_time,
< 			(int)reg_data[0], (int)reg_data[1], (int)reg_data[2], (int)reg_data[3],
< 			(int)chip_address, (int)reg_address, (int)crc);
---
> 			(int)timeout_data, (int)frequency, (int)voltage[0], (int)voltage[1],
> 			(int)chain_check_time, (int)reg_data[0], (int)reg_data[1],
> 			(int)reg_data[2], (int)reg_data[3], (int)chip_address,
> 			(int)reg_address, (int)crc);
442c538
< 	uint32_t work_id = 0;
---
> 	uint32_t wid = 0;
481,482c577,578
< 		work_id = DATAW(witem)->wid;
< 		bm->works[cursentcount].work_id = htole32(work_id);
---
> 		wid = DATAW(witem)->wid;
> 		bm->works[cursentcount].work_id = htole32(wid);
485c581
< 				  bm->works[cursentcount].work_id, work_id);
---
> 				  wid, bm->works[cursentcount].work_id);
762c858
< 			asic_num = 0;
---
> 			asic_num = 1;
775c871
< 			asic_num = 0;
---
> 			asic_num = 1;
911d1006
< 
922c1017,1018
< 		       size_t bufsize, int timeout, int ep)
---
> 			size_t bufsize, __maybe_unused int timeout,
> 			__maybe_unused int ep)
925c1021
< 	int readlen = 0, err = 0;
---
> 	int readlen = 0;
934,942c1030,1037
< 	if (is_usb) {
< 		err = usb_read_once_timeout(bitmain, (char *)buf, bufsize, &readlen, timeout, ep);
< 		applog(LOG_DEBUG, "%s%i: Get %s() got readlen %d err %d",
< 				  bitmain->drv->name, bitmain->device_id,
< 				  __func__, readlen, err);
< 	}
< #ifdef USE_ANT_S2
< 	else
< 		readlen = read(info->device_fd, buf, bufsize);
---
> #if (defined(USE_ANT_S1) || defined(USE_ANT_S3))
> 	int err = usb_read_once_timeout(bitmain, (char *)buf, bufsize, &readlen,
> 					timeout, ep);
> 	applog(LOG_DEBUG, "%s%i: Get %s() got readlen %d err %d",
> 			  bitmain->drv->name, bitmain->device_id,
> 			  __func__, readlen, err);
> #else
> 	readlen = read(info->device_fd, buf, bufsize);
947c1042,1043
< static int bitmain_write(struct cgpu_info *bitmain, char *buf, ssize_t len, int ep)
---
> static int bitmain_write(struct cgpu_info *bitmain, char *buf, ssize_t len,
> 			 __maybe_unused int ep)
950c1046
< 	int err, amount, __maybe_unused sent;
---
> 	int amount, __maybe_unused sent;
952,968c1048,1063
< 	if (is_usb) {
< 		err = usb_write(bitmain, buf, len, &amount, ep);
< 		applog(LOG_DEBUG, "%s%d: usb_write got err %d",
< 				  bitmain->drv->name, bitmain->device_id, err);
< 
< 		if (unlikely(err != 0)) {
< 			applog(LOG_ERR, "%s%d: usb_write error on %s() err=%d",
< 					bitmain->drv->name, bitmain->device_id, __func__, err);
< 			return BTM_SEND_ERROR;
< 		}
< 		if (amount != len) {
< 			applog(LOG_ERR, "%s%d: usb_write length mismatch on %s() "
< 					"amount=%d len=%d",
< 					bitmain->drv->name, bitmain->device_id, __func__,
< 					amount, (int)len);
< 			return BTM_SEND_ERROR;
< 		}
---
> #if (defined(USE_ANT_S1) || defined(USE_ANT_S3))
> 	int err = usb_write(bitmain, buf, len, &amount, ep);
> 	applog(LOG_DEBUG, "%s%d: usb_write got err %d",
> 			  bitmain->drv->name, bitmain->device_id, err);
> 
> 	if (unlikely(err != 0)) {
> 		applog(LOG_ERR, "%s%d: usb_write error on %s() err=%d",
> 				bitmain->drv->name, bitmain->device_id, __func__, err);
> 		return BTM_SEND_ERROR;
> 	}
> 	if (amount != len) {
> 		applog(LOG_ERR, "%s%d: usb_write length mismatch on %s() "
> 				"amount=%d len=%d",
> 				bitmain->drv->name, bitmain->device_id, __func__,
> 				amount, (int)len);
> 		return BTM_SEND_ERROR;
970,972c1065,1066
< #ifdef USE_ANT_S2
< 	else {
< 		sent = 0;
---
> #else
> 	sent = 0;
974,981c1068,1073
< 		while (sent < len) {
< 			amount = write(info->device_fd, buf+sent, len-sent);
< 			if (amount < 0) {
< 				applog(LOG_WARNING, "%s%d: ser_write got err %d",
< 						    bitmain->drv->name, bitmain->device_id, amount);
< 				return BTM_SEND_ERROR;
< 			}
< 			sent += amount;
---
> 	while (sent < len) {
> 		amount = write(info->device_fd, buf+sent, len-sent);
> 		if (amount < 0) {
> 			applog(LOG_WARNING, "%s%d: ser_write got err %d",
> 					    bitmain->drv->name, bitmain->device_id, amount);
> 			return BTM_SEND_ERROR;
982a1075
> 		sent += amount;
990c1083
< 	int ret, ep = C_BITMAIN_SEND;
---
> 	int ret, ep = 0;
998a1092,1093
> #if (defined(USE_ANT_S1) || defined(USE_ANT_S3))
> 	ep = C_BITMAIN_SEND;
1005a1101
> #endif
1243a1340
> 					uint32_t wid = rxnoncedata.nonces[j].work_id;
1249c1346
< 						if (DATAW(witem)->work->id == rxnoncedata.nonces[j].work_id)
---
> 						if (DATAW(witem)->wid == wid)
1269,1272c1366,1369
< 								  "work(%"PRIu32"-%"PRIu32")(%08x)",
< 								  bitmain->drv->name, bitmain->device_id,
< 								  __func__, work->id,
< 								  rxnoncedata.nonces[j].work_id,
---
> 								  "work(%"PRIu32")(%08x)",
> 								  bitmain->drv->name,
> 								  bitmain->device_id,
> 								  __func__, wid,
1320,1323c1417,1422
< 						applog(LOG_ERR, "%s%d: %s() Work not found for id (%"PRIu32")"
< 								" (min=%"PRIu32" max=%"PRIu32" count=%d)",
< 								bitmain->drv->name, bitmain->device_id,
< 								__func__, rxnoncedata.nonces[j].work_id,
---
> 						applog(LOG_ERR, "%s%d: %s() Work not found"
> 								" for id (%"PRIu32") (min=%"
> 								PRIu32" max=%"PRIu32" count=%d)",
> 								bitmain->drv->name,
> 								bitmain->device_id,
> 								__func__, wid,
1367c1466
< 	int asicnum = 0;
---
> 	int asicnum = 0, mod = 0, tmp = 0;
1419a1519
> 					mod = 0;
1423c1523,1524
< 						if (info->chain_asic_num[n] % 32 == 0)
---
> 						mod = info->chain_asic_num[n] % 32;
> 						if (mod == 0)
1430,1431c1531,1533
< 							for (r = 0; r < 32; r++) {
< 								if ((r % 8) == 0 && r != 0) {
---
> 							tmp = (mod ? (32 - mod) : 0);
> 							for (r = tmp; r < 32; r++) {
> 								if (((r-tmp) % 8) == 0 && (r-tmp) != 0) {
1446a1549
> 							mod = 0;
1520a1624
> 					uint32_t wid = rxnoncedata.nonces[j].work_id;
1526c1630
< 						if (DATAW(witem)->wid == rxnoncedata.nonces[j].work_id)
---
> 						if (DATAW(witem)->wid == wid)
1546c1650
< 								  "work(%"PRIu32"-%"PRIu32")(%08x)",
---
> 								  "work(%"PRIu32")(%08x)",
1548,1549c1652
< 								  __func__, work->id,
< 								  rxnoncedata.nonces[j].work_id,
---
> 								  __func__, wid,
1589,1591c1692,1696
< 						applog(LOG_ERR, "%s%d: %s() Work not found for id (%"PRIu32")",
< 								bitmain->drv->name, bitmain->device_id,
< 								__func__, rxnoncedata.nonces[j].work_id);
---
> 						applog(LOG_ERR, "%s%d: %s() Work not found "
> 								"for id (%"PRIu32")",
> 								bitmain->drv->name,
> 								bitmain->device_id,
> 								__func__, wid);
1668a1774
> 			info->readbuf_over++;
1693a1800
> 			info->read_bad++;
1703a1811,1814
> #ifndef USE_ANT_S1
> 			if (errorcount > 0)
> 				cgsleep_ms(1);
> #endif
1712a1824,1835
> 		info->read_size += ret;
> 		if (info->read_good == 0)
> 			info->read_sizemin = info->read_sizemax = ret;
> 		else {
> 			if (info->read_sizemin > ret)
> 				info->read_sizemin = ret;
> 			if (info->read_sizemax < ret)
> 				info->read_sizemax = ret;
> 		}
> 		info->read_good++;
> 		if (ret == 18)
> 			info->read_18s++;
2052c2175
< 						info->frequency, BITMAIN_DEFAULT_VOLTAGE,
---
> 						info->frequency, info->voltage,
2076a2200
> #ifdef USE_ANT_S1
2077a2202,2204
> #else
> static void ant_info(struct bitmain_info *info, int baud, int chain_num, int asic_num)
> #endif
2081a2209,2210
> 
> #ifdef USE_ANT_S1
2085d2213
< 
2086a2215,2264
> #else
> 	info->timeout = BITMAIN_DEFAULT_TIMEOUT;
> 	info->frequency = BITMAIN_DEFAULT_FREQUENCY;
> 	memset(info->reg_data, BITMAIN_DEFAULT_REG_DATA, 4);
> 	info->voltage[0] = BITMAIN_VOLTAGE0_DEF;
> 	info->voltage[1] = BITMAIN_VOLTAGE1_DEF;
> 
> 	if (opt_bitmain_freq) {
> 		char buf[BUFSIZ+1];
> 		char *colon, *colon2;
> 		uint8_t reg_data[4];
> 		int timeout, freq;
> 		size_t len;
> 
> 		strncpy(buf, opt_bitmain_freq, sizeof(buf));
> 		buf[sizeof(buf)-1] = '\0';
> 		colon = strchr(buf, ':');
> 		if (colon)
> 			*(colon++) = '\0';
> 		timeout = atoi(buf);
> 		if (timeout > 0 && timeout <= 0xff)
> 			info->timeout = timeout;
> 		if (colon && *colon) {
> 			colon2 = strchr(colon, ':');
> 			if (colon2)
> 				*(colon2++) = '\0';
> 			freq = atoi(colon);
> 			if (freq >= BITMAIN_MIN_FREQUENCY &&
> 			    freq <= BITMAIN_MAX_FREQUENCY) {
> 				info->frequency = freq;
> 			}
> 			if (colon2 && *colon2) {
> 				len = strlen(colon2);
> 				if (len > 1 && len <= 8 && (len & 1) == 0) {
> 					memset(reg_data, BITMAIN_DEFAULT_REG_DATA, 4);
> 					if (hex2bin(reg_data, colon2, len/2))
> 						memcpy(info->reg_data, reg_data, len/2);
> 				}
> 			}
> 		}
> 	}
> 
> 	if (opt_bitmain_voltage) {
> 		unsigned char v[2];
> 		if (hex2bin(v, opt_bitmain_voltage, 2)) {
> 			info->voltage[0] = (uint8_t)(v[0]);
> 			info->voltage[1] = (uint8_t)(v[1]);
> 		}
> 	}
> #endif
2098a2277
> #if (defined(USE_ANT_S1) || defined(USE_ANT_S3))
2101c2280,2282
< 	int baud, chain_num, asic_num, timeout, frequency = 0;
---
> 	int baud, chain_num, asic_num = 0;
> #ifdef USE_ANT_S1
> 	int timeout, frequency = 0;
2102a2284
> #endif
2108c2290,2291
< 	if (opt_bitmain_options == NULL)
---
> 	if (!opt_bitmain_options || !(*opt_bitmain_options)) {
> 		applog(LOG_ERR, "%s: no bitmain-options specified", ANTDRV.dname);
2109a2293
> 	}
2115a2300
> #ifdef USE_ANT_S1
2117a2303
> #endif
2121a2308
> #ifdef USE_ANT_S1
2123a2311,2313
> #else
> 	configured = get_options(++option_offset, &baud, &chain_num, &asic_num);
> #endif
2133a2324
> #ifdef USE_ANT_S1
2139a2331,2337
> #else
> 	if (configured)
> 		ant_info(info, baud, chain_num, asic_num);
> 	else
> 		ant_info(info, BITMAIN_IO_SPEED, BITMAIN_DEFAULT_CHAIN_NUM, BITMAIN_DEFAULT_ASIC_NUM);
> 
> #endif
2156c2354
< #ifdef USE_ANT_S2
---
> #ifdef USE_ANT_S3
2157a2356
> 	dupalloc(bitmain, 10);
2181,2182c2380
< 
< #ifdef USE_ANT_S2
---
> #else // S2 (and only S2)
2185,2186c2383
< 	int baud, chain_num, asic_num, timeout, frequency = 0;
< 	uint8_t reg_data[4] = {0};
---
> 	int baud, chain_num = 0, asic_num = 0;
2206d2402
< 	bitmain->usbinfo.nodev = true;
2208,2209c2404
< 	configured = get_options(++option_offset, &baud, &chain_num,
< 				  &asic_num, &timeout, &frequency, reg_data);
---
> 	configured = get_options(++option_offset, &baud, &chain_num, &asic_num);
2224d2418
< 	bitmain->usbinfo.nodev = false;
2227c2421
< 		ant_info(info, baud, chain_num, asic_num, timeout, frequency, reg_data);
---
> 		ant_info(info, baud, chain_num, asic_num);
2229,2231c2423
< 		ant_info(info, BITMAIN_IO_SPEED, BITMAIN_DEFAULT_CHAIN_NUM,
< 			  BITMAIN_DEFAULT_ASIC_NUM, BITMAIN_DEFAULT_TIMEOUT,
< 			  BITMAIN_DEFAULT_FREQUENCY, reg_data);
---
> 		ant_info(info, BITMAIN_IO_SPEED, BITMAIN_DEFAULT_CHAIN_NUM, BITMAIN_DEFAULT_ASIC_NUM);
2270d2461
< 	is_usb = true;
2275c2466,2471
< 
---
> #ifdef USE_ANT_S3
> static void ants3_detect(bool __maybe_unused hotplug)
> {
> 	usb_detect(&ANTDRV, bitmain_detect_one);
> }
> #else
2287,2295c2483
< 	if (opt_bitmain_dev && *opt_bitmain_dev)
< 		is_usb = false;
< 	else
< 		is_usb = true;
< 
< 	if (is_usb)
< 		usb_detect(&ANTDRV, bitmain_detect_one);
< 	else
< 		ser_detect();
---
> 	ser_detect();
2297a2486
> #endif
2333c2522
< 	bool ret = true;
---
> 	bool ret = true, dodelay = false;
2389a2579
> 	info->fill_calls++;
2395a2586,2587
> 		info->fill_nospace++;
> 		dodelay = true;
2404,2409c2596,2643
< 	while (info->fifo_space > 0) {
< #ifdef USE_ANT_S1
< 		neednum = info->fifo_space<8?info->fifo_space:8;
< #else
< 		neednum = info->fifo_space<BITMAIN_MAX_WORK_NUM?info->fifo_space:BITMAIN_MAX_WORK_NUM;
< #endif
---
> 	if (info->fifo_space > 0) {
> 		work = get_queued(bitmain);
> 		if (!work) {
> 			if (info->fifo_space < BITMAIN_MAX_WORK_NUM)
> 				neednum = info->fifo_space;
> 			else
> 				neednum = BITMAIN_MAX_WORK_NUM;
> 
> 			queuednum = info->queued;
> 
> 			int need = neednum - queuednum;
> 			if (need > BITMAIN_MAX_WORK_NUM) {
> 				need = BITMAIN_MAX_WORK_NUM;
> 				info->need_over++;
> 			} else {
> 				if (need < 0)
> 					need = 0;
> 			}
> 			info->fill_nowork++;
> 			info->need_nowork[need]++;
> 			goto out_unlock;
> 		}
> 
> 		roll_limit = work->drv_rolllimit;
> 		info->fill_rolltot += roll_limit;
> 		if (info->fill_roll == 0)
> 			info->fill_rollmin = info->fill_rollmax = roll_limit;
> 		else {
> 			if (info->fill_rollmin > roll_limit)
> 				info->fill_rollmin = roll_limit;
> 			if (info->fill_rollmax < roll_limit)
> 				info->fill_rollmax = roll_limit;
> 		}
> 		info->fill_roll++;
> 		roll = 0;
> 	}
> 
> 	while (info->fifo_space > 0 && roll <= roll_limit) {
> 		info->fifo_checks++;
> 		if (info->fifo_space < BITMAIN_MAX_WORK_NUM) {
> 			neednum = info->fifo_space;
> 			info->fill_neededless++;
> 		} else
> 			neednum = BITMAIN_MAX_WORK_NUM;
> 
> 		info->fill_totalneeded += neednum;
> 		info->fill_need[neednum]++;
> 
2414,2451c2648,2662
< 		while (queuednum < neednum) {
< 			work = get_queued(bitmain);
< 			if (!work)
< 				break;
< 			else {
< 				roll_limit = work->drv_rolllimit;
< 				roll = 0;
< 				while (queuednum < neednum && roll <= roll_limit) {
< 					applog(LOG_DEBUG, "%s%d: get work queued number:%d"
< 							  " neednum:%d",
< 							  bitmain->drv->name,
< 							  bitmain->device_id,
< 							  queuednum, neednum);
< 
< 					// Using devflag to say if it was rolled
< 					if (roll == 0) {
< 						usework = work;
< 						usework->devflag = false;
< 					} else {
< 						usework = copy_work_noffset(work, roll);
< 						usework->devflag = true;
< 					}
< 
< 					witem = k_unlink_tail(info->work_list);
< 					if (DATAW(witem)->work) {
< 						// Was it rolled?
< 						if (DATAW(witem)->work->devflag)
< 							free_work(DATAW(witem)->work);
< 						else
< 							work_completed(bitmain, DATAW(witem)->work);
< 					}
< 					DATAW(witem)->work = usework;
< 					DATAW(witem)->wid = ++info->last_wid;
< 					info->queued++;
< 					k_add_head(info->work_ready, witem);
< 					queuednum++;
< 					roll++;
< 				}
---
> 		info->fill_want += (neednum - queuednum);
> 		while (queuednum < neednum && roll <= roll_limit) {
> 			applog(LOG_DEBUG, "%s%d: get work queued number:%d"
> 					  " neednum:%d",
> 					  bitmain->drv->name,
> 					  bitmain->device_id,
> 					  queuednum, neednum);
> 
> 			// Using devflag to say if it was rolled
> 			if (roll == 0) {
> 				usework = work;
> 				usework->devflag = false;
> 			} else {
> 				usework = copy_work_noffset(work, roll);
> 				usework->devflag = true;
2452a2664,2678
> 
> 			witem = k_unlink_tail(info->work_list);
> 			if (DATAW(witem)->work) {
> 				// Was it rolled?
> 				if (DATAW(witem)->work->devflag)
> 					free_work(DATAW(witem)->work);
> 				else
> 					work_completed(bitmain, DATAW(witem)->work);
> 			}
> 			DATAW(witem)->work = usework;
> 			DATAW(witem)->wid = ++info->last_wid;
> 			info->queued++;
> 			k_add_head(info->work_ready, witem);
> 			queuednum++;
> 			roll++;
2455a2682,2683
> 				info->fill_toosmall++;
> 				info->fill_less += (neednum - queuednum);
2459c2687
< 				break;
---
> 				goto out_unlock;
2461a2690
> 		info->fill_sends++;
2462a2692,2694
> 		info->fill_totalsend += sendnum;
> 		info->fill_send[sendnum]++;
> 		info->fill_sendless[neednum - sendnum]++;
2477a2710
> 				info->fill_senderr++;
2491c2724
< 				break;
---
> 				goto out_unlock;
2498a2732
> 			info->fill_seterr++;
2502d2735
< 			break;
2509,2511c2742,2745
< 	if (timediff < 0) timediff = -timediff;
< 
< 	if (now.tv_sec - info->last_status_time.tv_sec > BITMAIN_SEND_STATUS_TIME) {
---
> 	if (timediff < 0)
> 		timediff = -timediff;
> 	if (timediff > BITMAIN_SEND_STATUS_TIME) {
> 		info->fill_sendstatus++;
2550a2785,2787
> 	} else {
> 		if (dodelay)
> 			cgsleep_ms(opt_bitmain_workdelay);
2587a2825
> #if (defined(USE_ANT_S1) || defined(USE_ANT_S3))
2592a2831
> #endif
2618c2857,2863
< 	//int i = 0;
---
> 	char needbuf[16 * (BITMAIN_MAX_WORK_NUM + 1)], *needptr;
> 	char fillbuf[64];
> 	char rollbuf[64];
> 	char regbuf[16];
> 	float avg;
> 	int i = 0;
> 	size_t len;
2626a2872,2876
> 	snprintf(regbuf, sizeof(regbuf), "0x%02x%02x%02x%02x",
> 		 (int)(info->reg_data[0]), (int)(info->reg_data[1]),
> 		 (int)(info->reg_data[2]), (int)(info->reg_data[3]));
> 	root = api_add_string(root, "regdata", regbuf, true);
> #ifdef USE_ANT_S1
2627a2878,2883
> #else
> 	char vbuf[8];
> 	snprintf(vbuf, sizeof(vbuf), "0x%02x%02x",
> 		 (int)(info->voltage[0]), (int)(info->voltage[1]));
> 	root = api_add_string(root, "voltage", vbuf, true);
> #endif
2674,2675c2930,2931
< 	root = api_add_int(root, "temp_avg", &(info->temp_avg), false);
< 	root = api_add_int(root, "temp_max", &(info->temp_max), false);
---
> 	root = api_add_int(root, "temp_avg", &(info->temp_avg), true);
> 	root = api_add_int(root, "temp_max", &(info->temp_max), true);
2677c2933
< 	root = api_add_int(root, "no_matching_work", &(info->no_matching_work), false);
---
> 	root = api_add_int(root, "no_matching_work", &(info->no_matching_work), true);
2730,2731c2986,2987
< 	float avg = info->work_search ? (float)(info->tot_search) /
< 						(float)(info->work_search) : 0;
---
> 	avg = info->work_search ? (float)(info->tot_search) /
> 					(float)(info->work_search) : 0;
2750a3007,3091
> 	root = api_add_uint64(root, "fill_calls", &(info->fill_calls), true);
> 	root = api_add_uint64(root, "fill_nospace", &(info->fill_nospace), true);
> 	root = api_add_uint64(root, "fifo_checks", &(info->fifo_checks), true);
> 	root = api_add_uint64(root, "fill_neededless", &(info->fill_neededless), true);
> 	avg = info->fifo_checks ? (float)(info->fill_totalneeded) /
> 					(float)(info->fifo_checks) : 0;
> 	snprintf(fillbuf, sizeof(fillbuf), "%"PRId64"/%.2fav", info->fill_totalneeded, avg);
> 	root = api_add_string(root, "fill_needed", fillbuf, true);
> 	needptr = needbuf;
> 	for (i = 0; i <= BITMAIN_MAX_WORK_NUM; i++) {
> 		len = sizeof(needbuf) - (needptr - needbuf);
> 		if (len > 1) {
> 			snprintf(needptr, len, "%s%"PRIu64,
> 				 i ? "/" : "", info->fill_need[i]);
> 			needptr += strlen(needptr);
> 		}
> 	}
> 	root = api_add_string(root, "fill_need", needbuf, true);
> 	avg = info->fifo_checks ? (float)(info->fill_want) /
> 					(float)(info->fifo_checks) : 0;
> 	snprintf(fillbuf, sizeof(fillbuf), "%"PRId64"/%.2fav", info->fill_want, avg);
> 	root = api_add_string(root, "fill_want", fillbuf, true);
> 	root = api_add_uint64(root, "fill_nowork", &(info->fill_nowork), true);
> 	root = api_add_uint64(root, "fill_toosmall", &(info->fill_toosmall), true);
> 	avg = info->fill_toosmall ? (float)(info->fill_less) /
> 					(float)(info->fill_toosmall) : 0;
> 	snprintf(fillbuf, sizeof(fillbuf), "%"PRId64" %.2fav", info->fill_less, avg);
> 	root = api_add_string(root, "fill_less", fillbuf, true);
> 	root = api_add_uint64(root, "fill_sends", &(info->fill_sends), true);
> 	avg = info->fill_sends ? (float)(info->fill_totalsend) /
> 					(float)(info->fill_sends) : 0;
> 	snprintf(fillbuf, sizeof(fillbuf), "%"PRId64"/%.2fav", info->fill_totalsend, avg);
> 	root = api_add_string(root, "fill_totalsend", fillbuf, true);
> 	needptr = needbuf;
> 	for (i = 0; i <= BITMAIN_MAX_WORK_NUM; i++) {
> 		len = sizeof(needbuf) - (needptr - needbuf);
> 		if (len > 1) {
> 			snprintf(needptr, len, "%s%"PRIu64,
> 				 i ? "/" : "", info->fill_send[i]);
> 			needptr += strlen(needptr);
> 		}
> 	}
> 	root = api_add_string(root, "fill_send", needbuf, true);
> 	needptr = needbuf;
> 	for (i = 0; i <= BITMAIN_MAX_WORK_NUM; i++) {
> 		len = sizeof(needbuf) - (needptr - needbuf);
> 		if (len > 1) {
> 			snprintf(needptr, len, "%s%"PRIu64,
> 				 i ? "/" : "", info->fill_sendless[i]);
> 			needptr += strlen(needptr);
> 		}
> 	}
> 	root = api_add_string(root, "fill_sendless", needbuf, true);
> 	root = api_add_uint64(root, "fill_seterr", &(info->fill_seterr), true);
> 	root = api_add_uint64(root, "fill_senderr", &(info->fill_senderr), true);
> 
> 	needptr = needbuf;
> 	for (i = 0; i <= BITMAIN_MAX_WORK_NUM; i++) {
> 		len = sizeof(needbuf) - (needptr - needbuf);
> 		if (len > 1) {
> 			snprintf(needptr, len, "%s%"PRIu64,
> 				 i ? "/" : "", info->need_nowork[i]);
> 			needptr += strlen(needptr);
> 		}
> 	}
> 	len = sizeof(needbuf) - (needptr - needbuf);
> 	if (len > 1)
> 		snprintf(needptr, len, " %"PRIu64, info->need_over);
> 	root = api_add_string(root, "need_nowork", needbuf, true);
> 	avg = info->fill_roll ? (float)(info->fill_rolltot) / (float)(info->fill_roll) : 0;
> 	snprintf(rollbuf, sizeof(rollbuf), "%"PRIu64"/%d/%d/%.2fav",
> 		 info->fill_roll, info->fill_rollmin, info->fill_rollmax, avg);
> 	root = api_add_string(root, "roll", rollbuf, true);
> 	i = BITMAIN_SEND_STATUS_TIME;
> 	root = api_add_int(root, "send_status_time", &i, true);
> 	root = api_add_timeval(root, "last_status_time", &(info->last_status_time), true);
> 	root = api_add_uint64(root, "fill_sendstatus", &(info->fill_sendstatus), true);
> 	root = api_add_uint64(root, "read_good", &(info->read_good), true);
> 	avg = info->read_good ? (float)(info->read_size) / (float)(info->read_good) : 0;
> 	snprintf(fillbuf, sizeof(fillbuf), "%"PRIu64"/%d/%d/%.2fav",
> 		 info->read_size, info->read_sizemin, info->read_sizemax, avg);
> 	root = api_add_string(root, "read_size", fillbuf, true);
> 	root = api_add_uint64(root, "read_18s", &(info->read_18s), true);
> 	root = api_add_uint64(root, "read_bad", &(info->readbuf_over), true);
> 	root = api_add_uint64(root, "readbuf_over", &(info->readbuf_over), true);
2756a3098
> 	root = api_add_int(root, "opt_bitmain_workdelay", &opt_bitmain_workdelay, false);
2760,2761d3101
< 	root = api_add_int(root, "opt_bitmain_freq_min", &opt_bitmain_freq_min, false);
< 	root = api_add_int(root, "opt_bitmain_freq_max", &opt_bitmain_freq_max, false);
2790,2810d3129
< 
< char *set_bitmain_freq(char *arg)
< {
< 	int val1, val2, ret;
< 
< 	ret = sscanf(arg, "%d-%d", &val1, &val2);
< 	if (ret < 1)
< 		return "No values passed to bitmain-freq";
< 	if (ret == 1)
< 		val2 = val1;
< 
< 	if (val1 < BITMAIN_MIN_FREQUENCY || val1 > BITMAIN_MAX_FREQUENCY ||
< 	    val2 < BITMAIN_MIN_FREQUENCY || val2 > BITMAIN_MAX_FREQUENCY ||
< 	    val2 < val1)
< 		return "Invalid value passed to bitmain-freq";
< 
< 	opt_bitmain_freq_min = val1;
< 	opt_bitmain_freq_max = val2;
< 
< 	return NULL;
< }
2833a3153,3159
> #ifdef USE_ANT_S3
> struct device_drv ants3_drv = {
> 	.drv_id = DRIVER_ants3,
> 	.dname = "BitmainAntS3",
> 	.name = "AS3",
> 	.drv_detect = ants3_detect,
> #else
2838a3165
> #endif
diff '--color=auto' cgminer-4.9.0/driver-bitmain.h cgminer-4.10.0/driver-bitmain.h
4c4
<  * Copyright 2014 Andrew Smith
---
>  * Copyright 2014-2015 Andrew Smith
15c15,20
< #if defined(USE_ANT_S1) || defined(USE_ANT_S2)
---
> // S3 is a USB S2 with other minor changes (search for USE_ANT_S3)
> #if defined(USE_ANT_S3)
> #define USE_ANT_S2 1
> #endif
> 
> #if (defined(USE_ANT_S1) || defined(USE_ANT_S2))
50d54
< #define BITMAIN_DEFAULT_VOLTAGE 5
58a63,71
> #define BITMAIN_DEFAULT_VOLTAGE 5
> #define BITMAIN_WORK_DELAY 1
> #else // S2 or S3
> #ifdef USE_ANT_S3 // S3
> #define BITMAIN_FTDI_READSIZE 510
> #define BITMAIN_VOLTAGE_DEF "0000"
> #define BITMAIN_VOLTAGE0_DEF 0x00
> #define BITMAIN_VOLTAGE1_DEF 0x00
> #define BITMAIN_WORK_DELAY 1
60a74,78
> #define BITMAIN_VOLTAGE_DEF "0725"
> #define BITMAIN_VOLTAGE0_DEF 0x07
> #define BITMAIN_VOLTAGE1_DEF 0x25
> #define BITMAIN_WORK_DELAY 1
> #endif
66d83
< #define BITMAIN_READ_TIMEOUT 18 /* Enough to only half fill the buffer */
69a87
> #define BITMAIN_READ_TIMEOUT 18 /* Enough to only half fill the buffer */
74a93,100
> #else // S2 or S3
> #ifdef USE_ANT_S3
> #define BITMAIN_READ_TIMEOUT 100
> #define BITMAIN_MAX_WORK_NUM       8
> #define BITMAIN_MAX_WORK_QUEUE_NUM 1024
> #define BITMAIN_MAX_DEAL_QUEUE_NUM 2
> #define BITMAIN_MAX_NONCE_NUM      128
> #define BITMAIN_MAX_CHAIN_NUM      8
75a102
> #define BITMAIN_READ_TIMEOUT 0 // Ignored
81a109
> #endif
89c117
< #else // S2
---
> #else // S2 or S3
90a119,121
> #ifdef USE_ANT_S3
> #define BITMAIN_SEND_FULL_SPACE    256
> #else
92a124
> #endif
129c161,162
< 	uint8_t reserved[2];
---
> 	uint8_t chain_check_time;
> 	uint8_t reserved2;
137a171
> #ifdef USE_ANT_S1
139a174,176
> #else
> 	uint8_t voltage[2];
> #endif
281c318,319
< #else // S2
---
> #else // S2 or S3
> #ifndef USE_ANT_S3
282a321
> #endif
310d348
< 	int voltage;
312c350,353
< #ifdef USE_ANT_S2
---
> #ifdef USE_ANT_S1
> 	int voltage;
> #else
> 	uint8_t voltage[2];
368a410,440
> 
> 	uint64_t fill_calls;
> 	uint64_t fill_nospace;
> 	uint64_t fifo_checks;
> 	uint64_t fill_neededless;
> 	uint64_t fill_totalneeded;
> 	uint64_t fill_need[BITMAIN_MAX_WORK_NUM+1];
> 	uint64_t fill_want;
> 	uint64_t fill_nowork;
> 	uint64_t fill_roll;
> 	int fill_rollmin;
> 	int fill_rollmax;
> 	uint64_t fill_rolltot;
> 	uint64_t fill_toosmall;
> 	uint64_t fill_less;
> 	uint64_t fill_sends;
> 	uint64_t fill_totalsend;
> 	uint64_t fill_send[BITMAIN_MAX_WORK_NUM+1];
> 	uint64_t fill_sendless[BITMAIN_MAX_WORK_NUM+1];
> 	uint64_t fill_seterr;
> 	uint64_t fill_senderr;
> 	uint64_t need_over;
> 	uint64_t need_nowork[BITMAIN_MAX_WORK_NUM+1];
> 	uint64_t fill_sendstatus;
> 	uint64_t read_good;
> 	uint64_t read_size;
> 	uint64_t read_18s;
> 	int read_sizemin;
> 	int read_sizemax;
> 	uint64_t read_bad;
> 	uint64_t readbuf_over;
379a452,454
> #ifdef USE_ANT_S3
> #define ALLOC_WITEMS 4096
> #else // S2
381a457
> #endif
388a465,467
> #ifdef USE_ANT_S3
> #define LIMIT_WITEMS 4096
> #else // S2
390a470
> #endif
410a491
> extern int opt_bitmain_workdelay;
418d498
< extern char *set_bitmain_freq(char *arg);
diff '--color=auto' cgminer-4.9.0/driver-blockerupter.c cgminer-4.10.0/driver-blockerupter.c
18d17
< #include <windows.h>
247,248c246,251
< 		     applog(LOG_DEBUG, "BlockErupter missing board: %d, received %02x",
< 			    i, answer);
---
> 			if (!i) {
> 				applog(LOG_DEBUG, "BlockErupter no boards found, likely not BET");
> 				break;
> 			}
> 			applog(LOG_DEBUG, "BlockErupter missing board: %d, received %02x",
> 			       i, answer);
253c256,257
< 		usb_free_cgpu(blockerupter);
---
> 		usb_uninit(blockerupter);
> 		blockerupter = usb_free_cgpu(blockerupter);
diff '--color=auto' cgminer-4.9.0/driver-hashfast.h cgminer-4.10.0/driver-hashfast.h
19,29c19,29
< int opt_hfa_ntime_roll;
< int opt_hfa_hash_clock;
< int opt_hfa_overheat;
< int opt_hfa_target;
< bool opt_hfa_pll_bypass;
< bool opt_hfa_dfu_boot;
< int opt_hfa_fan_default;
< int opt_hfa_fan_max;
< int opt_hfa_fan_min;
< int opt_hfa_fail_drop;
< bool opt_hfa_noshed;
---
> extern int opt_hfa_ntime_roll;
> extern int opt_hfa_hash_clock;
> extern int opt_hfa_overheat;
> extern int opt_hfa_target;
> extern bool opt_hfa_pll_bypass;
> extern bool opt_hfa_dfu_boot;
> extern int opt_hfa_fan_default;
> extern int opt_hfa_fan_max;
> extern int opt_hfa_fan_min;
> extern int opt_hfa_fail_drop;
> extern bool opt_hfa_noshed;
31,33c31,33
< char *set_hfa_fan(char *arg);
< char *opt_hfa_name;
< char *opt_hfa_options;
---
> extern char *set_hfa_fan(char *arg);
> extern char *opt_hfa_name;
> extern char *opt_hfa_options;
diff '--color=auto' cgminer-4.9.0/driver-hashratio.c cgminer-4.10.0/driver-hashratio.c
2c2
<  * Copyright 2013-2014 Con Kolivas <kernel@kolivas.org>
---
>  * Copyright 2013-2015 Con Kolivas <kernel@kolivas.org>
28d27
<   #include <windows.h>
83,95d81
< static inline uint8_t rev8(uint8_t d)
< {
< 	int i;
< 	uint8_t out = 0;
< 
< 	/* (from left to right) */
< 	for (i = 0; i < 8; i++)
< 		if (d & (1 << i))
< 		out |= (1 << (7 - i));
< 
< 	return out;
< }
< 
625,627c611
< 	hashratio->device_data = calloc(sizeof(struct hashratio_info), 1);
< 	if (unlikely(!(hashratio->device_data)))
< 		quit(1, "Failed to malloc hashratio_info");
---
> 	hashratio->device_data = cgcalloc(sizeof(struct hashratio_info), 1);
673,676c657
< 	align_len(&coinbase_len);
< 	pool_stratum->coinbase = calloc(coinbase_len, 1);
< 	if (unlikely(!pool_stratum->coinbase))
< 		quit(1, "Failed to calloc pool_stratum coinbase in hashratio");
---
> 	pool_stratum->coinbase = cgcalloc(coinbase_len, 1);
679d659
< 
683,684c663,664
< 		pool_stratum->swork.merkle_bin = realloc(pool_stratum->swork.merkle_bin,
< 						 sizeof(char *) * merkles + 1);
---
> 		pool_stratum->swork.merkle_bin = cgrealloc(pool_stratum->swork.merkle_bin,
> 							   sizeof(char *) * merkles + 1);
686,688c666
< 			pool_stratum->swork.merkle_bin[i] = malloc(32);
< 			if (unlikely(!pool_stratum->swork.merkle_bin[i]))
< 				quit(1, "Failed to malloc pool_stratum swork merkle_bin");
---
> 			pool_stratum->swork.merkle_bin[i] = cgmalloc(32);
diff '--color=auto' cgminer-4.9.0/driver-icarus.c cgminer-4.10.0/driver-icarus.c
4c4
<  * Copyright 2013-2014 Con Kolivas <kernel@kolivas.org>
---
>  * Copyright 2013-2015 Con Kolivas <kernel@kolivas.org>
45,48d44
< #ifdef WIN32
< #include <windows.h>
< #endif
< 
79c75,76
< #define ICARUS_WAIT_TIMEOUT (info->u3 ? AU3_WAIT_TIMEOUT : (info->ant ? ANT_WAIT_TIMEOUT : ICA_WAIT_TIMEOUT))
---
> #define GSC_WAIT_TIMEOUT 1
> #define ICARUS_WAIT_TIMEOUT (info->compac ? GSC_WAIT_TIMEOUT : (info->u3 ? AU3_WAIT_TIMEOUT : (info->ant ? ANT_WAIT_TIMEOUT : ICA_WAIT_TIMEOUT)))
100a98,99
> #define COMPAC_READ_COUNT_TIMING	5000
> 
124a124,125
> #define COMPAC_HASH_MHZ 0.0000000128
> #define COMPAC_HASH_TIME (COMPAC_HASH_MHZ / (double)(opt_compac_freq))
340a342,345
> 	bool compac;
> 	float compac_ramp_freq;
> 	float compac_target_freq;
> 	uint16_t compac_ramp_idx;
384a390,392
> #define COMPAC_DEFFREQ 150
> #define COMPAC_MAXFREQ 500
> 
403a412,473
> struct {
> 	float freq;
> 	uint16_t hex;
> } compacfreqtable[] = {
> 	{ 100,		0x0783 },
> 	{ 106.25,	0x0803 },
> 	{ 112.5,	0x0883 },
> 	{ 118.75,	0x0903 },
> 	{ 125,		0x0983 },
> 	{ 131.25,	0x0a03 },
> 	{ 137.5,	0x0a83 },
> 	{ 143.75,	0x1687 },
> 	{ 150,		0x0b83 },
> 	{ 156.25,	0x0c03 },
> 	{ 162.5,	0x0c83 },
> 	{ 168.75,	0x1a87 },
> 	{ 175,		0x0d83 },
> 	{ 181.25,	0x0e83 },
> 	{ 193.75,	0x0f03 },
> 	{ 196.88,	0x1f07 },
> 	{ 200,		0x0782 },
> 	{ 206.25,	0x1006 },
> 	{ 212.5,	0x1086 },
> 	{ 218.75,	0x1106 },
> 	{ 225,		0x0882 },
> 	{ 231.25,	0x1206 },
> 	{ 237.5,	0x1286 },
> 	{ 243.75,	0x1306 },
> 	{ 250,		0x0982 },
> 	{ 256.25,	0x1406 },
> 	{ 262.5,	0x0a02 },
> 	{ 268.75,	0x1506 },
> 	{ 275,		0x0a82 },
> 	{ 281.25,	0x1606 },
> 	{ 287.5,	0x0b02 },
> 	{ 293.75,	0x1706 },
> 	{ 300,		0x0b82 },
> 	{ 306.25,	0x1806 },
> 	{ 312.5,	0x0c02 },
> 	{ 318.75,	0x1906 },
> 	{ 325,		0x0c82 },
> 	{ 331.25,	0x1a06 },
> 	{ 337.5,	0x0d02 },
> 	{ 343.75,	0x1b06 },
> 	{ 350,		0x0d82 },
> 	{ 356.25,	0x1c06 },
> 	{ 362.5,	0x0e02 },
> 	{ 368.75,	0x1d06 },
> 	{ 375,		0x0e82 },
> 	{ 381.25,	0x1e06 },
> 	{ 387.5,	0x0f02 },
> 	{ 393.75,	0x1f06 },
> 	{ 400,		0x0f82 },
> 	{ 412.5,	0x1006 },
> 	{ 425,		0x0801 },
> 	{ 437.5,	0x1105 },
> 	{ 450,		0x0881 },
> 	{ 462.5,	0x1205 },
> 	{ 475,		0x0901 },
> 	{ 487.5,	0x1305 },
> 	{ 500,		0x0981 },
> };
565a636,637
> 		case IDENT_BSC:
> 		case IDENT_GSC:
732a805,809
> 		case IDENT_BSC:
> 		case IDENT_GSC:
> 			info->Hs = COMPAC_HASH_TIME;
> 			read_count_timing = COMPAC_READ_COUNT_TIMING;
> 			break;
824c901
< 	info->fail_time = fail_time;
---
> 	info->fail_time = fail_time + 1;
895a973,974
> 		case IDENT_BSC:
> 		case IDENT_GSC:
1193c1272
< 	unsigned char nonce_bin[ICARUS_READ_SIZE];
---
> 	unsigned char nonce_bin[ICARUS_BUF_SIZE];
1216,1218c1295
< 	info = (struct ICARUS_INFO *)calloc(1, sizeof(struct ICARUS_INFO));
< 	if (unlikely(!info))
< 		quit(1, "Failed to malloc ICARUS_INFO");
---
> 	info = cgcalloc(1, sizeof(struct ICARUS_INFO));
1232d1308
< 		case IDENT_AU3:
1234a1311,1313
> 		case IDENT_AU3:
> 			info->timeout = AU3_WAIT_TIMEOUT;
> 			break;
1431,1433c1510
< 			intmp = (struct ICARUS_INFO *)malloc(sizeof(struct ICARUS_INFO));
< 			if (unlikely(!intmp))
< 				quit(1, "Failed2 to malloc ICARUS_INFO");
---
> 			intmp = cgmalloc(sizeof(struct ICARUS_INFO));
1468a1546,1619
> static struct cgpu_info *compac_detect_one(struct libusb_device *dev, struct usb_find_devices *found)
> {
> 	struct ICARUS_INFO *info;
> 	struct timeval tv_start, tv_finish;
> 	struct cgpu_info *compac = usb_alloc_cgpu(&icarus_drv, 1);
> 
> 	if (!usb_init(compac, dev, found)) {
> 		compac = usb_free_cgpu(compac);
> 		return NULL;
> 	}
> 
> 	info = cgcalloc(1, sizeof(struct ICARUS_INFO));
> 	compac->device_data = info;
> 
> 	info->ident = usb_ident(compac);
> 
> 	if (info->ident == IDENT_BSC || info->ident == IDENT_GSC) {
> 		int this_option_offset = ++option_offset;
> 		const uint32_t golden_nonce_val = 0x000187a2;
> 		int baud, uninitialised_var(work_division), uninitialised_var(fpga_count);
> 		uint16_t compac_freq_hex;
> 
> 		applog(LOG_DEBUG, "%s %i: Detected GekkoScience Compac", compac->drv->name,
> 			   compac->device_id);
> 
> 		get_options(this_option_offset, compac, &baud, &work_division, &fpga_count);
> 
> 		info->compac_ramp_idx = 0;
> 		info->compac_ramp_freq = compacfreqtable[info->compac_ramp_idx].freq;
> 		info->compac_target_freq = opt_compac_freq;
> 
> 		compac_freq_hex = compacfreqtable[info->compac_ramp_idx].hex;
> 
> 		if (!set_anu_freq(compac, info, compac_freq_hex)) {
> 			applog(LOG_WARNING, "%s %i: Failed to set frequency, too much overclock?",
> 				   compac->drv->name, compac->device_id);
> 		}
> 
> 		applog(LOG_DEBUG, "%s %d: Init baud=%d work_division=%d fpga_count=%d",
> 			   compac->drv->name, compac->device_id, baud, work_division, fpga_count);
> 
> 		info->ant = true;
> 		info->compac = true;
> 		info->baud = baud;
> 		info->work_division = work_division;
> 		info->fpga_count = fpga_count;
> 		info->nonce_mask = mask(work_division);
> 		info->nonce_size = ANT_READ_SIZE;
> 
> 		if (add_cgpu(compac)) {
> 			char *tmp_str = cgmalloc(50 * sizeof(char));
> 
> 			strncpy(tmp_str,compac->unique_id,11);
> 			strncpy(compac->unique_id,"\0\0\0\0\0\0\0\0\0\0\0",11);
> 			strncpy(compac->unique_id,(tmp_str)+3*sizeof(char),8);
> 
> 			update_usb_stats(compac);
> 
> 			info->golden_hashes = (golden_nonce_val & info->nonce_mask) * fpga_count;
> 			timersub(&tv_finish, &tv_start, &(info->golden_tv));
> 
> 			set_timing_mode(this_option_offset, compac);
> 			return compac;
> 		}
> 	}
> 
> 	usb_uninit(compac);
> 	free(info);
> 	compac->device_data = NULL;
> 
> 	compac = usb_free_cgpu(compac);
> 	return NULL;
> }
> 
1513c1664
< 	unsigned char nonce_bin[ROCK_READ_SIZE];
---
> 	unsigned char nonce_bin[ICARUS_BUF_SIZE];
1542,1544c1693
< 	info = (struct ICARUS_INFO *)calloc(1, sizeof(struct ICARUS_INFO));
< 	if (unlikely(!info))
< 		quit(1, "Failed to malloc ICARUS_INFO");
---
> 	info = cgcalloc(1, sizeof(struct ICARUS_INFO));
1597a1747
> #if 0
1605a1756
> #endif
1717a1869
> 	usb_detect(&icarus_drv, compac_detect_one);
1727c1879
< 		info->antworks = calloc(sizeof(struct work *), ANT_QUEUE_NUM);
---
> 		info->antworks = cgcalloc(sizeof(struct work *), ANT_QUEUE_NUM);
1978a2131,2141
> 	if (info->compac && info->compac_ramp_freq < info->compac_target_freq) {
> 		uint16_t compac_freq_hex = compacfreqtable[++info->compac_ramp_idx].hex;
> 
> 		if (!set_anu_freq(icarus, info, compac_freq_hex)) {
> 			applog(LOG_WARNING, "%s %i: Failed to set frequency, too much overclock?",
> 				   icarus->drv->name, icarus->device_id);
> 			info->compac_target_freq = info->compac_ramp_freq;
> 		} else
> 			info->compac_ramp_freq = compacfreqtable[info->compac_ramp_idx].freq;
> 	}
> 
2388c2551,2553
< 		if (info->u3)
---
> 		if (info->compac)
> 			tailsprintf(buf, bufsiz, "%3.0fMHz", info->compac_ramp_freq);
> 		else if (info->u3)
diff '--color=auto' cgminer-4.9.0/driver-klondike.c cgminer-4.10.0/driver-klondike.c
24,27d23
< #ifdef WIN32
< #include <windows.h>
< #endif
< 
diff '--color=auto' cgminer-4.9.0/driver-spondoolies-sp10.c cgminer-4.10.0/driver-spondoolies-sp10.c
37,40d36
< #ifdef WIN32
< #include <windows.h>
< #endif
< 
146c142
< 	struct cgpu_info *cgpu = calloc(1, sizeof(*cgpu));
---
> 	struct cgpu_info *cgpu = cgcalloc(1, sizeof(*cgpu));
158,160c154
< 	cgpu->device_data = calloc(sizeof(struct spond_adapter), 1);
< 	if (unlikely(!(cgpu->device_data)))
< 		quit(1, "Failed to calloc cgpu_info data");
---
> 	cgpu->device_data = cgcalloc(sizeof(struct spond_adapter), 1);
diff '--color=auto' cgminer-4.9.0/driver-spondoolies-sp10-p.c cgminer-4.10.0/driver-spondoolies-sp10-p.c
2c2
<  * Copyright 2014 Con Kolivas <kernel@kolivas.org>
---
>  * Copyright 2014-2015 Con Kolivas <kernel@kolivas.org>
24c24
< 	minergate_req_packet *p  = (minergate_req_packet*)malloc(sizeof(minergate_req_packet));
---
> 	minergate_req_packet *p  = cgmalloc(sizeof(minergate_req_packet));
36c36
< 	minergate_rsp_packet *p  = (minergate_rsp_packet*)malloc(sizeof(minergate_rsp_packet));
---
> 	minergate_rsp_packet *p  = cgmalloc(sizeof(minergate_rsp_packet));
diff '--color=auto' cgminer-4.9.0/driver-spondoolies-sp10-p.h cgminer-4.10.0/driver-spondoolies-sp10-p.h
2c2
<  * Copyright 2014 Con Kolivas <kernel@kolivas.org>
---
>  * Copyright 2014-2015 Con Kolivas <kernel@kolivas.org>
15a16,17
> #include "config.h"
> 
26a29,31
> 
> #include "miner.h"
> #include "util.h"
diff '--color=auto' cgminer-4.9.0/driver-spondoolies-sp30.c cgminer-4.10.0/driver-spondoolies-sp30.c
37,40d36
< #ifdef WIN32
< #include <windows.h>
< #endif
< 
101d96
< 	printf("Init\n");
104,105c99
< 		printf("socket() failed\n");
< 		perror("Err:");
---
> 		applog(LOG_ERR, "SP30: socket error: %s", strerror(errno));
116,117c110
< 		printf("connect() failed\n");
< 		perror("Err:");
---
> 		applog(LOG_ERR, "SP30: socket connect error: %s", strerror(errno));
130c123
< 			printf("%d + %d != %d\n", a->works_in_minergate_and_pending_tx, a->works_pending_tx,a->works_in_driver);
---
> 			applog(LOG_DEBUG, "SP30: %d + %d != %d", a->works_in_minergate_and_pending_tx, a->works_pending_tx,a->works_in_driver);
134c127
< 			printf("FLUSH!\n");
---
> 			applog(LOG_DEBUG, "SP30: FLUSH!");
174c167
< 		printf("Error connecting to minergate server!");
---
> 		applog(LOG_ERR, "SP30: Failed to connect to minergate server");
183c176
< 	applog(LOG_DEBUG, "SPOND spondoolies_detect_sp30 done");
---
> 	applog(LOG_DEBUG, "SP30: SPOND spondoolies_detect_sp30 done");
371c364
< 		applog(LOG_DEBUG, "SPOND unable to open mg_rate_temp");
---
> 		applog(LOG_DEBUG, "SP30: SPOND unable to open mg_rate_temp");
381c374
< 	applog(LOG_DEBUG, "SPOND poll_stats rate: %d front: %d rear(T/B): %d/%d",
---
> 	applog(LOG_DEBUG, "SP30: SPOND poll_stats rate: %d front: %d rear(T/B): %d/%d",
447c440
< 					printf("Dropping minergate old job id=%d mrkl=%x my-mrkl=%x\n",
---
> 					applog(LOG_DEBUG, "SP30: Dropping minergate old job id=%d mrkl=%x my-mrkl=%x",
452c445
< 				printf("No cgminer job (id:%d res:%d)!\n",job_id, work->res);
---
> 				applog(LOG_DEBUG, "SP30: No cgminer job (id:%d res:%d)!",job_id, work->res);
diff '--color=auto' cgminer-4.9.0/driver-spondoolies-sp30-p.c cgminer-4.10.0/driver-spondoolies-sp30-p.c
1,12c1,9
< /*
<  * Copyright 2014 Zvi (Zvisha) Shteingart - Spondoolies-tech.com
<  *
<  * This program is free software; you can redistribute it and/or modify it
<  * under the terms of the GNU General Public License as published by the Free
<  * Software Foundation; either version 3 of the License, or (at your option)
<  * any later version.  See COPYING for more details.
<  */
< 
< /*
<  This file holds functions needed for minergate packet parsing/creation
< */
---
> /*
>  * Copyright 2015 Con Kolivas <kernel@kolivas.org>
>  * Copyright 2014 Zvi (Zvisha) Shteingart - Spondoolies-tech.com
>  *
>  * This program is free software; you can redistribute it and/or modify it
>  * under the terms of the GNU General Public License as published by the Free
>  * Software Foundation; either version 3 of the License, or (at your option)
>  * any later version.  See COPYING for more details.
>  */
14c11,15
< #include "driver-spondoolies-sp30-p.h"
---
> /*
>  This file holds functions needed for minergate packet parsing/creation
> */
> 
> #include "driver-spondoolies-sp30-p.h"
16,17c17,18
< //#include "spond_debug.h"
< 
---
> //#include "spond_debug.h"
> 
22,25c23,25
< minergate_req_packet_sp30 *allocate_minergate_packet_req_sp30(uint8_t requester_id,
<                                                         uint8_t request_id) {
<   minergate_req_packet_sp30 *p =
<       (minergate_req_packet_sp30 *)malloc(sizeof(minergate_req_packet_sp30));
---
> minergate_req_packet_sp30 *allocate_minergate_packet_req_sp30(uint8_t requester_id,
>                                                         uint8_t request_id) {
>   minergate_req_packet_sp30 *p = cgmalloc(sizeof(minergate_req_packet_sp30));
28c28
<   p->protocol_version = MINERGATE_PROTOCOL_VERSION_SP30;
---
>   p->protocol_version = MINERGATE_PROTOCOL_VERSION_SP30;
31c31
<   p->mask = 0;
---
>   p->mask = 0;
35c35
< minergate_rsp_packet_sp30 *allocate_minergate_packet_rsp_sp30(uint8_t requester_id,
---
> minergate_rsp_packet_sp30 *allocate_minergate_packet_rsp_sp30(uint8_t requester_id,
38,39c38
<   minergate_rsp_packet_sp30 *p =
<       (minergate_rsp_packet_sp30 *)malloc(sizeof(minergate_rsp_packet_sp30));
---
>   minergate_rsp_packet_sp30 *p = cgmalloc(sizeof(minergate_rsp_packet_sp30));
42c41
<   p->protocol_version = MINERGATE_PROTOCOL_VERSION_SP30;
---
>   p->protocol_version = MINERGATE_PROTOCOL_VERSION_SP30;
45c44
<   p->gh_div_50_rate= 0;
---
>   p->gh_div_50_rate= 0;
diff '--color=auto' cgminer-4.9.0/driver-spondoolies-sp30-p.h cgminer-4.10.0/driver-spondoolies-sp30-p.h
1a2
>  * Copyright 2015 Con Kolivas <kernel@kolivas.org>
15a17,18
> #include "config.h"
> 
24a28,29
> #include "miner.h"
> #include "util.h"
diff '--color=auto' cgminer-4.9.0/i2c-context.c cgminer-4.10.0/i2c-context.c
3a4
>  * Copyright 2014-2016 Mikeqin <Fengling.Qin@gmail.com>
12d12
< 
30d29
< 
71a71,94
> static bool i2c_slave_write_raw(struct i2c_ctx *ctx, uint8_t *buf, uint32_t len)
> {
> 	/* SMBus cann't support write bytes > 32, use plain i2c write */
> 	if (len != write(ctx->file, buf, len)) {
> 		applog(LOG_INFO, "i2c 0x%02x: failed to write raw to fdesc %d: %s",
> 		       ctx->addr, ctx->file, strerror(errno));
> 		return false;
> 	}
> 	applog(LOG_DEBUG, "I2C-W-RAW(0x%02x)", ctx->addr);
> 	return true;
> }
> 
> static bool i2c_slave_read_raw(struct i2c_ctx *ctx, uint8_t *buf, uint32_t len)
> {
> 	/* SMBus cann't support read bytes > 32, use plain i2c read */
> 	if (len != read(ctx->file, buf, len)) {
> 		applog(LOG_INFO, "i2c 0x%02x: failed to read raw from fdesc %d: %s",
> 		       ctx->addr, ctx->file, strerror(errno));
> 		return false;
> 	}
> 	applog(LOG_DEBUG, "I2C-R-RAW(0x%02x)", ctx->addr);
> 	return true;
> }
> 
84c107
< 		applog(LOG_INFO, "Failed to open i2c-1: %s", strerror(errno));
---
> 		applog(LOG_INFO, "Failed to open %s: %s", i2c_bus, strerror(errno));
99a123,124
> 	ctx->read_raw = i2c_slave_read_raw;
> 	ctx->write_raw = i2c_slave_write_raw;
diff '--color=auto' cgminer-4.9.0/i2c-context.h cgminer-4.10.0/i2c-context.h
14a15,18
> 	/* write multiple bytes to addr */
> 	bool (*write_raw)(struct i2c_ctx *ctx, uint8_t *buf, uint32_t len);
> 	/* read multiple bytes from addr */
> 	bool (*read_raw)(struct i2c_ctx *ctx, uint8_t *buf, uint32_t len);
diff '--color=auto' cgminer-4.9.0/install-sh cgminer-4.10.0/install-sh
4c4
< scriptversion=2011-11-20.07; # UTC
---
> scriptversion=2014-09-12.12; # UTC
43a44
> tab='	'
46c47
< IFS=" ""	$nl"
---
> IFS=" $tab$nl"
48c49
< # set DOITPROG to echo to test this script
---
> # Set DOITPROG to "echo" to test this script.
50d50
< # Don't use :- since 4.3BSD and earlier shells don't like it.
52,56c52
< if test -z "$doit"; then
<   doit_exec=exec
< else
<   doit_exec=$doit
< fi
---
> doit_exec=${doit:-exec}
71,81d66
< posix_glob='?'
< initialize_posix_glob='
<   test "$posix_glob" != "?" || {
<     if (set -f) 2>/dev/null; then
<       posix_glob=
<     else
<       posix_glob=:
<     fi
<   }
< '
< 
100c85
< no_target_directory=
---
> is_target_a_directory=possibly
140c125
< 	shift;;
---
>         shift;;
145,151c130,135
< 	case $mode in
< 	  *' '* | *'	'* | *'
< '*	  | *'*'* | *'?'* | *'['*)
< 	    echo "$0: invalid mode: $mode" >&2
< 	    exit 1;;
< 	esac
< 	shift;;
---
>         case $mode in
>           *' '* | *"$tab"* | *"$nl"* | *'*'* | *'?'* | *'['*)
>             echo "$0: invalid mode: $mode" >&2
>             exit 1;;
>         esac
>         shift;;
154c138
< 	shift;;
---
>         shift;;
158,163c142,149
<     -t) dst_arg=$2
< 	# Protect names problematic for 'test' and other utilities.
< 	case $dst_arg in
< 	  -* | [=\(\)!]) dst_arg=./$dst_arg;;
< 	esac
< 	shift;;
---
>     -t)
>         is_target_a_directory=always
>         dst_arg=$2
>         # Protect names problematic for 'test' and other utilities.
>         case $dst_arg in
>           -* | [=\(\)!]) dst_arg=./$dst_arg;;
>         esac
>         shift;;
165c151
<     -T) no_target_directory=true;;
---
>     -T) is_target_a_directory=never;;
169,170c155,156
<     --)	shift
< 	break;;
---
>     --) shift
>         break;;
172,173c158,159
<     -*)	echo "$0: invalid option: $1" >&2
< 	exit 1;;
---
>     -*) echo "$0: invalid option: $1" >&2
>         exit 1;;
179a166,175
> # We allow the use of options -d and -T together, by making -d
> # take the precedence; this is for compatibility with GNU install.
> 
> if test -n "$dir_arg"; then
>   if test -n "$dst_arg"; then
>     echo "$0: target directory not allowed when installing a directory." >&2
>     exit 1
>   fi
> fi
> 
210a207,215
>   if test $# -gt 1 || test "$is_target_a_directory" = always; then
>     if test ! -d "$dst_arg"; then
>       echo "$0: $dst_arg: Is not a directory." >&2
>       exit 1
>     fi
>   fi
> fi
> 
> if test -z "$dir_arg"; then
226c231
< 	u_plus_rw=
---
>         u_plus_rw=
228c233
< 	u_plus_rw='% 200'
---
>         u_plus_rw='% 200'
233c238
< 	u_plus_rw=
---
>         u_plus_rw=
235c240
< 	u_plus_rw=,u+rw
---
>         u_plus_rw=,u+rw
272,274c277,279
<       if test -n "$no_target_directory"; then
< 	echo "$0: $dst_arg: Is a directory" >&2
< 	exit 1
---
>       if test "$is_target_a_directory" = never; then
>         echo "$0: $dst_arg: Is a directory" >&2
>         exit 1
280,306c285
<       # Prefer dirname, but fall back on a substitute if dirname fails.
<       dstdir=`
< 	(dirname "$dst") 2>/dev/null ||
< 	expr X"$dst" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
< 	     X"$dst" : 'X\(//\)[^/]' \| \
< 	     X"$dst" : 'X\(//\)$' \| \
< 	     X"$dst" : 'X\(/\)' \| . 2>/dev/null ||
< 	echo X"$dst" |
< 	    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
< 		   s//\1/
< 		   q
< 		 }
< 		 /^X\(\/\/\)[^/].*/{
< 		   s//\1/
< 		   q
< 		 }
< 		 /^X\(\/\/\)$/{
< 		   s//\1/
< 		   q
< 		 }
< 		 /^X\(\/\).*/{
< 		   s//\1/
< 		   q
< 		 }
< 		 s/.*/./; q'
<       `
< 
---
>       dstdir=`dirname "$dst"`
317,378c296,364
< 	# Create intermediate dirs using mode 755 as modified by the umask.
< 	# This is like FreeBSD 'install' as of 1997-10-28.
< 	umask=`umask`
< 	case $stripcmd.$umask in
< 	  # Optimize common cases.
< 	  *[2367][2367]) mkdir_umask=$umask;;
< 	  .*0[02][02] | .[02][02] | .[02]) mkdir_umask=22;;
< 
< 	  *[0-7])
< 	    mkdir_umask=`expr $umask + 22 \
< 	      - $umask % 100 % 40 + $umask % 20 \
< 	      - $umask % 10 % 4 + $umask % 2
< 	    `;;
< 	  *) mkdir_umask=$umask,go-w;;
< 	esac
< 
< 	# With -d, create the new directory with the user-specified mode.
< 	# Otherwise, rely on $mkdir_umask.
< 	if test -n "$dir_arg"; then
< 	  mkdir_mode=-m$mode
< 	else
< 	  mkdir_mode=
< 	fi
< 
< 	posix_mkdir=false
< 	case $umask in
< 	  *[123567][0-7][0-7])
< 	    # POSIX mkdir -p sets u+wx bits regardless of umask, which
< 	    # is incompatible with FreeBSD 'install' when (umask & 300) != 0.
< 	    ;;
< 	  *)
< 	    tmpdir=${TMPDIR-/tmp}/ins$RANDOM-$$
< 	    trap 'ret=$?; rmdir "$tmpdir/d" "$tmpdir" 2>/dev/null; exit $ret' 0
< 
< 	    if (umask $mkdir_umask &&
< 		exec $mkdirprog $mkdir_mode -p -- "$tmpdir/d") >/dev/null 2>&1
< 	    then
< 	      if test -z "$dir_arg" || {
< 		   # Check for POSIX incompatibilities with -m.
< 		   # HP-UX 11.23 and IRIX 6.5 mkdir -m -p sets group- or
< 		   # other-writable bit of parent directory when it shouldn't.
< 		   # FreeBSD 6.1 mkdir -m -p sets mode of existing directory.
< 		   ls_ld_tmpdir=`ls -ld "$tmpdir"`
< 		   case $ls_ld_tmpdir in
< 		     d????-?r-*) different_mode=700;;
< 		     d????-?--*) different_mode=755;;
< 		     *) false;;
< 		   esac &&
< 		   $mkdirprog -m$different_mode -p -- "$tmpdir" && {
< 		     ls_ld_tmpdir_1=`ls -ld "$tmpdir"`
< 		     test "$ls_ld_tmpdir" = "$ls_ld_tmpdir_1"
< 		   }
< 		 }
< 	      then posix_mkdir=:
< 	      fi
< 	      rmdir "$tmpdir/d" "$tmpdir"
< 	    else
< 	      # Remove any dirs left behind by ancient mkdir implementations.
< 	      rmdir ./$mkdir_mode ./-p ./-- 2>/dev/null
< 	    fi
< 	    trap '' 0;;
< 	esac;;
---
>         # Create intermediate dirs using mode 755 as modified by the umask.
>         # This is like FreeBSD 'install' as of 1997-10-28.
>         umask=`umask`
>         case $stripcmd.$umask in
>           # Optimize common cases.
>           *[2367][2367]) mkdir_umask=$umask;;
>           .*0[02][02] | .[02][02] | .[02]) mkdir_umask=22;;
> 
>           *[0-7])
>             mkdir_umask=`expr $umask + 22 \
>               - $umask % 100 % 40 + $umask % 20 \
>               - $umask % 10 % 4 + $umask % 2
>             `;;
>           *) mkdir_umask=$umask,go-w;;
>         esac
> 
>         # With -d, create the new directory with the user-specified mode.
>         # Otherwise, rely on $mkdir_umask.
>         if test -n "$dir_arg"; then
>           mkdir_mode=-m$mode
>         else
>           mkdir_mode=
>         fi
> 
>         posix_mkdir=false
>         case $umask in
>           *[123567][0-7][0-7])
>             # POSIX mkdir -p sets u+wx bits regardless of umask, which
>             # is incompatible with FreeBSD 'install' when (umask & 300) != 0.
>             ;;
>           *)
>             # $RANDOM is not portable (e.g. dash);  use it when possible to
>             # lower collision chance
>             tmpdir=${TMPDIR-/tmp}/ins$RANDOM-$$
>             trap 'ret=$?; rmdir "$tmpdir/a/b" "$tmpdir/a" "$tmpdir" 2>/dev/null; exit $ret' 0
> 
>             # As "mkdir -p" follows symlinks and we work in /tmp possibly;  so
>             # create the $tmpdir first (and fail if unsuccessful) to make sure
>             # that nobody tries to guess the $tmpdir name.
>             if (umask $mkdir_umask &&
>                 $mkdirprog $mkdir_mode "$tmpdir" &&
>                 exec $mkdirprog $mkdir_mode -p -- "$tmpdir/a/b") >/dev/null 2>&1
>             then
>               if test -z "$dir_arg" || {
>                    # Check for POSIX incompatibilities with -m.
>                    # HP-UX 11.23 and IRIX 6.5 mkdir -m -p sets group- or
>                    # other-writable bit of parent directory when it shouldn't.
>                    # FreeBSD 6.1 mkdir -m -p sets mode of existing directory.
>                    test_tmpdir="$tmpdir/a"
>                    ls_ld_tmpdir=`ls -ld "$test_tmpdir"`
>                    case $ls_ld_tmpdir in
>                      d????-?r-*) different_mode=700;;
>                      d????-?--*) different_mode=755;;
>                      *) false;;
>                    esac &&
>                    $mkdirprog -m$different_mode -p -- "$test_tmpdir" && {
>                      ls_ld_tmpdir_1=`ls -ld "$test_tmpdir"`
>                      test "$ls_ld_tmpdir" = "$ls_ld_tmpdir_1"
>                    }
>                  }
>               then posix_mkdir=:
>               fi
>               rmdir "$tmpdir/a/b" "$tmpdir/a" "$tmpdir"
>             else
>               # Remove any dirs left behind by ancient mkdir implementations.
>               rmdir ./$mkdir_mode ./-p ./-- "$tmpdir" 2>/dev/null
>             fi
>             trap '' 0;;
>         esac;;
383,384c369,370
< 	umask $mkdir_umask &&
< 	$doit_exec $mkdirprog $mkdir_mode -p -- "$dstdir"
---
>         umask $mkdir_umask &&
>         $doit_exec $mkdirprog $mkdir_mode -p -- "$dstdir"
394,396c380,382
< 	/*) prefix='/';;
< 	[-=\(\)!]*) prefix='./';;
< 	*)  prefix='';;
---
>         /*) prefix='/';;
>         [-=\(\)!]*) prefix='./';;
>         *)  prefix='';;
399,400d384
<       eval "$initialize_posix_glob"
< 
403c387
<       $posix_glob set -f
---
>       set -f
406c390
<       $posix_glob set +f
---
>       set +f
413c397
< 	test X"$d" = X && continue
---
>         test X"$d" = X && continue
415,432c399,416
< 	prefix=$prefix$d
< 	if test -d "$prefix"; then
< 	  prefixes=
< 	else
< 	  if $posix_mkdir; then
< 	    (umask=$mkdir_umask &&
< 	     $doit_exec $mkdirprog $mkdir_mode -p -- "$dstdir") && break
< 	    # Don't fail if two instances are running concurrently.
< 	    test -d "$prefix" || exit 1
< 	  else
< 	    case $prefix in
< 	      *\'*) qprefix=`echo "$prefix" | sed "s/'/'\\\\\\\\''/g"`;;
< 	      *) qprefix=$prefix;;
< 	    esac
< 	    prefixes="$prefixes '$qprefix'"
< 	  fi
< 	fi
< 	prefix=$prefix/
---
>         prefix=$prefix$d
>         if test -d "$prefix"; then
>           prefixes=
>         else
>           if $posix_mkdir; then
>             (umask=$mkdir_umask &&
>              $doit_exec $mkdirprog $mkdir_mode -p -- "$dstdir") && break
>             # Don't fail if two instances are running concurrently.
>             test -d "$prefix" || exit 1
>           else
>             case $prefix in
>               *\'*) qprefix=`echo "$prefix" | sed "s/'/'\\\\\\\\''/g"`;;
>               *) qprefix=$prefix;;
>             esac
>             prefixes="$prefixes '$qprefix'"
>           fi
>         fi
>         prefix=$prefix/
436,440c420,424
< 	# Don't fail if two instances are running concurrently.
< 	(umask $mkdir_umask &&
< 	 eval "\$doit_exec \$mkdirprog $prefixes") ||
< 	  test -d "$dstdir" || exit 1
< 	obsolete_mkdir_used=true
---
>         # Don't fail if two instances are running concurrently.
>         (umask $mkdir_umask &&
>          eval "\$doit_exec \$mkdirprog $prefixes") ||
>           test -d "$dstdir" || exit 1
>         obsolete_mkdir_used=true
475,479c459,461
<        old=`LC_ALL=C ls -dlL "$dst"	2>/dev/null` &&
<        new=`LC_ALL=C ls -dlL "$dsttmp"	2>/dev/null` &&
< 
<        eval "$initialize_posix_glob" &&
<        $posix_glob set -f &&
---
>        old=`LC_ALL=C ls -dlL "$dst"     2>/dev/null` &&
>        new=`LC_ALL=C ls -dlL "$dsttmp"  2>/dev/null` &&
>        set -f &&
482,483c464
<        $posix_glob set +f &&
< 
---
>        set +f &&
496,510c477,491
< 	# Now remove or move aside any old file at destination location.
< 	# We try this two ways since rm can't unlink itself on some
< 	# systems and the destination file might be busy for other
< 	# reasons.  In this case, the final cleanup might fail but the new
< 	# file should still install successfully.
< 	{
< 	  test ! -f "$dst" ||
< 	  $doit $rmcmd -f "$dst" 2>/dev/null ||
< 	  { $doit $mvcmd -f "$dst" "$rmtmp" 2>/dev/null &&
< 	    { $doit $rmcmd -f "$rmtmp" 2>/dev/null; :; }
< 	  } ||
< 	  { echo "$0: cannot unlink or rename $dst" >&2
< 	    (exit 1); exit 1
< 	  }
< 	} &&
---
>         # Now remove or move aside any old file at destination location.
>         # We try this two ways since rm can't unlink itself on some
>         # systems and the destination file might be busy for other
>         # reasons.  In this case, the final cleanup might fail but the new
>         # file should still install successfully.
>         {
>           test ! -f "$dst" ||
>           $doit $rmcmd -f "$dst" 2>/dev/null ||
>           { $doit $mvcmd -f "$dst" "$rmtmp" 2>/dev/null &&
>             { $doit $rmcmd -f "$rmtmp" 2>/dev/null; :; }
>           } ||
>           { echo "$0: cannot unlink or rename $dst" >&2
>             (exit 1); exit 1
>           }
>         } &&
512,513c493,494
< 	# Now rename the file to the real destination.
< 	$doit $mvcmd "$dsttmp" "$dst"
---
>         # Now rename the file to the real destination.
>         $doit $mvcmd "$dsttmp" "$dst"
Common subdirectories: cgminer-4.9.0/lib and cgminer-4.10.0/lib
diff '--color=auto' cgminer-4.9.0/libbitfury.c cgminer-4.10.0/libbitfury.c
2c2
<  * Copyright 2014 Con Kolivas
---
>  * Copyright 2014-2015 Con Kolivas
88c88
< 	memcpy(p->midstate, work->midstate, 32);
---
> 	cg_memcpy(p->midstate, work->midstate, 32);
175c175
< 	memcpy(&info->spibuf[info->spibufsz], buf, sz);
---
> 	cg_memcpy(&info->spibuf[info->spibufsz], buf, sz);
296c296
< 	memcpy(&buf[3], info->spibuf, info->spibufsz);
---
> 	cg_memcpy(&buf[3], info->spibuf, info->spibufsz);
350c350
< 	memcpy(localvec, p, 20 * 4);
---
> 	cg_memcpy(localvec, p, 20 * 4);
360c360
< 	memcpy(newbuf, info->spibuf + 4 + chip_n, 17 * 4);
---
> 	cg_memcpy(newbuf, info->spibuf + 4 + chip_n, 17 * 4);
379c379
< 			memcpy(oldbuf, newbuf, 17 * 4);
---
> 			cg_memcpy(oldbuf, newbuf, 17 * 4);
diff '--color=auto' cgminer-4.9.0/logging.c cgminer-4.10.0/logging.c
69a70
> 		int ms = (int)(tv.tv_usec / 1000);
72c73
< 		snprintf(datetime, sizeof(datetime), " [%d-%02d-%02d %02d:%02d:%02d] ",
---
> 		snprintf(datetime, sizeof(datetime), " [%d-%02d-%02d %02d:%02d:%02d.%03d] ",
78c79
< 			tm->tm_sec);
---
> 			tm->tm_sec, ms);
diff '--color=auto' cgminer-4.9.0/ltmain.sh cgminer-4.10.0/ltmain.sh
0a1,3
> #! /bin/sh
> ## DO NOT EDIT - This file generated from ./build-aux/ltmain.in
> ##               by inline-source v2014-01-03.01
2c5,6
< # libtool (GNU libtool) 2.4.2
---
> # libtool (GNU libtool) 2.4.6
> # Provide generalized library-building support services.
5,6c9
< # Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2003, 2004, 2005, 2006,
< # 2007, 2008, 2009, 2010, 2011 Free Software Foundation, Inc.
---
> # Copyright (C) 1996-2015 Free Software Foundation, Inc.
26,29c29
< # along with GNU Libtool; see the file COPYING.  If not, a copy
< # can be downloaded from http://www.gnu.org/licenses/gpl.html,
< # or obtained by writing to the Free Software Foundation, Inc.,
< # 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
---
> # along with this program.  If not, see <http://www.gnu.org/licenses/>.
31,79d30
< # Usage: $progname [OPTION]... [MODE-ARG]...
< #
< # Provide generalized library-building support services.
< #
< #       --config             show all configuration variables
< #       --debug              enable verbose shell tracing
< #   -n, --dry-run            display commands without modifying any files
< #       --features           display basic configuration information and exit
< #       --mode=MODE          use operation mode MODE
< #       --preserve-dup-deps  don't remove duplicate dependency libraries
< #       --quiet, --silent    don't print informational messages
< #       --no-quiet, --no-silent
< #                            print informational messages (default)
< #       --no-warn            don't display warning messages
< #       --tag=TAG            use configuration variables from tag TAG
< #   -v, --verbose            print more informational messages than default
< #       --no-verbose         don't print the extra informational messages
< #       --version            print version information
< #   -h, --help, --help-all   print short, long, or detailed help message
< #
< # MODE must be one of the following:
< #
< #         clean              remove files from the build directory
< #         compile            compile a source file into a libtool object
< #         execute            automatically set library path, then run a program
< #         finish             complete the installation of libtool libraries
< #         install            install libraries or executables
< #         link               create a library or an executable
< #         uninstall          remove libraries from an installed directory
< #
< # MODE-ARGS vary depending on the MODE.  When passed as first option,
< # `--mode=MODE' may be abbreviated as `MODE' or a unique abbreviation of that.
< # Try `$progname --help --mode=MODE' for a more detailed description of MODE.
< #
< # When reporting a bug, please describe a test case to reproduce it and
< # include the following information:
< #
< #         host-triplet:	$host
< #         shell:		$SHELL
< #         compiler:		$LTCC
< #         compiler flags:		$LTCFLAGS
< #         linker:		$LD (gnu? $with_gnu_ld)
< #         $progname:	(GNU libtool) 2.4.2 Debian-2.4.2-1.7ubuntu1
< #         automake:	$automake_version
< #         autoconf:	$autoconf_version
< #
< # Report bugs to <bug-libtool@gnu.org>.
< # GNU libtool home page: <http://www.gnu.org/software/libtool/>.
< # General help using GNU software: <http://www.gnu.org/gethelp/>.
83,85c34,35
< VERSION="2.4.2 Debian-2.4.2-1.7ubuntu1"
< TIMESTAMP=""
< package_revision=1.3337
---
> VERSION="2.4.6 Debian-2.4.6-1"
> package_revision=2.4.6
87,88c37,118
< # Be Bourne compatible
< if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
---
> 
> ## ------ ##
> ## Usage. ##
> ## ------ ##
> 
> # Run './libtool --help' for help with using this script from the
> # command line.
> 
> 
> ## ------------------------------- ##
> ## User overridable command paths. ##
> ## ------------------------------- ##
> 
> # After configure completes, it has a better idea of some of the
> # shell tools we need than the defaults used by the functions shared
> # with bootstrap, so set those here where they can still be over-
> # ridden by the user, but otherwise take precedence.
> 
> : ${AUTOCONF="autoconf"}
> : ${AUTOMAKE="automake"}
> 
> 
> ## -------------------------- ##
> ## Source external libraries. ##
> ## -------------------------- ##
> 
> # Much of our low-level functionality needs to be sourced from external
> # libraries, which are installed to $pkgauxdir.
> 
> # Set a version string for this script.
> scriptversion=2015-01-20.17; # UTC
> 
> # General shell script boiler plate, and helper functions.
> # Written by Gary V. Vaughan, 2004
> 
> # Copyright (C) 2004-2015 Free Software Foundation, Inc.
> # This is free software; see the source for copying conditions.  There is NO
> # warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
> 
> # This program is free software; you can redistribute it and/or modify
> # it under the terms of the GNU General Public License as published by
> # the Free Software Foundation; either version 3 of the License, or
> # (at your option) any later version.
> 
> # As a special exception to the GNU General Public License, if you distribute
> # this file as part of a program or library that is built using GNU Libtool,
> # you may include this file under the same distribution terms that you use
> # for the rest of that program.
> 
> # This program is distributed in the hope that it will be useful,
> # but WITHOUT ANY WARRANTY; without even the implied warranty of
> # MERCHANTABILITY or FITNES FOR A PARTICULAR PURPOSE. See the GNU
> # General Public License for more details.
> 
> # You should have received a copy of the GNU General Public License
> # along with this program. If not, see <http://www.gnu.org/licenses/>.
> 
> # Please report bugs or propose patches to gary@gnu.org.
> 
> 
> ## ------ ##
> ## Usage. ##
> ## ------ ##
> 
> # Evaluate this file near the top of your script to gain access to
> # the functions and variables defined here:
> #
> #   . `echo "$0" | ${SED-sed} 's|[^/]*$||'`/build-aux/funclib.sh
> #
> # If you need to override any of the default environment variable
> # settings, do that before evaluating this file.
> 
> 
> ## -------------------- ##
> ## Shell normalisation. ##
> ## -------------------- ##
> 
> # Some shells need a little help to be as Bourne compatible as possible.
> # Before doing anything else, make sure all that help has been provided!
> 
> DUALCASE=1; export DUALCASE # for MKS sh
> if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then :
91c121
<   # Zsh 3.x and 4.x performs word splitting on ${1+"$@"}, which
---
>   # Pre-4.2 versions of Zsh do word splitting on ${1+"$@"}, which
96c126
<   case `(set -o) 2>/dev/null` in *posix*) set -o posix;; esac
---
>   case `(set -o) 2>/dev/null` in *posix*) set -o posix ;; esac
98,107d127
< BIN_SH=xpg4; export BIN_SH # for Tru64
< DUALCASE=1; export DUALCASE # for MKS sh
< 
< # A function that is used when there is no print builtin or printf.
< func_fallback_echo ()
< {
<   eval 'cat <<_LTECHO_EOF
< $1
< _LTECHO_EOF'
< }
109,112c129,132
< # NLS nuisances: We save the old values to restore during execute mode.
< lt_user_locale=
< lt_safe_locale=
< for lt_var in LANG LANGUAGE LC_ALL LC_CTYPE LC_COLLATE LC_MESSAGES
---
> # NLS nuisances: We save the old values in case they are required later.
> _G_user_locale=
> _G_safe_locale=
> for _G_var in LANG LANGUAGE LC_ALL LC_CTYPE LC_COLLATE LC_MESSAGES
114,119c134,139
<   eval "if test \"\${$lt_var+set}\" = set; then
<           save_$lt_var=\$$lt_var
<           $lt_var=C
< 	  export $lt_var
< 	  lt_user_locale=\"$lt_var=\\\$save_\$lt_var; \$lt_user_locale\"
< 	  lt_safe_locale=\"$lt_var=C; \$lt_safe_locale\"
---
>   eval "if test set = \"\${$_G_var+set}\"; then
>           save_$_G_var=\$$_G_var
>           $_G_var=C
> 	  export $_G_var
> 	  _G_user_locale=\"$_G_var=\\\$save_\$_G_var; \$_G_user_locale\"
> 	  _G_safe_locale=\"$_G_var=C; \$_G_safe_locale\"
122,124d141
< LC_ALL=C
< LANGUAGE=C
< export LANGUAGE LC_ALL
126c143,150
< $lt_unset CDPATH
---
> # CDPATH.
> (unset CDPATH) >/dev/null 2>&1 && unset CDPATH
> 
> # Make sure IFS has a sensible default
> sp=' '
> nl='
> '
> IFS="$sp	$nl"
127a152,165
> # There are apparently some retarded systems that use ';' as a PATH separator!
> if test "${PATH_SEPARATOR+set}" != set; then
>   PATH_SEPARATOR=:
>   (PATH='/bin;/bin'; FPATH=$PATH; sh -c :) >/dev/null 2>&1 && {
>     (PATH='/bin:/bin'; FPATH=$PATH; sh -c :) >/dev/null 2>&1 ||
>       PATH_SEPARATOR=';'
>   }
> fi
> 
> 
> 
> ## ------------------------- ##
> ## Locate command utilities. ##
> ## ------------------------- ##
129,134d166
< # Work around backward compatibility issue on IRIX 6.5. On IRIX 6.4+, sh
< # is ksh but when the shell is invoked as "sh" and the current value of
< # the _XPG environment variable is not equal to 1 (one), the special
< # positional parameter $0, within a function call, is the name of the
< # function.
< progpath="$0"
135a168,174
> # func_executable_p FILE
> # ----------------------
> # Check that FILE is an executable regular file.
> func_executable_p ()
> {
>     test -f "$1" && test -x "$1"
> }
137a177,311
> # func_path_progs PROGS_LIST CHECK_FUNC [PATH]
> # --------------------------------------------
> # Search for either a program that responds to --version with output
> # containing "GNU", or else returned by CHECK_FUNC otherwise, by
> # trying all the directories in PATH with each of the elements of
> # PROGS_LIST.
> #
> # CHECK_FUNC should accept the path to a candidate program, and
> # set $func_check_prog_result if it truncates its output less than
> # $_G_path_prog_max characters.
> func_path_progs ()
> {
>     _G_progs_list=$1
>     _G_check_func=$2
>     _G_PATH=${3-"$PATH"}
> 
>     _G_path_prog_max=0
>     _G_path_prog_found=false
>     _G_save_IFS=$IFS; IFS=${PATH_SEPARATOR-:}
>     for _G_dir in $_G_PATH; do
>       IFS=$_G_save_IFS
>       test -z "$_G_dir" && _G_dir=.
>       for _G_prog_name in $_G_progs_list; do
>         for _exeext in '' .EXE; do
>           _G_path_prog=$_G_dir/$_G_prog_name$_exeext
>           func_executable_p "$_G_path_prog" || continue
>           case `"$_G_path_prog" --version 2>&1` in
>             *GNU*) func_path_progs_result=$_G_path_prog _G_path_prog_found=: ;;
>             *)     $_G_check_func $_G_path_prog
> 		   func_path_progs_result=$func_check_prog_result
> 		   ;;
>           esac
>           $_G_path_prog_found && break 3
>         done
>       done
>     done
>     IFS=$_G_save_IFS
>     test -z "$func_path_progs_result" && {
>       echo "no acceptable sed could be found in \$PATH" >&2
>       exit 1
>     }
> }
> 
> 
> # We want to be able to use the functions in this file before configure
> # has figured out where the best binaries are kept, which means we have
> # to search for them ourselves - except when the results are already set
> # where we skip the searches.
> 
> # Unless the user overrides by setting SED, search the path for either GNU
> # sed, or the sed that truncates its output the least.
> test -z "$SED" && {
>   _G_sed_script=s/aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa/bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb/
>   for _G_i in 1 2 3 4 5 6 7; do
>     _G_sed_script=$_G_sed_script$nl$_G_sed_script
>   done
>   echo "$_G_sed_script" 2>/dev/null | sed 99q >conftest.sed
>   _G_sed_script=
> 
>   func_check_prog_sed ()
>   {
>     _G_path_prog=$1
> 
>     _G_count=0
>     printf 0123456789 >conftest.in
>     while :
>     do
>       cat conftest.in conftest.in >conftest.tmp
>       mv conftest.tmp conftest.in
>       cp conftest.in conftest.nl
>       echo '' >> conftest.nl
>       "$_G_path_prog" -f conftest.sed <conftest.nl >conftest.out 2>/dev/null || break
>       diff conftest.out conftest.nl >/dev/null 2>&1 || break
>       _G_count=`expr $_G_count + 1`
>       if test "$_G_count" -gt "$_G_path_prog_max"; then
>         # Best one so far, save it but keep looking for a better one
>         func_check_prog_result=$_G_path_prog
>         _G_path_prog_max=$_G_count
>       fi
>       # 10*(2^10) chars as input seems more than enough
>       test 10 -lt "$_G_count" && break
>     done
>     rm -f conftest.in conftest.tmp conftest.nl conftest.out
>   }
> 
>   func_path_progs "sed gsed" func_check_prog_sed $PATH:/usr/xpg4/bin
>   rm -f conftest.sed
>   SED=$func_path_progs_result
> }
> 
> 
> # Unless the user overrides by setting GREP, search the path for either GNU
> # grep, or the grep that truncates its output the least.
> test -z "$GREP" && {
>   func_check_prog_grep ()
>   {
>     _G_path_prog=$1
> 
>     _G_count=0
>     _G_path_prog_max=0
>     printf 0123456789 >conftest.in
>     while :
>     do
>       cat conftest.in conftest.in >conftest.tmp
>       mv conftest.tmp conftest.in
>       cp conftest.in conftest.nl
>       echo 'GREP' >> conftest.nl
>       "$_G_path_prog" -e 'GREP$' -e '-(cannot match)-' <conftest.nl >conftest.out 2>/dev/null || break
>       diff conftest.out conftest.nl >/dev/null 2>&1 || break
>       _G_count=`expr $_G_count + 1`
>       if test "$_G_count" -gt "$_G_path_prog_max"; then
>         # Best one so far, save it but keep looking for a better one
>         func_check_prog_result=$_G_path_prog
>         _G_path_prog_max=$_G_count
>       fi
>       # 10*(2^10) chars as input seems more than enough
>       test 10 -lt "$_G_count" && break
>     done
>     rm -f conftest.in conftest.tmp conftest.nl conftest.out
>   }
> 
>   func_path_progs "grep ggrep" func_check_prog_grep $PATH:/usr/xpg4/bin
>   GREP=$func_path_progs_result
> }
> 
> 
> ## ------------------------------- ##
> ## User overridable command paths. ##
> ## ------------------------------- ##
> 
> # All uppercase variable names are used for environment variables.  These
> # variables can be overridden by the user before calling a script that
> # uses them if a suitable command of that name is not already available
> # in the command search PATH.
> 
139c313,316
< test "${ECHO+set}" = set || ECHO=${as_echo-'printf %s\n'}
---
> : ${ECHO="printf %s\n"}
> : ${EGREP="$GREP -E"}
> : ${FGREP="$GREP -F"}
> : ${LN_S="ln -s"}
145,153d321
< : ${Xsed="$SED -e 1s/^X//"}
< 
< # Global variables:
< EXIT_SUCCESS=0
< EXIT_FAILURE=1
< EXIT_MISMATCH=63  # $? = 63 is used to indicate version mismatch to missing.
< EXIT_SKIP=77	  # $? = 77 is used to indicate a skipped test to automake.
< 
< exit_status=$EXIT_SUCCESS
155,158d322
< # Make sure IFS has a sensible default
< lt_nl='
< '
< IFS=" 	$lt_nl"
160,174c324,326
< dirname="s,/[^/]*$,,"
< basename="s,^.*/,,"
< 
< # func_dirname file append nondir_replacement
< # Compute the dirname of FILE.  If nonempty, add APPEND to the result,
< # otherwise set result to NONDIR_REPLACEMENT.
< func_dirname ()
< {
<     func_dirname_result=`$ECHO "${1}" | $SED "$dirname"`
<     if test "X$func_dirname_result" = "X${1}"; then
<       func_dirname_result="${3}"
<     else
<       func_dirname_result="$func_dirname_result${2}"
<     fi
< } # func_dirname may be replaced by extended shell implementation
---
> ## -------------------- ##
> ## Useful sed snippets. ##
> ## -------------------- ##
175a328,329
> sed_dirname='s|/[^/]*$||'
> sed_basename='s|^.*/||'
177,181c331,333
< # func_basename file
< func_basename ()
< {
<     func_basename_result=`$ECHO "${1}" | $SED "$basename"`
< } # func_basename may be replaced by extended shell implementation
---
> # Sed substitution that helps us do robust quoting.  It backslashifies
> # metacharacters that are still active within double-quoted strings.
> sed_quote_subst='s|\([`"$\\]\)|\\\1|g'
182a335,336
> # Same as above, but do not quote variable references.
> sed_double_quote_subst='s/\(["`\\]\)/\\\1/g'
184,206c338,340
< # func_dirname_and_basename file append nondir_replacement
< # perform func_basename and func_dirname in a single function
< # call:
< #   dirname:  Compute the dirname of FILE.  If nonempty,
< #             add APPEND to the result, otherwise set result
< #             to NONDIR_REPLACEMENT.
< #             value returned in "$func_dirname_result"
< #   basename: Compute filename of FILE.
< #             value retuned in "$func_basename_result"
< # Implementation must be kept synchronized with func_dirname
< # and func_basename. For efficiency, we do not delegate to
< # those functions but instead duplicate the functionality here.
< func_dirname_and_basename ()
< {
<     # Extract subdirectory from the argument.
<     func_dirname_result=`$ECHO "${1}" | $SED -e "$dirname"`
<     if test "X$func_dirname_result" = "X${1}"; then
<       func_dirname_result="${3}"
<     else
<       func_dirname_result="$func_dirname_result${2}"
<     fi
<     func_basename_result=`$ECHO "${1}" | $SED -e "$basename"`
< } # func_dirname_and_basename may be replaced by extended shell implementation
---
> # Sed substitution that turns a string into a regex matching for the
> # string literally.
> sed_make_literal_regex='s|[].[^$\\*\/]|\\&|g'
207a342,345
> # Sed substitution that converts a w32 file name or path
> # that contains forward slashes, into one that contains
> # (escaped) backslashes.  A very naive implementation.
> sed_naive_backslashify='s|\\\\*|\\|g;s|/|\\|g;s|\\|\\\\|g'
209,221c347,361
< # func_stripname prefix suffix name
< # strip PREFIX and SUFFIX off of NAME.
< # PREFIX and SUFFIX must not contain globbing or regex special
< # characters, hashes, percent signs, but SUFFIX may contain a leading
< # dot (in which case that matches only a dot).
< # func_strip_suffix prefix name
< func_stripname ()
< {
<     case ${2} in
<       .*) func_stripname_result=`$ECHO "${3}" | $SED "s%^${1}%%; s%\\\\${2}\$%%"`;;
<       *)  func_stripname_result=`$ECHO "${3}" | $SED "s%^${1}%%; s%${2}\$%%"`;;
<     esac
< } # func_stripname may be replaced by extended shell implementation
---
> # Re-'\' parameter expansions in output of sed_double_quote_subst that
> # were '\'-ed in input to the same.  If an odd number of '\' preceded a
> # '$' in input to sed_double_quote_subst, that '$' was protected from
> # expansion.  Since each input '\' is now two '\'s, look for any number
> # of runs of four '\'s followed by two '\'s and then a '$'.  '\' that '$'.
> _G_bs='\\'
> _G_bs2='\\\\'
> _G_bs4='\\\\\\\\'
> _G_dollar='\$'
> sed_double_backslash="\
>   s/$_G_bs4/&\\
> /g
>   s/^$_G_bs2$_G_dollar/$_G_bs&/
>   s/\\([^$_G_bs]\\)$_G_bs2$_G_dollar/\\1$_G_bs2$_G_bs$_G_dollar/g
>   s/\n//g"
224,232c364,379
< # These SED scripts presuppose an absolute path with a trailing slash.
< pathcar='s,^/\([^/]*\).*$,\1,'
< pathcdr='s,^/[^/]*,,'
< removedotparts=':dotsl
< 		s@/\./@/@g
< 		t dotsl
< 		s,/\.$,/,'
< collapseslashes='s@/\{1,\}@/@g'
< finalslash='s,/*$,/,'
---
> ## ----------------- ##
> ## Global variables. ##
> ## ----------------- ##
> 
> # Except for the global variables explicitly listed below, the following
> # functions in the '^func_' namespace, and the '^require_' namespace
> # variables initialised in the 'Resource management' section, sourcing
> # this file will not pollute your global namespace with anything
> # else. There's no portable way to scope variables in Bourne shell
> # though, so actually running these functions will sometimes place
> # results into a variable named after the function, and often use
> # temporary variables in the '^_G_' namespace. If you are careful to
> # avoid using those namespaces casually in your sourcing script, things
> # should continue to work as you expect. And, of course, you can freely
> # overwrite any of the functions or variables defined here before
> # calling anything to customize them.
234,308c381,384
< # func_normal_abspath PATH
< # Remove doubled-up and trailing slashes, "." path components,
< # and cancel out any ".." path components in PATH after making
< # it an absolute path.
< #             value returned in "$func_normal_abspath_result"
< func_normal_abspath ()
< {
<   # Start from root dir and reassemble the path.
<   func_normal_abspath_result=
<   func_normal_abspath_tpath=$1
<   func_normal_abspath_altnamespace=
<   case $func_normal_abspath_tpath in
<     "")
<       # Empty path, that just means $cwd.
<       func_stripname '' '/' "`pwd`"
<       func_normal_abspath_result=$func_stripname_result
<       return
<     ;;
<     # The next three entries are used to spot a run of precisely
<     # two leading slashes without using negated character classes;
<     # we take advantage of case's first-match behaviour.
<     ///*)
<       # Unusual form of absolute path, do nothing.
<     ;;
<     //*)
<       # Not necessarily an ordinary path; POSIX reserves leading '//'
<       # and for example Cygwin uses it to access remote file shares
<       # over CIFS/SMB, so we conserve a leading double slash if found.
<       func_normal_abspath_altnamespace=/
<     ;;
<     /*)
<       # Absolute path, do nothing.
<     ;;
<     *)
<       # Relative path, prepend $cwd.
<       func_normal_abspath_tpath=`pwd`/$func_normal_abspath_tpath
<     ;;
<   esac
<   # Cancel out all the simple stuff to save iterations.  We also want
<   # the path to end with a slash for ease of parsing, so make sure
<   # there is one (and only one) here.
<   func_normal_abspath_tpath=`$ECHO "$func_normal_abspath_tpath" | $SED \
<         -e "$removedotparts" -e "$collapseslashes" -e "$finalslash"`
<   while :; do
<     # Processed it all yet?
<     if test "$func_normal_abspath_tpath" = / ; then
<       # If we ascended to the root using ".." the result may be empty now.
<       if test -z "$func_normal_abspath_result" ; then
<         func_normal_abspath_result=/
<       fi
<       break
<     fi
<     func_normal_abspath_tcomponent=`$ECHO "$func_normal_abspath_tpath" | $SED \
<         -e "$pathcar"`
<     func_normal_abspath_tpath=`$ECHO "$func_normal_abspath_tpath" | $SED \
<         -e "$pathcdr"`
<     # Figure out what to do with it
<     case $func_normal_abspath_tcomponent in
<       "")
<         # Trailing empty path component, ignore it.
<       ;;
<       ..)
<         # Parent dir; strip last assembled component from result.
<         func_dirname "$func_normal_abspath_result"
<         func_normal_abspath_result=$func_dirname_result
<       ;;
<       *)
<         # Actual path component, append it.
<         func_normal_abspath_result=$func_normal_abspath_result/$func_normal_abspath_tcomponent
<       ;;
<     esac
<   done
<   # Restore leading double-slash if one was found on entry.
<   func_normal_abspath_result=$func_normal_abspath_altnamespace$func_normal_abspath_result
< }
---
> EXIT_SUCCESS=0
> EXIT_FAILURE=1
> EXIT_MISMATCH=63  # $? = 63 is used to indicate version mismatch to missing.
> EXIT_SKIP=77	  # $? = 77 is used to indicate a skipped test to automake.
310,353c386,392
< # func_relative_path SRCDIR DSTDIR
< # generates a relative path from SRCDIR to DSTDIR, with a trailing
< # slash if non-empty, suitable for immediately appending a filename
< # without needing to append a separator.
< #             value returned in "$func_relative_path_result"
< func_relative_path ()
< {
<   func_relative_path_result=
<   func_normal_abspath "$1"
<   func_relative_path_tlibdir=$func_normal_abspath_result
<   func_normal_abspath "$2"
<   func_relative_path_tbindir=$func_normal_abspath_result
< 
<   # Ascend the tree starting from libdir
<   while :; do
<     # check if we have found a prefix of bindir
<     case $func_relative_path_tbindir in
<       $func_relative_path_tlibdir)
<         # found an exact match
<         func_relative_path_tcancelled=
<         break
<         ;;
<       $func_relative_path_tlibdir*)
<         # found a matching prefix
<         func_stripname "$func_relative_path_tlibdir" '' "$func_relative_path_tbindir"
<         func_relative_path_tcancelled=$func_stripname_result
<         if test -z "$func_relative_path_result"; then
<           func_relative_path_result=.
<         fi
<         break
<         ;;
<       *)
<         func_dirname $func_relative_path_tlibdir
<         func_relative_path_tlibdir=${func_dirname_result}
<         if test "x$func_relative_path_tlibdir" = x ; then
<           # Have to descend all the way to the root!
<           func_relative_path_result=../$func_relative_path_result
<           func_relative_path_tcancelled=$func_relative_path_tbindir
<           break
<         fi
<         func_relative_path_result=../$func_relative_path_result
<         ;;
<     esac
<   done
---
> # Allow overriding, eg assuming that you follow the convention of
> # putting '$debug_cmd' at the start of all your functions, you can get
> # bash to show function call trace with:
> #
> #    debug_cmd='eval echo "${FUNCNAME[0]} $*" >&2' bash your-script-name
> debug_cmd=${debug_cmd-":"}
> exit_cmd=:
355,361c394,401
<   # Now calculate path; take care to avoid doubling-up slashes.
<   func_stripname '' '/' "$func_relative_path_result"
<   func_relative_path_result=$func_stripname_result
<   func_stripname '/' '/' "$func_relative_path_tcancelled"
<   if test "x$func_stripname_result" != x ; then
<     func_relative_path_result=${func_relative_path_result}/${func_stripname_result}
<   fi
---
> # By convention, finish your script with:
> #
> #    exit $exit_status
> #
> # so that you can set exit_status to non-zero if you want to indicate
> # something went wrong during execution without actually bailing out at
> # the point of failure.
> exit_status=$EXIT_SUCCESS
363,370c403,408
<   # Normalisation. If bindir is libdir, return empty string,
<   # else relative path ending with a slash; either way, target
<   # file name can be directly appended.
<   if test ! -z "$func_relative_path_result"; then
<     func_stripname './' '' "$func_relative_path_result/"
<     func_relative_path_result=$func_stripname_result
<   fi
< }
---
> # Work around backward compatibility issue on IRIX 6.5. On IRIX 6.4+, sh
> # is ksh but when the shell is invoked as "sh" and the current value of
> # the _XPG environment variable is not equal to 1 (one), the special
> # positional parameter $0, within a function call, is the name of the
> # function.
> progpath=$0
372,374c410,411
< # The name of this program:
< func_dirname_and_basename "$progpath"
< progname=$func_basename_result
---
> # The name of this program.
> progname=`$ECHO "$progpath" |$SED "$sed_basename"`
376c413
< # Make sure we have an absolute path for reexecution:
---
> # Make sure we have an absolute progpath for reexecution:
380c417
<      progdir=$func_dirname_result
---
>      progdir=`$ECHO "$progpath" |$SED "$sed_dirname"`
382c419
<      progpath="$progdir/$progname"
---
>      progpath=$progdir/$progname
385c422
<      save_IFS="$IFS"
---
>      _G_IFS=$IFS
388c425
<        IFS="$save_IFS"
---
>        IFS=$_G_IFS
391c428
<      IFS="$save_IFS"
---
>      IFS=$_G_IFS
393c430
<      progpath="$progdir/$progname"
---
>      progpath=$progdir/$progname
397,412d433
< # Sed substitution that helps us do robust quoting.  It backslashifies
< # metacharacters that are still active within double-quoted strings.
< Xsed="${SED}"' -e 1s/^X//'
< sed_quote_subst='s/\([`"$\\]\)/\\\1/g'
< 
< # Same as above, but do not quote variable references.
< double_quote_subst='s/\(["`\\]\)/\\\1/g'
< 
< # Sed substitution that turns a string into a regex matching for the
< # string literally.
< sed_make_literal_regex='s,[].[^$\\*\/],\\&,g'
< 
< # Sed substitution that converts a w32 file name or path
< # which contains forward slashes, into one that contains
< # (escaped) backslashes.  A very naive implementation.
< lt_sed_naive_backslashify='s|\\\\*|\\|g;s|/|\\|g;s|\\|\\\\|g'
414,428c435,441
< # Re-`\' parameter expansions in output of double_quote_subst that were
< # `\'-ed in input to the same.  If an odd number of `\' preceded a '$'
< # in input to double_quote_subst, that '$' was protected from expansion.
< # Since each input `\' is now two `\'s, look for any number of runs of
< # four `\'s followed by two `\'s and then a '$'.  `\' that '$'.
< bs='\\'
< bs2='\\\\'
< bs4='\\\\\\\\'
< dollar='\$'
< sed_double_backslash="\
<   s/$bs4/&\\
< /g
<   s/^$bs2$dollar/$bs&/
<   s/\\([^$bs]\\)$bs2$dollar/\\1$bs2$bs$dollar/g
<   s/\n//g"
---
> ## ----------------- ##
> ## Standard options. ##
> ## ----------------- ##
> 
> # The following options affect the operation of the functions defined
> # below, and should be set appropriately depending on run-time para-
> # meters passed on the command line.
430d442
< # Standard options:
432d443
< opt_help=false
435d445
< opt_warning=:
437,442c447,514
< # func_echo arg...
< # Echo program name prefixed message, along with the current mode
< # name if it has been set yet.
< func_echo ()
< {
<     $ECHO "$progname: ${opt_mode+$opt_mode: }$*"
---
> # Categories 'all' and 'none' are always available.  Append any others
> # you will pass as the first argument to func_warning from your own
> # code.
> warning_categories=
> 
> # By default, display warnings according to 'opt_warning_types'.  Set
> # 'warning_func'  to ':' to elide all warnings, or func_fatal_error to
> # treat the next displayed warning as a fatal error.
> warning_func=func_warn_and_continue
> 
> # Set to 'all' to display all warnings, 'none' to suppress all
> # warnings, or a space delimited list of some subset of
> # 'warning_categories' to display only the listed warnings.
> opt_warning_types=all
> 
> 
> ## -------------------- ##
> ## Resource management. ##
> ## -------------------- ##
> 
> # This section contains definitions for functions that each ensure a
> # particular resource (a file, or a non-empty configuration variable for
> # example) is available, and if appropriate to extract default values
> # from pertinent package files. Call them using their associated
> # 'require_*' variable to ensure that they are executed, at most, once.
> #
> # It's entirely deliberate that calling these functions can set
> # variables that don't obey the namespace limitations obeyed by the rest
> # of this file, in order that that they be as useful as possible to
> # callers.
> 
> 
> # require_term_colors
> # -------------------
> # Allow display of bold text on terminals that support it.
> require_term_colors=func_require_term_colors
> func_require_term_colors ()
> {
>     $debug_cmd
> 
>     test -t 1 && {
>       # COLORTERM and USE_ANSI_COLORS environment variables take
>       # precedence, because most terminfo databases neglect to describe
>       # whether color sequences are supported.
>       test -n "${COLORTERM+set}" && : ${USE_ANSI_COLORS="1"}
> 
>       if test 1 = "$USE_ANSI_COLORS"; then
>         # Standard ANSI escape sequences
>         tc_reset='[0m'
>         tc_bold='[1m';   tc_standout='[7m'
>         tc_red='[31m';   tc_green='[32m'
>         tc_blue='[34m';  tc_cyan='[36m'
>       else
>         # Otherwise trust the terminfo database after all.
>         test -n "`tput sgr0 2>/dev/null`" && {
>           tc_reset=`tput sgr0`
>           test -n "`tput bold 2>/dev/null`" && tc_bold=`tput bold`
>           tc_standout=$tc_bold
>           test -n "`tput smso 2>/dev/null`" && tc_standout=`tput smso`
>           test -n "`tput setaf 1 2>/dev/null`" && tc_red=`tput setaf 1`
>           test -n "`tput setaf 2 2>/dev/null`" && tc_green=`tput setaf 2`
>           test -n "`tput setaf 4 2>/dev/null`" && tc_blue=`tput setaf 4`
>           test -n "`tput setaf 5 2>/dev/null`" && tc_cyan=`tput setaf 5`
>         }
>       fi
>     }
> 
>     require_term_colors=:
445,447c517,670
< # func_verbose arg...
< # Echo program name prefixed message in verbose mode only.
< func_verbose ()
---
> 
> ## ----------------- ##
> ## Function library. ##
> ## ----------------- ##
> 
> # This section contains a variety of useful functions to call in your
> # scripts. Take note of the portable wrappers for features provided by
> # some modern shells, which will fall back to slower equivalents on
> # less featureful shells.
> 
> 
> # func_append VAR VALUE
> # ---------------------
> # Append VALUE onto the existing contents of VAR.
> 
>   # We should try to minimise forks, especially on Windows where they are
>   # unreasonably slow, so skip the feature probes when bash or zsh are
>   # being used:
>   if test set = "${BASH_VERSION+set}${ZSH_VERSION+set}"; then
>     : ${_G_HAVE_ARITH_OP="yes"}
>     : ${_G_HAVE_XSI_OPS="yes"}
>     # The += operator was introduced in bash 3.1
>     case $BASH_VERSION in
>       [12].* | 3.0 | 3.0*) ;;
>       *)
>         : ${_G_HAVE_PLUSEQ_OP="yes"}
>         ;;
>     esac
>   fi
> 
>   # _G_HAVE_PLUSEQ_OP
>   # Can be empty, in which case the shell is probed, "yes" if += is
>   # useable or anything else if it does not work.
>   test -z "$_G_HAVE_PLUSEQ_OP" \
>     && (eval 'x=a; x+=" b"; test "a b" = "$x"') 2>/dev/null \
>     && _G_HAVE_PLUSEQ_OP=yes
> 
> if test yes = "$_G_HAVE_PLUSEQ_OP"
> then
>   # This is an XSI compatible shell, allowing a faster implementation...
>   eval 'func_append ()
>   {
>     $debug_cmd
> 
>     eval "$1+=\$2"
>   }'
> else
>   # ...otherwise fall back to using expr, which is often a shell builtin.
>   func_append ()
>   {
>     $debug_cmd
> 
>     eval "$1=\$$1\$2"
>   }
> fi
> 
> 
> # func_append_quoted VAR VALUE
> # ----------------------------
> # Quote VALUE and append to the end of shell variable VAR, separated
> # by a space.
> if test yes = "$_G_HAVE_PLUSEQ_OP"; then
>   eval 'func_append_quoted ()
>   {
>     $debug_cmd
> 
>     func_quote_for_eval "$2"
>     eval "$1+=\\ \$func_quote_for_eval_result"
>   }'
> else
>   func_append_quoted ()
>   {
>     $debug_cmd
> 
>     func_quote_for_eval "$2"
>     eval "$1=\$$1\\ \$func_quote_for_eval_result"
>   }
> fi
> 
> 
> # func_append_uniq VAR VALUE
> # --------------------------
> # Append unique VALUE onto the existing contents of VAR, assuming
> # entries are delimited by the first character of VALUE.  For example:
> #
> #   func_append_uniq options " --another-option option-argument"
> #
> # will only append to $options if " --another-option option-argument "
> # is not already present somewhere in $options already (note spaces at
> # each end implied by leading space in second argument).
> func_append_uniq ()
> {
>     $debug_cmd
> 
>     eval _G_current_value='`$ECHO $'$1'`'
>     _G_delim=`expr "$2" : '\(.\)'`
> 
>     case $_G_delim$_G_current_value$_G_delim in
>       *"$2$_G_delim"*) ;;
>       *) func_append "$@" ;;
>     esac
> }
> 
> 
> # func_arith TERM...
> # ------------------
> # Set func_arith_result to the result of evaluating TERMs.
>   test -z "$_G_HAVE_ARITH_OP" \
>     && (eval 'test 2 = $(( 1 + 1 ))') 2>/dev/null \
>     && _G_HAVE_ARITH_OP=yes
> 
> if test yes = "$_G_HAVE_ARITH_OP"; then
>   eval 'func_arith ()
>   {
>     $debug_cmd
> 
>     func_arith_result=$(( $* ))
>   }'
> else
>   func_arith ()
>   {
>     $debug_cmd
> 
>     func_arith_result=`expr "$@"`
>   }
> fi
> 
> 
> # func_basename FILE
> # ------------------
> # Set func_basename_result to FILE with everything up to and including
> # the last / stripped.
> if test yes = "$_G_HAVE_XSI_OPS"; then
>   # If this shell supports suffix pattern removal, then use it to avoid
>   # forking. Hide the definitions single quotes in case the shell chokes
>   # on unsupported syntax...
>   _b='func_basename_result=${1##*/}'
>   _d='case $1 in
>         */*) func_dirname_result=${1%/*}$2 ;;
>         *  ) func_dirname_result=$3        ;;
>       esac'
> 
> else
>   # ...otherwise fall back to using sed.
>   _b='func_basename_result=`$ECHO "$1" |$SED "$sed_basename"`'
>   _d='func_dirname_result=`$ECHO "$1"  |$SED "$sed_dirname"`
>       if test "X$func_dirname_result" = "X$1"; then
>         func_dirname_result=$3
>       else
>         func_append func_dirname_result "$2"
>       fi'
> fi
> 
> eval 'func_basename ()
449c672
<     $opt_verbose && func_echo ${1+"$@"}
---
>     $debug_cmd
451,454c674,726
<     # A bug in bash halts the script if the last line of a function
<     # fails when set -e is in force, so we need another command to
<     # work around that:
<     :
---
>     '"$_b"'
> }'
> 
> 
> # func_dirname FILE APPEND NONDIR_REPLACEMENT
> # -------------------------------------------
> # Compute the dirname of FILE.  If nonempty, add APPEND to the result,
> # otherwise set result to NONDIR_REPLACEMENT.
> eval 'func_dirname ()
> {
>     $debug_cmd
> 
>     '"$_d"'
> }'
> 
> 
> # func_dirname_and_basename FILE APPEND NONDIR_REPLACEMENT
> # --------------------------------------------------------
> # Perform func_basename and func_dirname in a single function
> # call:
> #   dirname:  Compute the dirname of FILE.  If nonempty,
> #             add APPEND to the result, otherwise set result
> #             to NONDIR_REPLACEMENT.
> #             value returned in "$func_dirname_result"
> #   basename: Compute filename of FILE.
> #             value retuned in "$func_basename_result"
> # For efficiency, we do not delegate to the functions above but instead
> # duplicate the functionality here.
> eval 'func_dirname_and_basename ()
> {
>     $debug_cmd
> 
>     '"$_b"'
>     '"$_d"'
> }'
> 
> 
> # func_echo ARG...
> # ----------------
> # Echo program name prefixed message.
> func_echo ()
> {
>     $debug_cmd
> 
>     _G_message=$*
> 
>     func_echo_IFS=$IFS
>     IFS=$nl
>     for _G_line in $_G_message; do
>       IFS=$func_echo_IFS
>       $ECHO "$progname: $_G_line"
>     done
>     IFS=$func_echo_IFS
457c729,731
< # func_echo_all arg...
---
> 
> # func_echo_all ARG...
> # --------------------
464c738,776
< # func_error arg...
---
> 
> # func_echo_infix_1 INFIX ARG...
> # ------------------------------
> # Echo program name, followed by INFIX on the first line, with any
> # additional lines not showing INFIX.
> func_echo_infix_1 ()
> {
>     $debug_cmd
> 
>     $require_term_colors
> 
>     _G_infix=$1; shift
>     _G_indent=$_G_infix
>     _G_prefix="$progname: $_G_infix: "
>     _G_message=$*
> 
>     # Strip color escape sequences before counting printable length
>     for _G_tc in "$tc_reset" "$tc_bold" "$tc_standout" "$tc_red" "$tc_green" "$tc_blue" "$tc_cyan"
>     do
>       test -n "$_G_tc" && {
>         _G_esc_tc=`$ECHO "$_G_tc" | $SED "$sed_make_literal_regex"`
>         _G_indent=`$ECHO "$_G_indent" | $SED "s|$_G_esc_tc||g"`
>       }
>     done
>     _G_indent="$progname: "`echo "$_G_indent" | $SED 's|.| |g'`"  " ## exclude from sc_prohibit_nested_quotes
> 
>     func_echo_infix_1_IFS=$IFS
>     IFS=$nl
>     for _G_line in $_G_message; do
>       IFS=$func_echo_infix_1_IFS
>       $ECHO "$_G_prefix$tc_bold$_G_line$tc_reset" >&2
>       _G_prefix=$_G_indent
>     done
>     IFS=$func_echo_infix_1_IFS
> }
> 
> 
> # func_error ARG...
> # -----------------
468,469c780
<     $ECHO "$progname: ${opt_mode+$opt_mode: }"${1+"$@"} 1>&2
< }
---
>     $debug_cmd
471,475c782
< # func_warning arg...
< # Echo program name prefixed warning message to standard error.
< func_warning ()
< {
<     $opt_warning && $ECHO "$progname: ${opt_mode+$opt_mode: }warning: "${1+"$@"} 1>&2
---
>     $require_term_colors
477,478c784
<     # bash bug again:
<     :
---
>     func_echo_infix_1 "  $tc_standout${tc_red}error$tc_reset" "$*" >&2
481c787,789
< # func_fatal_error arg...
---
> 
> # func_fatal_error ARG...
> # -----------------------
485,487c793
<     func_error ${1+"$@"}
<     exit $EXIT_FAILURE
< }
---
>     $debug_cmd
489,495c795,796
< # func_fatal_help arg...
< # Echo program name prefixed message to standard error, followed by
< # a help hint, and exit.
< func_fatal_help ()
< {
<     func_error ${1+"$@"}
<     func_fatal_error "$help"
---
>     func_error "$*"
>     exit $EXIT_FAILURE
497d797
< help="Try \`$progname --help' for more information."  ## default
500c800,801
< # func_grep expression filename
---
> # func_grep EXPRESSION FILENAME
> # -----------------------------
503a805,806
>     $debug_cmd
> 
508c811,838
< # func_mkdir_p directory-path
---
> # func_len STRING
> # ---------------
> # Set func_len_result to the length of STRING. STRING may not
> # start with a hyphen.
>   test -z "$_G_HAVE_XSI_OPS" \
>     && (eval 'x=a/b/c;
>       test 5aa/bb/cc = "${#x}${x%%/*}${x%/*}${x#*/}${x##*/}"') 2>/dev/null \
>     && _G_HAVE_XSI_OPS=yes
> 
> if test yes = "$_G_HAVE_XSI_OPS"; then
>   eval 'func_len ()
>   {
>     $debug_cmd
> 
>     func_len_result=${#1}
>   }'
> else
>   func_len ()
>   {
>     $debug_cmd
> 
>     func_len_result=`expr "$1" : ".*" 2>/dev/null || echo $max_cmd_len`
>   }
> fi
> 
> 
> # func_mkdir_p DIRECTORY-PATH
> # ---------------------------
512,513c842,845
<     my_directory_path="$1"
<     my_dir_list=
---
>     $debug_cmd
> 
>     _G_directory_path=$1
>     _G_dir_list=
515c847
<     if test -n "$my_directory_path" && test "$opt_dry_run" != ":"; then
---
>     if test -n "$_G_directory_path" && test : != "$opt_dry_run"; then
517,519c849,851
<       # Protect directory names starting with `-'
<       case $my_directory_path in
<         -*) my_directory_path="./$my_directory_path" ;;
---
>       # Protect directory names starting with '-'
>       case $_G_directory_path in
>         -*) _G_directory_path=./$_G_directory_path ;;
523c855
<       while test ! -d "$my_directory_path"; do
---
>       while test ! -d "$_G_directory_path"; do
526c858
<         my_dir_list="$my_directory_path:$my_dir_list"
---
>         _G_dir_list=$_G_directory_path:$_G_dir_list
529c861
<         case $my_directory_path in */*) ;; *) break ;; esac
---
>         case $_G_directory_path in */*) ;; *) break ;; esac
532c864
<         my_directory_path=`$ECHO "$my_directory_path" | $SED -e "$dirname"`
---
>         _G_directory_path=`$ECHO "$_G_directory_path" | $SED -e "$sed_dirname"`
534c866
<       my_dir_list=`$ECHO "$my_dir_list" | $SED 's,:*$,,'`
---
>       _G_dir_list=`$ECHO "$_G_dir_list" | $SED 's|:*$||'`
536,539c868,871
<       save_mkdir_p_IFS="$IFS"; IFS=':'
<       for my_dir in $my_dir_list; do
< 	IFS="$save_mkdir_p_IFS"
<         # mkdir can fail with a `File exist' error if two processes
---
>       func_mkdir_p_IFS=$IFS; IFS=:
>       for _G_dir in $_G_dir_list; do
> 	IFS=$func_mkdir_p_IFS
>         # mkdir can fail with a 'File exist' error if two processes
542c874
<         $MKDIR "$my_dir" 2>/dev/null || :
---
>         $MKDIR "$_G_dir" 2>/dev/null || :
544c876
<       IFS="$save_mkdir_p_IFS"
---
>       IFS=$func_mkdir_p_IFS
547,548c879,880
<       test -d "$my_directory_path" || \
<         func_fatal_error "Failed to create \`$1'"
---
>       test -d "$_G_directory_path" || \
>         func_fatal_error "Failed to create '$1'"
553c885,886
< # func_mktempdir [string]
---
> # func_mktempdir [BASENAME]
> # -------------------------
556c889
< # given, STRING is the basename for that directory.
---
> # given, BASENAME is the basename for that directory.
559c892
<     my_template="${TMPDIR-/tmp}/${1-$progname}"
---
>     $debug_cmd
561c894,896
<     if test "$opt_dry_run" = ":"; then
---
>     _G_template=${TMPDIR-/tmp}/${1-$progname}
> 
>     if test : = "$opt_dry_run"; then
563c898
<       my_tmpdir="${my_template}-$$"
---
>       _G_tmpdir=$_G_template-$$
567c902
<       my_tmpdir=`mktemp -d "${my_template}-XXXXXXXX" 2>/dev/null`
---
>       _G_tmpdir=`mktemp -d "$_G_template-XXXXXXXX" 2>/dev/null`
569c904
<       if test ! -d "$my_tmpdir"; then
---
>       if test ! -d "$_G_tmpdir"; then
571c906
<         my_tmpdir="${my_template}-${RANDOM-0}$$"
---
>         _G_tmpdir=$_G_template-${RANDOM-0}$$
573c908
<         save_mktempdir_umask=`umask`
---
>         func_mktempdir_umask=`umask`
575,576c910,911
<         $MKDIR "$my_tmpdir"
<         umask $save_mktempdir_umask
---
>         $MKDIR "$_G_tmpdir"
>         umask $func_mktempdir_umask
580,581c915,916
<       test -d "$my_tmpdir" || \
<         func_fatal_error "cannot create temporary directory \`$my_tmpdir'"
---
>       test -d "$_G_tmpdir" || \
>         func_fatal_error "cannot create temporary directory '$_G_tmpdir'"
584c919
<     $ECHO "$my_tmpdir"
---
>     $ECHO "$_G_tmpdir"
588,594c923,928
< # func_quote_for_eval arg
< # Aesthetically quote ARG to be evaled later.
< # This function returns two values: FUNC_QUOTE_FOR_EVAL_RESULT
< # is double-quoted, suitable for a subsequent eval, whereas
< # FUNC_QUOTE_FOR_EVAL_UNQUOTED_RESULT has merely all characters
< # which are still active within double quotes backslashified.
< func_quote_for_eval ()
---
> # func_normal_abspath PATH
> # ------------------------
> # Remove doubled-up and trailing slashes, "." path components,
> # and cancel out any ".." path components in PATH after making
> # it an absolute path.
> func_normal_abspath ()
596,601c930
<     case $1 in
<       *[\\\`\"\$]*)
< 	func_quote_for_eval_unquoted_result=`$ECHO "$1" | $SED "$sed_quote_subst"` ;;
<       *)
<         func_quote_for_eval_unquoted_result="$1" ;;
<     esac
---
>     $debug_cmd
603,610c932,966
<     case $func_quote_for_eval_unquoted_result in
<       # Double-quote args containing shell metacharacters to delay
<       # word splitting, command substitution and and variable
<       # expansion for a subsequent eval.
<       # Many Bourne shells cannot handle close brackets correctly
<       # in scan sets, so we specify it separately.
<       *[\[\~\#\^\&\*\(\)\{\}\|\;\<\>\?\'\ \	]*|*]*|"")
<         func_quote_for_eval_result="\"$func_quote_for_eval_unquoted_result\""
---
>     # These SED scripts presuppose an absolute path with a trailing slash.
>     _G_pathcar='s|^/\([^/]*\).*$|\1|'
>     _G_pathcdr='s|^/[^/]*||'
>     _G_removedotparts=':dotsl
> 		s|/\./|/|g
> 		t dotsl
> 		s|/\.$|/|'
>     _G_collapseslashes='s|/\{1,\}|/|g'
>     _G_finalslash='s|/*$|/|'
> 
>     # Start from root dir and reassemble the path.
>     func_normal_abspath_result=
>     func_normal_abspath_tpath=$1
>     func_normal_abspath_altnamespace=
>     case $func_normal_abspath_tpath in
>       "")
>         # Empty path, that just means $cwd.
>         func_stripname '' '/' "`pwd`"
>         func_normal_abspath_result=$func_stripname_result
>         return
>         ;;
>       # The next three entries are used to spot a run of precisely
>       # two leading slashes without using negated character classes;
>       # we take advantage of case's first-match behaviour.
>       ///*)
>         # Unusual form of absolute path, do nothing.
>         ;;
>       //*)
>         # Not necessarily an ordinary path; POSIX reserves leading '//'
>         # and for example Cygwin uses it to access remote file shares
>         # over CIFS/SMB, so we conserve a leading double slash if found.
>         func_normal_abspath_altnamespace=/
>         ;;
>       /*)
>         # Absolute path, do nothing.
613c969,971
<         func_quote_for_eval_result="$func_quote_for_eval_unquoted_result"
---
>         # Relative path, prepend $cwd.
>         func_normal_abspath_tpath=`pwd`/$func_normal_abspath_tpath
>         ;;
614a973,1090
> 
>     # Cancel out all the simple stuff to save iterations.  We also want
>     # the path to end with a slash for ease of parsing, so make sure
>     # there is one (and only one) here.
>     func_normal_abspath_tpath=`$ECHO "$func_normal_abspath_tpath" | $SED \
>           -e "$_G_removedotparts" -e "$_G_collapseslashes" -e "$_G_finalslash"`
>     while :; do
>       # Processed it all yet?
>       if test / = "$func_normal_abspath_tpath"; then
>         # If we ascended to the root using ".." the result may be empty now.
>         if test -z "$func_normal_abspath_result"; then
>           func_normal_abspath_result=/
>         fi
>         break
>       fi
>       func_normal_abspath_tcomponent=`$ECHO "$func_normal_abspath_tpath" | $SED \
>           -e "$_G_pathcar"`
>       func_normal_abspath_tpath=`$ECHO "$func_normal_abspath_tpath" | $SED \
>           -e "$_G_pathcdr"`
>       # Figure out what to do with it
>       case $func_normal_abspath_tcomponent in
>         "")
>           # Trailing empty path component, ignore it.
>           ;;
>         ..)
>           # Parent dir; strip last assembled component from result.
>           func_dirname "$func_normal_abspath_result"
>           func_normal_abspath_result=$func_dirname_result
>           ;;
>         *)
>           # Actual path component, append it.
>           func_append func_normal_abspath_result "/$func_normal_abspath_tcomponent"
>           ;;
>       esac
>     done
>     # Restore leading double-slash if one was found on entry.
>     func_normal_abspath_result=$func_normal_abspath_altnamespace$func_normal_abspath_result
> }
> 
> 
> # func_notquiet ARG...
> # --------------------
> # Echo program name prefixed message only when not in quiet mode.
> func_notquiet ()
> {
>     $debug_cmd
> 
>     $opt_quiet || func_echo ${1+"$@"}
> 
>     # A bug in bash halts the script if the last line of a function
>     # fails when set -e is in force, so we need another command to
>     # work around that:
>     :
> }
> 
> 
> # func_relative_path SRCDIR DSTDIR
> # --------------------------------
> # Set func_relative_path_result to the relative path from SRCDIR to DSTDIR.
> func_relative_path ()
> {
>     $debug_cmd
> 
>     func_relative_path_result=
>     func_normal_abspath "$1"
>     func_relative_path_tlibdir=$func_normal_abspath_result
>     func_normal_abspath "$2"
>     func_relative_path_tbindir=$func_normal_abspath_result
> 
>     # Ascend the tree starting from libdir
>     while :; do
>       # check if we have found a prefix of bindir
>       case $func_relative_path_tbindir in
>         $func_relative_path_tlibdir)
>           # found an exact match
>           func_relative_path_tcancelled=
>           break
>           ;;
>         $func_relative_path_tlibdir*)
>           # found a matching prefix
>           func_stripname "$func_relative_path_tlibdir" '' "$func_relative_path_tbindir"
>           func_relative_path_tcancelled=$func_stripname_result
>           if test -z "$func_relative_path_result"; then
>             func_relative_path_result=.
>           fi
>           break
>           ;;
>         *)
>           func_dirname $func_relative_path_tlibdir
>           func_relative_path_tlibdir=$func_dirname_result
>           if test -z "$func_relative_path_tlibdir"; then
>             # Have to descend all the way to the root!
>             func_relative_path_result=../$func_relative_path_result
>             func_relative_path_tcancelled=$func_relative_path_tbindir
>             break
>           fi
>           func_relative_path_result=../$func_relative_path_result
>           ;;
>       esac
>     done
> 
>     # Now calculate path; take care to avoid doubling-up slashes.
>     func_stripname '' '/' "$func_relative_path_result"
>     func_relative_path_result=$func_stripname_result
>     func_stripname '/' '/' "$func_relative_path_tcancelled"
>     if test -n "$func_stripname_result"; then
>       func_append func_relative_path_result "/$func_stripname_result"
>     fi
> 
>     # Normalisation. If bindir is libdir, return '.' else relative path.
>     if test -n "$func_relative_path_result"; then
>       func_stripname './' '' "$func_relative_path_result"
>       func_relative_path_result=$func_stripname_result
>     fi
> 
>     test -n "$func_relative_path_result" || func_relative_path_result=.
> 
>     :
618c1094,1147
< # func_quote_for_expand arg
---
> # func_quote_for_eval ARG...
> # --------------------------
> # Aesthetically quote ARGs to be evaled later.
> # This function returns two values:
> #   i) func_quote_for_eval_result
> #      double-quoted, suitable for a subsequent eval
> #  ii) func_quote_for_eval_unquoted_result
> #      has all characters that are still active within double
> #      quotes backslashified.
> func_quote_for_eval ()
> {
>     $debug_cmd
> 
>     func_quote_for_eval_unquoted_result=
>     func_quote_for_eval_result=
>     while test 0 -lt $#; do
>       case $1 in
>         *[\\\`\"\$]*)
> 	  _G_unquoted_arg=`printf '%s\n' "$1" |$SED "$sed_quote_subst"` ;;
>         *)
>           _G_unquoted_arg=$1 ;;
>       esac
>       if test -n "$func_quote_for_eval_unquoted_result"; then
> 	func_append func_quote_for_eval_unquoted_result " $_G_unquoted_arg"
>       else
>         func_append func_quote_for_eval_unquoted_result "$_G_unquoted_arg"
>       fi
> 
>       case $_G_unquoted_arg in
>         # Double-quote args containing shell metacharacters to delay
>         # word splitting, command substitution and variable expansion
>         # for a subsequent eval.
>         # Many Bourne shells cannot handle close brackets correctly
>         # in scan sets, so we specify it separately.
>         *[\[\~\#\^\&\*\(\)\{\}\|\;\<\>\?\'\ \	]*|*]*|"")
>           _G_quoted_arg=\"$_G_unquoted_arg\"
>           ;;
>         *)
>           _G_quoted_arg=$_G_unquoted_arg
> 	  ;;
>       esac
> 
>       if test -n "$func_quote_for_eval_result"; then
> 	func_append func_quote_for_eval_result " $_G_quoted_arg"
>       else
>         func_append func_quote_for_eval_result "$_G_quoted_arg"
>       fi
>       shift
>     done
> }
> 
> 
> # func_quote_for_expand ARG
> # -------------------------
622a1152,1153
>     $debug_cmd
> 
625,626c1156,1157
< 	my_arg=`$ECHO "$1" | $SED \
< 	    -e "$double_quote_subst" -e "$sed_double_backslash"` ;;
---
> 	_G_arg=`$ECHO "$1" | $SED \
> 	    -e "$sed_double_quote_subst" -e "$sed_double_backslash"` ;;
628c1159
<         my_arg="$1" ;;
---
>         _G_arg=$1 ;;
631c1162
<     case $my_arg in
---
>     case $_G_arg in
637c1168
<         my_arg="\"$my_arg\""
---
>         _G_arg=\"$_G_arg\"
641c1172
<     func_quote_for_expand_result="$my_arg"
---
>     func_quote_for_expand_result=$_G_arg
645,646c1176,1208
< # func_show_eval cmd [fail_exp]
< # Unless opt_silent is true, then output CMD.  Then, if opt_dryrun is
---
> # func_stripname PREFIX SUFFIX NAME
> # ---------------------------------
> # strip PREFIX and SUFFIX from NAME, and store in func_stripname_result.
> # PREFIX and SUFFIX must not contain globbing or regex special
> # characters, hashes, percent signs, but SUFFIX may contain a leading
> # dot (in which case that matches only a dot).
> if test yes = "$_G_HAVE_XSI_OPS"; then
>   eval 'func_stripname ()
>   {
>     $debug_cmd
> 
>     # pdksh 5.2.14 does not do ${X%$Y} correctly if both X and Y are
>     # positional parameters, so assign one to ordinary variable first.
>     func_stripname_result=$3
>     func_stripname_result=${func_stripname_result#"$1"}
>     func_stripname_result=${func_stripname_result%"$2"}
>   }'
> else
>   func_stripname ()
>   {
>     $debug_cmd
> 
>     case $2 in
>       .*) func_stripname_result=`$ECHO "$3" | $SED -e "s%^$1%%" -e "s%\\\\$2\$%%"`;;
>       *)  func_stripname_result=`$ECHO "$3" | $SED -e "s%^$1%%" -e "s%$2\$%%"`;;
>     esac
>   }
> fi
> 
> 
> # func_show_eval CMD [FAIL_EXP]
> # -----------------------------
> # Unless opt_quiet is true, then output CMD.  Then, if opt_dryrun is
651,652c1213
<     my_cmd="$1"
<     my_fail_exp="${2-:}"
---
>     $debug_cmd
654,657c1215,1219
<     ${opt_silent-false} || {
<       func_quote_for_expand "$my_cmd"
<       eval "func_echo $func_quote_for_expand_result"
<     }
---
>     _G_cmd=$1
>     _G_fail_exp=${2-':'}
> 
>     func_quote_for_expand "$_G_cmd"
>     eval "func_notquiet $func_quote_for_expand_result"
659,663c1221,1225
<     if ${opt_dry_run-false}; then :; else
<       eval "$my_cmd"
<       my_status=$?
<       if test "$my_status" -eq 0; then :; else
< 	eval "(exit $my_status); $my_fail_exp"
---
>     $opt_dry_run || {
>       eval "$_G_cmd"
>       _G_status=$?
>       if test 0 -ne "$_G_status"; then
> 	eval "(exit $_G_status); $_G_fail_exp"
665c1227
<     fi
---
>     }
669,670c1231,1233
< # func_show_eval_locale cmd [fail_exp]
< # Unless opt_silent is true, then output CMD.  Then, if opt_dryrun is
---
> # func_show_eval_locale CMD [FAIL_EXP]
> # ------------------------------------
> # Unless opt_quiet is true, then output CMD.  Then, if opt_dryrun is
675,676c1238,1241
<     my_cmd="$1"
<     my_fail_exp="${2-:}"
---
>     $debug_cmd
> 
>     _G_cmd=$1
>     _G_fail_exp=${2-':'}
678,679c1243,1244
<     ${opt_silent-false} || {
<       func_quote_for_expand "$my_cmd"
---
>     $opt_quiet || {
>       func_quote_for_expand "$_G_cmd"
683,689c1248,1254
<     if ${opt_dry_run-false}; then :; else
<       eval "$lt_user_locale
< 	    $my_cmd"
<       my_status=$?
<       eval "$lt_safe_locale"
<       if test "$my_status" -eq 0; then :; else
< 	eval "(exit $my_status); $my_fail_exp"
---
>     $opt_dry_run || {
>       eval "$_G_user_locale
> 	    $_G_cmd"
>       _G_status=$?
>       eval "$_G_safe_locale"
>       if test 0 -ne "$_G_status"; then
> 	eval "(exit $_G_status); $_G_fail_exp"
691c1256
<     fi
---
>     }
693a1259
> 
694a1261
> # ----------
701,708c1268,1277
<   case $1 in
<   [0-9]* | *[!a-zA-Z0-9_]*)
<     func_tr_sh_result=`$ECHO "$1" | $SED 's/^\([0-9]\)/_\1/; s/[^a-zA-Z0-9_]/_/g'`
<     ;;
<   * )
<     func_tr_sh_result=$1
<     ;;
<   esac
---
>     $debug_cmd
> 
>     case $1 in
>     [0-9]* | *[!a-zA-Z0-9_]*)
>       func_tr_sh_result=`$ECHO "$1" | $SED -e 's/^\([0-9]\)/_\1/' -e 's/[^a-zA-Z0-9_]/_/g'`
>       ;;
>     * )
>       func_tr_sh_result=$1
>       ;;
>     esac
712,714c1281,1284
< # func_version
< # Echo version message to standard output and exit.
< func_version ()
---
> # func_verbose ARG...
> # -------------------
> # Echo program name prefixed message in verbose mode only.
> func_verbose ()
716c1286
<     $opt_debug
---
>     $debug_cmd
718,732c1288,1290
<     $SED -n '/(C)/!b go
< 	:more
< 	/\./!{
< 	  N
< 	  s/\n# / /
< 	  b more
< 	}
< 	:go
< 	/^# '$PROGRAM' (GNU /,/# warranty; / {
<         s/^# //
< 	s/^# *$//
<         s/\((C)\)[ 0-9,-]*\( [1-9][0-9]*\)/\1\2/
<         p
<      }' < "$progpath"
<      exit $?
---
>     $opt_verbose && func_echo "$*"
> 
>     :
735,737c1293,1297
< # func_usage
< # Echo short help message to standard output and exit.
< func_usage ()
---
> 
> # func_warn_and_continue ARG...
> # -----------------------------
> # Echo program name prefixed warning message to standard error.
> func_warn_and_continue ()
739c1299
<     $opt_debug
---
>     $debug_cmd
741,749c1301,1490
<     $SED -n '/^# Usage:/,/^#  *.*--help/ {
<         s/^# //
< 	s/^# *$//
< 	s/\$progname/'$progname'/
< 	p
<     }' < "$progpath"
<     echo
<     $ECHO "run \`$progname --help | more' for full usage"
<     exit $?
---
>     $require_term_colors
> 
>     func_echo_infix_1 "${tc_red}warning$tc_reset" "$*" >&2
> }
> 
> 
> # func_warning CATEGORY ARG...
> # ----------------------------
> # Echo program name prefixed warning message to standard error. Warning
> # messages can be filtered according to CATEGORY, where this function
> # elides messages where CATEGORY is not listed in the global variable
> # 'opt_warning_types'.
> func_warning ()
> {
>     $debug_cmd
> 
>     # CATEGORY must be in the warning_categories list!
>     case " $warning_categories " in
>       *" $1 "*) ;;
>       *) func_internal_error "invalid warning category '$1'" ;;
>     esac
> 
>     _G_category=$1
>     shift
> 
>     case " $opt_warning_types " in
>       *" $_G_category "*) $warning_func ${1+"$@"} ;;
>     esac
> }
> 
> 
> # func_sort_ver VER1 VER2
> # -----------------------
> # 'sort -V' is not generally available.
> # Note this deviates from the version comparison in automake
> # in that it treats 1.5 < 1.5.0, and treats 1.4.4a < 1.4-p3a
> # but this should suffice as we won't be specifying old
> # version formats or redundant trailing .0 in bootstrap.conf.
> # If we did want full compatibility then we should probably
> # use m4_version_compare from autoconf.
> func_sort_ver ()
> {
>     $debug_cmd
> 
>     printf '%s\n%s\n' "$1" "$2" \
>       | sort -t. -k 1,1n -k 2,2n -k 3,3n -k 4,4n -k 5,5n -k 6,6n -k 7,7n -k 8,8n -k 9,9n
> }
> 
> # func_lt_ver PREV CURR
> # ---------------------
> # Return true if PREV and CURR are in the correct order according to
> # func_sort_ver, otherwise false.  Use it like this:
> #
> #  func_lt_ver "$prev_ver" "$proposed_ver" || func_fatal_error "..."
> func_lt_ver ()
> {
>     $debug_cmd
> 
>     test "x$1" = x`func_sort_ver "$1" "$2" | $SED 1q`
> }
> 
> 
> # Local variables:
> # mode: shell-script
> # sh-indentation: 2
> # eval: (add-hook 'before-save-hook 'time-stamp)
> # time-stamp-pattern: "10/scriptversion=%:y-%02m-%02d.%02H; # UTC"
> # time-stamp-time-zone: "UTC"
> # End:
> #! /bin/sh
> 
> # Set a version string for this script.
> scriptversion=2014-01-07.03; # UTC
> 
> # A portable, pluggable option parser for Bourne shell.
> # Written by Gary V. Vaughan, 2010
> 
> # Copyright (C) 2010-2015 Free Software Foundation, Inc.
> # This is free software; see the source for copying conditions.  There is NO
> # warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
> 
> # This program is free software: you can redistribute it and/or modify
> # it under the terms of the GNU General Public License as published by
> # the Free Software Foundation, either version 3 of the License, or
> # (at your option) any later version.
> 
> # This program is distributed in the hope that it will be useful,
> # but WITHOUT ANY WARRANTY; without even the implied warranty of
> # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
> # GNU General Public License for more details.
> 
> # You should have received a copy of the GNU General Public License
> # along with this program.  If not, see <http://www.gnu.org/licenses/>.
> 
> # Please report bugs or propose patches to gary@gnu.org.
> 
> 
> ## ------ ##
> ## Usage. ##
> ## ------ ##
> 
> # This file is a library for parsing options in your shell scripts along
> # with assorted other useful supporting features that you can make use
> # of too.
> #
> # For the simplest scripts you might need only:
> #
> #   #!/bin/sh
> #   . relative/path/to/funclib.sh
> #   . relative/path/to/options-parser
> #   scriptversion=1.0
> #   func_options ${1+"$@"}
> #   eval set dummy "$func_options_result"; shift
> #   ...rest of your script...
> #
> # In order for the '--version' option to work, you will need to have a
> # suitably formatted comment like the one at the top of this file
> # starting with '# Written by ' and ending with '# warranty; '.
> #
> # For '-h' and '--help' to work, you will also need a one line
> # description of your script's purpose in a comment directly above the
> # '# Written by ' line, like the one at the top of this file.
> #
> # The default options also support '--debug', which will turn on shell
> # execution tracing (see the comment above debug_cmd below for another
> # use), and '--verbose' and the func_verbose function to allow your script
> # to display verbose messages only when your user has specified
> # '--verbose'.
> #
> # After sourcing this file, you can plug processing for additional
> # options by amending the variables from the 'Configuration' section
> # below, and following the instructions in the 'Option parsing'
> # section further down.
> 
> ## -------------- ##
> ## Configuration. ##
> ## -------------- ##
> 
> # You should override these variables in your script after sourcing this
> # file so that they reflect the customisations you have added to the
> # option parser.
> 
> # The usage line for option parsing errors and the start of '-h' and
> # '--help' output messages. You can embed shell variables for delayed
> # expansion at the time the message is displayed, but you will need to
> # quote other shell meta-characters carefully to prevent them being
> # expanded when the contents are evaled.
> usage='$progpath [OPTION]...'
> 
> # Short help message in response to '-h' and '--help'.  Add to this or
> # override it after sourcing this library to reflect the full set of
> # options your script accepts.
> usage_message="\
>        --debug        enable verbose shell tracing
>    -W, --warnings=CATEGORY
>                       report the warnings falling in CATEGORY [all]
>    -v, --verbose      verbosely report processing
>        --version      print version information and exit
>    -h, --help         print short or long help message and exit
> "
> 
> # Additional text appended to 'usage_message' in response to '--help'.
> long_help_message="
> Warning categories include:
>        'all'          show all warnings
>        'none'         turn off all the warnings
>        'error'        warnings are treated as fatal errors"
> 
> # Help message printed before fatal option parsing errors.
> fatal_help="Try '\$progname --help' for more information."
> 
> 
> 
> ## ------------------------- ##
> ## Hook function management. ##
> ## ------------------------- ##
> 
> # This section contains functions for adding, removing, and running hooks
> # to the main code.  A hook is just a named list of of function, that can
> # be run in order later on.
> 
> # func_hookable FUNC_NAME
> # -----------------------
> # Declare that FUNC_NAME will run hooks added with
> # 'func_add_hook FUNC_NAME ...'.
> func_hookable ()
> {
>     $debug_cmd
> 
>     func_append hookable_fns " $1"
752,754c1493,1820
< # func_help [NOEXIT]
< # Echo long help message to standard output and exit,
< # unless 'noexit' is passed as argument.
---
> 
> # func_add_hook FUNC_NAME HOOK_FUNC
> # ---------------------------------
> # Request that FUNC_NAME call HOOK_FUNC before it returns.  FUNC_NAME must
> # first have been declared "hookable" by a call to 'func_hookable'.
> func_add_hook ()
> {
>     $debug_cmd
> 
>     case " $hookable_fns " in
>       *" $1 "*) ;;
>       *) func_fatal_error "'$1' does not accept hook functions." ;;
>     esac
> 
>     eval func_append ${1}_hooks '" $2"'
> }
> 
> 
> # func_remove_hook FUNC_NAME HOOK_FUNC
> # ------------------------------------
> # Remove HOOK_FUNC from the list of functions called by FUNC_NAME.
> func_remove_hook ()
> {
>     $debug_cmd
> 
>     eval ${1}_hooks='`$ECHO "\$'$1'_hooks" |$SED "s| '$2'||"`'
> }
> 
> 
> # func_run_hooks FUNC_NAME [ARG]...
> # ---------------------------------
> # Run all hook functions registered to FUNC_NAME.
> # It is assumed that the list of hook functions contains nothing more
> # than a whitespace-delimited list of legal shell function names, and
> # no effort is wasted trying to catch shell meta-characters or preserve
> # whitespace.
> func_run_hooks ()
> {
>     $debug_cmd
> 
>     case " $hookable_fns " in
>       *" $1 "*) ;;
>       *) func_fatal_error "'$1' does not support hook funcions.n" ;;
>     esac
> 
>     eval _G_hook_fns=\$$1_hooks; shift
> 
>     for _G_hook in $_G_hook_fns; do
>       eval $_G_hook '"$@"'
> 
>       # store returned options list back into positional
>       # parameters for next 'cmd' execution.
>       eval _G_hook_result=\$${_G_hook}_result
>       eval set dummy "$_G_hook_result"; shift
>     done
> 
>     func_quote_for_eval ${1+"$@"}
>     func_run_hooks_result=$func_quote_for_eval_result
> }
> 
> 
> 
> ## --------------- ##
> ## Option parsing. ##
> ## --------------- ##
> 
> # In order to add your own option parsing hooks, you must accept the
> # full positional parameter list in your hook function, remove any
> # options that you action, and then pass back the remaining unprocessed
> # options in '<hooked_function_name>_result', escaped suitably for
> # 'eval'.  Like this:
> #
> #    my_options_prep ()
> #    {
> #        $debug_cmd
> #
> #        # Extend the existing usage message.
> #        usage_message=$usage_message'
> #      -s, --silent       don'\''t print informational messages
> #    '
> #
> #        func_quote_for_eval ${1+"$@"}
> #        my_options_prep_result=$func_quote_for_eval_result
> #    }
> #    func_add_hook func_options_prep my_options_prep
> #
> #
> #    my_silent_option ()
> #    {
> #        $debug_cmd
> #
> #        # Note that for efficiency, we parse as many options as we can
> #        # recognise in a loop before passing the remainder back to the
> #        # caller on the first unrecognised argument we encounter.
> #        while test $# -gt 0; do
> #          opt=$1; shift
> #          case $opt in
> #            --silent|-s) opt_silent=: ;;
> #            # Separate non-argument short options:
> #            -s*)         func_split_short_opt "$_G_opt"
> #                         set dummy "$func_split_short_opt_name" \
> #                             "-$func_split_short_opt_arg" ${1+"$@"}
> #                         shift
> #                         ;;
> #            *)            set dummy "$_G_opt" "$*"; shift; break ;;
> #          esac
> #        done
> #
> #        func_quote_for_eval ${1+"$@"}
> #        my_silent_option_result=$func_quote_for_eval_result
> #    }
> #    func_add_hook func_parse_options my_silent_option
> #
> #
> #    my_option_validation ()
> #    {
> #        $debug_cmd
> #
> #        $opt_silent && $opt_verbose && func_fatal_help "\
> #    '--silent' and '--verbose' options are mutually exclusive."
> #
> #        func_quote_for_eval ${1+"$@"}
> #        my_option_validation_result=$func_quote_for_eval_result
> #    }
> #    func_add_hook func_validate_options my_option_validation
> #
> # You'll alse need to manually amend $usage_message to reflect the extra
> # options you parse.  It's preferable to append if you can, so that
> # multiple option parsing hooks can be added safely.
> 
> 
> # func_options [ARG]...
> # ---------------------
> # All the functions called inside func_options are hookable. See the
> # individual implementations for details.
> func_hookable func_options
> func_options ()
> {
>     $debug_cmd
> 
>     func_options_prep ${1+"$@"}
>     eval func_parse_options \
>         ${func_options_prep_result+"$func_options_prep_result"}
>     eval func_validate_options \
>         ${func_parse_options_result+"$func_parse_options_result"}
> 
>     eval func_run_hooks func_options \
>         ${func_validate_options_result+"$func_validate_options_result"}
> 
>     # save modified positional parameters for caller
>     func_options_result=$func_run_hooks_result
> }
> 
> 
> # func_options_prep [ARG]...
> # --------------------------
> # All initialisations required before starting the option parse loop.
> # Note that when calling hook functions, we pass through the list of
> # positional parameters.  If a hook function modifies that list, and
> # needs to propogate that back to rest of this script, then the complete
> # modified list must be put in 'func_run_hooks_result' before
> # returning.
> func_hookable func_options_prep
> func_options_prep ()
> {
>     $debug_cmd
> 
>     # Option defaults:
>     opt_verbose=false
>     opt_warning_types=
> 
>     func_run_hooks func_options_prep ${1+"$@"}
> 
>     # save modified positional parameters for caller
>     func_options_prep_result=$func_run_hooks_result
> }
> 
> 
> # func_parse_options [ARG]...
> # ---------------------------
> # The main option parsing loop.
> func_hookable func_parse_options
> func_parse_options ()
> {
>     $debug_cmd
> 
>     func_parse_options_result=
> 
>     # this just eases exit handling
>     while test $# -gt 0; do
>       # Defer to hook functions for initial option parsing, so they
>       # get priority in the event of reusing an option name.
>       func_run_hooks func_parse_options ${1+"$@"}
> 
>       # Adjust func_parse_options positional parameters to match
>       eval set dummy "$func_run_hooks_result"; shift
> 
>       # Break out of the loop if we already parsed every option.
>       test $# -gt 0 || break
> 
>       _G_opt=$1
>       shift
>       case $_G_opt in
>         --debug|-x)   debug_cmd='set -x'
>                       func_echo "enabling shell trace mode"
>                       $debug_cmd
>                       ;;
> 
>         --no-warnings|--no-warning|--no-warn)
>                       set dummy --warnings none ${1+"$@"}
>                       shift
> 		      ;;
> 
>         --warnings|--warning|-W)
>                       test $# = 0 && func_missing_arg $_G_opt && break
>                       case " $warning_categories $1" in
>                         *" $1 "*)
>                           # trailing space prevents matching last $1 above
>                           func_append_uniq opt_warning_types " $1"
>                           ;;
>                         *all)
>                           opt_warning_types=$warning_categories
>                           ;;
>                         *none)
>                           opt_warning_types=none
>                           warning_func=:
>                           ;;
>                         *error)
>                           opt_warning_types=$warning_categories
>                           warning_func=func_fatal_error
>                           ;;
>                         *)
>                           func_fatal_error \
>                              "unsupported warning category: '$1'"
>                           ;;
>                       esac
>                       shift
>                       ;;
> 
>         --verbose|-v) opt_verbose=: ;;
>         --version)    func_version ;;
>         -\?|-h)       func_usage ;;
>         --help)       func_help ;;
> 
> 	# Separate optargs to long options (plugins may need this):
> 	--*=*)        func_split_equals "$_G_opt"
> 	              set dummy "$func_split_equals_lhs" \
>                           "$func_split_equals_rhs" ${1+"$@"}
>                       shift
>                       ;;
> 
>        # Separate optargs to short options:
>         -W*)
>                       func_split_short_opt "$_G_opt"
>                       set dummy "$func_split_short_opt_name" \
>                           "$func_split_short_opt_arg" ${1+"$@"}
>                       shift
>                       ;;
> 
>         # Separate non-argument short options:
>         -\?*|-h*|-v*|-x*)
>                       func_split_short_opt "$_G_opt"
>                       set dummy "$func_split_short_opt_name" \
>                           "-$func_split_short_opt_arg" ${1+"$@"}
>                       shift
>                       ;;
> 
>         --)           break ;;
>         -*)           func_fatal_help "unrecognised option: '$_G_opt'" ;;
>         *)            set dummy "$_G_opt" ${1+"$@"}; shift; break ;;
>       esac
>     done
> 
>     # save modified positional parameters for caller
>     func_quote_for_eval ${1+"$@"}
>     func_parse_options_result=$func_quote_for_eval_result
> }
> 
> 
> # func_validate_options [ARG]...
> # ------------------------------
> # Perform any sanity checks on option settings and/or unconsumed
> # arguments.
> func_hookable func_validate_options
> func_validate_options ()
> {
>     $debug_cmd
> 
>     # Display all warnings if -W was not given.
>     test -n "$opt_warning_types" || opt_warning_types=" $warning_categories"
> 
>     func_run_hooks func_validate_options ${1+"$@"}
> 
>     # Bail if the options were screwed!
>     $exit_cmd $EXIT_FAILURE
> 
>     # save modified positional parameters for caller
>     func_validate_options_result=$func_run_hooks_result
> }
> 
> 
> 
> ## ----------------- ##
> ## Helper functions. ##
> ## ----------------- ##
> 
> # This section contains the helper functions used by the rest of the
> # hookable option parser framework in ascii-betical order.
> 
> 
> # func_fatal_help ARG...
> # ----------------------
> # Echo program name prefixed message to standard error, followed by
> # a help hint, and exit.
> func_fatal_help ()
> {
>     $debug_cmd
> 
>     eval \$ECHO \""Usage: $usage"\"
>     eval \$ECHO \""$fatal_help"\"
>     func_error ${1+"$@"}
>     exit $EXIT_FAILURE
> }
> 
> 
> # func_help
> # ---------
> # Echo long help message to standard output and exit.
757c1823
<     $opt_debug
---
>     $debug_cmd
759,781c1825,1827
<     $SED -n '/^# Usage:/,/# Report bugs to/ {
< 	:print
<         s/^# //
< 	s/^# *$//
< 	s*\$progname*'$progname'*
< 	s*\$host*'"$host"'*
< 	s*\$SHELL*'"$SHELL"'*
< 	s*\$LTCC*'"$LTCC"'*
< 	s*\$LTCFLAGS*'"$LTCFLAGS"'*
< 	s*\$LD*'"$LD"'*
< 	s/\$with_gnu_ld/'"$with_gnu_ld"'/
< 	s/\$automake_version/'"`(${AUTOMAKE-automake} --version) 2>/dev/null |$SED 1q`"'/
< 	s/\$autoconf_version/'"`(${AUTOCONF-autoconf} --version) 2>/dev/null |$SED 1q`"'/
< 	p
< 	d
<      }
<      /^# .* home page:/b print
<      /^# General help using/b print
<      ' < "$progpath"
<     ret=$?
<     if test -z "$1"; then
<       exit $ret
<     fi
---
>     func_usage_message
>     $ECHO "$long_help_message"
>     exit 0
784c1830,1832
< # func_missing_arg argname
---
> 
> # func_missing_arg ARGNAME
> # ------------------------
789c1837
<     $opt_debug
---
>     $debug_cmd
791c1839
<     func_error "missing argument for $1."
---
>     func_error "Missing argument for '$1'."
796c1844,1880
< # func_split_short_opt shortopt
---
> # func_split_equals STRING
> # ------------------------
> # Set func_split_equals_lhs and func_split_equals_rhs shell variables after
> # splitting STRING at the '=' sign.
> test -z "$_G_HAVE_XSI_OPS" \
>     && (eval 'x=a/b/c;
>       test 5aa/bb/cc = "${#x}${x%%/*}${x%/*}${x#*/}${x##*/}"') 2>/dev/null \
>     && _G_HAVE_XSI_OPS=yes
> 
> if test yes = "$_G_HAVE_XSI_OPS"
> then
>   # This is an XSI compatible shell, allowing a faster implementation...
>   eval 'func_split_equals ()
>   {
>       $debug_cmd
> 
>       func_split_equals_lhs=${1%%=*}
>       func_split_equals_rhs=${1#*=}
>       test "x$func_split_equals_lhs" = "x$1" \
>         && func_split_equals_rhs=
>   }'
> else
>   # ...otherwise fall back to using expr, which is often a shell builtin.
>   func_split_equals ()
>   {
>       $debug_cmd
> 
>       func_split_equals_lhs=`expr "x$1" : 'x\([^=]*\)'`
>       func_split_equals_rhs=
>       test "x$func_split_equals_lhs" = "x$1" \
>         || func_split_equals_rhs=`expr "x$1" : 'x[^=]*=\(.*\)$'`
>   }
> fi #func_split_equals
> 
> 
> # func_split_short_opt SHORTOPT
> # -----------------------------
799c1883,1908
< func_split_short_opt ()
---
> if test yes = "$_G_HAVE_XSI_OPS"
> then
>   # This is an XSI compatible shell, allowing a faster implementation...
>   eval 'func_split_short_opt ()
>   {
>       $debug_cmd
> 
>       func_split_short_opt_arg=${1#??}
>       func_split_short_opt_name=${1%"$func_split_short_opt_arg"}
>   }'
> else
>   # ...otherwise fall back to using expr, which is often a shell builtin.
>   func_split_short_opt ()
>   {
>       $debug_cmd
> 
>       func_split_short_opt_name=`expr "x$1" : 'x-\(.\)'`
>       func_split_short_opt_arg=`expr "x$1" : 'x-.\(.*\)$'`
>   }
> fi #func_split_short_opt
> 
> 
> # func_usage
> # ----------
> # Echo short help message to standard output and exit.
> func_usage ()
801,802c1910
<     my_sed_short_opt='1s/^\(..\).*$/\1/;q'
<     my_sed_short_rest='1s/^..\(.*\)$/\1/;q'
---
>     $debug_cmd
804,806c1912,1915
<     func_split_short_opt_name=`$ECHO "$1" | $SED "$my_sed_short_opt"`
<     func_split_short_opt_arg=`$ECHO "$1" | $SED "$my_sed_short_rest"`
< } # func_split_short_opt may be replaced by extended shell implementation
---
>     func_usage_message
>     $ECHO "Run '$progname --help |${PAGER-more}' for full usage"
>     exit 0
> }
809,812c1918,1921
< # func_split_long_opt longopt
< # Set func_split_long_opt_name and func_split_long_opt_arg shell
< # variables after splitting LONGOPT at the `=' sign.
< func_split_long_opt ()
---
> # func_usage_message
> # ------------------
> # Echo short help message to standard output.
> func_usage_message ()
814,815c1923
<     my_sed_long_opt='1s/^\(--[^=]*\)=.*/\1/;q'
<     my_sed_long_arg='1s/^--[^=]*=//'
---
>     $debug_cmd
817,819c1925,1935
<     func_split_long_opt_name=`$ECHO "$1" | $SED "$my_sed_long_opt"`
<     func_split_long_opt_arg=`$ECHO "$1" | $SED "$my_sed_long_arg"`
< } # func_split_long_opt may be replaced by extended shell implementation
---
>     eval \$ECHO \""Usage: $usage"\"
>     echo
>     $SED -n 's|^# ||
>         /^Written by/{
>           x;p;x
>         }
> 	h
> 	/^Written by/q' < "$progpath"
>     echo
>     eval \$ECHO \""$usage_message"\"
> }
821d1936
< exit_cmd=:
822a1938,1943
> # func_version
> # ------------
> # Echo version message to standard output and exit.
> func_version ()
> {
>     $debug_cmd
823a1945,1965
>     printf '%s\n' "$progname $scriptversion"
>     $SED -n '
>         /(C)/!b go
>         :more
>         /\./!{
>           N
>           s|\n# | |
>           b more
>         }
>         :go
>         /^# Written by /,/# warranty; / {
>           s|^# ||
>           s|^# *$||
>           s|\((C)\)[ 0-9,-]*[ ,-]\([1-9][0-9]* \)|\1 \2|
>           p
>         }
>         /^# Written by / {
>           s|^# ||
>           p
>         }
>         /^warranty; /q' < "$progpath"
824a1967,1968
>     exit $?
> }
827,828c1971,1977
< magic="%%%MAGIC variable%%%"
< magic_exe="%%%MAGIC EXE variable%%%"
---
> # Local variables:
> # mode: shell-script
> # sh-indentation: 2
> # eval: (add-hook 'before-save-hook 'time-stamp)
> # time-stamp-pattern: "10/scriptversion=%:y-%02m-%02d.%02H; # UTC"
> # time-stamp-time-zone: "UTC"
> # End:
830,836c1979,1980
< # Global variables.
< nonopt=
< preserve_args=
< lo2o="s/\\.lo\$/.${objext}/"
< o2lo="s/\\.${objext}\$/.lo/"
< extracted_archives=
< extracted_serial=0
---
> # Set a version string.
> scriptversion='(GNU libtool) 2.4.6 Debian-2.4.6-1'
838,841d1981
< # If this variable is set in any of the actions, the command in it
< # will be execed at the end.  This prevents here-documents from being
< # left over by shells.
< exec_cmd=
843,845c1983,1987
< # func_append var value
< # Append VALUE to the end of shell variable VAR.
< func_append ()
---
> # func_echo ARG...
> # ----------------
> # Libtool also displays the current mode in messages, so override
> # funclib.sh func_echo with this custom definition.
> func_echo ()
847,848c1989
<     eval "${1}=\$${1}\${2}"
< } # func_append may be replaced by extended shell implementation
---
>     $debug_cmd
850,857c1991,2000
< # func_append_quoted var value
< # Quote VALUE and append to the end of shell variable VAR, separated
< # by a space.
< func_append_quoted ()
< {
<     func_quote_for_eval "${2}"
<     eval "${1}=\$${1}\\ \$func_quote_for_eval_result"
< } # func_append_quoted may be replaced by extended shell implementation
---
>     _G_message=$*
> 
>     func_echo_IFS=$IFS
>     IFS=$nl
>     for _G_line in $_G_message; do
>       IFS=$func_echo_IFS
>       $ECHO "$progname${opt_mode+: $opt_mode}: $_G_line"
>     done
>     IFS=$func_echo_IFS
> }
860,861c2003,2007
< # func_arith arithmetic-term...
< func_arith ()
---
> # func_warning ARG...
> # -------------------
> # Libtool warnings are not categorized, so override funclib.sh
> # func_warning with this simpler definition.
> func_warning ()
863,864c2009
<     func_arith_result=`expr "${@}"`
< } # func_arith may be replaced by extended shell implementation
---
>     $debug_cmd
865a2011,2012
>     $warning_func ${1+"$@"}
> }
867,872d2013
< # func_len string
< # STRING may not start with a hyphen.
< func_len ()
< {
<     func_len_result=`expr "${1}" : ".*" 2>/dev/null || echo $max_cmd_len`
< } # func_len may be replaced by extended shell implementation
873a2015,2039
> ## ---------------- ##
> ## Options parsing. ##
> ## ---------------- ##
> 
> # Hook in the functions to make sure our own options are parsed during
> # the option parsing loop.
> 
> usage='$progpath [OPTION]... [MODE-ARG]...'
> 
> # Short help message in response to '-h'.
> usage_message="Options:
>        --config             show all configuration variables
>        --debug              enable verbose shell tracing
>    -n, --dry-run            display commands without modifying any files
>        --features           display basic configuration information and exit
>        --mode=MODE          use operation mode MODE
>        --no-warnings        equivalent to '-Wnone'
>        --preserve-dup-deps  don't remove duplicate dependency libraries
>        --quiet, --silent    don't print informational messages
>        --tag=TAG            use configuration variables from tag TAG
>    -v, --verbose            print more informational messages than default
>        --version            print version information
>    -W, --warnings=CATEGORY  report the warnings falling in CATEGORY [all]
>    -h, --help, --help-all   print short, long, or detailed help message
> "
875,876c2041,2042
< # func_lo2o object
< func_lo2o ()
---
> # Additional text appended to 'usage_message' in response to '--help'.
> func_help ()
878,879c2044
<     func_lo2o_result=`$ECHO "${1}" | $SED "$lo2o"`
< } # func_lo2o may be replaced by extended shell implementation
---
>     $debug_cmd
880a2046,2047
>     func_usage_message
>     $ECHO "$long_help_message
882,886c2049
< # func_xform libobj-or-source
< func_xform ()
< {
<     func_xform_result=`$ECHO "${1}" | $SED 's/\.[^.]*$/.lo/'`
< } # func_xform may be replaced by extended shell implementation
---
> MODE must be one of the following:
887a2051,2097
>        clean           remove files from the build directory
>        compile         compile a source file into a libtool object
>        execute         automatically set library path, then run a program
>        finish          complete the installation of libtool libraries
>        install         install libraries or executables
>        link            create a library or an executable
>        uninstall       remove libraries from an installed directory
> 
> MODE-ARGS vary depending on the MODE.  When passed as first option,
> '--mode=MODE' may be abbreviated as 'MODE' or a unique abbreviation of that.
> Try '$progname --help --mode=MODE' for a more detailed description of MODE.
> 
> When reporting a bug, please describe a test case to reproduce it and
> include the following information:
> 
>        host-triplet:   $host
>        shell:          $SHELL
>        compiler:       $LTCC
>        compiler flags: $LTCFLAGS
>        linker:         $LD (gnu? $with_gnu_ld)
>        version:        $progname $scriptversion
>        automake:       `($AUTOMAKE --version) 2>/dev/null |$SED 1q`
>        autoconf:       `($AUTOCONF --version) 2>/dev/null |$SED 1q`
> 
> Report bugs to <bug-libtool@gnu.org>.
> GNU libtool home page: <http://www.gnu.org/s/libtool/>.
> General help using GNU software: <http://www.gnu.org/gethelp/>."
>     exit 0
> }
> 
> 
> # func_lo2o OBJECT-NAME
> # ---------------------
> # Transform OBJECT-NAME from a '.lo' suffix to the platform specific
> # object suffix.
> 
> lo2o=s/\\.lo\$/.$objext/
> o2lo=s/\\.$objext\$/.lo/
> 
> if test yes = "$_G_HAVE_XSI_OPS"; then
>   eval 'func_lo2o ()
>   {
>     case $1 in
>       *.lo) func_lo2o_result=${1%.lo}.$objext ;;
>       *   ) func_lo2o_result=$1               ;;
>     esac
>   }'
889c2099,2122
< # func_fatal_configuration arg...
---
>   # func_xform LIBOBJ-OR-SOURCE
>   # ---------------------------
>   # Transform LIBOBJ-OR-SOURCE from a '.o' or '.c' (or otherwise)
>   # suffix to a '.lo' libtool-object suffix.
>   eval 'func_xform ()
>   {
>     func_xform_result=${1%.*}.lo
>   }'
> else
>   # ...otherwise fall back to using sed.
>   func_lo2o ()
>   {
>     func_lo2o_result=`$ECHO "$1" | $SED "$lo2o"`
>   }
> 
>   func_xform ()
>   {
>     func_xform_result=`$ECHO "$1" | $SED 's|\.[^.]*$|.lo|'`
>   }
> fi
> 
> 
> # func_fatal_configuration ARG...
> # -------------------------------
894,896c2127,2129
<     func_error ${1+"$@"}
<     func_error "See the $PACKAGE documentation for more information."
<     func_fatal_error "Fatal configuration error."
---
>     func__fatal_error ${1+"$@"} \
>       "See the $PACKAGE documentation for more information." \
>       "Fatal configuration error."
900a2134
> # -----------
917a2152
> 
918a2154
> # -------------
923c2159
<     if test "$build_libtool_libs" = yes; then
---
>     if test yes = "$build_libtool_libs"; then
928c2164
<     if test "$build_old_libs" = yes; then
---
>     if test yes = "$build_old_libs"; then
937c2173,2175
< # func_enable_tag tagname
---
> 
> # func_enable_tag TAGNAME
> # -----------------------
943,944c2181,2182
<   # Global variable:
<   tagname="$1"
---
>     # Global variable:
>     tagname=$1
946,955c2184,2193
<   re_begincf="^# ### BEGIN LIBTOOL TAG CONFIG: $tagname\$"
<   re_endcf="^# ### END LIBTOOL TAG CONFIG: $tagname\$"
<   sed_extractcf="/$re_begincf/,/$re_endcf/p"
< 
<   # Validate tagname.
<   case $tagname in
<     *[!-_A-Za-z0-9,/]*)
<       func_fatal_error "invalid tag name: $tagname"
<       ;;
<   esac
---
>     re_begincf="^# ### BEGIN LIBTOOL TAG CONFIG: $tagname\$"
>     re_endcf="^# ### END LIBTOOL TAG CONFIG: $tagname\$"
>     sed_extractcf=/$re_begincf/,/$re_endcf/p
> 
>     # Validate tagname.
>     case $tagname in
>       *[!-_A-Za-z0-9,/]*)
>         func_fatal_error "invalid tag name: $tagname"
>         ;;
>     esac
957,960c2195,2198
<   # Don't test for the "default" C tag, as we know it's
<   # there but not specially marked.
<   case $tagname in
<     CC) ;;
---
>     # Don't test for the "default" C tag, as we know it's
>     # there but not specially marked.
>     case $tagname in
>         CC) ;;
962,963c2200,2201
<       if $GREP "$re_begincf" "$progpath" >/dev/null 2>&1; then
< 	taglist="$taglist $tagname"
---
>         if $GREP "$re_begincf" "$progpath" >/dev/null 2>&1; then
> 	  taglist="$taglist $tagname"
965,975c2203,2213
< 	# Evaluate the configuration.  Be careful to quote the path
< 	# and the sed script, to avoid splitting on whitespace, but
< 	# also don't use non-portable quotes within backquotes within
< 	# quotes we have to do it in 2 steps:
< 	extractedcf=`$SED -n -e "$sed_extractcf" < "$progpath"`
< 	eval "$extractedcf"
<       else
< 	func_error "ignoring unknown tag $tagname"
<       fi
<       ;;
<   esac
---
> 	  # Evaluate the configuration.  Be careful to quote the path
> 	  # and the sed script, to avoid splitting on whitespace, but
> 	  # also don't use non-portable quotes within backquotes within
> 	  # quotes we have to do it in 2 steps:
> 	  extractedcf=`$SED -n -e "$sed_extractcf" < "$progpath"`
> 	  eval "$extractedcf"
>         else
> 	  func_error "ignoring unknown tag $tagname"
>         fi
>         ;;
>     esac
977a2216
> 
978a2218
> # ------------------------
983,986c2223,2226
<   if test "$package_revision" != "$macro_revision"; then
<     if test "$VERSION" != "$macro_version"; then
<       if test -z "$macro_version"; then
<         cat >&2 <<_LT_EOF
---
>     if test "$package_revision" != "$macro_revision"; then
>       if test "$VERSION" != "$macro_version"; then
>         if test -z "$macro_version"; then
>           cat >&2 <<_LT_EOF
992,993c2232,2233
<       else
<         cat >&2 <<_LT_EOF
---
>         else
>           cat >&2 <<_LT_EOF
999,1001c2239,2241
<       fi
<     else
<       cat >&2 <<_LT_EOF
---
>         fi
>       else
>         cat >&2 <<_LT_EOF
1007c2247
<     fi
---
>       fi
1009,1010c2249,2250
<     exit $EXIT_MISMATCH
<   fi
---
>       exit $EXIT_MISMATCH
>     fi
1014,1037c2254,2259
< # Shorthand for --mode=foo, only valid as the first argument
< case $1 in
< clean|clea|cle|cl)
<   shift; set dummy --mode clean ${1+"$@"}; shift
<   ;;
< compile|compil|compi|comp|com|co|c)
<   shift; set dummy --mode compile ${1+"$@"}; shift
<   ;;
< execute|execut|execu|exec|exe|ex|e)
<   shift; set dummy --mode execute ${1+"$@"}; shift
<   ;;
< finish|finis|fini|fin|fi|f)
<   shift; set dummy --mode finish ${1+"$@"}; shift
<   ;;
< install|instal|insta|inst|ins|in|i)
<   shift; set dummy --mode install ${1+"$@"}; shift
<   ;;
< link|lin|li|l)
<   shift; set dummy --mode link ${1+"$@"}; shift
<   ;;
< uninstall|uninstal|uninsta|uninst|unins|unin|uni|un|u)
<   shift; set dummy --mode uninstall ${1+"$@"}; shift
<   ;;
< esac
---
> # libtool_options_prep [ARG]...
> # -----------------------------
> # Preparation for options parsed by libtool.
> libtool_options_prep ()
> {
>     $debug_mode
1038a2261,2268
>     # Option defaults:
>     opt_config=false
>     opt_dlopen=
>     opt_dry_run=false
>     opt_help=false
>     opt_mode=
>     opt_preserve_dup_deps=false
>     opt_quiet=false
1039a2270,2271
>     nonopt=
>     preserve_args=
1041,1054c2273,2296
< # Option defaults:
< opt_debug=:
< opt_dry_run=false
< opt_config=false
< opt_preserve_dup_deps=false
< opt_features=false
< opt_finish=false
< opt_help=false
< opt_help_all=false
< opt_silent=:
< opt_warning=:
< opt_verbose=:
< opt_silent=false
< opt_verbose=false
---
>     # Shorthand for --mode=foo, only valid as the first argument
>     case $1 in
>     clean|clea|cle|cl)
>       shift; set dummy --mode clean ${1+"$@"}; shift
>       ;;
>     compile|compil|compi|comp|com|co|c)
>       shift; set dummy --mode compile ${1+"$@"}; shift
>       ;;
>     execute|execut|execu|exec|exe|ex|e)
>       shift; set dummy --mode execute ${1+"$@"}; shift
>       ;;
>     finish|finis|fini|fin|fi|f)
>       shift; set dummy --mode finish ${1+"$@"}; shift
>       ;;
>     install|instal|insta|inst|ins|in|i)
>       shift; set dummy --mode install ${1+"$@"}; shift
>       ;;
>     link|lin|li|l)
>       shift; set dummy --mode link ${1+"$@"}; shift
>       ;;
>     uninstall|uninstal|uninsta|uninst|unins|unin|uni|un|u)
>       shift; set dummy --mode uninstall ${1+"$@"}; shift
>       ;;
>     esac
1055a2298,2302
>     # Pass back the list of options.
>     func_quote_for_eval ${1+"$@"}
>     libtool_options_prep_result=$func_quote_for_eval_result
> }
> func_add_hook func_options_prep libtool_options_prep
1057,1169d2303
< # Parse options once, thoroughly.  This comes as soon as possible in the
< # script to make things like `--version' happen as quickly as we can.
< {
<   # this just eases exit handling
<   while test $# -gt 0; do
<     opt="$1"
<     shift
<     case $opt in
<       --debug|-x)	opt_debug='set -x'
< 			func_echo "enabling shell trace mode"
< 			$opt_debug
< 			;;
<       --dry-run|--dryrun|-n)
< 			opt_dry_run=:
< 			;;
<       --config)
< 			opt_config=:
< func_config
< 			;;
<       --dlopen|-dlopen)
< 			optarg="$1"
< 			opt_dlopen="${opt_dlopen+$opt_dlopen
< }$optarg"
< 			shift
< 			;;
<       --preserve-dup-deps)
< 			opt_preserve_dup_deps=:
< 			;;
<       --features)
< 			opt_features=:
< func_features
< 			;;
<       --finish)
< 			opt_finish=:
< set dummy --mode finish ${1+"$@"}; shift
< 			;;
<       --help)
< 			opt_help=:
< 			;;
<       --help-all)
< 			opt_help_all=:
< opt_help=': help-all'
< 			;;
<       --mode)
< 			test $# = 0 && func_missing_arg $opt && break
< 			optarg="$1"
< 			opt_mode="$optarg"
< case $optarg in
<   # Valid mode arguments:
<   clean|compile|execute|finish|install|link|relink|uninstall) ;;
< 
<   # Catch anything else as an error
<   *) func_error "invalid argument for $opt"
<      exit_cmd=exit
<      break
<      ;;
< esac
< 			shift
< 			;;
<       --no-silent|--no-quiet)
< 			opt_silent=false
< func_append preserve_args " $opt"
< 			;;
<       --no-warning|--no-warn)
< 			opt_warning=false
< func_append preserve_args " $opt"
< 			;;
<       --no-verbose)
< 			opt_verbose=false
< func_append preserve_args " $opt"
< 			;;
<       --silent|--quiet)
< 			opt_silent=:
< func_append preserve_args " $opt"
<         opt_verbose=false
< 			;;
<       --verbose|-v)
< 			opt_verbose=:
< func_append preserve_args " $opt"
< opt_silent=false
< 			;;
<       --tag)
< 			test $# = 0 && func_missing_arg $opt && break
< 			optarg="$1"
< 			opt_tag="$optarg"
< func_append preserve_args " $opt $optarg"
< func_enable_tag "$optarg"
< 			shift
< 			;;
< 
<       -\?|-h)		func_usage				;;
<       --help)		func_help				;;
<       --version)	func_version				;;
< 
<       # Separate optargs to long options:
<       --*=*)
< 			func_split_long_opt "$opt"
< 			set dummy "$func_split_long_opt_name" "$func_split_long_opt_arg" ${1+"$@"}
< 			shift
< 			;;
< 
<       # Separate non-argument short options:
<       -\?*|-h*|-n*|-v*)
< 			func_split_short_opt "$opt"
< 			set dummy "$func_split_short_opt_name" "-$func_split_short_opt_arg" ${1+"$@"}
< 			shift
< 			;;
< 
<       --)		break					;;
<       -*)		func_fatal_help "unrecognized option \`$opt'" ;;
<       *)		set dummy "$opt" ${1+"$@"};	shift; break  ;;
<     esac
<   done
1171c2305,2310
<   # Validate options:
---
> # libtool_parse_options [ARG]...
> # ---------------------------------
> # Provide handling for libtool specific options.
> libtool_parse_options ()
> {
>     $debug_cmd
1173,1177c2312,2387
<   # save first non-option argument
<   if test "$#" -gt 0; then
<     nonopt="$opt"
<     shift
<   fi
---
>     # Perform our own loop to consume as many options as possible in
>     # each iteration.
>     while test $# -gt 0; do
>       _G_opt=$1
>       shift
>       case $_G_opt in
>         --dry-run|--dryrun|-n)
>                         opt_dry_run=:
>                         ;;
> 
>         --config)       func_config ;;
> 
>         --dlopen|-dlopen)
>                         opt_dlopen="${opt_dlopen+$opt_dlopen
> }$1"
>                         shift
>                         ;;
> 
>         --preserve-dup-deps)
>                         opt_preserve_dup_deps=: ;;
> 
>         --features)     func_features ;;
> 
>         --finish)       set dummy --mode finish ${1+"$@"}; shift ;;
> 
>         --help)         opt_help=: ;;
> 
>         --help-all)     opt_help=': help-all' ;;
> 
>         --mode)         test $# = 0 && func_missing_arg $_G_opt && break
>                         opt_mode=$1
>                         case $1 in
>                           # Valid mode arguments:
>                           clean|compile|execute|finish|install|link|relink|uninstall) ;;
> 
>                           # Catch anything else as an error
>                           *) func_error "invalid argument for $_G_opt"
>                              exit_cmd=exit
>                              break
>                              ;;
>                         esac
>                         shift
>                         ;;
> 
>         --no-silent|--no-quiet)
>                         opt_quiet=false
>                         func_append preserve_args " $_G_opt"
>                         ;;
> 
>         --no-warnings|--no-warning|--no-warn)
>                         opt_warning=false
>                         func_append preserve_args " $_G_opt"
>                         ;;
> 
>         --no-verbose)
>                         opt_verbose=false
>                         func_append preserve_args " $_G_opt"
>                         ;;
> 
>         --silent|--quiet)
>                         opt_quiet=:
>                         opt_verbose=false
>                         func_append preserve_args " $_G_opt"
>                         ;;
> 
>         --tag)          test $# = 0 && func_missing_arg $_G_opt && break
>                         opt_tag=$1
>                         func_append preserve_args " $_G_opt $1"
>                         func_enable_tag "$1"
>                         shift
>                         ;;
> 
>         --verbose|-v)   opt_quiet=false
>                         opt_verbose=:
>                         func_append preserve_args " $_G_opt"
>                         ;;
1179,1180c2389,2392
<   # preserve --debug
<   test "$opt_debug" = : || func_append preserve_args " --debug"
---
> 	# An option not handled by this hook function:
>         *)		set dummy "$_G_opt" ${1+"$@"};	shift; break  ;;
>       esac
>     done
1182,1190d2393
<   case $host in
<     *cygwin* | *mingw* | *pw32* | *cegcc*)
<       # don't eliminate duplications in $postdeps and $predeps
<       opt_duplicate_compiler_generated_deps=:
<       ;;
<     *)
<       opt_duplicate_compiler_generated_deps=$opt_preserve_dup_deps
<       ;;
<   esac
1192,1194c2395,2399
<   $opt_help || {
<     # Sanity checks first:
<     func_check_version_match
---
>     # save modified positional parameters for caller
>     func_quote_for_eval ${1+"$@"}
>     libtool_parse_options_result=$func_quote_for_eval_result
> }
> func_add_hook func_parse_options libtool_parse_options
1196,1198d2400
<     if test "$build_libtool_libs" != yes && test "$build_old_libs" != yes; then
<       func_fatal_configuration "not configured to build any kind of library"
<     fi
1200,1201d2401
<     # Darwin sucks
<     eval std_shrext=\"$shrext_cmds\"
1203,1207c2403,2412
<     # Only execute mode is allowed to have -dlopen flags.
<     if test -n "$opt_dlopen" && test "$opt_mode" != execute; then
<       func_error "unrecognized option \`-dlopen'"
<       $ECHO "$help" 1>&2
<       exit $EXIT_FAILURE
---
> # libtool_validate_options [ARG]...
> # ---------------------------------
> # Perform any sanity checks on option settings and/or unconsumed
> # arguments.
> libtool_validate_options ()
> {
>     # save first non-option argument
>     if test 0 -lt $#; then
>       nonopt=$1
>       shift
1210,1213c2415,2428
<     # Change the help message to a mode-specific one.
<     generic_help="$help"
<     help="Try \`$progname --help --mode=$opt_mode' for more information."
<   }
---
>     # preserve --debug
>     test : = "$debug_cmd" || func_append preserve_args " --debug"
> 
>     case $host in
>       # Solaris2 added to fix http://debbugs.gnu.org/cgi/bugreport.cgi?bug=16452
>       # see also: http://gcc.gnu.org/bugzilla/show_bug.cgi?id=59788
>       *cygwin* | *mingw* | *pw32* | *cegcc* | *solaris2* | *os2*)
>         # don't eliminate duplications in $postdeps and $predeps
>         opt_duplicate_compiler_generated_deps=:
>         ;;
>       *)
>         opt_duplicate_compiler_generated_deps=$opt_preserve_dup_deps
>         ;;
>     esac
1214a2430,2451
>     $opt_help || {
>       # Sanity checks first:
>       func_check_version_match
> 
>       test yes != "$build_libtool_libs" \
>         && test yes != "$build_old_libs" \
>         && func_fatal_configuration "not configured to build any kind of library"
> 
>       # Darwin sucks
>       eval std_shrext=\"$shrext_cmds\"
> 
>       # Only execute mode is allowed to have -dlopen flags.
>       if test -n "$opt_dlopen" && test execute != "$opt_mode"; then
>         func_error "unrecognized option '-dlopen'"
>         $ECHO "$help" 1>&2
>         exit $EXIT_FAILURE
>       fi
> 
>       # Change the help message to a mode-specific one.
>       generic_help=$help
>       help="Try '$progname --help --mode=$opt_mode' for more information."
>     }
1216,1217c2453,2455
<   # Bail if the options were screwed
<   $exit_cmd $EXIT_FAILURE
---
>     # Pass back the unparsed argument list
>     func_quote_for_eval ${1+"$@"}
>     libtool_validate_options_result=$func_quote_for_eval_result
1218a2457
> func_add_hook func_validate_options libtool_validate_options
1220a2460,2464
> # Process options as early as possible so that --help and --version
> # can return quickly.
> func_options ${1+"$@"}
> eval set dummy "$func_options_result"; shift
> 
1226a2471,2499
> magic='%%%MAGIC variable%%%'
> magic_exe='%%%MAGIC EXE variable%%%'
> 
> # Global variables.
> extracted_archives=
> extracted_serial=0
> 
> # If this variable is set in any of the actions, the command in it
> # will be execed at the end.  This prevents here-documents from being
> # left over by shells.
> exec_cmd=
> 
> 
> # A function that is used when there is no print builtin or printf.
> func_fallback_echo ()
> {
>   eval 'cat <<_LTECHO_EOF
> $1
> _LTECHO_EOF'
> }
> 
> # func_generated_by_libtool
> # True iff stdin has been generated by Libtool. This function is only
> # a basic sanity check; it will hardly flush out determined imposters.
> func_generated_by_libtool_p ()
> {
>   $GREP "^# Generated by .*$PACKAGE" > /dev/null 2>&1
> }
> 
1228c2501
< # True iff FILE is a libtool `.la' library or `.lo' object file.
---
> # True iff FILE is a libtool '.la' library or '.lo' object file.
1234,1235c2507
<       $SED -e 4q "$1" 2>/dev/null \
<         | $GREP "^# Generated by .*$PACKAGE" > /dev/null 2>&1
---
>       $SED -e 4q "$1" 2>/dev/null | func_generated_by_libtool_p
1239c2511
< # True iff FILE is a libtool `.la' library or `.lo' object file.
---
> # True iff FILE is a libtool '.la' library or '.lo' object file.
1244c2516
< # fatal anyway.  Works if `file' does not exist.
---
> # fatal anyway.  Works if 'file' does not exist.
1252c2524
< 	    case "$lalib_p_line" in
---
> 	    case $lalib_p_line in
1258c2530
<     test "$lalib_p" = yes
---
>     test yes = "$lalib_p"
1267c2539,2540
<     func_lalib_p "$1"
---
>     test -f "$1" &&
>       $lt_truncate_bin < "$1" 2>/dev/null | func_generated_by_libtool_p
1292c2565
<     func_ltwrapper_scriptname_result="$func_dirname_result/$objdir/${func_stripname_result}_ltshwrapper"
---
>     func_ltwrapper_scriptname_result=$func_dirname_result/$objdir/${func_stripname_result}_ltshwrapper
1311c2584,2585
<     $opt_debug
---
>     $debug_cmd
> 
1314c2588
<       IFS=$save_ifs
---
>       IFS=$sp$nl
1315a2590
>       IFS=$save_ifs
1327c2602
< # `FILE.' does not work on cygwin managed mounts.
---
> # 'FILE.' does not work on cygwin managed mounts.
1330c2605,2606
<     $opt_debug
---
>     $debug_cmd
> 
1357c2633
<   case "$lt_sysroot:$1" in
---
>   case $lt_sysroot:$1 in
1360c2636
<     func_replace_sysroot_result="=$func_stripname_result"
---
>     func_replace_sysroot_result='='$func_stripname_result
1377c2653,2654
<     $opt_debug
---
>     $debug_cmd
> 
1396c2673
< 	    eval "`${SED} -n -e '/^# ### BEGIN LIBTOOL TAG CONFIG: '$z'$/,/^# ### END LIBTOOL TAG CONFIG: '$z'$/p' < $progpath`"
---
> 	    eval "`$SED -n -e '/^# ### BEGIN LIBTOOL TAG CONFIG: '$z'$/,/^# ### END LIBTOOL TAG CONFIG: '$z'$/p' < $progpath`"
1421c2698
< 	  func_fatal_error "specify a tag with \`--tag'"
---
> 	  func_fatal_error "specify a tag with '--tag'"
1437,1439c2714,2716
<     write_libobj=${1}
<     if test "$build_libtool_libs" = yes; then
<       write_lobj=\'${2}\'
---
>     write_libobj=$1
>     if test yes = "$build_libtool_libs"; then
>       write_lobj=\'$2\'
1444,1445c2721,2722
<     if test "$build_old_libs" = yes; then
<       write_oldobj=\'${3}\'
---
>     if test yes = "$build_old_libs"; then
>       write_oldobj=\'$3\'
1453c2730
< # Generated by $PROGRAM (GNU $PACKAGE$TIMESTAMP) $VERSION
---
> # Generated by $PROGRAM (GNU $PACKAGE) $VERSION
1465c2742
<       $MV "${write_libobj}T" "${write_libobj}"
---
>       $MV "${write_libobj}T" "$write_libobj"
1485,1486c2762,2764
<   $opt_debug
<   func_convert_core_file_wine_to_w32_result="$1"
---
>   $debug_cmd
> 
>   func_convert_core_file_wine_to_w32_result=$1
1494c2772
<     if test "$?" -eq 0 && test -n "${func_convert_core_file_wine_to_w32_tmp}"; then
---
>     if test "$?" -eq 0 && test -n "$func_convert_core_file_wine_to_w32_tmp"; then
1496c2774
<         $SED -e "$lt_sed_naive_backslashify"`
---
>         $SED -e "$sed_naive_backslashify"`
1517c2795,2796
<   $opt_debug
---
>   $debug_cmd
> 
1519c2798
<   func_convert_core_path_wine_to_w32_result=""
---
>   func_convert_core_path_wine_to_w32_result=
1526c2805
<       if test -n "$func_convert_core_file_wine_to_w32_result" ; then
---
>       if test -n "$func_convert_core_file_wine_to_w32_result"; then
1528c2807
<           func_convert_core_path_wine_to_w32_result="$func_convert_core_file_wine_to_w32_result"
---
>           func_convert_core_path_wine_to_w32_result=$func_convert_core_file_wine_to_w32_result
1557c2836,2837
<   $opt_debug
---
>   $debug_cmd
> 
1566c2846
<     func_error "LT_CYGPATH is empty or specifies non-existent file: \`$LT_CYGPATH'"
---
>     func_error "LT_CYGPATH is empty or specifies non-existent file: '$LT_CYGPATH'"
1577c2857,2858
<   $opt_debug
---
>   $debug_cmd
> 
1580c2861
<     $SED -e 's/[ ]*$//' -e "$lt_sed_naive_backslashify"`
---
>     $SED -e 's/[ ]*$//' -e "$sed_naive_backslashify"`
1591,1592c2872,2874
<   $opt_debug
<   if test -z "$2" && test -n "$1" ; then
---
>   $debug_cmd
> 
>   if test -z "$2" && test -n "$1"; then
1594c2876
<     func_error "  \`$1'"
---
>     func_error "  '$1'"
1597c2879
<     func_to_host_file_result="$1"
---
>     func_to_host_file_result=$1
1609c2891,2892
<   $opt_debug
---
>   $debug_cmd
> 
1612c2895
<     func_error "  \`$3'"
---
>     func_error "  '$3'"
1621c2904
<       func_to_host_path_result="$3"
---
>       func_to_host_path_result=$3
1633c2916,2917
<   $opt_debug
---
>   $debug_cmd
> 
1635c2919
<   $1 ) func_to_host_path_result="$3$func_to_host_path_result"
---
>   $1 ) func_to_host_path_result=$3$func_to_host_path_result
1649c2933
< # invoked via `$to_host_file_cmd ARG'
---
> # invoked via '$to_host_file_cmd ARG'
1660c2944,2945
<   $opt_debug
---
>   $debug_cmd
> 
1672c2957,2958
<   $opt_debug
---
>   $debug_cmd
> 
1690c2976
<   func_to_host_file_result="$1"
---
>   func_to_host_file_result=$1
1701,1702c2987,2989
<   $opt_debug
<   func_to_host_file_result="$1"
---
>   $debug_cmd
> 
>   func_to_host_file_result=$1
1705c2992
<     func_to_host_file_result="$func_convert_core_msys_to_w32_result"
---
>     func_to_host_file_result=$func_convert_core_msys_to_w32_result
1717,1718c3004,3006
<   $opt_debug
<   func_to_host_file_result="$1"
---
>   $debug_cmd
> 
>   func_to_host_file_result=$1
1734,1735c3022,3024
<   $opt_debug
<   func_to_host_file_result="$1"
---
>   $debug_cmd
> 
>   func_to_host_file_result=$1
1738c3027
<     func_to_host_file_result="$func_convert_core_file_wine_to_w32_result"
---
>     func_to_host_file_result=$func_convert_core_file_wine_to_w32_result
1750,1751c3039,3041
<   $opt_debug
<   func_to_host_file_result="$1"
---
>   $debug_cmd
> 
>   func_to_host_file_result=$1
1755c3045
<     func_to_host_file_result="$func_cygpath_result"
---
>     func_to_host_file_result=$func_cygpath_result
1768,1769c3058,3060
<   $opt_debug
<   func_to_host_file_result="$1"
---
>   $debug_cmd
> 
>   func_to_host_file_result=$1
1774c3065
<     func_to_host_file_result="$func_cygpath_result"
---
>     func_to_host_file_result=$func_cygpath_result
1784c3075
< # invoked via `$to_host_path_cmd ARG'
---
> # invoked via '$to_host_path_cmd ARG'
1808c3099,3100
<   $opt_debug
---
>   $debug_cmd
> 
1811c3103
<     to_host_path_cmd="func_convert_path_${func_stripname_result}"
---
>     to_host_path_cmd=func_convert_path_$func_stripname_result
1821c3113,3114
<   $opt_debug
---
>   $debug_cmd
> 
1832c3125
<   func_to_host_path_result="$1"
---
>   func_to_host_path_result=$1
1843,1844c3136,3138
<   $opt_debug
<   func_to_host_path_result="$1"
---
>   $debug_cmd
> 
>   func_to_host_path_result=$1
1852c3146
<     func_to_host_path_result="$func_convert_core_msys_to_w32_result"
---
>     func_to_host_path_result=$func_convert_core_msys_to_w32_result
1866,1867c3160,3162
<   $opt_debug
<   func_to_host_path_result="$1"
---
>   $debug_cmd
> 
>   func_to_host_path_result=$1
1886,1887c3181,3183
<   $opt_debug
<   func_to_host_path_result="$1"
---
>   $debug_cmd
> 
>   func_to_host_path_result=$1
1893c3189
<     func_to_host_path_result="$func_convert_core_path_wine_to_w32_result"
---
>     func_to_host_path_result=$func_convert_core_path_wine_to_w32_result
1907,1908c3203,3205
<   $opt_debug
<   func_to_host_path_result="$1"
---
>   $debug_cmd
> 
>   func_to_host_path_result=$1
1915c3212
<     func_to_host_path_result="$func_cygpath_result"
---
>     func_to_host_path_result=$func_cygpath_result
1930,1931c3227,3229
<   $opt_debug
<   func_to_host_path_result="$1"
---
>   $debug_cmd
> 
>   func_to_host_path_result=$1
1940c3238
<     func_to_host_path_result="$func_cygpath_result"
---
>     func_to_host_path_result=$func_cygpath_result
1948a3247,3263
> # func_dll_def_p FILE
> # True iff FILE is a Windows DLL '.def' file.
> # Keep in sync with _LT_DLL_DEF_P in libtool.m4
> func_dll_def_p ()
> {
>   $debug_cmd
> 
>   func_dll_def_p_tmp=`$SED -n \
>     -e 's/^[	 ]*//' \
>     -e '/^\(;.*\)*$/d' \
>     -e 's/^\(EXPORTS\|LIBRARY\)\([	 ].*\)*$/DEF/p' \
>     -e q \
>     "$1"`
>   test DEF = "$func_dll_def_p_tmp"
> }
> 
> 
1952c3267,3268
<     $opt_debug
---
>     $debug_cmd
> 
1955c3271
<     srcfile="$nonopt"  #  always keep a non-empty value in "srcfile"
---
>     srcfile=$nonopt  #  always keep a non-empty value in "srcfile"
1968c3284
< 	lastarg="$arg"
---
> 	lastarg=$arg
1973c3289
< 	libobj="$arg"
---
> 	libobj=$arg
1983c3299
< 	    func_fatal_error "you cannot specify \`-o' more than once"
---
> 	    func_fatal_error "you cannot specify '-o' more than once"
2012c3328
< 	  save_ifs="$IFS"; IFS=','
---
> 	  save_ifs=$IFS; IFS=,
2014c3330
< 	    IFS="$save_ifs"
---
> 	    IFS=$save_ifs
2017c3333
< 	  IFS="$save_ifs"
---
> 	  IFS=$save_ifs
2030,2031c3346,3347
< 	  lastarg="$srcfile"
< 	  srcfile="$arg"
---
> 	  lastarg=$srcfile
> 	  srcfile=$arg
2046c3362
<       func_fatal_error "you must specify a target with \`-o'"
---
>       func_fatal_error "you must specify a target with '-o'"
2052c3368
< 	libobj="$func_basename_result"
---
> 	libobj=$func_basename_result
2072c3388
<       func_fatal_error "cannot determine name of library object from \`$libobj'"
---
>       func_fatal_error "cannot determine name of library object from '$libobj'"
2081,2082c3397,3398
< 	test "$build_libtool_libs" != yes && \
< 	  func_fatal_configuration "can not build a shared library"
---
> 	test yes = "$build_libtool_libs" \
> 	  || func_fatal_configuration "cannot build a shared library"
2108c3424
<       && func_warning "libobj name \`$libobj' may not contain shell special characters."
---
>       && func_warning "libobj name '$libobj' may not contain shell special characters."
2110,2112c3426,3428
<     objname="$func_basename_result"
<     xdir="$func_dirname_result"
<     lobj=${xdir}$objdir/$objname
---
>     objname=$func_basename_result
>     xdir=$func_dirname_result
>     lobj=$xdir$objdir/$objname
2118c3434
<     if test "$build_old_libs" = yes; then
---
>     if test yes = "$build_old_libs"; then
2130c3446
<     if test "$pic_mode" = no && test "$deplibs_check_method" != pass_all; then
---
>     if test no = "$pic_mode" && test pass_all != "$deplibs_check_method"; then
2137,2139c3453,3455
<     if test "$compiler_c_o" = no; then
<       output_obj=`$ECHO "$srcfile" | $SED 's%^.*/%%; s%\.[^.]*$%%'`.${objext}
<       lockfile="$output_obj.lock"
---
>     if test no = "$compiler_c_o"; then
>       output_obj=`$ECHO "$srcfile" | $SED 's%^.*/%%; s%\.[^.]*$%%'`.$objext
>       lockfile=$output_obj.lock
2148c3464
<     if test "$need_locks" = yes; then
---
>     if test yes = "$need_locks"; then
2153c3469
<     elif test "$need_locks" = warn; then
---
>     elif test warn = "$need_locks"; then
2161c3477
< your compiler does not support \`-c' and \`-o' together.  If you
---
> your compiler does not support '-c' and '-o' together.  If you
2183c3499
<     if test "$build_libtool_libs" = yes; then
---
>     if test yes = "$build_libtool_libs"; then
2187c3503
<       if test "$pic_mode" != no; then
---
>       if test no != "$pic_mode"; then
2204c3520
<       if test "$need_locks" = warn &&
---
>       if test warn = "$need_locks" &&
2215c3531
< your compiler does not support \`-c' and \`-o' together.  If you
---
> your compiler does not support '-c' and '-o' together.  If you
2231c3547
<       if test "$suppress_opt" = yes; then
---
>       if test yes = "$suppress_opt"; then
2237,2238c3553,3554
<     if test "$build_old_libs" = yes; then
<       if test "$pic_mode" != yes; then
---
>     if test yes = "$build_old_libs"; then
>       if test yes != "$pic_mode"; then
2244c3560
<       if test "$compiler_c_o" = yes; then
---
>       if test yes = "$compiler_c_o"; then
2253c3569
<       if test "$need_locks" = warn &&
---
>       if test warn = "$need_locks" &&
2264c3580
< your compiler does not support \`-c' and \`-o' together.  If you
---
> your compiler does not support '-c' and '-o' together.  If you
2284c3600
<       if test "$need_locks" != no; then
---
>       if test no != "$need_locks"; then
2294c3610
<   test "$opt_mode" = compile && func_mode_compile ${1+"$@"}
---
>   test compile = "$opt_mode" && func_mode_compile ${1+"$@"}
2314c3630
< (typically \`/bin/rm').  RM-OPTIONS are options (such as \`-f') to be passed
---
> (typically '/bin/rm').  RM-OPTIONS are options (such as '-f') to be passed
2333,2334c3649,3650
<   -shared           do not build a \`.o' file suitable for static linking
<   -static           only build a \`.o' file suitable for static linking
---
>   -shared           do not build a '.o' file suitable for static linking
>   -static           only build a '.o' file suitable for static linking
2337c3653
< COMPILE-COMMAND is a command to be used in creating a \`standard' object file
---
> COMPILE-COMMAND is a command to be used in creating a 'standard' object file
2341,2342c3657,3658
< SOURCEFILE, then substituting the C source code suffix \`.c' with the
< library object suffix, \`.lo'."
---
> SOURCEFILE, then substituting the C source code suffix '.c' with the
> library object suffix, '.lo'."
2355c3671
< This mode sets the library path environment variable according to \`-dlopen'
---
> This mode sets the library path environment variable according to '-dlopen'
2374c3690
< the \`--dry-run' option if you just want to see what would be executed."
---
> the '--dry-run' option if you just want to see what would be executed."
2384c3700
< either the \`install' or \`cp' program.
---
> either the 'install' or 'cp' program.
2410c3726
<   -dlopen FILE      \`-dlpreopen' FILE if it cannot be dlopened at runtime
---
>   -dlopen FILE      '-dlpreopen' FILE if it cannot be dlopened at runtime
2424c3740,3741
<   -objectlist FILE  Use a list of object files found in FILE to specify objects
---
>   -objectlist FILE  use a list of object files found in FILE to specify objects
>   -os2dllname NAME  force a short DLL name on OS/2 (no effect on other OSes)
2444c3761
< All other options (arguments beginning with \`-') are ignored.
---
> All other options (arguments beginning with '-') are ignored.
2446c3763
< Every other argument is treated as a filename.  Files ending in \`.la' are
---
> Every other argument is treated as a filename.  Files ending in '.la' are
2450,2451c3767,3768
< If the OUTPUT-FILE ends in \`.la', then a libtool library is created,
< only library objects (\`.lo' files) may be specified, and \`-rpath' is
---
> If the OUTPUT-FILE ends in '.la', then a libtool library is created,
> only library objects ('.lo' files) may be specified, and '-rpath' is
2454,2455c3771,3772
< If OUTPUT-FILE ends in \`.a' or \`.lib', then a standard library is created
< using \`ar' and \`ranlib', or on Windows using \`lib'.
---
> If OUTPUT-FILE ends in '.a' or '.lib', then a standard library is created
> using 'ar' and 'ranlib', or on Windows using 'lib'.
2457c3774
< If OUTPUT-FILE ends in \`.lo' or \`.${objext}', then a reloadable object file
---
> If OUTPUT-FILE ends in '.lo' or '.$objext', then a reloadable object file
2468c3785
< (typically \`/bin/rm').  RM-OPTIONS are options (such as \`-f') to be passed
---
> (typically '/bin/rm').  RM-OPTIONS are options (such as '-f') to be passed
2476c3793
<         func_fatal_help "invalid operation mode \`$opt_mode'"
---
>         func_fatal_help "invalid operation mode '$opt_mode'"
2481c3798
<     $ECHO "Try \`$progname --help' for more information about other modes."
---
>     $ECHO "Try '$progname --help' for more information about other modes."
2486c3803
<   if test "$opt_help" = :; then
---
>   if test : = "$opt_help"; then
2494c3811
<     } | sed -n '1p; 2,$s/^Usage:/  or: /p'
---
>     } | $SED -n '1p; 2,$s/^Usage:/  or: /p'
2502c3819
<     sed '1d
---
>     $SED '1d
2519c3836,3837
<     $opt_debug
---
>     $debug_cmd
> 
2521c3839
<     cmd="$nonopt"
---
>     cmd=$nonopt
2528c3846
< 	|| func_fatal_help "\`$file' is not a file"
---
> 	|| func_fatal_help "'$file' is not a file"
2538c3856
< 	  || func_fatal_help "\`$lib' is not a valid libtool archive"
---
> 	  || func_fatal_help "'$lib' is not a valid libtool archive"
2549c3867
< 	    func_warning "\`$file' was not linked with \`-export-dynamic'"
---
> 	    func_warning "'$file' was not linked with '-export-dynamic'"
2554c3872
< 	dir="$func_dirname_result"
---
> 	dir=$func_dirname_result
2560c3878
< 	    func_fatal_error "cannot find \`$dlname' in \`$dir' or \`$dir/$objdir'"
---
> 	    func_fatal_error "cannot find '$dlname' in '$dir' or '$dir/$objdir'"
2568c3886
< 	dir="$func_dirname_result"
---
> 	dir=$func_dirname_result
2572c3890
< 	func_warning "\`-dlopen' is ignored for non-libtool libraries and objects"
---
> 	func_warning "'-dlopen' is ignored for non-libtool libraries and objects"
2579c3897
<       test -n "$absdir" && dir="$absdir"
---
>       test -n "$absdir" && dir=$absdir
2591c3909
<     libtool_execute_magic="$magic"
---
>     libtool_execute_magic=$magic
2604c3922
< 	  file="$progdir/$program"
---
> 	  file=$progdir/$program
2609c3927
< 	  file="$progdir/$program"
---
> 	  file=$progdir/$program
2617c3935,3943
<     if test "X$opt_dry_run" = Xfalse; then
---
>     if $opt_dry_run; then
>       # Display what would be done.
>       if test -n "$shlibpath_var"; then
> 	eval "\$ECHO \"\$shlibpath_var=\$$shlibpath_var\""
> 	echo "export $shlibpath_var"
>       fi
>       $ECHO "$cmd$args"
>       exit $EXIT_SUCCESS
>     else
2634,2642c3960
<       exec_cmd="\$cmd$args"
<     else
<       # Display what would be done.
<       if test -n "$shlibpath_var"; then
< 	eval "\$ECHO \"\$shlibpath_var=\$$shlibpath_var\""
< 	echo "export $shlibpath_var"
<       fi
<       $ECHO "$cmd$args"
<       exit $EXIT_SUCCESS
---
>       exec_cmd=\$cmd$args
2646c3964
< test "$opt_mode" = execute && func_mode_execute ${1+"$@"}
---
> test execute = "$opt_mode" && func_mode_execute ${1+"$@"}
2652c3970,3971
<     $opt_debug
---
>     $debug_cmd
> 
2666c3985
< 	  func_warning "\`$opt' is not a valid libtool archive"
---
> 	  func_warning "'$opt' is not a valid libtool archive"
2670c3989
< 	func_fatal_error "invalid argument \`$opt'"
---
> 	func_fatal_error "invalid argument '$opt'"
2685c4004
<           echo "removing references to $lt_sysroot and \`=' prefixes from $lib"
---
>           echo "removing references to $lt_sysroot and '=' prefixes from $lib"
2690c4009
< 	  sed -e "${sysroot_cmd} s/\([ ']-[LR]\)=/\1/g; s/\([ ']\)=/\1/g" $lib \
---
> 	  $SED -e "$sysroot_cmd s/\([ ']-[LR]\)=/\1/g; s/\([ ']\)=/\1/g" $lib \
2715c4034
<     $opt_silent && exit $EXIT_SUCCESS
---
>     $opt_quiet && exit $EXIT_SUCCESS
2726c4045
<       echo "specify the full pathname of the library, or use the \`-LLIBDIR'"
---
>       echo "specify the full pathname of the library, or use the '-LLIBDIR'"
2729c4048
< 	echo "   - add LIBDIR to the \`$shlibpath_var' environment variable"
---
> 	echo "   - add LIBDIR to the '$shlibpath_var' environment variable"
2733c4052
< 	echo "   - add LIBDIR to the \`$runpath_var' environment variable"
---
> 	echo "   - add LIBDIR to the '$runpath_var' environment variable"
2740c4059
< 	$ECHO "   - use the \`$flag' linker flag"
---
> 	$ECHO "   - use the '$flag' linker flag"
2746c4065
< 	echo "   - have your system administrator add LIBDIR to \`/etc/ld.so.conf'"
---
> 	echo "   - have your system administrator add LIBDIR to '/etc/ld.so.conf'"
2765c4084
< test "$opt_mode" = finish && func_mode_finish ${1+"$@"}
---
> test finish = "$opt_mode" && func_mode_finish ${1+"$@"}
2771c4090,4091
<     $opt_debug
---
>     $debug_cmd
> 
2774c4094
<     if test "$nonopt" = "$SHELL" || test "$nonopt" = /bin/sh ||
---
>     if test "$SHELL" = "$nonopt" || test /bin/sh = "$nonopt" ||
2776c4096,4097
<        case $nonopt in *shtool*) :;; *) false;; esac; then
---
>        case $nonopt in *shtool*) :;; *) false;; esac
>     then
2803c4124
<     isdir=no
---
>     isdir=false
2816c4137
<       -d) isdir=yes ;;
---
>       -d) isdir=: ;;
2834c4155
< 	  if test "x$prev" = x-m && test -n "$install_override_mode"; then
---
> 	  if test X-m = "X$prev" && test -n "$install_override_mode"; then
2859c4180
<       func_fatal_help "the \`$prev' option requires an argument"
---
>       func_fatal_help "the '$prev' option requires an argument"
2881,2883c4202,4204
<     test -d "$dest" && isdir=yes
<     if test "$isdir" = yes; then
<       destdir="$dest"
---
>     test -d "$dest" && isdir=:
>     if $isdir; then
>       destdir=$dest
2887,2888c4208,4209
<       destdir="$func_dirname_result"
<       destname="$func_basename_result"
---
>       destdir=$func_dirname_result
>       destname=$func_basename_result
2893c4214
< 	func_fatal_help "\`$dest' is not a directory"
---
> 	func_fatal_help "'$dest' is not a directory"
2902c4223
< 	  func_fatal_help "\`$destdir' must be an absolute directory name"
---
> 	  func_fatal_help "'$destdir' must be an absolute directory name"
2911c4232
<     libtool_install_magic="$magic"
---
>     libtool_install_magic=$magic
2931c4252
< 	  || func_fatal_help "\`$file' is not a valid libtool archive"
---
> 	  || func_fatal_help "'$file' is not a valid libtool archive"
2953c4274
< 	dir="$func_dirname_result"
---
> 	dir=$func_dirname_result
2967c4288
< 	    func_fatal_error "error: cannot install \`$file' to a directory not ending in $libdir"
---
> 	    func_fatal_error "error: cannot install '$file' to a directory not ending in $libdir"
2976c4297
< 	  func_warning "relinking \`$file'"
---
> 	  func_warning "relinking '$file'"
2978c4299
< 	    'func_fatal_error "error: relink \`$file'\'' with the above command before installing it"'
---
> 	    'func_fatal_error "error: relink '\''$file'\'' with the above command before installing it"'
2984c4305
< 	  realname="$1"
---
> 	  realname=$1
2987,2988c4308,4309
< 	  srcname="$realname"
< 	  test -n "$relink_command" && srcname="$realname"T
---
> 	  srcname=$realname
> 	  test -n "$relink_command" && srcname=${realname}T
2993c4314
< 	  tstripme="$stripme"
---
> 	  tstripme=$stripme
2998c4319,4326
< 	      tstripme=""
---
> 	      tstripme=
> 	      ;;
> 	    esac
> 	    ;;
> 	  os2*)
> 	    case $realname in
> 	    *_dll.a)
> 	      tstripme=
3009c4337
< 	    # Try `ln -sf' first, because the `ln' binary might depend on
---
> 	    # Try 'ln -sf' first, because the 'ln' binary might depend on
3020c4348
< 	  lib="$destdir/$realname"
---
> 	  lib=$destdir/$realname
3026,3027c4354,4355
< 	name="$func_basename_result"
< 	instname="$dir/$name"i
---
> 	name=$func_basename_result
> 	instname=$dir/${name}i
3039c4367
< 	  destfile="$destdir/$destname"
---
> 	  destfile=$destdir/$destname
3042,3043c4370,4371
< 	  destfile="$func_basename_result"
< 	  destfile="$destdir/$destfile"
---
> 	  destfile=$func_basename_result
> 	  destfile=$destdir/$destfile
3053c4381
< 	  staticdest="$destfile"
---
> 	  staticdest=$destfile
3057c4385
< 	  func_fatal_help "cannot copy a libtool object to \`$destfile'"
---
> 	  func_fatal_help "cannot copy a libtool object to '$destfile'"
3066c4394
< 	if test "$build_old_libs" = yes; then
---
> 	if test yes = "$build_old_libs"; then
3078c4406
< 	  destfile="$destdir/$destname"
---
> 	  destfile=$destdir/$destname
3081,3082c4409,4410
< 	  destfile="$func_basename_result"
< 	  destfile="$destdir/$destfile"
---
> 	  destfile=$func_basename_result
> 	  destfile=$destdir/$destfile
3088c4416
< 	stripped_ext=""
---
> 	stripped_ext=
3094c4422
< 	      stripped_ext=".exe"
---
> 	      stripped_ext=.exe
3122c4450
< 	    func_fatal_error "invalid libtool wrapper script \`$wrapper'"
---
> 	    func_fatal_error "invalid libtool wrapper script '$wrapper'"
3124c4452
< 	  finalize=yes
---
> 	  finalize=:
3131c4459
< 	    libfile="$libdir/"`$ECHO "$lib" | $SED 's%^.*/%%g'` ### testsuite: skip nested quoting test
---
> 	    libfile=$libdir/`$ECHO "$lib" | $SED 's%^.*/%%g'`
3133,3134c4461,4462
< 	      func_warning "\`$lib' has not been installed in \`$libdir'"
< 	      finalize=no
---
> 	      func_warning "'$lib' has not been installed in '$libdir'"
> 	      finalize=false
3142c4470
< 	  if test "$fast_install" = no && test -n "$relink_command"; then
---
> 	  if test no = "$fast_install" && test -n "$relink_command"; then
3144c4472
< 	      if test "$finalize" = yes; then
---
> 	      if $finalize; then
3147,3148c4475,4476
< 		file="$func_basename_result"
< 	        outputname="$tmpdir/$file"
---
> 		file=$func_basename_result
> 	        outputname=$tmpdir/$file
3152c4480
< 	        $opt_silent || {
---
> 	        $opt_quiet || {
3158c4486
< 		  func_error "error: relink \`$file' with the above command before installing it"
---
> 		  func_error "error: relink '$file' with the above command before installing it"
3162c4490
< 	        file="$outputname"
---
> 	        file=$outputname
3164c4492
< 	        func_warning "cannot relink \`$file'"
---
> 	        func_warning "cannot relink '$file'"
3201c4529
<       name="$func_basename_result"
---
>       name=$func_basename_result
3204c4532
<       oldlib="$destdir/$name"
---
>       oldlib=$destdir/$name
3219c4547
<       func_warning "remember to run \`$progname --finish$future_libdirs'"
---
>       func_warning "remember to run '$progname --finish$future_libdirs'"
3224c4552
<       exec_cmd='$SHELL $progpath $preserve_args --finish$current_libdirs'
---
>       exec_cmd='$SHELL "$progpath" $preserve_args --finish$current_libdirs'
3230c4558
< test "$opt_mode" = install && func_mode_install ${1+"$@"}
---
> test install = "$opt_mode" && func_mode_install ${1+"$@"}
3238,3242c4566,4571
<     $opt_debug
<     my_outputname="$1"
<     my_originator="$2"
<     my_pic_p="${3-no}"
<     my_prefix=`$ECHO "$my_originator" | sed 's%[^a-zA-Z0-9]%_%g'`
---
>     $debug_cmd
> 
>     my_outputname=$1
>     my_originator=$2
>     my_pic_p=${3-false}
>     my_prefix=`$ECHO "$my_originator" | $SED 's%[^a-zA-Z0-9]%_%g'`
3245c4574
<     if test -n "$dlfiles$dlprefiles" || test "$dlself" != no; then
---
>     if test -n "$dlfiles$dlprefiles" || test no != "$dlself"; then
3247c4576
< 	my_dlsyms="${my_outputname}S.c"
---
> 	my_dlsyms=${my_outputname}S.c
3258c4587
< 	nlist="$output_objdir/${my_outputname}.nm"
---
> 	nlist=$output_objdir/$my_outputname.nm
3266,3267c4595,4596
< /* $my_dlsyms - symbol resolution table for \`$my_outputname' dlsym emulation. */
< /* Generated by $PROGRAM (GNU $PACKAGE$TIMESTAMP) $VERSION */
---
> /* $my_dlsyms - symbol resolution table for '$my_outputname' dlsym emulation. */
> /* Generated by $PROGRAM (GNU $PACKAGE) $VERSION */
3273c4602
< #if defined(__GNUC__) && (((__GNUC__ == 4) && (__GNUC_MINOR__ >= 4)) || (__GNUC__ > 4))
---
> #if defined __GNUC__ && (((__GNUC__ == 4) && (__GNUC_MINOR__ >= 4)) || (__GNUC__ > 4))
3278,3279c4607,4608
< #if defined(_WIN32) || defined(__CYGWIN__) || defined(_WIN32_WCE)
< /* DATA imports from DLLs on WIN32 con't be const, because runtime
---
> #if defined _WIN32 || defined __CYGWIN__ || defined _WIN32_WCE
> /* DATA imports from DLLs on WIN32 can't be const, because runtime
3282c4611
< #elif defined(__osf__)
---
> #elif defined __osf__
3288a4618,4619
> #define STREQ(s1, s2) (strcmp ((s1), (s2)) == 0)
> 
3292,3293c4623,4624
< 	if test "$dlself" = yes; then
< 	  func_verbose "generating symbol list for \`$output'"
---
> 	if test yes = "$dlself"; then
> 	  func_verbose "generating symbol list for '$output'"
3301c4632
< 	    func_verbose "extracting global C symbols from \`$func_to_tool_file_result'"
---
> 	    func_verbose "extracting global C symbols from '$func_to_tool_file_result'"
3321c4652
< 	    export_symbols="$output_objdir/$outputname.exp"
---
> 	    export_symbols=$output_objdir/$outputname.exp
3324c4655
< 	      eval "${SED} -n -e '/^: @PROGRAM@ $/d' -e 's/^.* \(.*\)$/\1/p' "'< "$nlist" > "$export_symbols"'
---
> 	      eval "$SED -n -e '/^: @PROGRAM@ $/d' -e 's/^.* \(.*\)$/\1/p' "'< "$nlist" > "$export_symbols"'
3334c4665
< 	      eval "${SED} -e 's/\([].[*^$]\)/\\\\\1/g' -e 's/^/ /' -e 's/$/$/'"' < "$export_symbols" > "$output_objdir/$outputname.exp"'
---
> 	      eval "$SED -e 's/\([].[*^$]\)/\\\\\1/g' -e 's/^/ /' -e 's/$/$/'"' < "$export_symbols" > "$output_objdir/$outputname.exp"'
3348c4679
< 	  func_verbose "extracting global C symbols from \`$dlprefile'"
---
> 	  func_verbose "extracting global C symbols from '$dlprefile'"
3350c4681
< 	  name="$func_basename_result"
---
> 	  name=$func_basename_result
3357c4688
< 	        dlprefile_dlbasename=""
---
> 	        dlprefile_dlbasename=
3361c4692
< 	          if test -n "$dlprefile_dlname" ; then
---
> 	          if test -n "$dlprefile_dlname"; then
3363c4694
< 	            dlprefile_dlbasename="$func_basename_result"
---
> 	            dlprefile_dlbasename=$func_basename_result
3371c4702
< 	          if test -n "$dlprefile_dlbasename" ; then
---
> 	          if test -n "$dlprefile_dlbasename"; then
3426a4758,4762
> 	  func_show_eval '$RM "${nlist}I"'
> 	  if test -n "$global_symbol_to_import"; then
> 	    eval "$global_symbol_to_import"' < "$nlist"S > "$nlist"I'
> 	  fi
> 
3435c4771,4786
< lt_${my_prefix}_LTX_preloaded_symbols[];
---
> lt_${my_prefix}_LTX_preloaded_symbols[];\
> "
> 
> 	  if test -s "$nlist"I; then
> 	    echo >> "$output_objdir/$my_dlsyms" "\
> static void lt_syminit(void)
> {
>   LT_DLSYM_CONST lt_dlsymlist *symbol = lt_${my_prefix}_LTX_preloaded_symbols;
>   for (; symbol->name; ++symbol)
>     {"
> 	    $SED 's/.*/      if (STREQ (symbol->name, \"&\")) symbol->address = (void *) \&&;/' < "$nlist"I >> "$output_objdir/$my_dlsyms"
> 	    echo >> "$output_objdir/$my_dlsyms" "\
>     }
> }"
> 	  fi
> 	  echo >> "$output_objdir/$my_dlsyms" "\
3438,3439c4789,4794
< {\
<   { \"$my_originator\", (void *) 0 },"
---
> { {\"$my_originator\", (void *) 0},"
> 
> 	  if test -s "$nlist"I; then
> 	    echo >> "$output_objdir/$my_dlsyms" "\
>   {\"@INIT@\", (void *) &lt_syminit},"
> 	  fi
3481,3483c4836
< 	    if test "X$my_pic_p" != Xno; then
< 	      pic_flag_for_symtable=" $pic_flag"
< 	    fi
---
> 	    $my_pic_p && pic_flag_for_symtable=" $pic_flag"
3500c4853
< 	func_show_eval '$RM "$output_objdir/$my_dlsyms" "$nlist" "${nlist}S" "${nlist}T"'
---
> 	func_show_eval '$RM "$output_objdir/$my_dlsyms" "$nlist" "${nlist}S" "${nlist}T" "${nlist}I"'
3503c4856
< 	symfileobj="$output_objdir/${my_outputname}S.$objext"
---
> 	symfileobj=$output_objdir/${my_outputname}S.$objext
3521c4874
< 	func_fatal_error "unknown suffix for \`$my_dlsyms'"
---
> 	func_fatal_error "unknown suffix for '$my_dlsyms'"
3534a4888,4913
> # func_cygming_gnu_implib_p ARG
> # This predicate returns with zero status (TRUE) if
> # ARG is a GNU/binutils-style import library. Returns
> # with nonzero status (FALSE) otherwise.
> func_cygming_gnu_implib_p ()
> {
>   $debug_cmd
> 
>   func_to_tool_file "$1" func_convert_file_msys_to_w32
>   func_cygming_gnu_implib_tmp=`$NM "$func_to_tool_file_result" | eval "$global_symbol_pipe" | $EGREP ' (_head_[A-Za-z0-9_]+_[ad]l*|[A-Za-z0-9_]+_[ad]l*_iname)$'`
>   test -n "$func_cygming_gnu_implib_tmp"
> }
> 
> # func_cygming_ms_implib_p ARG
> # This predicate returns with zero status (TRUE) if
> # ARG is an MS-style import library. Returns
> # with nonzero status (FALSE) otherwise.
> func_cygming_ms_implib_p ()
> {
>   $debug_cmd
> 
>   func_to_tool_file "$1" func_convert_file_msys_to_w32
>   func_cygming_ms_implib_tmp=`$NM "$func_to_tool_file_result" | eval "$global_symbol_pipe" | $GREP '_NULL_IMPORT_DESCRIPTOR'`
>   test -n "$func_cygming_ms_implib_tmp"
> }
> 
3544,3545c4923,4925
<   $opt_debug
<   win32_libid_type="unknown"
---
>   $debug_cmd
> 
>   win32_libid_type=unknown
3555,3557c4935,4948
<       func_to_tool_file "$1" func_convert_file_msys_to_w32
<       win32_nmres=`eval $NM -f posix -A \"$func_to_tool_file_result\" |
< 	$SED -n -e '
---
>       case $nm_interface in
>       "MS dumpbin")
> 	if func_cygming_ms_implib_p "$1" ||
> 	   func_cygming_gnu_implib_p "$1"
> 	then
> 	  win32_nmres=import
> 	else
> 	  win32_nmres=
> 	fi
> 	;;
>       *)
> 	func_to_tool_file "$1" func_convert_file_msys_to_w32
> 	win32_nmres=`eval $NM -f posix -A \"$func_to_tool_file_result\" |
> 	  $SED -n -e '
3560c4951
< 		    s,.*,import,
---
> 		    s|.*|import|
3564a4956,4957
> 	;;
>       esac
3596c4989,4990
<   $opt_debug
---
>   $debug_cmd
> 
3613c5007,5008
<   $opt_debug
---
>   $debug_cmd
> 
3649,3650c5044,5045
<     # archive which possess that section. Heuristic: eliminate
<     # all those which have a first or second character that is
---
>     # archive that possess that section. Heuristic: eliminate
>     # all those that have a first or second character that is
3661,3684d5055
< # func_cygming_gnu_implib_p ARG
< # This predicate returns with zero status (TRUE) if
< # ARG is a GNU/binutils-style import library. Returns
< # with nonzero status (FALSE) otherwise.
< func_cygming_gnu_implib_p ()
< {
<   $opt_debug
<   func_to_tool_file "$1" func_convert_file_msys_to_w32
<   func_cygming_gnu_implib_tmp=`$NM "$func_to_tool_file_result" | eval "$global_symbol_pipe" | $EGREP ' (_head_[A-Za-z0-9_]+_[ad]l*|[A-Za-z0-9_]+_[ad]l*_iname)$'`
<   test -n "$func_cygming_gnu_implib_tmp"
< }
< 
< # func_cygming_ms_implib_p ARG
< # This predicate returns with zero status (TRUE) if
< # ARG is an MS-style import library. Returns
< # with nonzero status (FALSE) otherwise.
< func_cygming_ms_implib_p ()
< {
<   $opt_debug
<   func_to_tool_file "$1" func_convert_file_msys_to_w32
<   func_cygming_ms_implib_tmp=`$NM "$func_to_tool_file_result" | eval "$global_symbol_pipe" | $GREP '_NULL_IMPORT_DESCRIPTOR'`
<   test -n "$func_cygming_ms_implib_tmp"
< }
< 
3698,3699c5069,5071
<   $opt_debug
<   if func_cygming_gnu_implib_p "$1" ; then
---
>   $debug_cmd
> 
>   if func_cygming_gnu_implib_p "$1"; then
3702c5074
<   elif func_cygming_ms_implib_p "$1" ; then
---
>   elif func_cygming_ms_implib_p "$1"; then
3707c5079
<     sharedlib_from_linklib_result=""
---
>     sharedlib_from_linklib_result=
3715,3718c5087,5091
<     $opt_debug
<     f_ex_an_ar_dir="$1"; shift
<     f_ex_an_ar_oldlib="$1"
<     if test "$lock_old_archive_extraction" = yes; then
---
>     $debug_cmd
> 
>     f_ex_an_ar_dir=$1; shift
>     f_ex_an_ar_oldlib=$1
>     if test yes = "$lock_old_archive_extraction"; then
3727c5100
<     if test "$lock_old_archive_extraction" = yes; then
---
>     if test yes = "$lock_old_archive_extraction"; then
3741,3742c5114,5116
<     $opt_debug
<     my_gentop="$1"; shift
---
>     $debug_cmd
> 
>     my_gentop=$1; shift
3744,3747c5118,5121
<     my_oldobjs=""
<     my_xlib=""
<     my_xabs=""
<     my_xdir=""
---
>     my_oldobjs=
>     my_xlib=
>     my_xabs=
>     my_xdir=
3752c5126
< 	[\\/]* | [A-Za-z]:[\\/]*) my_xabs="$my_xlib" ;;
---
> 	[\\/]* | [A-Za-z]:[\\/]*) my_xabs=$my_xlib ;;
3756c5130
<       my_xlib="$func_basename_result"
---
>       my_xlib=$func_basename_result
3768c5142
<       my_xdir="$my_gentop/$my_xlib_u"
---
>       my_xdir=$my_gentop/$my_xlib_u
3781c5155,5156
< 	  darwin_base_archive=`basename "$darwin_archive"`
---
> 	  func_basename "$darwin_archive"
> 	  darwin_base_archive=$func_basename_result
3787,3791c5162,5166
< 	    for darwin_arch in  $darwin_arches ; do
< 	      func_mkdir_p "unfat-$$/${darwin_base_archive}-${darwin_arch}"
< 	      $LIPO -thin $darwin_arch -output "unfat-$$/${darwin_base_archive}-${darwin_arch}/${darwin_base_archive}" "${darwin_archive}"
< 	      cd "unfat-$$/${darwin_base_archive}-${darwin_arch}"
< 	      func_extract_an_archive "`pwd`" "${darwin_base_archive}"
---
> 	    for darwin_arch in  $darwin_arches; do
> 	      func_mkdir_p "unfat-$$/$darwin_base_archive-$darwin_arch"
> 	      $LIPO -thin $darwin_arch -output "unfat-$$/$darwin_base_archive-$darwin_arch/$darwin_base_archive" "$darwin_archive"
> 	      cd "unfat-$$/$darwin_base_archive-$darwin_arch"
> 	      func_extract_an_archive "`pwd`" "$darwin_base_archive"
3793c5168
< 	      $RM "unfat-$$/${darwin_base_archive}-${darwin_arch}/${darwin_base_archive}"
---
> 	      $RM "unfat-$$/$darwin_base_archive-$darwin_arch/$darwin_base_archive"
3796c5171
< 	    darwin_filelist=`find unfat-$$ -type f -name \*.o -print -o -name \*.lo -print | $SED -e "$basename" | sort -u`
---
> 	    darwin_filelist=`find unfat-$$ -type f -name \*.o -print -o -name \*.lo -print | $SED -e "$sed_basename" | sort -u`
3818c5193
<     func_extract_archives_result="$my_oldobjs"
---
>     func_extract_archives_result=$my_oldobjs
3833c5208
< # will assume that the directory in which it is stored is
---
> # will assume that the directory where it is stored is
3844c5219
< # Generated by $PROGRAM (GNU $PACKAGE$TIMESTAMP) $VERSION
---
> # Generated by $PROGRAM (GNU $PACKAGE) $VERSION
3901c5276
< # /script/ and the wrapper /executable/ which is used only on
---
> # /script/ and the wrapper /executable/ that is used only on
3903c5278
< # (application programs are unlikely to have options which match
---
> # (application programs are unlikely to have options that match
3936c5311
<     echo \"${outputname}:${output}:\${LINENO}: libtool wrapper (GNU $PACKAGE$TIMESTAMP) $VERSION\" 1>&2
---
>     echo \"$outputname:$output:\$LINENO: libtool wrapper (GNU $PACKAGE) $VERSION\" 1>&2
3947c5322
<     \$ECHO \"${outputname}:${output}:\${LINENO}: newargv[\$lt_dump_args_N]: \$lt_arg\"
---
>     \$ECHO \"$outputname:$output:\$LINENO: newargv[\$lt_dump_args_N]: \$lt_arg\"
3961c5336
<         \$ECHO \"${outputname}:${output}:\${LINENO}: newargv[0]: \$progdir\\\\\$program\" 1>&2
---
>         \$ECHO \"$outputname:$output:\$LINENO: newargv[0]: \$progdir\\\\\$program\" 1>&2
3971c5346
<         \$ECHO \"${outputname}:${output}:\${LINENO}: newargv[0]: \$progdir/\$program\" 1>&2
---
>         \$ECHO \"$outputname:$output:\$LINENO: newargv[0]: \$progdir/\$program\" 1>&2
4046c5421
< 	if test "$fast_install" = yes; then
---
> 	if test yes = "$fast_install"; then
4052c5427
<      { file=\`ls -1dt \"\$progdir/\$program\" \"\$progdir/../\$program\" 2>/dev/null | ${SED} 1q\`; \\
---
>      { file=\`ls -1dt \"\$progdir/\$program\" \"\$progdir/../\$program\" 2>/dev/null | $SED 1q\`; \\
4069c5444
< 	$ECHO \"\$relink_command_output\" >&2
---
> 	\$ECHO \"\$relink_command_output\" >&2
4104c5479
< 	if test "$shlibpath_overrides_runpath" = yes && test -n "$shlibpath_var" && test -n "$temp_rpath"; then
---
> 	if test yes = "$shlibpath_overrides_runpath" && test -n "$shlibpath_var" && test -n "$temp_rpath"; then
4124c5499
<     \$ECHO \"\$0: error: \\\`\$progdir/\$program' does not exist\" 1>&2
---
>     \$ECHO \"\$0: error: '\$progdir/\$program' does not exist\" 1>&2
4143c5518
<    Generated by $PROGRAM (GNU $PACKAGE$TIMESTAMP) $VERSION
---
>    Generated by $PROGRAM (GNU $PACKAGE) $VERSION
4177a5553,5554
> #define STREQ(s1, s2) (strcmp ((s1), (s2)) == 0)
> 
4179c5556
< #if defined(__MINGW32__)
---
> #if defined __MINGW32__
4183c5560
< #elif defined(__CYGWIN__)
---
> #elif defined __CYGWIN__
4189c5566
< /* #elif defined (other platforms) ... */
---
> /* #elif defined other_platform || defined ... */
4193c5570
< #if defined(_MSC_VER)
---
> #if defined _MSC_VER
4200,4204c5577
< # ifndef _INTPTR_T_DEFINED
< #  define _INTPTR_T_DEFINED
< #  define intptr_t int
< # endif
< #elif defined(__MINGW32__)
---
> #elif defined __MINGW32__
4210c5583
< #elif defined(__CYGWIN__)
---
> #elif defined __CYGWIN__
4213c5586
< /* #elif defined (other platforms) ... */
---
> /* #elif defined other platforms ... */
4216c5589
< #if defined(PATH_MAX)
---
> #if defined PATH_MAX
4218c5591
< #elif defined(MAXPATHLEN)
---
> #elif defined MAXPATHLEN
4237,4238c5610,5611
< #if defined (_WIN32) || defined (__MSDOS__) || defined (__DJGPP__) || \
<   defined (__OS2__)
---
> #if defined _WIN32 || defined __MSDOS__ || defined __DJGPP__ || \
>   defined __OS2__
4271c5644
<   if (stale) { free ((void *) stale); stale = 0; } \
---
>   if (stale) { free (stale); stale = 0; } \
4274c5647
< #if defined(LT_DEBUGWRAPPER)
---
> #if defined LT_DEBUGWRAPPER
4303c5676,5681
< volatile const char * MAGIC_EXE = "$magic_exe";
---
> #if __GNUC__ < 4 || (__GNUC__ == 4 && __GNUC_MINOR__ < 5)
> # define externally_visible volatile
> #else
> # define externally_visible __attribute__((externally_visible)) volatile
> #endif
> externally_visible const char * MAGIC_EXE = "$magic_exe";
4307c5685
< 	    if test "$shlibpath_overrides_runpath" = yes && test -n "$shlibpath_var" && test -n "$temp_rpath"; then
---
> 	    if test yes = "$shlibpath_overrides_runpath" && test -n "$shlibpath_var" && test -n "$temp_rpath"; then
4331c5709
< 	    if test "$fast_install" = yes; then
---
> 	    if test yes = "$fast_install"; then
4360c5738
<   intptr_t rval = 127;
---
>   int rval = 127;
4365c5743
<   newargz = XMALLOC (char *, argc + 1);
---
>   newargz = XMALLOC (char *, (size_t) argc + 1);
4374c5752
<       if (strcmp (argv[i], dumpscript_opt) == 0)
---
>       if (STREQ (argv[i], dumpscript_opt))
4377c5755
< 	    case "$host" in
---
> 	    case $host in
4388c5766
<       if (strcmp (argv[i], debug_opt) == 0)
---
>       if (STREQ (argv[i], debug_opt))
4393c5771
<       if (strcmp (argv[i], ltwrapper_option_prefix) == 0)
---
>       if (STREQ (argv[i], ltwrapper_option_prefix))
4416c5794
<   lt_debugprintf (__FILE__, __LINE__, "libtool wrapper (GNU $PACKAGE$TIMESTAMP) $VERSION\n");
---
>   lt_debugprintf (__FILE__, __LINE__, "libtool wrapper (GNU $PACKAGE) $VERSION\n");
4527c5905
<   rval = _spawnv (_P_WAIT, lt_argv_zero, (const char * const *) newargz);
---
>   rval = (int) _spawnv (_P_WAIT, lt_argv_zero, (const char * const *) newargz);
4572c5950
< #if defined (HAVE_DOS_BASED_FILE_SYSTEM)
---
> #if defined HAVE_DOS_BASED_FILE_SYSTEM
4631c6009
<   int tmp_len;
---
>   size_t tmp_len;
4641c6019
< #if defined (HAVE_DOS_BASED_FILE_SYSTEM)
---
> #if defined HAVE_DOS_BASED_FILE_SYSTEM
4659c6037
< #if defined (HAVE_DOS_BASED_FILE_SYSTEM)
---
> #if defined HAVE_DOS_BASED_FILE_SYSTEM
4682c6060
< 	      p_len = q - p;
---
> 	      p_len = (size_t) (q - p);
4801c6179
<       if (strcmp (str, pat) == 0)
---
>       if (STREQ (str, pat))
4866c6244
<     int len = strlen (name) + 1 + strlen (value) + 1;
---
>     size_t len = strlen (name) + 1 + strlen (value) + 1;
4883,4884c6261,6262
<       int orig_value_len = strlen (orig_value);
<       int add_len = strlen (add);
---
>       size_t orig_value_len = strlen (orig_value);
>       size_t add_len = strlen (add);
4915,4916c6293,6294
<       int len = strlen (new_value);
<       while (((len = strlen (new_value)) > 0) && IS_PATH_SEPARATOR (new_value[len-1]))
---
>       size_t len = strlen (new_value);
>       while ((len > 0) && IS_PATH_SEPARATOR (new_value[len-1]))
4918c6296
<           new_value[len-1] = '\0';
---
>           new_value[--len] = '\0';
5085c6463,6464
<     $opt_debug
---
>     $debug_cmd
> 
5091a6471,6488
> # func_suncc_cstd_abi
> # !!ONLY CALL THIS FOR SUN CC AFTER $compile_command IS FULLY EXPANDED!!
> # Several compiler flags select an ABI that is incompatible with the
> # Cstd library. Avoid specifying it if any are in CXXFLAGS.
> func_suncc_cstd_abi ()
> {
>     $debug_cmd
> 
>     case " $compile_command " in
>     *" -compat=g "*|*\ -std=c++[0-9][0-9]\ *|*" -library=stdcxx4 "*|*" -library=stlport4 "*)
>       suncc_use_cstd_abi=no
>       ;;
>     *)
>       suncc_use_cstd_abi=yes
>       ;;
>     esac
> }
> 
5095c6492,6493
<     $opt_debug
---
>     $debug_cmd
> 
5100c6498
<       # which system we are compiling for in order to pass an extra
---
>       # what system we are compiling for in order to pass an extra
5105c6503
<       # to make a dll which has undefined symbols, in which case not
---
>       # to make a dll that has undefined symbols, in which case not
5148a6547
>     os2dllname=
5152c6551
<     preload=no
---
>     preload=false
5164c6563
<     single_module="${wl}-single_module"
---
>     single_module=$wl-single_module
5172,5173c6571,6572
< 	test "$build_libtool_libs" != yes && \
< 	  func_fatal_configuration "can not build a shared library"
---
> 	test yes != "$build_libtool_libs" \
> 	  && func_fatal_configuration "cannot build a shared library"
5180c6579
< 	  if test "$build_libtool_libs" = yes && test -z "$link_static_flag"; then
---
> 	  if test yes = "$build_libtool_libs" && test -z "$link_static_flag"; then
5213c6612
<       arg="$1"
---
>       arg=$1
5230c6629
< 	  bindir="$arg"
---
> 	  bindir=$arg
5235c6634
< 	  if test "$preload" = no; then
---
> 	  $preload || {
5239,5240c6638,6639
< 	    preload=yes
< 	  fi
---
> 	    preload=:
> 	  }
5244c6643
< 	    if test "$dlself" = no; then
---
> 	    if test no = "$dlself"; then
5252c6651
< 	    if test "$prev" = dlprefiles; then
---
> 	    if test dlprefiles = "$prev"; then
5254c6653
< 	    elif test "$prev" = dlfiles && test "$dlopen_self" != yes; then
---
> 	    elif test dlfiles = "$prev" && test yes != "$dlopen_self"; then
5264c6663
< 	    if test "$prev" = dlfiles; then
---
> 	    if test dlfiles = "$prev"; then
5275c6674
< 	  export_symbols="$arg"
---
> 	  export_symbols=$arg
5277c6676
< 	    || func_fatal_error "symbol file \`$arg' does not exist"
---
> 	    || func_fatal_error "symbol file '$arg' does not exist"
5282c6681
< 	  export_symbols_regex="$arg"
---
> 	  export_symbols_regex=$arg
5300c6699,6705
< 	  inst_prefix_dir="$arg"
---
> 	  inst_prefix_dir=$arg
> 	  prev=
> 	  continue
> 	  ;;
> 	mllvm)
> 	  # Clang does not use LLVM to link, so we can simply discard any
> 	  # '-mllvm $arg' options when doing the link step.
5324,5326c6729,6731
< 		   test "$pic_object" = none &&
< 		   test "$non_pic_object" = none; then
< 		  func_fatal_error "cannot find name of object for \`$arg'"
---
> 		   test none = "$pic_object" &&
> 		   test none = "$non_pic_object"; then
> 		  func_fatal_error "cannot find name of object for '$arg'"
5331c6736
< 		xdir="$func_dirname_result"
---
> 		xdir=$func_dirname_result
5333c6738
< 		if test "$pic_object" != none; then
---
> 		if test none != "$pic_object"; then
5335c6740
< 		  pic_object="$xdir$pic_object"
---
> 		  pic_object=$xdir$pic_object
5337,5338c6742,6743
< 		  if test "$prev" = dlfiles; then
< 		    if test "$build_libtool_libs" = yes && test "$dlopen_support" = yes; then
---
> 		  if test dlfiles = "$prev"; then
> 		    if test yes = "$build_libtool_libs" && test yes = "$dlopen_support"; then
5349c6754
< 		  if test "$prev" = dlprefiles; then
---
> 		  if test dlprefiles = "$prev"; then
5357c6762
< 		  arg="$pic_object"
---
> 		  arg=$pic_object
5361c6766
< 		if test "$non_pic_object" != none; then
---
> 		if test none != "$non_pic_object"; then
5363c6768
< 		  non_pic_object="$xdir$non_pic_object"
---
> 		  non_pic_object=$xdir$non_pic_object
5367,5368c6772,6773
< 		  if test -z "$pic_object" || test "$pic_object" = none ; then
< 		    arg="$non_pic_object"
---
> 		  if test -z "$pic_object" || test none = "$pic_object"; then
> 		    arg=$non_pic_object
5373c6778
< 		  non_pic_object="$pic_object"
---
> 		  non_pic_object=$pic_object
5381c6786
< 		  xdir="$func_dirname_result"
---
> 		  xdir=$func_dirname_result
5389c6794
< 		  func_fatal_error "\`$arg' is not a valid libtool object"
---
> 		  func_fatal_error "'$arg' is not a valid libtool object"
5394c6799
< 	    func_fatal_error "link input file \`$arg' does not exist"
---
> 	    func_fatal_error "link input file '$arg' does not exist"
5399a6805,6809
> 	os2dllname)
> 	  os2dllname=$arg
> 	  prev=
> 	  continue
> 	  ;;
5401c6811
< 	  precious_files_regex="$arg"
---
> 	  precious_files_regex=$arg
5406c6816
< 	  release="-$arg"
---
> 	  release=-$arg
5418c6828
< 	  if test "$prev" = rpath; then
---
> 	  if test rpath = "$prev"; then
5433c6843
< 	  shrext_cmds="$arg"
---
> 	  shrext_cmds=$arg
5473c6883
<       prevarg="$arg"
---
>       prevarg=$arg
5487c6897
< 	func_fatal_error "\`-allow-undefined' must not be used because it is the default"
---
> 	func_fatal_error "'-allow-undefined' must not be used because it is the default"
5519c6929
< 	if test "X$arg" = "X-export-symbols"; then
---
> 	if test X-export-symbols = "X$arg"; then
5553c6963
< 	    func_fatal_error "require no space between \`-L' and \`$1'"
---
> 	    func_fatal_error "require no space between '-L' and '$1'"
5555c6965
< 	    func_fatal_error "need path for \`-L' option"
---
> 	    func_fatal_error "need path for '-L' option"
5566,5567c6976,6977
< 	    func_fatal_error "cannot determine absolute directory name of \`$dir'"
< 	  dir="$absdir"
---
> 	    func_fatal_error "cannot determine absolute directory name of '$dir'"
> 	  dir=$absdir
5602c7012
< 	if test "X$arg" = "X-lc" || test "X$arg" = "X-lm"; then
---
> 	if test X-lc = "X$arg" || test X-lm = "X$arg"; then
5610c7020
< 	    test "X$arg" = "X-lc" && continue
---
> 	    test X-lc = "X$arg" && continue
5612c7022
< 	  *-*-openbsd* | *-*-freebsd* | *-*-dragonfly*)
---
> 	  *-*-openbsd* | *-*-freebsd* | *-*-dragonfly* | *-*-bitrig*)
5614c7024
< 	    test "X$arg" = "X-lc" && continue
---
> 	    test X-lc = "X$arg" && continue
5623c7033
< 	    test "X$arg" = "X-lc" && continue
---
> 	    test X-lc = "X$arg" && continue
5627c7037
< 	    test "X$arg" = "X-lc" && continue
---
> 	    test X-lc = "X$arg" && continue
5630c7040
< 	elif test "X$arg" = "X-lc_r"; then
---
> 	elif test X-lc_r = "X$arg"; then
5632c7042
< 	 *-*-openbsd* | *-*-freebsd* | *-*-dragonfly*)
---
> 	 *-*-openbsd* | *-*-freebsd* | *-*-dragonfly* | *-*-bitrig*)
5641a7052,7056
>       -mllvm)
> 	prev=mllvm
> 	continue
> 	;;
> 
5671c7086
< 	single_module="${wl}-multi_module"
---
> 	single_module=$wl-multi_module
5685,5686c7100,7101
< 	  func_warning "\`-no-install' is ignored for $host"
< 	  func_warning "assuming \`-no-fast-install' instead"
---
> 	  func_warning "'-no-install' is ignored for $host"
> 	  func_warning "assuming '-no-fast-install' instead"
5703a7119,7123
>       -os2dllname)
> 	prev=os2dllname
> 	continue
> 	;;
> 
5791c7211
< 	save_ifs="$IFS"; IFS=','
---
> 	save_ifs=$IFS; IFS=,
5793c7213
< 	  IFS="$save_ifs"
---
> 	  IFS=$save_ifs
5798c7218
< 	IFS="$save_ifs"
---
> 	IFS=$save_ifs
5807c7227
< 	save_ifs="$IFS"; IFS=','
---
> 	save_ifs=$IFS; IFS=,
5809c7229
< 	  IFS="$save_ifs"
---
> 	  IFS=$save_ifs
5815c7235
< 	IFS="$save_ifs"
---
> 	IFS=$save_ifs
5838c7258
< 	arg="$func_quote_for_eval_result"
---
> 	arg=$func_quote_for_eval_result
5849a7270
>       # -fstack-protector*   stack protector flags for GCC
5853c7274,7277
<       # -O*, -flto*, -fwhopr*, -fuse-linker-plugin GCC link-time optimization
---
>       # -O*, -g*, -flto*, -fwhopr*, -fuse-linker-plugin GCC link-time optimization
>       # -specs=*             GCC specs files
>       # -stdlib=*            select c++ std lib with clang
>       # -fsanitize=*         Clang/GCC memory and address sanitizer
5856c7280,7281
<       -O*|-flto*|-fwhopr*|-fuse-linker-plugin)
---
>       -O*|-g*|-flto*|-fwhopr*|-fuse-linker-plugin|-fstack-protector*|-stdlib=*| \
>       -specs=*|-fsanitize=*)
5858c7283
< 	arg="$func_quote_for_eval_result"
---
> 	arg=$func_quote_for_eval_result
5864a7290,7308
>       -Z*)
>         if test os2 = "`expr $host : '.*\(os2\)'`"; then
>           # OS/2 uses -Zxxx to specify OS/2-specific options
> 	  compiler_flags="$compiler_flags $arg"
> 	  func_append compile_command " $arg"
> 	  func_append finalize_command " $arg"
> 	  case $arg in
> 	  -Zlinker | -Zstack)
> 	    prev=xcompiler
> 	    ;;
> 	  esac
> 	  continue
>         else
> 	  # Otherwise treat like 'Some other compiler flag' below
> 	  func_quote_for_eval "$arg"
> 	  arg=$func_quote_for_eval_result
>         fi
> 	;;
> 
5868c7312
< 	arg="$func_quote_for_eval_result"
---
> 	arg=$func_quote_for_eval_result
5889,5891c7333,7335
< 	     test "$pic_object" = none &&
< 	     test "$non_pic_object" = none; then
< 	    func_fatal_error "cannot find name of object for \`$arg'"
---
> 	     test none = "$pic_object" &&
> 	     test none = "$non_pic_object"; then
> 	    func_fatal_error "cannot find name of object for '$arg'"
5896c7340
< 	  xdir="$func_dirname_result"
---
> 	  xdir=$func_dirname_result
5898c7342
< 	  if test "$pic_object" != none; then
---
> 	  test none = "$pic_object" || {
5900c7344
< 	    pic_object="$xdir$pic_object"
---
> 	    pic_object=$xdir$pic_object
5902,5903c7346,7347
< 	    if test "$prev" = dlfiles; then
< 	      if test "$build_libtool_libs" = yes && test "$dlopen_support" = yes; then
---
> 	    if test dlfiles = "$prev"; then
> 	      if test yes = "$build_libtool_libs" && test yes = "$dlopen_support"; then
5914c7358
< 	    if test "$prev" = dlprefiles; then
---
> 	    if test dlprefiles = "$prev"; then
5922,5923c7366,7367
< 	    arg="$pic_object"
< 	  fi
---
> 	    arg=$pic_object
> 	  }
5926c7370
< 	  if test "$non_pic_object" != none; then
---
> 	  if test none != "$non_pic_object"; then
5928c7372
< 	    non_pic_object="$xdir$non_pic_object"
---
> 	    non_pic_object=$xdir$non_pic_object
5932,5933c7376,7377
< 	    if test -z "$pic_object" || test "$pic_object" = none ; then
< 	      arg="$non_pic_object"
---
> 	    if test -z "$pic_object" || test none = "$pic_object"; then
> 	      arg=$non_pic_object
5938c7382
< 	    non_pic_object="$pic_object"
---
> 	    non_pic_object=$pic_object
5946c7390
< 	    xdir="$func_dirname_result"
---
> 	    xdir=$func_dirname_result
5954c7398
< 	    func_fatal_error "\`$arg' is not a valid libtool object"
---
> 	    func_fatal_error "'$arg' is not a valid libtool object"
5970c7414
< 	if test "$prev" = dlfiles; then
---
> 	if test dlfiles = "$prev"; then
5974c7418
< 	elif test "$prev" = dlprefiles; then
---
> 	elif test dlprefiles = "$prev"; then
5989c7433
< 	arg="$func_quote_for_eval_result"
---
> 	arg=$func_quote_for_eval_result
6001c7445
<       func_fatal_help "the \`$prevarg' option requires an argument"
---
>       func_fatal_help "the '$prevarg' option requires an argument"
6003c7447
<     if test "$export_dynamic" = yes && test -n "$export_dynamic_flag_spec"; then
---
>     if test yes = "$export_dynamic" && test -n "$export_dynamic_flag_spec"; then
6012,6013c7456,7457
<     outputname="$func_basename_result"
<     libobjs_save="$libobjs"
---
>     outputname=$func_basename_result
>     libobjs_save=$libobjs
6017c7461
<       eval shlib_search_path=\`\$ECHO \"\${$shlibpath_var}\" \| \$SED \'s/:/ /g\'\`
---
>       eval shlib_search_path=\`\$ECHO \"\$$shlibpath_var\" \| \$SED \'s/:/ /g\'\`
6023a7468,7470
>     # Definition is injected by LT_CONFIG during libtool generation.
>     func_munge_path_list sys_lib_dlsearch_path "$LT_SYS_LIBRARY_PATH"
> 
6025c7472
<     output_objdir="$func_dirname_result$objdir"
---
>     output_objdir=$func_dirname_result$objdir
6048c7495
<       if $opt_preserve_dup_deps ; then
---
>       if $opt_preserve_dup_deps; then
6056c7503
<     if test "$linkmode" = lib; then
---
>     if test lib = "$linkmode"; then
6088c7535
< 	    func_fatal_help "libraries can \`-dlopen' only libtool libraries: $file"
---
> 	    func_fatal_help "libraries can '-dlopen' only libtool libraries: $file"
6096c7543
< 	alldeplibs=no
---
> 	alldeplibs=false
6108c7555
<       if test "$linkmode,$pass" = "lib,link"; then
---
>       if test lib,link = "$linkmode,$pass"; then
6115c7562
< 	deplibs="$tmp_deplibs"
---
> 	deplibs=$tmp_deplibs
6118,6120c7565,7567
<       if test "$linkmode,$pass" = "lib,link" ||
< 	 test "$linkmode,$pass" = "prog,scan"; then
< 	libs="$deplibs"
---
>       if test lib,link = "$linkmode,$pass" ||
> 	 test prog,scan = "$linkmode,$pass"; then
> 	libs=$deplibs
6123c7570
<       if test "$linkmode" = prog; then
---
>       if test prog = "$linkmode"; then
6125,6126c7572,7573
< 	dlopen) libs="$dlfiles" ;;
< 	dlpreopen) libs="$dlprefiles" ;;
---
> 	dlopen) libs=$dlfiles ;;
> 	dlpreopen) libs=$dlprefiles ;;
6133c7580
<       if test "$linkmode,$pass" = "lib,dlpreopen"; then
---
>       if test lib,dlpreopen = "$linkmode,$pass"; then
6154c7601
< 	libs="$dlprefiles"
---
> 	libs=$dlprefiles
6156c7603
<       if test "$pass" = dlopen; then
---
>       if test dlopen = "$pass"; then
6158c7605
< 	save_deplibs="$deplibs"
---
> 	save_deplibs=$deplibs
6164c7611
< 	found=no
---
> 	found=false
6168c7615
< 	  if test "$linkmode,$pass" = "prog,link"; then
---
> 	  if test prog,link = "$linkmode,$pass"; then
6173c7620
< 	    if test "$linkmode" = lib ; then
---
> 	    if test lib = "$linkmode"; then
6183,6184c7630,7631
< 	  if test "$linkmode" != lib && test "$linkmode" != prog; then
< 	    func_warning "\`-l' is ignored for archives/objects"
---
> 	  if test lib != "$linkmode" && test prog != "$linkmode"; then
> 	    func_warning "'-l' is ignored for archives/objects"
6189c7636
< 	  if test "$linkmode" = lib; then
---
> 	  if test lib = "$linkmode"; then
6197c7644
< 	      lib="$searchdir/lib${name}${search_ext}"
---
> 	      lib=$searchdir/lib$name$search_ext
6199,6200c7646,7647
< 		if test "$search_ext" = ".la"; then
< 		  found=yes
---
> 		if test .la = "$search_ext"; then
> 		  found=:
6202c7649
< 		  found=no
---
> 		  found=false
6208,6218c7655,7656
< 	  if test "$found" != yes; then
< 	    # deplib doesn't seem to be a libtool library
< 	    if test "$linkmode,$pass" = "prog,link"; then
< 	      compile_deplibs="$deplib $compile_deplibs"
< 	      finalize_deplibs="$deplib $finalize_deplibs"
< 	    else
< 	      deplibs="$deplib $deplibs"
< 	      test "$linkmode" = lib && newdependency_libs="$deplib $newdependency_libs"
< 	    fi
< 	    continue
< 	  else # deplib is a libtool library
---
> 	  if $found; then
> 	    # deplib is a libtool library
6221c7659
< 	    if test "X$allow_libtool_libs_with_static_runtimes" = "Xyes" ; then
---
> 	    if test yes = "$allow_libtool_libs_with_static_runtimes"; then
6229c7667
< 		    ll="$l"
---
> 		    ll=$l
6231,6232c7669,7670
< 		  if test "X$ll" = "X$old_library" ; then # only static version available
< 		    found=no
---
> 		  if test "X$ll" = "X$old_library"; then # only static version available
> 		    found=false
6234c7672
< 		    ladir="$func_dirname_result"
---
> 		    ladir=$func_dirname_result
6236c7674
< 		    if test "$linkmode,$pass" = "prog,link"; then
---
> 		    if test prog,link = "$linkmode,$pass"; then
6241c7679
< 		      test "$linkmode" = lib && newdependency_libs="$deplib $newdependency_libs"
---
> 		      test lib = "$linkmode" && newdependency_libs="$deplib $newdependency_libs"
6249a7688,7697
> 	  else
> 	    # deplib doesn't seem to be a libtool library
> 	    if test prog,link = "$linkmode,$pass"; then
> 	      compile_deplibs="$deplib $compile_deplibs"
> 	      finalize_deplibs="$deplib $finalize_deplibs"
> 	    else
> 	      deplibs="$deplib $deplibs"
> 	      test lib = "$linkmode" && newdependency_libs="$deplib $newdependency_libs"
> 	    fi
> 	    continue
6253c7701
< 	  if test "$linkmode,$pass" = "prog,link"; then
---
> 	  if test prog,link = "$linkmode,$pass"; then
6258c7706
< 	    if test "$linkmode" = lib ; then
---
> 	    if test lib = "$linkmode"; then
6271c7719
< 	    test "$pass" = conv && continue
---
> 	    test conv = "$pass" && continue
6278c7726
< 	    if test "$pass" = conv; then
---
> 	    if test conv = "$pass"; then
6282c7730
< 	    if test "$pass" = scan; then
---
> 	    if test scan = "$pass"; then
6293c7741
< 	    func_warning "\`-L' is ignored for archives/objects"
---
> 	    func_warning "'-L' is ignored for archives/objects"
6299c7747
< 	  if test "$pass" = link; then
---
> 	  if test link = "$pass"; then
6317c7765
< 	  if test "$pass" = conv; then
---
> 	  if test conv = "$pass"; then
6328c7776
< 	      valid_a_lib=no
---
> 	      valid_a_lib=false
6335c7783
< 		    valid_a_lib=yes
---
> 		    valid_a_lib=:
6339c7787
< 		  valid_a_lib=yes
---
> 		  valid_a_lib=:
6342c7790,7795
< 	      if test "$valid_a_lib" != yes; then
---
> 	      if $valid_a_lib; then
> 		echo
> 		$ECHO "*** Warning: Linking the shared library $output against the"
> 		$ECHO "*** static library $deplib is not portable!"
> 		deplibs="$deplib $deplibs"
> 	      else
6350,6354d7802
< 	      else
< 		echo
< 		$ECHO "*** Warning: Linking the shared library $output against the"
< 		$ECHO "*** static library $deplib is not portable!"
< 		deplibs="$deplib $deplibs"
6361c7809
< 	    if test "$pass" != link; then
---
> 	    if test link != "$pass"; then
6372c7820
< 	  if test "$pass" = conv; then
---
> 	  if test conv = "$pass"; then
6374,6375c7822,7823
< 	  elif test "$linkmode" = prog; then
< 	    if test "$pass" = dlpreopen || test "$dlopen_support" != yes || test "$build_libtool_libs" = no; then
---
> 	  elif test prog = "$linkmode"; then
> 	    if test dlpreopen = "$pass" || test yes != "$dlopen_support" || test no = "$build_libtool_libs"; then
6388c7836
< 	  alldeplibs=yes
---
> 	  alldeplibs=:
6393,6396c7841,7842
< 	if test "$found" = yes || test -f "$lib"; then :
< 	else
< 	  func_fatal_error "cannot find the library \`$lib' or unhandled argument \`$deplib'"
< 	fi
---
> 	$found || test -f "$lib" \
> 	  || func_fatal_error "cannot find the library '$lib' or unhandled argument '$deplib'"
6400c7846
< 	  || func_fatal_error "\`$lib' is not a valid libtool archive"
---
> 	  || func_fatal_error "'$lib' is not a valid libtool archive"
6403c7849
< 	ladir="$func_dirname_result"
---
> 	ladir=$func_dirname_result
6433,6435c7879,7881
< 	if test "$linkmode,$pass" = "lib,link" ||
< 	   test "$linkmode,$pass" = "prog,scan" ||
< 	   { test "$linkmode" != prog && test "$linkmode" != lib; }; then
---
> 	if test lib,link = "$linkmode,$pass" ||
> 	   test prog,scan = "$linkmode,$pass" ||
> 	   { test prog != "$linkmode" && test lib != "$linkmode"; }; then
6440c7886
< 	if test "$pass" = conv; then
---
> 	if test conv = "$pass"; then
6445c7891
< 	      func_fatal_error "cannot find name of link library for \`$lib'"
---
> 	      func_fatal_error "cannot find name of link library for '$lib'"
6453c7899
< 	      if $opt_preserve_dup_deps ; then
---
> 	      if $opt_preserve_dup_deps; then
6460,6461c7906,7907
< 	  elif test "$linkmode" != prog && test "$linkmode" != lib; then
< 	    func_fatal_error "\`$lib' is not a convenience library"
---
> 	  elif test prog != "$linkmode" && test lib != "$linkmode"; then
> 	    func_fatal_error "'$lib' is not a convenience library"
6470,6471c7916,7917
< 	   { test "$prefer_static_libs" = yes ||
< 	     test "$prefer_static_libs,$installed" = "built,no"; }; then
---
> 	   { test yes = "$prefer_static_libs" ||
> 	     test built,no = "$prefer_static_libs,$installed"; }; then
6475c7921
< 	    linklib="$l"
---
> 	    linklib=$l
6479c7925
< 	  func_fatal_error "cannot find name of link library for \`$lib'"
---
> 	  func_fatal_error "cannot find name of link library for '$lib'"
6483,6486c7929,7931
< 	if test "$pass" = dlopen; then
< 	  if test -z "$libdir"; then
< 	    func_fatal_error "cannot -dlopen a convenience library: \`$lib'"
< 	  fi
---
> 	if test dlopen = "$pass"; then
> 	  test -z "$libdir" \
> 	    && func_fatal_error "cannot -dlopen a convenience library: '$lib'"
6488,6489c7933,7935
< 	     test "$dlopen_support" != yes ||
< 	     test "$build_libtool_libs" = no; then
---
> 	     test yes != "$dlopen_support" ||
> 	     test no = "$build_libtool_libs"
> 	  then
6503c7949
< 	[\\/]* | [A-Za-z]:[\\/]*) abs_ladir="$ladir" ;;
---
> 	[\\/]* | [A-Za-z]:[\\/]*) abs_ladir=$ladir ;;
6507c7953
< 	    func_warning "cannot determine absolute directory name of \`$ladir'"
---
> 	    func_warning "cannot determine absolute directory name of '$ladir'"
6509c7955
< 	    abs_ladir="$ladir"
---
> 	    abs_ladir=$ladir
6514c7960
< 	laname="$func_basename_result"
---
> 	laname=$func_basename_result
6517c7963
< 	if test "X$installed" = Xyes; then
---
> 	if test yes = "$installed"; then
6519,6522c7965,7968
< 	    func_warning "library \`$lib' was moved."
< 	    dir="$ladir"
< 	    absdir="$abs_ladir"
< 	    libdir="$abs_ladir"
---
> 	    func_warning "library '$lib' was moved."
> 	    dir=$ladir
> 	    absdir=$abs_ladir
> 	    libdir=$abs_ladir
6524,6525c7970,7971
< 	    dir="$lt_sysroot$libdir"
< 	    absdir="$lt_sysroot$libdir"
---
> 	    dir=$lt_sysroot$libdir
> 	    absdir=$lt_sysroot$libdir
6527c7973
< 	  test "X$hardcode_automatic" = Xyes && avoidtemprpath=yes
---
> 	  test yes = "$hardcode_automatic" && avoidtemprpath=yes
6530,6531c7976,7977
< 	    dir="$ladir"
< 	    absdir="$abs_ladir"
---
> 	    dir=$ladir
> 	    absdir=$abs_ladir
6535,6536c7981,7982
< 	    dir="$ladir/$objdir"
< 	    absdir="$abs_ladir/$objdir"
---
> 	    dir=$ladir/$objdir
> 	    absdir=$abs_ladir/$objdir
6545,6547c7991,7993
< 	if test "$pass" = dlpreopen; then
< 	  if test -z "$libdir" && test "$linkmode" = prog; then
< 	    func_fatal_error "only libraries may -dlpreopen a convenience library: \`$lib'"
---
> 	if test dlpreopen = "$pass"; then
> 	  if test -z "$libdir" && test prog = "$linkmode"; then
> 	    func_fatal_error "only libraries may -dlpreopen a convenience library: '$lib'"
6549c7995
< 	  case "$host" in
---
> 	  case $host in
6593c8039
< 	  if test "$linkmode" = lib; then
---
> 	  if test lib = "$linkmode"; then
6595c8041
< 	  elif test "$linkmode,$pass" = "prog,link"; then
---
> 	  elif test prog,link = "$linkmode,$pass"; then
6605c8051
< 	if test "$linkmode" = prog && test "$pass" != link; then
---
> 	if test prog = "$linkmode" && test link != "$pass"; then
6609,6612c8055,8058
< 	  linkalldeplibs=no
< 	  if test "$link_all_deplibs" != no || test -z "$library_names" ||
< 	     test "$build_libtool_libs" = no; then
< 	    linkalldeplibs=yes
---
> 	  linkalldeplibs=false
> 	  if test no != "$link_all_deplibs" || test -z "$library_names" ||
> 	     test no = "$build_libtool_libs"; then
> 	    linkalldeplibs=:
6624c8070
< 	    if test "$linkalldeplibs" = yes; then
---
> 	    if $linkalldeplibs; then
6631c8077
< 	    if $opt_preserve_dup_deps ; then
---
> 	    if $opt_preserve_dup_deps; then
6641c8087
< 	if test "$linkmode,$pass" = "prog,link"; then
---
> 	if test prog,link = "$linkmode,$pass"; then
6643,6644c8089,8090
< 	     { { test "$prefer_static_libs" = no ||
< 	         test "$prefer_static_libs,$installed" = "built,yes"; } ||
---
> 	     { { test no = "$prefer_static_libs" ||
> 	         test built,yes = "$prefer_static_libs,$installed"; } ||
6647c8093
< 	    if test -n "$shlibpath_var" && test -z "$avoidtemprpath" ; then
---
> 	    if test -n "$shlibpath_var" && test -z "$avoidtemprpath"; then
6649c8095
< 	      case "$temp_rpath:" in
---
> 	      case $temp_rpath: in
6678,6680c8124,8126
< 	  if test "$alldeplibs" = yes &&
< 	     { test "$deplibs_check_method" = pass_all ||
< 	       { test "$build_libtool_libs" = yes &&
---
> 	  if $alldeplibs &&
> 	     { test pass_all = "$deplibs_check_method" ||
> 	       { test yes = "$build_libtool_libs" &&
6689c8135
< 	if test "$use_static_libs" = built && test "$installed" = yes; then
---
> 	if test built = "$use_static_libs" && test yes = "$installed"; then
6693c8139
< 	   { test "$use_static_libs" = no || test -z "$old_library"; }; then
---
> 	   { test no = "$use_static_libs" || test -z "$old_library"; }; then
6695c8141
< 	  *cygwin* | *mingw* | *cegcc*)
---
> 	  *cygwin* | *mingw* | *cegcc* | *os2*)
6701c8147
< 	    if test "$installed" = no; then
---
> 	    if test no = "$installed"; then
6711c8157
< 	  dlopenmodule=""
---
> 	  dlopenmodule=
6714c8160
< 	      dlopenmodule="$dlpremoduletest"
---
> 	      dlopenmodule=$dlpremoduletest
6718c8164
< 	  if test -z "$dlopenmodule" && test "$shouldnotlink" = yes && test "$pass" = link; then
---
> 	  if test -z "$dlopenmodule" && test yes = "$shouldnotlink" && test link = "$pass"; then
6720c8166
< 	    if test "$linkmode" = prog; then
---
> 	    if test prog = "$linkmode"; then
6727,6728c8173,8174
< 	  if test "$linkmode" = lib &&
< 	     test "$hardcode_into_libs" = yes; then
---
> 	  if test lib = "$linkmode" &&
> 	     test yes = "$hardcode_into_libs"; then
6756c8202
< 	    realname="$1"
---
> 	    realname=$1
6761c8207
< 	      soname="$dlname"
---
> 	      soname=$dlname
6765c8211
< 	      *cygwin* | mingw* | *cegcc*)
---
> 	      *cygwin* | mingw* | *cegcc* | *os2*)
6768c8214
< 		versuffix="-$major"
---
> 		versuffix=-$major
6773c8219
< 	      soname="$realname"
---
> 	      soname=$realname
6777c8223
< 	    soroot="$soname"
---
> 	    soroot=$soname
6779c8225
< 	    soname="$func_basename_result"
---
> 	    soname=$func_basename_result
6786c8232
< 	      func_verbose "extracting exported symbol list from \`$soname'"
---
> 	      func_verbose "extracting exported symbol list from '$soname'"
6792c8238
< 	      func_verbose "generating import library for \`$soname'"
---
> 	      func_verbose "generating import library for '$soname'"
6800c8246
< 	  if test "$linkmode" = prog || test "$opt_mode" != relink; then
---
> 	  if test prog = "$linkmode" || test relink != "$opt_mode"; then
6807,6808c8253,8254
< 	      if test "$hardcode_direct" = no; then
< 		add="$dir/$linklib"
---
> 	      if test no = "$hardcode_direct"; then
> 		add=$dir/$linklib
6810,6811c8256,8257
< 		  *-*-sco3.2v5.0.[024]*) add_dir="-L$dir" ;;
< 		  *-*-sysv4*uw2*) add_dir="-L$dir" ;;
---
> 		  *-*-sco3.2v5.0.[024]*) add_dir=-L$dir ;;
> 		  *-*-sysv4*uw2*) add_dir=-L$dir ;;
6813c8259
< 		    *-*-unixware7*) add_dir="-L$dir" ;;
---
> 		    *-*-unixware7*) add_dir=-L$dir ;;
6815c8261
< 		    # if the lib is a (non-dlopened) module then we can not
---
> 		    # if the lib is a (non-dlopened) module then we cannot
6818c8264
< 			 $GREP ": [^:]* bundle" >/dev/null ; then
---
> 			 $GREP ": [^:]* bundle" >/dev/null; then
6821c8267
< 			if test -z "$old_library" ; then
---
> 			if test -z "$old_library"; then
6826c8272
< 			  add="$dir/$old_library"
---
> 			  add=$dir/$old_library
6829c8275
< 			add="$dir/$old_library"
---
> 			add=$dir/$old_library
6833c8279
< 	      elif test "$hardcode_minus_L" = no; then
---
> 	      elif test no = "$hardcode_minus_L"; then
6835c8281
< 		*-*-sunos*) add_shlibpath="$dir" ;;
---
> 		*-*-sunos*) add_shlibpath=$dir ;;
6837,6841c8283,8287
< 		add_dir="-L$dir"
< 		add="-l$name"
< 	      elif test "$hardcode_shlibpath_var" = no; then
< 		add_shlibpath="$dir"
< 		add="-l$name"
---
> 		add_dir=-L$dir
> 		add=-l$name
> 	      elif test no = "$hardcode_shlibpath_var"; then
> 		add_shlibpath=$dir
> 		add=-l$name
6847,6851c8293,8297
< 	      if test "$hardcode_direct" = yes &&
< 	         test "$hardcode_direct_absolute" = no; then
< 		add="$dir/$linklib"
< 	      elif test "$hardcode_minus_L" = yes; then
< 		add_dir="-L$absdir"
---
> 	      if test yes = "$hardcode_direct" &&
> 	         test no = "$hardcode_direct_absolute"; then
> 		add=$dir/$linklib
> 	      elif test yes = "$hardcode_minus_L"; then
> 		add_dir=-L$absdir
6860,6863c8306,8309
< 		add="-l$name"
< 	      elif test "$hardcode_shlibpath_var" = yes; then
< 		add_shlibpath="$dir"
< 		add="-l$name"
---
> 		add=-l$name
> 	      elif test yes = "$hardcode_shlibpath_var"; then
> 		add_shlibpath=$dir
> 		add=-l$name
6871c8317
< 	    if test "$lib_linked" != yes; then
---
> 	    if test yes != "$lib_linked"; then
6881c8327
< 	    if test "$linkmode" = prog; then
---
> 	    if test prog = "$linkmode"; then
6887,6889c8333,8335
< 	      if test "$hardcode_direct" != yes &&
< 		 test "$hardcode_minus_L" != yes &&
< 		 test "$hardcode_shlibpath_var" = yes; then
---
> 	      if test yes != "$hardcode_direct" &&
> 		 test yes != "$hardcode_minus_L" &&
> 		 test yes = "$hardcode_shlibpath_var"; then
6898c8344
< 	  if test "$linkmode" = prog || test "$opt_mode" = relink; then
---
> 	  if test prog = "$linkmode" || test relink = "$opt_mode"; then
6903,6909c8349,8355
< 	    if test "$hardcode_direct" = yes &&
< 	       test "$hardcode_direct_absolute" = no; then
< 	      add="$libdir/$linklib"
< 	    elif test "$hardcode_minus_L" = yes; then
< 	      add_dir="-L$libdir"
< 	      add="-l$name"
< 	    elif test "$hardcode_shlibpath_var" = yes; then
---
> 	    if test yes = "$hardcode_direct" &&
> 	       test no = "$hardcode_direct_absolute"; then
> 	      add=$libdir/$linklib
> 	    elif test yes = "$hardcode_minus_L"; then
> 	      add_dir=-L$libdir
> 	      add=-l$name
> 	    elif test yes = "$hardcode_shlibpath_var"; then
6914,6915c8360,8361
< 	      add="-l$name"
< 	    elif test "$hardcode_automatic" = yes; then
---
> 	      add=-l$name
> 	    elif test yes = "$hardcode_automatic"; then
6917,6918c8363,8364
< 		 test -f "$inst_prefix_dir$libdir/$linklib" ; then
< 		add="$inst_prefix_dir$libdir/$linklib"
---
> 		 test -f "$inst_prefix_dir$libdir/$linklib"; then
> 		add=$inst_prefix_dir$libdir/$linklib
6920c8366
< 		add="$libdir/$linklib"
---
> 		add=$libdir/$linklib
6924c8370
< 	      add_dir="-L$libdir"
---
> 	      add_dir=-L$libdir
6933c8379
< 	      add="-l$name"
---
> 	      add=-l$name
6936c8382
< 	    if test "$linkmode" = prog; then
---
> 	    if test prog = "$linkmode"; then
6944c8390
< 	elif test "$linkmode" = prog; then
---
> 	elif test prog = "$linkmode"; then
6948,6949c8394,8395
< 	  if test "$hardcode_direct" != unsupported; then
< 	    test -n "$old_library" && linklib="$old_library"
---
> 	  if test unsupported != "$hardcode_direct"; then
> 	    test -n "$old_library" && linklib=$old_library
6956c8402
< 	elif test "$build_libtool_libs" = yes; then
---
> 	elif test yes = "$build_libtool_libs"; then
6958c8404
< 	  if test "$deplibs_check_method" != pass_all; then
---
> 	  if test pass_all != "$deplibs_check_method"; then
6965c8411
< 	    $ECHO "*** Warning: This system can not link to static lib archive $lib."
---
> 	    $ECHO "*** Warning: This system cannot link to static lib archive $lib."
6969c8415
< 	    if test "$module" = yes; then
---
> 	    if test yes = "$module"; then
6976c8422
< 		echo "*** lists from a program, using \`nm' or equivalent, but libtool could"
---
> 		echo "*** lists from a program, using 'nm' or equivalent, but libtool could"
6978c8424
< 		echo "*** \`nm' from GNU binutils and a full rebuild may help."
---
> 		echo "*** 'nm' from GNU binutils and a full rebuild may help."
6980c8426
< 	      if test "$build_old_libs" = no; then
---
> 	      if test no = "$build_old_libs"; then
6993c8439
< 	if test "$linkmode" = lib; then
---
> 	if test lib = "$linkmode"; then
6995,6997c8441,8443
< 	     { test "$hardcode_into_libs" != yes ||
< 	       test "$build_old_libs" = yes ||
< 	       test "$link_static" = yes; }; then
---
> 	     { test yes != "$hardcode_into_libs" ||
> 	       test yes = "$build_old_libs" ||
> 	       test yes = "$link_static"; }; then
7011c8457
< 	    dependency_libs="$temp_deplibs"
---
> 	    dependency_libs=$temp_deplibs
7016c8462
< 	  test "$link_static" = no && newdependency_libs="$abs_ladir/$laname $newdependency_libs"
---
> 	  test no = "$link_static" && newdependency_libs="$abs_ladir/$laname $newdependency_libs"
7026c8472
< 	    if $opt_preserve_dup_deps ; then
---
> 	    if $opt_preserve_dup_deps; then
7035c8481
< 	  if test "$link_all_deplibs" != no; then
---
> 	  if test no != "$link_all_deplibs"; then
7040c8486
< 	      -L*) path="$deplib" ;;
---
> 	      -L*) path=$deplib ;;
7048c8494
< 		[\\/]* | [A-Za-z]:[\\/]*) absdir="$dir" ;;
---
> 		[\\/]* | [A-Za-z]:[\\/]*) absdir=$dir ;;
7052,7053c8498,8499
< 		    func_warning "cannot determine absolute directory name of \`$dir'"
< 		    absdir="$dir"
---
> 		    func_warning "cannot determine absolute directory name of '$dir'"
> 		    absdir=$dir
7061,7063c8507,8509
< 		  eval deplibrary_names=`${SED} -n -e 's/^library_names=\(.*\)$/\1/p' $deplib`
< 		  if test -n "$deplibrary_names" ; then
< 		    for tmp in $deplibrary_names ; do
---
> 		  eval deplibrary_names=`$SED -n -e 's/^library_names=\(.*\)$/\1/p' $deplib`
> 		  if test -n "$deplibrary_names"; then
> 		    for tmp in $deplibrary_names; do
7066,7068c8512,8514
< 		    if test -f "$absdir/$objdir/$depdepl" ; then
< 		      depdepl="$absdir/$objdir/$depdepl"
< 		      darwin_install_name=`${OTOOL} -L $depdepl | awk '{if (NR == 2) {print $1;exit}}'`
---
> 		    if test -f "$absdir/$objdir/$depdepl"; then
> 		      depdepl=$absdir/$objdir/$depdepl
> 		      darwin_install_name=`$OTOOL -L $depdepl | awk '{if (NR == 2) {print $1;exit}}'`
7070c8516
<                           darwin_install_name=`${OTOOL64} -L $depdepl  | awk '{if (NR == 2) {print $1;exit}}'`
---
>                           darwin_install_name=`$OTOOL64 -L $depdepl  | awk '{if (NR == 2) {print $1;exit}}'`
7072,7073c8518,8519
< 		      func_append compiler_flags " ${wl}-dylib_file ${wl}${darwin_install_name}:${depdepl}"
< 		      func_append linker_flags " -dylib_file ${darwin_install_name}:${depdepl}"
---
> 		      func_append compiler_flags " $wl-dylib_file $wl$darwin_install_name:$depdepl"
> 		      func_append linker_flags " -dylib_file $darwin_install_name:$depdepl"
7079c8525
< 		  path="-L$absdir/$objdir"
---
> 		  path=-L$absdir/$objdir
7083c8529
< 		  eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $deplib`
---
> 		  eval libdir=`$SED -n -e 's/^libdir=\(.*\)$/\1/p' $deplib`
7085c8531
< 		    func_fatal_error "\`$deplib' is not a valid libtool archive"
---
> 		    func_fatal_error "'$deplib' is not a valid libtool archive"
7087c8533
< 		    func_warning "\`$deplib' seems to be moved"
---
> 		    func_warning "'$deplib' seems to be moved"
7089c8535
< 		  path="-L$absdir"
---
> 		  path=-L$absdir
7101,7102c8547,8548
<       if test "$pass" = link; then
< 	if test "$linkmode" = "prog"; then
---
>       if test link = "$pass"; then
> 	if test prog = "$linkmode"; then
7109,7110c8555,8556
<       dependency_libs="$newdependency_libs"
<       if test "$pass" = dlpreopen; then
---
>       dependency_libs=$newdependency_libs
>       if test dlpreopen = "$pass"; then
7116,7117c8562,8563
<       if test "$pass" != dlopen; then
< 	if test "$pass" != conv; then
---
>       if test dlopen != "$pass"; then
> 	test conv = "$pass" || {
7127c8573
< 	fi
---
> 	}
7129,7131c8575
< 	if test "$linkmode,$pass" != "prog,link"; then
< 	  vars="deplibs"
< 	else
---
> 	if test prog,link = "$linkmode,$pass"; then
7132a8577,8578
> 	else
> 	  vars=deplibs
7189a8636,8666
> 
>       # Add Sun CC postdeps if required:
>       test CXX = "$tagname" && {
>         case $host_os in
>         linux*)
>           case `$CC -V 2>&1 | sed 5q` in
>           *Sun\ C*) # Sun C++ 5.9
>             func_suncc_cstd_abi
> 
>             if test no != "$suncc_use_cstd_abi"; then
>               func_append postdeps ' -library=Cstd -library=Crun'
>             fi
>             ;;
>           esac
>           ;;
> 
>         solaris*)
>           func_cc_basename "$CC"
>           case $func_cc_basename_result in
>           CC* | sunCC*)
>             func_suncc_cstd_abi
> 
>             if test no != "$suncc_use_cstd_abi"; then
>               func_append postdeps ' -library=Cstd -library=Crun'
>             fi
>             ;;
>           esac
>           ;;
>         esac
>       }
> 
7193c8670
<       for i in $dependency_libs ; do
---
>       for i in $dependency_libs; do
7196c8673
< 	  i=""
---
> 	  i=
7199c8676
< 	if test -n "$i" ; then
---
> 	if test -n "$i"; then
7205,7206c8682,8683
<     if test "$linkmode" = prog; then
<       dlfiles="$newdlfiles"
---
>     if test prog = "$linkmode"; then
>       dlfiles=$newdlfiles
7208,7209c8685,8686
<     if test "$linkmode" = prog || test "$linkmode" = lib; then
<       dlprefiles="$newdlprefiles"
---
>     if test prog = "$linkmode" || test lib = "$linkmode"; then
>       dlprefiles=$newdlprefiles
7214,7215c8691,8692
<       if test -n "$dlfiles$dlprefiles" || test "$dlself" != no; then
< 	func_warning "\`-dlopen' is ignored for archives"
---
>       if test -n "$dlfiles$dlprefiles" || test no != "$dlself"; then
> 	func_warning "'-dlopen' is ignored for archives"
7220c8697
< 	func_warning "\`-l' and \`-L' are ignored for archives" ;;
---
> 	func_warning "'-l' and '-L' are ignored for archives" ;;
7224c8701
< 	func_warning "\`-rpath' is ignored for archives"
---
> 	func_warning "'-rpath' is ignored for archives"
7227c8704
< 	func_warning "\`-R' is ignored for archives"
---
> 	func_warning "'-R' is ignored for archives"
7230c8707
< 	func_warning "\`-version-info/-version-number' is ignored for archives"
---
> 	func_warning "'-version-info/-version-number' is ignored for archives"
7233c8710
< 	func_warning "\`-release' is ignored for archives"
---
> 	func_warning "'-release' is ignored for archives"
7236c8713
< 	func_warning "\`-export-symbols' is ignored for archives"
---
> 	func_warning "'-export-symbols' is ignored for archives"
7240c8717
<       oldlibs="$output"
---
>       oldlibs=$output
7245c8722
<       # Make sure we only generate libraries of the form `libNAME.la'.
---
>       # Make sure we only generate libraries of the form 'libNAME.la'.
7254,7255c8731,8732
< 	test "$module" = no && \
< 	  func_fatal_help "libtool library \`$output' must begin with \`lib'"
---
> 	test no = "$module" \
> 	  && func_fatal_help "libtool library '$output' must begin with 'lib'"
7257c8734
< 	if test "$need_lib_prefix" != no; then
---
> 	if test no != "$need_lib_prefix"; then
7271,7272c8748,8749
< 	if test "$deplibs_check_method" != pass_all; then
< 	  func_fatal_error "cannot build libtool library \`$output' from non-libtool objects on this host:$objs"
---
> 	if test pass_all != "$deplibs_check_method"; then
> 	  func_fatal_error "cannot build libtool library '$output' from non-libtool objects on this host:$objs"
7281,7282c8758,8759
<       test "$dlself" != no && \
< 	func_warning "\`-dlopen self' is ignored for libtool libraries"
---
>       test no = "$dlself" \
> 	|| func_warning "'-dlopen self' is ignored for libtool libraries"
7286,7287c8763,8764
<       test "$#" -gt 1 && \
< 	func_warning "ignoring multiple \`-rpath's for a libtool library"
---
>       test 1 -lt "$#" \
> 	&& func_warning "ignoring multiple '-rpath's for a libtool library"
7289c8766
<       install_libdir="$1"
---
>       install_libdir=$1
7293c8770
< 	if test "$build_libtool_libs" = yes; then
---
> 	if test yes = "$build_libtool_libs"; then
7295c8772
< 	  # Some compilers have problems with a `.al' extension so
---
> 	  # Some compilers have problems with a '.al' extension so
7304c8781
< 	  func_warning "\`-version-info/-version-number' is ignored for convenience libraries"
---
> 	  func_warning "'-version-info/-version-number' is ignored for convenience libraries"
7307c8784
< 	  func_warning "\`-release' is ignored for convenience libraries"
---
> 	  func_warning "'-release' is ignored for convenience libraries"
7311c8788
< 	save_ifs="$IFS"; IFS=':'
---
> 	save_ifs=$IFS; IFS=:
7314c8791
< 	IFS="$save_ifs"
---
> 	IFS=$save_ifs
7317c8794
< 	  func_fatal_help "too many parameters to \`-version-info'"
---
> 	  func_fatal_help "too many parameters to '-version-info'"
7325,7327c8802,8804
< 	  number_major="$1"
< 	  number_minor="$2"
< 	  number_revision="$3"
---
> 	  number_major=$1
> 	  number_minor=$2
> 	  number_revision=$3
7333c8810
< 	  # which has an extra 1 added just for fun
---
> 	  # that has an extra 1 added just for fun
7337c8814
< 	  darwin|linux|osf|windows|none)
---
> 	  darwin|freebsd-elf|linux|osf|windows|none)
7340,7341c8817,8818
< 	    age="$number_minor"
< 	    revision="$number_revision"
---
> 	    age=$number_minor
> 	    revision=$number_revision
7343,7346c8820,8823
< 	  freebsd-aout|freebsd-elf|qnx|sunos)
< 	    current="$number_major"
< 	    revision="$number_minor"
< 	    age="0"
---
> 	  freebsd-aout|qnx|sunos)
> 	    current=$number_major
> 	    revision=$number_minor
> 	    age=0
7351,7352c8828,8829
< 	    age="$number_minor"
< 	    revision="$number_minor"
---
> 	    age=$number_minor
> 	    revision=$number_minor
7356c8833
< 	    func_fatal_configuration "$modename: unknown library version type \`$version_type'"
---
> 	    func_fatal_configuration "$modename: unknown library version type '$version_type'"
7361,7363c8838,8840
< 	  current="$1"
< 	  revision="$2"
< 	  age="$3"
---
> 	  current=$1
> 	  revision=$2
> 	  age=$3
7371,7372c8848,8849
< 	  func_error "CURRENT \`$current' must be a nonnegative integer"
< 	  func_fatal_error "\`$vinfo' is not valid version information"
---
> 	  func_error "CURRENT '$current' must be a nonnegative integer"
> 	  func_fatal_error "'$vinfo' is not valid version information"
7379,7380c8856,8857
< 	  func_error "REVISION \`$revision' must be a nonnegative integer"
< 	  func_fatal_error "\`$vinfo' is not valid version information"
---
> 	  func_error "REVISION '$revision' must be a nonnegative integer"
> 	  func_fatal_error "'$vinfo' is not valid version information"
7387,7388c8864,8865
< 	  func_error "AGE \`$age' must be a nonnegative integer"
< 	  func_fatal_error "\`$vinfo' is not valid version information"
---
> 	  func_error "AGE '$age' must be a nonnegative integer"
> 	  func_fatal_error "'$vinfo' is not valid version information"
7393,7394c8870,8871
< 	  func_error "AGE \`$age' is greater than the current interface number \`$current'"
< 	  func_fatal_error "\`$vinfo' is not valid version information"
---
> 	  func_error "AGE '$age' is greater than the current interface number '$current'"
> 	  func_fatal_error "'$vinfo' is not valid version information"
7409c8886
< 	  versuffix="$major.$age.$revision"
---
> 	  versuffix=$major.$age.$revision
7413c8890
< 	  xlcverstring="${wl}-compatibility_version ${wl}$minor_current ${wl}-current_version ${wl}$minor_current.$revision"
---
> 	  xlcverstring="$wl-compatibility_version $wl$minor_current $wl-current_version $wl$minor_current.$revision"
7414a8892,8900
>           # On Darwin other compilers
>           case $CC in
>               nagfor*)
>                   verstring="$wl-compatibility_version $wl$minor_current $wl-current_version $wl$minor_current.$revision"
>                   ;;
>               *)
>                   verstring="-compatibility_version $minor_current -current_version $minor_current.$revision"
>                   ;;
>           esac
7418,7419c8904,8905
< 	  major=".$current"
< 	  versuffix=".$current.$revision";
---
> 	  major=.$current
> 	  versuffix=.$current.$revision
7423,7424c8909,8911
< 	  major=".$current"
< 	  versuffix=".$current"
---
> 	  func_arith $current - $age
> 	  major=.$func_arith_result
> 	  versuffix=$major.$age.$revision
7428c8915
< 	  if test "X$lt_irix_increment" = "Xno"; then
---
> 	  if test no = "$lt_irix_increment"; then
7439c8926
< 	  verstring="$verstring_prefix$major.$revision"
---
> 	  verstring=$verstring_prefix$major.$revision
7443c8930
< 	  while test "$loop" -ne 0; do
---
> 	  while test 0 -ne "$loop"; do
7448c8935
< 	    verstring="$verstring_prefix$major.$iface:$verstring"
---
> 	    verstring=$verstring_prefix$major.$iface:$verstring
7451c8938
< 	  # Before this point, $major must not contain `.'.
---
> 	  # Before this point, $major must not contain '.'.
7453c8940
< 	  versuffix="$major.$revision"
---
> 	  versuffix=$major.$revision
7459c8946
< 	  versuffix="$major.$age.$revision"
---
> 	  versuffix=$major.$age.$revision
7465,7466c8952,8953
< 	  versuffix=".$current.$age.$revision"
< 	  verstring="$current.$age.$revision"
---
> 	  versuffix=.$current.$age.$revision
> 	  verstring=$current.$age.$revision
7470c8957
< 	  while test "$loop" -ne 0; do
---
> 	  while test 0 -ne "$loop"; do
7475c8962
< 	    verstring="$verstring:${iface}.0"
---
> 	    verstring=$verstring:$iface.0
7479c8966
< 	  func_append verstring ":${current}.0"
---
> 	  func_append verstring ":$current.0"
7483,7484c8970,8976
< 	  major=".$current"
< 	  versuffix=".$current"
---
> 	  major=.$current
> 	  versuffix=.$current
> 	  ;;
> 
> 	sco)
> 	  major=.$current
> 	  versuffix=.$current
7488,7489c8980,8981
< 	  major=".$current"
< 	  versuffix=".$current.$revision"
---
> 	  major=.$current
> 	  versuffix=.$current.$revision
7494c8986
< 	  # extension on DOS 8.3 filesystems.
---
> 	  # extension on DOS 8.3 file systems.
7497c8989
< 	  versuffix="-$major"
---
> 	  versuffix=-$major
7501c8993
< 	  func_fatal_configuration "unknown library version type \`$version_type'"
---
> 	  func_fatal_configuration "unknown library version type '$version_type'"
7515c9007
< 	    verstring="0.0"
---
> 	    verstring=0.0
7518c9010
< 	  if test "$need_version" = no; then
---
> 	  if test no = "$need_version"; then
7521c9013
< 	    versuffix=".0.0"
---
> 	    versuffix=.0.0
7526c9018
< 	if test "$avoid_version" = yes && test "$need_version" = no; then
---
> 	if test yes,no = "$avoid_version,$need_version"; then
7529c9021
< 	  verstring=""
---
> 	  verstring=
7533,7537c9025,9032
< 	if test "$allow_undefined" = yes; then
< 	  if test "$allow_undefined_flag" = unsupported; then
< 	    func_warning "undefined symbols not allowed in $host shared libraries"
< 	    build_libtool_libs=no
< 	    build_old_libs=yes
---
> 	if test yes = "$allow_undefined"; then
> 	  if test unsupported = "$allow_undefined_flag"; then
> 	    if test yes = "$build_old_libs"; then
> 	      func_warning "undefined symbols not allowed in $host shared libraries; building static only"
> 	      build_libtool_libs=no
> 	    else
> 	      func_fatal_error "can't build $host shared library unless -no-undefined is specified"
> 	    fi
7541c9036
< 	  allow_undefined_flag="$no_undefined_flag"
---
> 	  allow_undefined_flag=$no_undefined_flag
7546c9041
<       func_generate_dlsyms "$libname" "$libname" "yes"
---
>       func_generate_dlsyms "$libname" "$libname" :
7548c9043
<       test "X$libobjs" = "X " && libobjs=
---
>       test " " = "$libobjs" && libobjs=
7550c9045
<       if test "$opt_mode" != relink; then
---
>       if test relink != "$opt_mode"; then
7559,7560c9054,9055
< 	    $output_objdir/$outputname | $output_objdir/$libname.* | $output_objdir/${libname}${release}.*)
< 	       if test "X$precious_files_regex" != "X"; then
---
> 	    $output_objdir/$outputname | $output_objdir/$libname.* | $output_objdir/$libname$release.*)
> 	       if test -n "$precious_files_regex"; then
7576c9071
<       if test "$build_old_libs" = yes && test "$build_libtool_libs" != convenience ; then
---
>       if test yes = "$build_old_libs" && test convenience != "$build_libtool_libs"; then
7580c9075
< 	oldobjs="$objs "`$ECHO "$libobjs" | $SP2NL | $SED "/\.${libext}$/d; $lo2o" | $NL2SP`
---
> 	oldobjs="$objs "`$ECHO "$libobjs" | $SP2NL | $SED "/\.$libext$/d; $lo2o" | $NL2SP`
7601c9096
< 	if test "$hardcode_into_libs" != yes || test "$build_old_libs" = yes; then
---
> 	if test yes != "$hardcode_into_libs" || test yes = "$build_old_libs"; then
7607c9102
<       old_dlfiles="$dlfiles"
---
>       old_dlfiles=$dlfiles
7617c9112
<       old_dlprefiles="$dlprefiles"
---
>       old_dlprefiles=$dlprefiles
7626c9121
<       if test "$build_libtool_libs" = yes; then
---
>       if test yes = "$build_libtool_libs"; then
7650c9145
< 	    if test "$build_libtool_need_lc" = "yes"; then
---
> 	    if test yes = "$build_libtool_need_lc"; then
7666,7668c9161,9163
< 	release=""
< 	versuffix=""
< 	major=""
---
> 	release=
> 	versuffix=
> 	major=
7697c9192
< 		if test "X$allow_libtool_libs_with_static_runtimes" = "Xyes" ; then
---
> 		if test yes = "$allow_libtool_libs_with_static_runtimes"; then
7701c9196
< 		    i=""
---
> 		    i=
7705c9200
< 		if test -n "$i" ; then
---
> 		if test -n "$i"; then
7710c9205
< 		  if test `expr "$ldd_output" : ".*$deplib_match"` -ne 0 ; then
---
> 		  if test `expr "$ldd_output" : ".*$deplib_match"` -ne 0; then
7740c9235
< 		  if test "X$allow_libtool_libs_with_static_runtimes" = "Xyes" ; then
---
> 		  if test yes = "$allow_libtool_libs_with_static_runtimes"; then
7744c9239
< 		      i=""
---
> 		      i=
7748c9243
< 		  if test -n "$i" ; then
---
> 		  if test -n "$i"; then
7753c9248
< 		    if test `expr "$ldd_output" : ".*$deplib_match"` -ne 0 ; then
---
> 		    if test `expr "$ldd_output" : ".*$deplib_match"` -ne 0; then
7790c9285
< 	      if test "X$allow_libtool_libs_with_static_runtimes" = "Xyes" ; then
---
> 	      if test yes = "$allow_libtool_libs_with_static_runtimes"; then
7794c9289
< 		  a_deplib=""
---
> 		  a_deplib=
7798c9293
< 	      if test -n "$a_deplib" ; then
---
> 	      if test -n "$a_deplib"; then
7805c9300
< 		test "$want_nocaseglob" = yes && nocaseglob=`shopt -p nocaseglob`
---
> 		test yes = "$want_nocaseglob" && nocaseglob=`shopt -p nocaseglob`
7807c9302
< 		  if test "$want_nocaseglob" = yes; then
---
> 		  if test yes = "$want_nocaseglob"; then
7825c9320
< 		      potlib="$potent_lib"
---
> 		      potlib=$potent_lib
7827c9322
< 			potliblink=`ls -ld $potlib | ${SED} 's/.* -> //'`
---
> 			potliblink=`ls -ld $potlib | $SED 's/.* -> //'`
7829,7830c9324,9325
< 			[\\/]* | [A-Za-z]:[\\/]*) potlib="$potliblink";;
< 			*) potlib=`$ECHO "$potlib" | $SED 's,[^/]*$,,'`"$potliblink";;
---
> 			[\\/]* | [A-Za-z]:[\\/]*) potlib=$potliblink;;
> 			*) potlib=`$ECHO "$potlib" | $SED 's|[^/]*$||'`"$potliblink";;
7837c9332
< 			a_deplib=""
---
> 			a_deplib=
7843c9338
< 	      if test -n "$a_deplib" ; then
---
> 	      if test -n "$a_deplib"; then
7851c9346
< 		if test -z "$potlib" ; then
---
> 		if test -z "$potlib"; then
7874c9369
< 	      if test "X$allow_libtool_libs_with_static_runtimes" = "Xyes" ; then
---
> 	      if test yes = "$allow_libtool_libs_with_static_runtimes"; then
7878c9373
< 		  a_deplib=""
---
> 		  a_deplib=
7882c9377
< 	      if test -n "$a_deplib" ; then
---
> 	      if test -n "$a_deplib"; then
7887c9382
< 		    potlib="$potent_lib" # see symlink-check above in file_magic test
---
> 		    potlib=$potent_lib # see symlink-check above in file_magic test
7891c9386
< 		      a_deplib=""
---
> 		      a_deplib=
7897c9392
< 	      if test -n "$a_deplib" ; then
---
> 	      if test -n "$a_deplib"; then
7905c9400
< 		if test -z "$potlib" ; then
---
> 		if test -z "$potlib"; then
7921c9416
< 	  newdeplibs=""
---
> 	  newdeplibs=
7923,7924c9418,9419
< 	  if test "X$allow_libtool_libs_with_static_runtimes" = "Xyes" ; then
< 	    for i in $predeps $postdeps ; do
---
> 	  if test yes = "$allow_libtool_libs_with_static_runtimes"; then
> 	    for i in $predeps $postdeps; do
7926c9421
< 	      tmp_deplibs=`$ECHO " $tmp_deplibs" | $SED "s,$i,,"`
---
> 	      tmp_deplibs=`$ECHO " $tmp_deplibs" | $SED "s|$i||"`
7932c9427
< 	    if test "X$deplibs_check_method" = "Xnone"; then
---
> 	    if test none = "$deplibs_check_method"; then
7956,7957c9451,9452
< 	if test "$droppeddeps" = yes; then
< 	  if test "$module" = yes; then
---
> 	if test yes = "$droppeddeps"; then
> 	  if test yes = "$module"; then
7966c9461
< 	      echo "*** lists from a program, using \`nm' or equivalent, but libtool could"
---
> 	      echo "*** lists from a program, using 'nm' or equivalent, but libtool could"
7968c9463
< 	      echo "*** \`nm' from GNU binutils and a full rebuild may help."
---
> 	      echo "*** 'nm' from GNU binutils and a full rebuild may help."
7970,7971c9465,9466
< 	    if test "$build_old_libs" = no; then
< 	      oldlibs="$output_objdir/$libname.$libext"
---
> 	    if test no = "$build_old_libs"; then
> 	      oldlibs=$output_objdir/$libname.$libext
7982c9477
< 	    if test "$allow_undefined" = no; then
---
> 	    if test no = "$allow_undefined"; then
7988,7989c9483,9484
< 	      if test "$build_old_libs" = no; then
< 		oldlibs="$output_objdir/$libname.$libext"
---
> 	      if test no = "$build_old_libs"; then
> 		oldlibs=$output_objdir/$libname.$libext
8035c9530
<       deplibs="$new_libs"
---
>       deplibs=$new_libs
8043,8044c9538,9539
<       if test "$build_libtool_libs" = yes; then
< 	# Remove ${wl} instances when linking with ld.
---
>       if test yes = "$build_libtool_libs"; then
> 	# Remove $wl instances when linking with ld.
8049c9544
< 	if test "$hardcode_into_libs" = yes; then
---
> 	if test yes = "$hardcode_into_libs"; then
8053,8054c9548,9549
< 	  rpath="$finalize_rpath"
< 	  test "$opt_mode" != relink && rpath="$compile_rpath$rpath"
---
> 	  rpath=$finalize_rpath
> 	  test relink = "$opt_mode" || rpath=$compile_rpath$rpath
8061c9556
< 		  hardcode_libdirs="$libdir"
---
> 		  hardcode_libdirs=$libdir
8086c9581
< 	    libdir="$hardcode_libdirs"
---
> 	    libdir=$hardcode_libdirs
8100,8101c9595,9596
< 	shlibpath="$finalize_shlibpath"
< 	test "$opt_mode" != relink && shlibpath="$compile_shlibpath$shlibpath"
---
> 	shlibpath=$finalize_shlibpath
> 	test relink = "$opt_mode" || shlibpath=$compile_shlibpath$shlibpath
8111c9606
< 	realname="$1"
---
> 	realname=$1
8117c9612
< 	  soname="$realname"
---
> 	  soname=$realname
8123c9618
< 	lib="$output_objdir/$realname"
---
> 	lib=$output_objdir/$realname
8137c9632
< 	  export_symbols="$output_objdir/$libname.uexp"
---
> 	  export_symbols=$output_objdir/$libname.uexp
8146c9641
< 	    if test "x`$SED 1q $export_symbols`" != xEXPORTS; then
---
> 	    func_dll_def_p "$export_symbols" || {
8153c9648
< 	      orig_export_symbols="$export_symbols"
---
> 	      orig_export_symbols=$export_symbols
8156c9651
< 	    fi
---
> 	    }
8163,8165c9658,9660
< 	  if test "$always_export_symbols" = yes || test -n "$export_symbols_regex"; then
< 	    func_verbose "generating symbol list for \`$libname.la'"
< 	    export_symbols="$output_objdir/$libname.exp"
---
> 	  if test yes = "$always_export_symbols" || test -n "$export_symbols_regex"; then
> 	    func_verbose "generating symbol list for '$libname.la'"
> 	    export_symbols=$output_objdir/$libname.exp
8168c9663
< 	    save_ifs="$IFS"; IFS='~'
---
> 	    save_ifs=$IFS; IFS='~'
8170c9665
< 	      IFS="$save_ifs"
---
> 	      IFS=$save_ifs
8184c9679
< 	      if test "$try_normal_branch" = yes \
---
> 	      if test yes = "$try_normal_branch" \
8195c9690
< 		output=${output_objdir}/${output_la}.nm
---
> 		output=$output_objdir/$output_la.nm
8218,8219c9713,9714
< 	    IFS="$save_ifs"
< 	    if test -n "$export_symbols_regex" && test "X$skipped_export" != "X:"; then
---
> 	    IFS=$save_ifs
> 	    if test -n "$export_symbols_regex" && test : != "$skipped_export"; then
8227,8228c9722,9723
< 	  tmp_export_symbols="$export_symbols"
< 	  test -n "$orig_export_symbols" && tmp_export_symbols="$orig_export_symbols"
---
> 	  tmp_export_symbols=$export_symbols
> 	  test -n "$orig_export_symbols" && tmp_export_symbols=$orig_export_symbols
8232c9727
< 	if test "X$skipped_export" != "X:" && test -n "$orig_export_symbols"; then
---
> 	if test : != "$skipped_export" && test -n "$orig_export_symbols"; then
8234c9729
< 	  func_verbose "filter symbol list for \`$libname.la' to tag DATA exports"
---
> 	  func_verbose "filter symbol list for '$libname.la' to tag DATA exports"
8236c9731
< 	  # 's' commands which not all seds can handle. GNU sed should be fine
---
> 	  # 's' commands, which not all seds can handle. GNU sed should be fine
8255c9750
< 	deplibs="$tmp_deplibs"
---
> 	deplibs=$tmp_deplibs
8259c9754
< 	    test "$compiler_needs_object" = yes &&
---
> 	    test yes = "$compiler_needs_object" &&
8270c9765
< 	    gentop="$output_objdir/${outputname}x"
---
> 	    gentop=$output_objdir/${outputname}x
8279c9774
< 	if test "$thread_safe" = yes && test -n "$thread_safe_flag_spec"; then
---
> 	if test yes = "$thread_safe" && test -n "$thread_safe_flag_spec"; then
8285c9780
< 	if test "$opt_mode" = relink; then
---
> 	if test relink = "$opt_mode"; then
8290c9785
< 	if test "$module" = yes && test -n "$module_cmds" ; then
---
> 	if test yes = "$module" && test -n "$module_cmds"; then
8308c9803
< 	if test "X$skipped_export" != "X:" &&
---
> 	if test : != "$skipped_export" &&
8341,8342c9836,9837
< 	  if test -n "$save_libobjs" && test "X$skipped_export" != "X:" && test "$with_gnu_ld" = yes; then
< 	    output=${output_objdir}/${output_la}.lnkscript
---
> 	  if test -n "$save_libobjs" && test : != "$skipped_export" && test yes = "$with_gnu_ld"; then
> 	    output=$output_objdir/$output_la.lnkscript
8354,8355c9849,9850
< 	  elif test -n "$save_libobjs" && test "X$skipped_export" != "X:" && test "X$file_list_spec" != X; then
< 	    output=${output_objdir}/${output_la}.lnk
---
> 	  elif test -n "$save_libobjs" && test : != "$skipped_export" && test -n "$file_list_spec"; then
> 	    output=$output_objdir/$output_la.lnk
8361c9856
< 	    if test "$compiler_needs_object" = yes; then
---
> 	    if test yes = "$compiler_needs_object"; then
8376c9871
< 	      output=$output_objdir/$output_la-${k}.$objext
---
> 	      output=$output_objdir/$output_la-$k.$objext
8388c9883
< 		if test "X$objlist" = X ||
---
> 		if test -z "$objlist" ||
8394c9889
< 		  if test "$k" -eq 1 ; then
---
> 		  if test 1 -eq "$k"; then
8404c9899
< 		  last_robj=$output_objdir/$output_la-${k}.$objext
---
> 		  last_robj=$output_objdir/$output_la-$k.$objext
8407c9902
< 		  output=$output_objdir/$output_la-${k}.$objext
---
> 		  output=$output_objdir/$output_la-$k.$objext
8419c9914
< 	      eval concat_cmds=\"\${concat_cmds}$reload_cmds\"
---
> 	      eval concat_cmds=\"\$concat_cmds$reload_cmds\"
8421c9916
< 	        eval concat_cmds=\"\${concat_cmds}~\$RM $last_robj\"
---
> 	        eval concat_cmds=\"\$concat_cmds~\$RM $last_robj\"
8429,8431c9924,9926
< 	    if ${skipped_export-false}; then
< 	      func_verbose "generating symbol list for \`$libname.la'"
< 	      export_symbols="$output_objdir/$libname.exp"
---
> 	    ${skipped_export-false} && {
> 	      func_verbose "generating symbol list for '$libname.la'"
> 	      export_symbols=$output_objdir/$libname.exp
8440c9935
< 	    fi
---
> 	    }
8446c9941
< 	    save_ifs="$IFS"; IFS='~'
---
> 	    save_ifs=$IFS; IFS='~'
8448,8449c9943,9944
< 	      IFS="$save_ifs"
< 	      $opt_silent || {
---
> 	      IFS=$save_ifs
> 	      $opt_quiet || {
8457c9952
< 		if test "$opt_mode" = relink; then
---
> 		if test relink = "$opt_mode"; then
8466c9961
< 	    IFS="$save_ifs"
---
> 	    IFS=$save_ifs
8474c9969
<           if ${skipped_export-false}; then
---
>           ${skipped_export-false} && {
8476,8477c9971,9972
< 	      tmp_export_symbols="$export_symbols"
< 	      test -n "$orig_export_symbols" && tmp_export_symbols="$orig_export_symbols"
---
> 	      tmp_export_symbols=$export_symbols
> 	      test -n "$orig_export_symbols" && tmp_export_symbols=$orig_export_symbols
8483c9978
< 	      func_verbose "filter symbol list for \`$libname.la' to tag DATA exports"
---
> 	      func_verbose "filter symbol list for '$libname.la' to tag DATA exports"
8485c9980
< 	      # 's' commands which not all seds can handle. GNU sed should be fine
---
> 	      # 's' commands, which not all seds can handle. GNU sed should be fine
8494c9989
< 	  fi
---
> 	  }
8508c10003
< 	  if test "$module" = yes && test -n "$module_cmds" ; then
---
> 	  if test yes = "$module" && test -n "$module_cmds"; then
8530c10025
< 	  gentop="$output_objdir/${outputname}x"
---
> 	  gentop=$output_objdir/${outputname}x
8538c10033
< 	save_ifs="$IFS"; IFS='~'
---
> 	save_ifs=$IFS; IFS='~'
8540c10035
< 	  IFS="$save_ifs"
---
> 	  IFS=$sp$nl
8542c10037,10038
< 	  $opt_silent || {
---
> 	  IFS=$save_ifs
> 	  $opt_quiet || {
8550c10046
< 	    if test "$opt_mode" = relink; then
---
> 	    if test relink = "$opt_mode"; then
8559c10055
< 	IFS="$save_ifs"
---
> 	IFS=$save_ifs
8562c10058
< 	if test "$opt_mode" = relink; then
---
> 	if test relink = "$opt_mode"; then
8582c10078
< 	if test "$module" = yes || test "$export_dynamic" = yes; then
---
> 	if test yes = "$module" || test yes = "$export_dynamic"; then
8584c10080
< 	  dlname="$soname"
---
> 	  dlname=$soname
8590,8591c10086,10087
<       if test -n "$dlfiles$dlprefiles" || test "$dlself" != no; then
< 	func_warning "\`-dlopen' is ignored for objects"
---
>       if test -n "$dlfiles$dlprefiles" || test no != "$dlself"; then
> 	func_warning "'-dlopen' is ignored for objects"
8596c10092
< 	func_warning "\`-l' and \`-L' are ignored for objects" ;;
---
> 	func_warning "'-l' and '-L' are ignored for objects" ;;
8600c10096
< 	func_warning "\`-rpath' is ignored for objects"
---
> 	func_warning "'-rpath' is ignored for objects"
8603c10099
< 	func_warning "\`-R' is ignored for objects"
---
> 	func_warning "'-R' is ignored for objects"
8606c10102
< 	func_warning "\`-version-info' is ignored for objects"
---
> 	func_warning "'-version-info' is ignored for objects"
8609c10105
< 	func_warning "\`-release' is ignored for objects"
---
> 	func_warning "'-release' is ignored for objects"
8614c10110
< 	  func_fatal_error "cannot build library object \`$output' from non-libtool objects"
---
> 	  func_fatal_error "cannot build library object '$output' from non-libtool objects"
8622c10118
< 	obj="$output"
---
> 	obj=$output
8635,8639c10131,10136
<       # reload_cmds runs $LD directly, so let us get rid of
<       # -Wl from whole_archive_flag_spec and hope we can get by with
<       # turning comma into space..
<       wl=
< 
---
>       # if reload_cmds runs $LD directly, get rid of -Wl from
>       # whole_archive_flag_spec and hope we can get by with turning comma
>       # into space.
>       case $reload_cmds in
>         *\$LD[\ \$]*) wl= ;;
>       esac
8643c10140,10141
< 	  reload_conv_objs=$reload_objs\ `$ECHO "$tmp_whole_archive_flags" | $SED 's|,| |g'`
---
> 	  test -n "$wl" || tmp_whole_archive_flags=`$ECHO "$tmp_whole_archive_flags" | $SED 's|,| |g'`
> 	  reload_conv_objs=$reload_objs\ $tmp_whole_archive_flags
8645c10143
< 	  gentop="$output_objdir/${obj}x"
---
> 	  gentop=$output_objdir/${obj}x
8654c10152
<       test "$build_libtool_libs" != yes && libobjs="$non_pic_objects"
---
>       test yes = "$build_libtool_libs" || libobjs=$non_pic_objects
8657c10155
<       reload_objs="$objs$old_deplibs "`$ECHO "$libobjs" | $SP2NL | $SED "/\.${libext}$/d; /\.lib$/d; $lo2o" | $NL2SP`" $reload_conv_objs" ### testsuite: skip nested quoting test
---
>       reload_objs=$objs$old_deplibs' '`$ECHO "$libobjs" | $SP2NL | $SED "/\.$libext$/d; /\.lib$/d; $lo2o" | $NL2SP`' '$reload_conv_objs
8659c10157
<       output="$obj"
---
>       output=$obj
8671c10169
<       if test "$build_libtool_libs" != yes; then
---
>       test yes = "$build_libtool_libs" || {
8681c10179
<       fi
---
>       }
8683c10181
<       if test -n "$pic_flag" || test "$pic_mode" != default; then
---
>       if test -n "$pic_flag" || test default != "$pic_mode"; then
8686c10184
< 	output="$libobj"
---
> 	output=$libobj
8703c10201
< 	func_warning "\`-version-info' is ignored for programs"
---
> 	func_warning "'-version-info' is ignored for programs"
8706c10204
< 	func_warning "\`-release' is ignored for programs"
---
> 	func_warning "'-release' is ignored for programs"
8708,8712c10206,10208
<       test "$preload" = yes \
<         && test "$dlopen_support" = unknown \
< 	&& test "$dlopen_self" = unknown \
< 	&& test "$dlopen_self_static" = unknown && \
< 	  func_warning "\`LT_INIT([dlopen])' not used. Assuming no dlopen support."
---
>       $preload \
> 	&& test unknown,unknown,unknown = "$dlopen_support,$dlopen_self,$dlopen_self_static" \
> 	&& func_warning "'LT_INIT([dlopen])' not used. Assuming no dlopen support."
8726c10222
< 	if test "$tagname" = CXX ; then
---
> 	if test CXX = "$tagname"; then
8729,8730c10225,10226
< 	      func_append compile_command " ${wl}-bind_at_load"
< 	      func_append finalize_command " ${wl}-bind_at_load"
---
> 	      func_append compile_command " $wl-bind_at_load"
> 	      func_append finalize_command " $wl-bind_at_load"
8766c10262
<       compile_deplibs="$new_libs"
---
>       compile_deplibs=$new_libs
8790c10286
< 	      hardcode_libdirs="$libdir"
---
> 	      hardcode_libdirs=$libdir
8813c10309
< 	  testbindir=`${ECHO} "$libdir" | ${SED} -e 's*/lib$*/bin*'`
---
> 	  testbindir=`$ECHO "$libdir" | $SED -e 's*/lib$*/bin*'`
8830c10326
< 	libdir="$hardcode_libdirs"
---
> 	libdir=$hardcode_libdirs
8833c10329
<       compile_rpath="$rpath"
---
>       compile_rpath=$rpath
8841c10337
< 	      hardcode_libdirs="$libdir"
---
> 	      hardcode_libdirs=$libdir
8866c10362
< 	libdir="$hardcode_libdirs"
---
> 	libdir=$hardcode_libdirs
8869c10365
<       finalize_rpath="$rpath"
---
>       finalize_rpath=$rpath
8871c10367
<       if test -n "$libobjs" && test "$build_old_libs" = yes; then
---
>       if test -n "$libobjs" && test yes = "$build_old_libs"; then
8877c10373
<       func_generate_dlsyms "$outputname" "@PROGRAM@" "no"
---
>       func_generate_dlsyms "$outputname" "@PROGRAM@" false
8884c10380
<       wrappers_required=yes
---
>       wrappers_required=:
8888c10384
<         wrappers_required=no
---
>         wrappers_required=false
8891,8893c10387
<         if test "$build_libtool_libs" != yes; then
<           wrappers_required=no
<         fi
---
>         test yes = "$build_libtool_libs" || wrappers_required=false
8896,8897c10390,10391
<         if test "$need_relink" = no || test "$build_libtool_libs" != yes; then
<           wrappers_required=no
---
>         if test no = "$need_relink" || test yes != "$build_libtool_libs"; then
>           wrappers_required=false
8901c10395
<       if test "$wrappers_required" = no; then
---
>       $wrappers_required || {
8904c10398
< 	link_command="$compile_command$compile_rpath"
---
> 	link_command=$compile_command$compile_rpath
8917,8918c10411,10412
< 	if test -f "$output_objdir/${outputname}S.${objext}"; then
< 	  func_show_eval '$RM "$output_objdir/${outputname}S.${objext}"'
---
> 	if test -f "$output_objdir/${outputname}S.$objext"; then
> 	  func_show_eval '$RM "$output_objdir/${outputname}S.$objext"'
8922c10416
<       fi
---
>       }
8952c10446
<       if test "$no_install" = yes; then
---
>       if test yes = "$no_install"; then
8954c10448
< 	link_command="$compile_var$compile_command$compile_rpath"
---
> 	link_command=$compile_var$compile_command$compile_rpath
8971,8991c10465,10486
<       if test "$hardcode_action" = relink; then
< 	# Fast installation is not supported
< 	link_command="$compile_var$compile_command$compile_rpath"
< 	relink_command="$finalize_var$finalize_command$finalize_rpath"
< 
< 	func_warning "this platform does not like uninstalled shared libraries"
< 	func_warning "\`$output' will be relinked during installation"
<       else
< 	if test "$fast_install" != no; then
< 	  link_command="$finalize_var$compile_command$finalize_rpath"
< 	  if test "$fast_install" = yes; then
< 	    relink_command=`$ECHO "$compile_var$compile_command$compile_rpath" | $SED 's%@OUTPUT@%\$progdir/\$file%g'`
< 	  else
< 	    # fast_install is set to needless
< 	    relink_command=
< 	  fi
< 	else
< 	  link_command="$compile_var$compile_command$compile_rpath"
< 	  relink_command="$finalize_var$finalize_command$finalize_rpath"
< 	fi
<       fi
---
>       case $hardcode_action,$fast_install in
>         relink,*)
> 	  # Fast installation is not supported
> 	  link_command=$compile_var$compile_command$compile_rpath
> 	  relink_command=$finalize_var$finalize_command$finalize_rpath
> 
> 	  func_warning "this platform does not like uninstalled shared libraries"
> 	  func_warning "'$output' will be relinked during installation"
> 	  ;;
>         *,yes)
> 	  link_command=$finalize_var$compile_command$finalize_rpath
> 	  relink_command=`$ECHO "$compile_var$compile_command$compile_rpath" | $SED 's%@OUTPUT@%\$progdir/\$file%g'`
>           ;;
> 	*,no)
> 	  link_command=$compile_var$compile_command$compile_rpath
> 	  relink_command=$finalize_var$finalize_command$finalize_rpath
>           ;;
> 	*,needless)
> 	  link_command=$finalize_var$compile_command$finalize_rpath
> 	  relink_command=
>           ;;
>       esac
9048,9049c10543,10544
< 	    cwrappersource="$output_path/$objdir/lt-$output_name.c"
< 	    cwrapper="$output_path/$output_name.exe"
---
> 	    cwrappersource=$output_path/$objdir/lt-$output_name.c
> 	    cwrapper=$output_path/$output_name.exe
9070c10565
< 	      if test "x$build" = "x$host" ; then
---
> 	      if test "x$build" = "x$host"; then
9093,9099c10588,10591
<       if test "$build_libtool_libs" = convenience; then
< 	oldobjs="$libobjs_save $symfileobj"
< 	addlibs="$convenience"
< 	build_libtool_libs=no
<       else
< 	if test "$build_libtool_libs" = module; then
< 	  oldobjs="$libobjs_save"
---
>       case $build_libtool_libs in
>         convenience)
> 	  oldobjs="$libobjs_save $symfileobj"
> 	  addlibs=$convenience
9101c10593,10599
< 	else
---
> 	  ;;
> 	module)
> 	  oldobjs=$libobjs_save
> 	  addlibs=$old_convenience
> 	  build_libtool_libs=no
>           ;;
> 	*)
9103,9108c10601,10605
< 	  if test "$preload" = yes && test -f "$symfileobj"; then
< 	    func_append oldobjs " $symfileobj"
< 	  fi
< 	fi
< 	addlibs="$old_convenience"
<       fi
---
> 	  $preload && test -f "$symfileobj" \
> 	    && func_append oldobjs " $symfileobj"
> 	  addlibs=$old_convenience
> 	  ;;
>       esac
9111c10608
< 	gentop="$output_objdir/${outputname}x"
---
> 	gentop=$output_objdir/${outputname}x
9119c10616
<       if test -n "$old_archive_from_new_cmds" && test "$build_libtool_libs" = yes; then
---
>       if test -n "$old_archive_from_new_cmds" && test yes = "$build_libtool_libs"; then
9125c10622
< 	  gentop="$output_objdir/${outputname}x"
---
> 	  gentop=$output_objdir/${outputname}x
9146c10643
< 	  gentop="$output_objdir/${outputname}x"
---
> 	  gentop=$output_objdir/${outputname}x
9155c10652
< 	    objbase="$func_basename_result"
---
> 	    objbase=$func_basename_result
9224c10721
< 	      if test "$obj" = "$last_oldobj" ; then
---
> 	      if test "$obj" = "$last_oldobj"; then
9228c10725
< 	      eval concat_cmds=\"\${concat_cmds}$old_archive_cmds\"
---
> 	      eval concat_cmds=\"\$concat_cmds$old_archive_cmds\"
9235c10732
< 	  if test "X$oldobjs" = "X" ; then
---
> 	  if test -z "$oldobjs"; then
9252c10749
<       test "$build_old_libs" = yes && old_library="$libname.$libext"
---
>       test yes = "$build_old_libs" && old_library=$libname.$libext
9267c10764
<       relink_command="(cd `pwd`; $SHELL $progpath $preserve_args --mode=relink $libtool_args @inst_prefix_dir@)"
---
>       relink_command="(cd `pwd`; $SHELL \"$progpath\" $preserve_args --mode=relink $libtool_args @inst_prefix_dir@)"
9269c10766
<       if test "$hardcode_automatic" = yes ; then
---
>       if test yes = "$hardcode_automatic"; then
9276c10773
< 	  if test "$installed" = yes; then
---
> 	  if test yes = "$installed"; then
9280c10777
< 	    output="$output_objdir/$outputname"i
---
> 	    output=$output_objdir/${outputname}i
9287c10784
< 		name="$func_basename_result"
---
> 		name=$func_basename_result
9289c10786
< 		eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $func_resolve_sysroot_result`
---
> 		eval libdir=`$SED -n -e 's/^libdir=\(.*\)$/\1/p' $func_resolve_sysroot_result`
9291c10788
< 		  func_fatal_error "\`$deplib' is not a valid libtool archive"
---
> 		  func_fatal_error "'$deplib' is not a valid libtool archive"
9307c10804
< 	    dependency_libs="$newdependency_libs"
---
> 	    dependency_libs=$newdependency_libs
9314,9315c10811,10812
< 		name="$func_basename_result"
< 		eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $lib`
---
> 		name=$func_basename_result
> 		eval libdir=`$SED -n -e 's/^libdir=\(.*\)$/\1/p' $lib`
9317c10814
< 		  func_fatal_error "\`$lib' is not a valid libtool archive"
---
> 		  func_fatal_error "'$lib' is not a valid libtool archive"
9323c10820
< 	    dlfiles="$newdlfiles"
---
> 	    dlfiles=$newdlfiles
9333,9334c10830,10831
< 		name="$func_basename_result"
< 		eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $lib`
---
> 		name=$func_basename_result
> 		eval libdir=`$SED -n -e 's/^libdir=\(.*\)$/\1/p' $lib`
9336c10833
< 		  func_fatal_error "\`$lib' is not a valid libtool archive"
---
> 		  func_fatal_error "'$lib' is not a valid libtool archive"
9341c10838
< 	    dlprefiles="$newdlprefiles"
---
> 	    dlprefiles=$newdlprefiles
9346c10843
< 		[\\/]* | [A-Za-z]:[\\/]*) abs="$lib" ;;
---
> 		[\\/]* | [A-Za-z]:[\\/]*) abs=$lib ;;
9351c10848
< 	    dlfiles="$newdlfiles"
---
> 	    dlfiles=$newdlfiles
9355c10852
< 		[\\/]* | [A-Za-z]:[\\/]*) abs="$lib" ;;
---
> 		[\\/]* | [A-Za-z]:[\\/]*) abs=$lib ;;
9360c10857
< 	    dlprefiles="$newdlprefiles"
---
> 	    dlprefiles=$newdlprefiles
9376,9377c10873
< 	      if test "x$bindir" != x ;
< 	      then
---
> 	      if test -n "$bindir"; then
9379c10875
< 		tdlname=$func_relative_path_result$dlname
---
> 		tdlname=$func_relative_path_result/$dlname
9388c10884
< # Generated by $PROGRAM (GNU $PACKAGE$TIMESTAMP) $VERSION
---
> # Generated by $PROGRAM (GNU $PACKAGE) $VERSION
9402c10898
< # Linker flags that can not go in dependency_libs.
---
> # Linker flags that cannot go in dependency_libs.
9428c10924
< 	  if test "$installed" = no && test "$need_relink" = yes; then
---
> 	  if test no,yes = "$installed,$need_relink"; then
9443,9444c10939,10941
< { test "$opt_mode" = link || test "$opt_mode" = relink; } &&
<     func_mode_link ${1+"$@"}
---
> if test link = "$opt_mode" || test relink = "$opt_mode"; then
>   func_mode_link ${1+"$@"}
> fi
9450,9451c10947,10949
<     $opt_debug
<     RM="$nonopt"
---
>     $debug_cmd
> 
>     RM=$nonopt
9453c10951
<     rmforce=
---
>     rmforce=false
9458c10956
<     libtool_install_magic="$magic"
---
>     libtool_install_magic=$magic
9463c10961
<       -f) func_append RM " $arg"; rmforce=yes ;;
---
>       -f) func_append RM " $arg"; rmforce=: ;;
9476,9478c10974,10976
<       dir="$func_dirname_result"
<       if test "X$dir" = X.; then
< 	odir="$objdir"
---
>       dir=$func_dirname_result
>       if test . = "$dir"; then
> 	odir=$objdir
9480c10978
< 	odir="$dir/$objdir"
---
> 	odir=$dir/$objdir
9483,9484c10981,10982
<       name="$func_basename_result"
<       test "$opt_mode" = uninstall && odir="$dir"
---
>       name=$func_basename_result
>       test uninstall = "$opt_mode" && odir=$dir
9487c10985
<       if test "$opt_mode" = clean; then
---
>       if test clean = "$opt_mode"; then
9502c11000
<       elif test "$rmforce" = yes; then
---
>       elif $rmforce; then
9506c11004
<       rmfiles="$file"
---
>       rmfiles=$file
9520c11018
< 	  case "$opt_mode" in
---
> 	  case $opt_mode in
9531c11029
< 	      func_execute_cmds "$postuninstall_cmds" 'test "$rmforce" = yes || exit_status=1'
---
> 	      func_execute_cmds "$postuninstall_cmds" '$rmforce || exit_status=1'
9536c11034
< 	      func_execute_cmds "$old_postuninstall_cmds" 'test "$rmforce" = yes || exit_status=1'
---
> 	      func_execute_cmds "$old_postuninstall_cmds" '$rmforce || exit_status=1'
9552,9553c11050
< 	  if test -n "$pic_object" &&
< 	     test "$pic_object" != none; then
---
> 	  if test -n "$pic_object" && test none != "$pic_object"; then
9558,9559c11055
< 	  if test -n "$non_pic_object" &&
< 	     test "$non_pic_object" != none; then
---
> 	  if test -n "$non_pic_object" && test none != "$non_pic_object"; then
9566c11062
< 	if test "$opt_mode" = clean ; then
---
> 	if test clean = "$opt_mode"; then
9593,9594c11089,11090
< 	    func_append rmfiles " $odir/$name $odir/${name}S.${objext}"
< 	    if test "$fast_install" = yes && test -n "$relink_command"; then
---
> 	    func_append rmfiles " $odir/$name $odir/${name}S.$objext"
> 	    if test yes = "$fast_install" && test -n "$relink_command"; then
9597,9598c11093,11094
< 	    if test "X$noexename" != "X$name" ; then
< 	      func_append rmfiles " $odir/lt-${noexename}.c"
---
> 	    if test "X$noexename" != "X$name"; then
> 	      func_append rmfiles " $odir/lt-$noexename.c"
9607c11103
<     # Try to remove the ${objdir}s in the directories where we deleted files
---
>     # Try to remove the $objdir's in the directories where we deleted files
9617,9618c11113,11115
< { test "$opt_mode" = uninstall || test "$opt_mode" = clean; } &&
<     func_mode_uninstall ${1+"$@"}
---
> if test uninstall = "$opt_mode" || test clean = "$opt_mode"; then
>   func_mode_uninstall ${1+"$@"}
> fi
9621c11118
<   help="$generic_help"
---
>   help=$generic_help
9626c11123
<   func_fatal_help "invalid operation mode \`$opt_mode'"
---
>   func_fatal_help "invalid operation mode '$opt_mode'"
9637c11134
< # in which we disable both kinds of libraries.  Given conflicting
---
> # where we disable both kinds of libraries.  Given conflicting
9660,9661d11156
< # vi:sw=2
< 
Common subdirectories: cgminer-4.9.0/m4 and cgminer-4.10.0/m4
diff '--color=auto' cgminer-4.9.0/Makefile.am cgminer-4.10.0/Makefile.am
4c4
< JANSSON_CPPFLAGS= -I$(top_builddir)/compat/jansson-2.6/src -I$(top_srcdir)/compat/jansson-2.6/src
---
> JANSSON_CPPFLAGS= -I$(top_builddir)/compat/jansson-2.9/src -I$(top_srcdir)/compat/jansson-2.9/src
7c7
< USBUTILS_CPPFLAGS = -I$(top_builddir)/compat/libusb-1.0/libusb -I$(top_srcdir)/compat/libusb-1.0/libusb
---
> USBUTILS_CPPFLAGS = `pkg-config libusb-1.0 --libs --cflags`
11a12,17
> if STATIC_CURL
> LIBCURL_CPPFLAGS = -DCURL_STATICLIB
> else
> LIBCURL_CPPFLAGS =
> endif
> 
21c27
< cgminer_CPPFLAGS = $(PTHREAD_FLAGS) -fno-strict-aliasing $(JANSSON_CPPFLAGS) $(USBUTILS_CPPFLAGS)
---
> cgminer_CPPFLAGS = $(PTHREAD_FLAGS) -fno-strict-aliasing $(JANSSON_CPPFLAGS) $(USBUTILS_CPPFLAGS) $(LIBCURL_CPPFLAGS)
28c34
< 		  @LIBUSB_LIBS@ @MM_LIBS@ @RT_LIBS@ \
---
> 		  @LIBUSB_LIBS@ @MM_LIBS@ @RT_LIBS@ @LIBSYSTEMD_LIBS@ \
144a151,162
> if HAS_AVALON7
> cgminer_SOURCES += driver-avalon7.c driver-avalon7.h
> endif
> 
> if NEED_I2C_CONTEXT
> cgminer_SOURCES += i2c-context.c
> endif
> 
> if HAS_AVALON_MINER
> cgminer_SOURCES += driver-avalon-miner.c driver-avalon-miner.h
> endif
> 
153a172,175
> cgminer_SOURCES += driver-bitmain.c driver-bitmain.h
> endif
> 
> if HAS_ANT_S3
diff '--color=auto' cgminer-4.9.0/Makefile.in cgminer-4.10.0/Makefile.in
1c1
< # Makefile.in generated by automake 1.14.1 from Makefile.am.
---
> # Makefile.in generated by automake 1.15 from Makefile.am.
4c4
< # Copyright (C) 1994-2013 Free Software Foundation, Inc.
---
> # Copyright (C) 1994-2014 Free Software Foundation, Inc.
19c19,29
< am__is_gnu_make = test -n '$(MAKEFILE_LIST)' && test -n '$(MAKELEVEL)'
---
> am__is_gnu_make = { \
>   if test -z '$(MAKELEVEL)'; then \
>     false; \
>   elif test -n '$(MAKE_HOST)'; then \
>     true; \
>   elif test -n '$(MAKE_VERSION)' && test -n '$(CURDIR)'; then \
>     true; \
>   else \
>     false; \
>   fi; \
> }
119,123c129,137
< @HAS_MINION_TRUE@am__append_24 = driver-minion.c
< @HAS_ANT_S1_TRUE@am__append_25 = driver-bitmain.c driver-bitmain.h
< @HAS_ANT_S2_TRUE@am__append_26 = driver-bitmain.c driver-bitmain.h
< @HAS_MODMINER_TRUE@am__append_27 = driver-modminer.c
< @HAS_BLOCKERUPTER_TRUE@am__append_28 = driver-blockerupter.c driver-blockerupter.h
---
> @HAS_AVALON7_TRUE@am__append_24 = driver-avalon7.c driver-avalon7.h
> @NEED_I2C_CONTEXT_TRUE@am__append_25 = i2c-context.c
> @HAS_AVALON_MINER_TRUE@am__append_26 = driver-avalon-miner.c driver-avalon-miner.h
> @HAS_MINION_TRUE@am__append_27 = driver-minion.c
> @HAS_ANT_S1_TRUE@am__append_28 = driver-bitmain.c driver-bitmain.h
> @HAS_ANT_S2_TRUE@am__append_29 = driver-bitmain.c driver-bitmain.h
> @HAS_ANT_S3_TRUE@am__append_30 = driver-bitmain.c driver-bitmain.h
> @HAS_MODMINER_TRUE@am__append_31 = driver-modminer.c
> @HAS_BLOCKERUPTER_TRUE@am__append_32 = driver-blockerupter.c driver-blockerupter.h
125,130d138
< DIST_COMMON = $(srcdir)/Makefile.in $(srcdir)/Makefile.am \
< 	$(top_srcdir)/configure $(am__configure_deps) \
< 	$(srcdir)/config.h.in depcomp $(am__dist_bitstreams_DATA_DIST) \
< 	ABOUT-NLS AUTHORS COPYING ChangeLog INSTALL NEWS README \
< 	compile config.guess config.rpath config.sub install-sh \
< 	missing ltmain.sh
136,142c144,148
< 	$(top_srcdir)/m4/include_next.m4 $(top_srcdir)/m4/libtool.m4 \
< 	$(top_srcdir)/m4/longlong.m4 $(top_srcdir)/m4/ltoptions.m4 \
< 	$(top_srcdir)/m4/ltsugar.m4 $(top_srcdir)/m4/ltversion.m4 \
< 	$(top_srcdir)/m4/lt~obsolete.m4 $(top_srcdir)/m4/memchr.m4 \
< 	$(top_srcdir)/m4/memmem.m4 $(top_srcdir)/m4/mmap-anon.m4 \
< 	$(top_srcdir)/m4/multiarch.m4 $(top_srcdir)/m4/onceonly.m4 \
< 	$(top_srcdir)/m4/sigaction.m4 $(top_srcdir)/m4/signal_h.m4 \
---
> 	$(top_srcdir)/m4/include_next.m4 $(top_srcdir)/m4/longlong.m4 \
> 	$(top_srcdir)/m4/memchr.m4 $(top_srcdir)/m4/memmem.m4 \
> 	$(top_srcdir)/m4/mmap-anon.m4 $(top_srcdir)/m4/multiarch.m4 \
> 	$(top_srcdir)/m4/onceonly.m4 $(top_srcdir)/m4/sigaction.m4 \
> 	$(top_srcdir)/m4/signal_h.m4 \
148a155,157
> DIST_COMMON = $(srcdir)/Makefile.am $(top_srcdir)/configure \
> 	$(am__configure_deps) $(am__dist_bitstreams_DATA_DIST) \
> 	$(am__DIST_COMMON)
179,180c188,191
< 	driver-minion.c driver-bitmain.c driver-bitmain.h \
< 	driver-modminer.c driver-blockerupter.c driver-blockerupter.h
---
> 	driver-avalon7.c driver-avalon7.h driver-avalon-miner.c \
> 	driver-avalon-miner.h driver-minion.c driver-bitmain.c \
> 	driver-bitmain.h driver-modminer.c driver-blockerupter.c \
> 	driver-blockerupter.h
217,221c228,237
< @HAS_MINION_TRUE@am__objects_22 = cgminer-driver-minion.$(OBJEXT)
< @HAS_ANT_S1_TRUE@am__objects_23 = cgminer-driver-bitmain.$(OBJEXT)
< @HAS_ANT_S2_TRUE@am__objects_24 = cgminer-driver-bitmain.$(OBJEXT)
< @HAS_MODMINER_TRUE@am__objects_25 = cgminer-driver-modminer.$(OBJEXT)
< @HAS_BLOCKERUPTER_TRUE@am__objects_26 =  \
---
> @HAS_AVALON7_TRUE@am__objects_22 = cgminer-driver-avalon7.$(OBJEXT)
> @NEED_I2C_CONTEXT_TRUE@am__objects_23 = cgminer-i2c-context.$(OBJEXT)
> @HAS_AVALON_MINER_TRUE@am__objects_24 =  \
> @HAS_AVALON_MINER_TRUE@	cgminer-driver-avalon-miner.$(OBJEXT)
> @HAS_MINION_TRUE@am__objects_25 = cgminer-driver-minion.$(OBJEXT)
> @HAS_ANT_S1_TRUE@am__objects_26 = cgminer-driver-bitmain.$(OBJEXT)
> @HAS_ANT_S2_TRUE@am__objects_27 = cgminer-driver-bitmain.$(OBJEXT)
> @HAS_ANT_S3_TRUE@am__objects_28 = cgminer-driver-bitmain.$(OBJEXT)
> @HAS_MODMINER_TRUE@am__objects_29 = cgminer-driver-modminer.$(OBJEXT)
> @HAS_BLOCKERUPTER_TRUE@am__objects_30 =  \
234c250,252
< 	$(am__objects_24) $(am__objects_25) $(am__objects_26)
---
> 	$(am__objects_24) $(am__objects_25) $(am__objects_26) \
> 	$(am__objects_27) $(am__objects_28) $(am__objects_29) \
> 	$(am__objects_30)
239,245c257,258
< AM_V_lt = $(am__v_lt_@AM_V@)
< am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
< am__v_lt_0 = --silent
< am__v_lt_1 = 
< cgminer_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
< 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
< 	$(cgminer_LDFLAGS) $(LDFLAGS) -o $@
---
> cgminer_LINK = $(CCLD) $(AM_CFLAGS) $(CFLAGS) $(cgminer_LDFLAGS) \
> 	$(LDFLAGS) -o $@
261a275,278
> AM_V_lt = $(am__v_lt_@AM_V@)
> am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
> am__v_lt_0 = --silent
> am__v_lt_1 = 
264,267d280
< LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
< 	$(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) \
< 	$(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) \
< 	$(AM_CFLAGS) $(CFLAGS)
273,275c286
< LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
< 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
< 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
---
> LINK = $(CCLD) $(AM_CFLAGS) $(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
353a365,368
> am__DIST_COMMON = $(srcdir)/Makefile.in $(srcdir)/config.h.in \
> 	ABOUT-NLS AUTHORS COPYING ChangeLog INSTALL NEWS README \
> 	compile config.guess config.sub depcomp install-sh ltmain.sh \
> 	missing
401d415
< AR = @AR@
419d432
< DLLTOOL = @DLLTOOL@
421,422d433
< DSYMUTIL = @DSYMUTIL@
< DUMPBIN = @DUMPBIN@
428d438
< FGREP = @FGREP@
512a523
> JANSSON_CFLAGS = @JANSSON_CFLAGS@
514d524
< LD = @LD@
522c532,533
< LIBTOOL = @LIBTOOL@
---
> LIBSYSTEMD_CFLAGS = @LIBSYSTEMD_CFLAGS@
> LIBSYSTEMD_LIBS = @LIBSYSTEMD_LIBS@
525,526d535
< LIPO = @LIPO@
< LN_S = @LN_S@
530d538
< MANIFEST_TOOL = @MANIFEST_TOOL@
543,545d550
< NM = @NM@
< NMEDIT = @NMEDIT@
< OBJDUMP = @OBJDUMP@
547,548d551
< OTOOL = @OTOOL@
< OTOOL64 = @OTOOL64@
583d585
< SED = @SED@
601d602
< ac_ct_AR = @ac_ct_AR@
603d603
< ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
646a647
> runstatedir = @runstatedir@
662c663
< JANSSON_CPPFLAGS = -I$(top_builddir)/compat/jansson-2.6/src -I$(top_srcdir)/compat/jansson-2.6/src
---
> JANSSON_CPPFLAGS = -I$(top_builddir)/compat/jansson-2.9/src -I$(top_srcdir)/compat/jansson-2.9/src
664c665,667
< @WANT_USBUTILS_TRUE@USBUTILS_CPPFLAGS = -I$(top_builddir)/compat/libusb-1.0/libusb -I$(top_srcdir)/compat/libusb-1.0/libusb
---
> @WANT_USBUTILS_TRUE@USBUTILS_CPPFLAGS = `pkg-config libusb-1.0 --libs --cflags`
> @STATIC_CURL_FALSE@LIBCURL_CPPFLAGS = 
> @STATIC_CURL_TRUE@LIBCURL_CPPFLAGS = -DCURL_STATICLIB
674,675c677,678
< 	$(JANSSON_CPPFLAGS) $(USBUTILS_CPPFLAGS) -I$(top_builddir)/lib \
< 	-I$(top_srcdir)/lib $(am__append_1)
---
> 	$(JANSSON_CPPFLAGS) $(USBUTILS_CPPFLAGS) $(LIBCURL_CPPFLAGS) \
> 	-I$(top_builddir)/lib -I$(top_srcdir)/lib $(am__append_1)
679,680c682,683
< 	@LIBUSB_LIBS@ @MM_LIBS@ @RT_LIBS@ @MATH_LIBS@ lib/libgnu.a \
< 	ccan/libccan.a $(am__append_8)
---
> 	@LIBUSB_LIBS@ @MM_LIBS@ @RT_LIBS@ @LIBSYSTEMD_LIBS@ \
> 	@MATH_LIBS@ lib/libgnu.a ccan/libccan.a $(am__append_8)
693c696,698
< 	$(am__append_26) $(am__append_27) $(am__append_28)
---
> 	$(am__append_26) $(am__append_27) $(am__append_28) \
> 	$(am__append_29) $(am__append_30) $(am__append_31) \
> 	$(am__append_32)
700c705
< .SUFFIXES: .c .lo .o .obj
---
> .SUFFIXES: .c .o .obj
716d720
< .PRECIOUS: Makefile
760d763
< 	 || test -f $$p1 \
775,776c778,779
< 	    echo " $(INSTALL_PROGRAM_ENV) $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL_PROGRAM) $$files '$(DESTDIR)$(bindir)$$dir'"; \
< 	    $(INSTALL_PROGRAM_ENV) $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL_PROGRAM) $$files "$(DESTDIR)$(bindir)$$dir" || exit $$?; \
---
> 	      echo " $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$files '$(DESTDIR)$(bindir)$$dir'"; \
> 	      $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$files "$(DESTDIR)$(bindir)$$dir" || exit $$?; \
792,798c795
< 	@list='$(bin_PROGRAMS)'; test -n "$$list" || exit 0; \
< 	echo " rm -f" $$list; \
< 	rm -f $$list || exit $$?; \
< 	test -n "$(EXEEXT)" || exit 0; \
< 	list=`for p in $$list; do echo "$$p"; done | sed 's/$(EXEEXT)$$//'`; \
< 	echo " rm -f" $$list; \
< 	rm -f $$list
---
> 	-test -z "$(bin_PROGRAMS)" || rm -f $(bin_PROGRAMS)
816a814
> @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/cgminer-driver-avalon-miner.Po@am__quote@
819a818
> @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/cgminer-driver-avalon7.Po@am__quote@
869,876d867
< .c.lo:
< @am__fastdepCC_TRUE@	$(AM_V_CC)depbase=`echo $@ | sed 's|[^/]*$$|$(DEPDIR)/&|;s|\.lo$$||'`;\
< @am__fastdepCC_TRUE@	$(LTCOMPILE) -MT $@ -MD -MP -MF $$depbase.Tpo -c -o $@ $< &&\
< @am__fastdepCC_TRUE@	$(am__mv) $$depbase.Tpo $$depbase.Plo
< @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='$<' object='$@' libtool=yes @AMDEPBACKSLASH@
< @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
< @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LTCOMPILE) -c -o $@ $<
< 
1408a1400,1427
> cgminer-driver-avalon7.o: driver-avalon7.c
> @am__fastdepCC_TRUE@	$(AM_V_CC)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(cgminer_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT cgminer-driver-avalon7.o -MD -MP -MF $(DEPDIR)/cgminer-driver-avalon7.Tpo -c -o cgminer-driver-avalon7.o `test -f 'driver-avalon7.c' || echo '$(srcdir)/'`driver-avalon7.c
> @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/cgminer-driver-avalon7.Tpo $(DEPDIR)/cgminer-driver-avalon7.Po
> @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='driver-avalon7.c' object='cgminer-driver-avalon7.o' libtool=no @AMDEPBACKSLASH@
> @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
> @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(cgminer_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o cgminer-driver-avalon7.o `test -f 'driver-avalon7.c' || echo '$(srcdir)/'`driver-avalon7.c
> 
> cgminer-driver-avalon7.obj: driver-avalon7.c
> @am__fastdepCC_TRUE@	$(AM_V_CC)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(cgminer_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT cgminer-driver-avalon7.obj -MD -MP -MF $(DEPDIR)/cgminer-driver-avalon7.Tpo -c -o cgminer-driver-avalon7.obj `if test -f 'driver-avalon7.c'; then $(CYGPATH_W) 'driver-avalon7.c'; else $(CYGPATH_W) '$(srcdir)/driver-avalon7.c'; fi`
> @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/cgminer-driver-avalon7.Tpo $(DEPDIR)/cgminer-driver-avalon7.Po
> @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='driver-avalon7.c' object='cgminer-driver-avalon7.obj' libtool=no @AMDEPBACKSLASH@
> @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
> @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(cgminer_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o cgminer-driver-avalon7.obj `if test -f 'driver-avalon7.c'; then $(CYGPATH_W) 'driver-avalon7.c'; else $(CYGPATH_W) '$(srcdir)/driver-avalon7.c'; fi`
> 
> cgminer-driver-avalon-miner.o: driver-avalon-miner.c
> @am__fastdepCC_TRUE@	$(AM_V_CC)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(cgminer_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT cgminer-driver-avalon-miner.o -MD -MP -MF $(DEPDIR)/cgminer-driver-avalon-miner.Tpo -c -o cgminer-driver-avalon-miner.o `test -f 'driver-avalon-miner.c' || echo '$(srcdir)/'`driver-avalon-miner.c
> @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/cgminer-driver-avalon-miner.Tpo $(DEPDIR)/cgminer-driver-avalon-miner.Po
> @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='driver-avalon-miner.c' object='cgminer-driver-avalon-miner.o' libtool=no @AMDEPBACKSLASH@
> @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
> @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(cgminer_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o cgminer-driver-avalon-miner.o `test -f 'driver-avalon-miner.c' || echo '$(srcdir)/'`driver-avalon-miner.c
> 
> cgminer-driver-avalon-miner.obj: driver-avalon-miner.c
> @am__fastdepCC_TRUE@	$(AM_V_CC)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(cgminer_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT cgminer-driver-avalon-miner.obj -MD -MP -MF $(DEPDIR)/cgminer-driver-avalon-miner.Tpo -c -o cgminer-driver-avalon-miner.obj `if test -f 'driver-avalon-miner.c'; then $(CYGPATH_W) 'driver-avalon-miner.c'; else $(CYGPATH_W) '$(srcdir)/driver-avalon-miner.c'; fi`
> @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/cgminer-driver-avalon-miner.Tpo $(DEPDIR)/cgminer-driver-avalon-miner.Po
> @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='driver-avalon-miner.c' object='cgminer-driver-avalon-miner.obj' libtool=no @AMDEPBACKSLASH@
> @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
> @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(cgminer_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o cgminer-driver-avalon-miner.obj `if test -f 'driver-avalon-miner.c'; then $(CYGPATH_W) 'driver-avalon-miner.c'; else $(CYGPATH_W) '$(srcdir)/driver-avalon-miner.c'; fi`
> 
1464,1472d1482
< 
< mostlyclean-libtool:
< 	-rm -f *.lo
< 
< clean-libtool:
< 	-rm -rf .libs _libs
< 
< distclean-libtool:
< 	-rm -f libtool config.lt
1682,1683c1692,1693
< 	@echo WARNING: "Support for shar distribution archives is" \
< 	               "deprecated." >&2
---
> 	@echo WARNING: "Support for distribution archives compressed with" \
> 		       "legacy program 'compress' is deprecated." >&2
1689,1690c1699,1700
< 	@echo WARNING: "Support for distribution archives compressed with" \
< 		       "legacy program 'compress' is deprecated." >&2
---
> 	@echo WARNING: "Support for shar distribution archives is" \
> 	               "deprecated." >&2
1726c1736
< 	mkdir $(distdir)/_build $(distdir)/_inst
---
> 	mkdir $(distdir)/_build $(distdir)/_build/sub $(distdir)/_inst
1732,1733c1742,1743
< 	  && $(am__cd) $(distdir)/_build \
< 	  && ../configure \
---
> 	  && $(am__cd) $(distdir)/_build/sub \
> 	  && ../../configure \
1736c1746
< 	    --srcdir=.. --prefix="$$dc_install_base" \
---
> 	    --srcdir=../.. --prefix="$$dc_install_base" \
1829c1839
< clean-am: clean-binPROGRAMS clean-generic clean-libtool mostlyclean-am
---
> clean-am: clean-binPROGRAMS clean-generic mostlyclean-am
1836c1846
< 	distclean-hdr distclean-libtool distclean-tags
---
> 	distclean-hdr distclean-tags
1887,1888c1897
< mostlyclean-am: mostlyclean-compile mostlyclean-generic \
< 	mostlyclean-libtool
---
> mostlyclean-am: mostlyclean-compile mostlyclean-generic
1904,1906c1913,1915
< 	clean-cscope clean-generic clean-libtool cscope cscopelist-am \
< 	ctags ctags-am dist dist-all dist-bzip2 dist-gzip dist-lzip \
< 	dist-shar dist-tarZ dist-xz dist-zip distcheck distclean \
---
> 	clean-cscope clean-generic cscope cscopelist-am ctags ctags-am \
> 	dist dist-all dist-bzip2 dist-gzip dist-lzip dist-shar \
> 	dist-tarZ dist-xz dist-zip distcheck distclean \
1908,1919c1917,1927
< 	distclean-libtool distclean-tags distcleancheck distdir \
< 	distuninstallcheck dvi dvi-am html html-am info info-am \
< 	install install-am install-binPROGRAMS install-data \
< 	install-data-am install-dist_bitstreamsDATA install-dvi \
< 	install-dvi-am install-exec install-exec-am install-html \
< 	install-html-am install-info install-info-am install-man \
< 	install-pdf install-pdf-am install-ps install-ps-am \
< 	install-strip installcheck installcheck-am installdirs \
< 	installdirs-am maintainer-clean maintainer-clean-generic \
< 	mostlyclean mostlyclean-compile mostlyclean-generic \
< 	mostlyclean-libtool pdf pdf-am ps ps-am tags tags-am uninstall \
< 	uninstall-am uninstall-binPROGRAMS \
---
> 	distclean-tags distcleancheck distdir distuninstallcheck dvi \
> 	dvi-am html html-am info info-am install install-am \
> 	install-binPROGRAMS install-data install-data-am \
> 	install-dist_bitstreamsDATA install-dvi install-dvi-am \
> 	install-exec install-exec-am install-html install-html-am \
> 	install-info install-info-am install-man install-pdf \
> 	install-pdf-am install-ps install-ps-am install-strip \
> 	installcheck installcheck-am installdirs installdirs-am \
> 	maintainer-clean maintainer-clean-generic mostlyclean \
> 	mostlyclean-compile mostlyclean-generic pdf pdf-am ps ps-am \
> 	tags tags-am uninstall uninstall-am uninstall-binPROGRAMS \
1920a1929,1930
> 
> .PRECIOUS: Makefile
diff '--color=auto' cgminer-4.9.0/miner.h cgminer-4.10.0/miner.h
11,21c11
< #ifdef HAVE_LIBCURL
< #include <curl/curl.h>
< #else
< typedef char CURL;
< extern char *curly;
< #define curl_easy_init(curl) (curly)
< #define curl_easy_cleanup(curl) {}
< #define curl_global_cleanup() {}
< #define CURL_GLOBAL_ALL 0
< #define curl_global_init(X) (0)
< #endif
---
> 
49,52c39,44
< # ifndef WIN32
< #  define alloca __builtin_alloca
< # else
< #  include <malloc.h>
---
> # ifndef __FreeBSD__ /* FreeBSD has below #define in stdlib.h */
> #  ifndef WIN32
> #   define alloca __builtin_alloca
> #  else
> #   include <malloc.h>
> #  endif
69d60
< #include <windows.h>
75a67,78
> #ifdef HAVE_LIBCURL
> #include <curl/curl.h>
> #else
> typedef char CURL;
> extern char *curly;
> #define curl_easy_init(curl) (curly)
> #define curl_easy_cleanup(curl) {}
> #define curl_global_cleanup() {}
> #define CURL_GLOBAL_ALL 0
> #define curl_global_init(X) (0)
> #endif
> 
222a226,228
> #define MACSTR(_num) MACSTR2(_num)
> #define MACSTR2(__num) #__num
> 
233a240
> 	DRIVER_ADD_COMMAND(ants3) \
236a244,245
> 	DRIVER_ADD_COMMAND(avalon7) \
> 	DRIVER_ADD_COMMAND(avalonm) \
355a365,367
> 
> 	/* Does this device generate work itself and not require stratum work generation? */
> 	bool genwork;
441c453
< #if defined(USE_AVALON) || defined(USE_AVALON2)
---
> #if defined(USE_AVALON) || defined(USE_AVALON2) || defined (USE_AVALON_MINER)
574c586
< 	n = calloc(1, sizeof(*n));
---
> 	n = cgcalloc(1, sizeof(*n));
977d988
< extern bool opt_fail_only;
1001a1013
> extern float opt_compac_freq;
1024a1037
> extern char *opt_bitmain_freq;
1027c1040,1041
< #ifdef USE_ANT_S2
---
> #if (defined(USE_ANT_S2) || defined(USE_ANT_S3))
> #ifndef USE_ANT_S3
1028a1043
> #endif
1029a1045
> extern char *opt_bitmain_freq;
1034a1051
> extern char *opt_bitmain_voltage;
1094,1096c1111
< extern int opt_queue;
< extern int opt_scantime;
< extern int opt_expiry;
---
> extern const int max_scantime;
1111c1126
< #if defined (USE_AVALON2) || defined (USE_AVALON4) || defined (USE_HASHRATIO)
---
> #if defined (USE_AVALON2) || defined (USE_AVALON4) || defined (USE_AVALON7) || defined (USE_AVALON_MINER) || defined (USE_HASHRATIO)
1166c1181
< extern unsigned long long global_hashrate;
---
> extern uint64_t global_hashrate;
1218d1232
< 	bool lagging;
1262a1277
> 	uint64_t bad_work;
1332a1348,1349
> 	double next_diff;
> 	double diff_after;
1333a1351
> 	uint32_t current_height;
1469a1488
> extern struct work *clone_queued_work_byid(struct cgpu_info *cgpu, uint32_t id);
1483,1487c1502,1503
< extern void _discard_work(struct work *work);
< #define discard_work(WORK) do { \
< 	_discard_work(WORK); \
< 	WORK = NULL; \
< } while (0)
---
> extern void _discard_work(struct work **workptr, const char *file, const char *func, const int line);
> #define discard_work(WORK) _discard_work(&(WORK), __FILE__, __func__, __LINE__)
1508a1525
> extern void roll_work_ntime(struct work *work, int noffset);
1511,1515c1528,1529
< extern void _free_work(struct work *work);
< #define free_work(WORK) do { \
< 	_free_work(WORK); \
< 	WORK = NULL; \
< } while (0)
---
> extern void _free_work(struct work **workptr, const char *file, const char *func, const int line);
> #define free_work(WORK) _free_work(&(WORK), __FILE__, __func__, __LINE__)
diff '--color=auto' cgminer-4.9.0/miner.php cgminer-4.10.0/miner.php
1318,1329d1317
< 		if (!isset($alldata['GPU']))
< 		{
< 			if ($value == 0)
< 				$ret = '&nbsp;';
< 			break;
< 		}
< 	case 'GPU Clock':
< 	case 'Memory Clock':
< 	case 'GPU Voltage':
< 	case 'GPU Activity':
< 		if ($section == 'total')
< 			break;
1331c1319
< 			$class = $warnclass;
---
> 			$ret = '&nbsp;';
1491,1492d1478
< 	case 'GPU':
< 		break;
1736,1831d1721
< function gpubuttons($count, $rig)
< {
<  global $devs;
< 
<  $basic = array( 'GPU', 'Enable', 'Disable', 'Restart' );
< 
<  $options = array(	'intensity' => 'Intensity',
< 			'fan' => 'Fan Percent',
< 			'engine' => 'GPU Clock',
< 			'mem' => 'Memory Clock',
< 			'vddc' => 'GPU Voltage' );
< 
<  newtable();
<  newrow();
< 
<  foreach ($basic as $head)
< 	echo "<td class=h>$head</td>";
< 
<  foreach ($options as $name => $des)
< 	echo "<td class=h nowrap>$des</td>";
< 
<  $n = 0;
<  for ($c = 0; $c < $count; $c++)
<  {
< 	endrow();
< 	newrow();
< 
< 	foreach ($basic as $name)
< 	{
< 		list($ignore, $class) = fmt('BUTTON', 'GPU', '', 0, null);
< 		echo "<td$class>";
< 
< 		if ($name == 'GPU')
< 			echo $c;
< 		else
< 		{
< 			echo "<input type=button value='$name $c' onclick='prs(\"gpu";
< 			echo strtolower($name);
< 			echo "|$c\",$rig)'>";
< 		}
< 
< 		echo '</td>';
< 	}
< 
< 	foreach ($options as $name => $des)
< 	{
< 		list($ignore, $class) = fmt('BUTTON', 'GPU', '', 0, null);
< 		echo "<td$class>";
< 
< 		if (!isset($devs["GPU$c"][$des]))
< 			echo '&nbsp;';
< 		else
< 		{
< 			$value = $devs["GPU$c"][$des];
< 			echo "<input type=button value='Set $c:' onclick='prs2(\"gpu$name|$c\",$n,$rig)'>";
< 			echo "<input size=7 type=text name=gi$n value='$value' id=gi$n>";
< 			$n++;
< 		}
< 
< 		echo '</td>';
< 	}
< 
<  }
<  endrow();
<  endtable();
< }
< #
< function processgpus($rig)
< {
<  global $error;
<  global $warnfont, $warnoff;
< 
<  $gpus = api($rig, 'gpucount');
< 
<  if ($error != null)
< 	otherrow("<td>Error getting GPU count: $warnfont$error$warnoff</td>");
<  else
<  {
< 	if (!isset($gpus['GPUS']['Count']))
< 	{
< 		$rw = '<td>No GPU count returned: '.$warnfont;
< 		$rw .= $gpus['STATUS']['STATUS'].' '.$gpus['STATUS']['Msg'];
< 		$rw .= $warnoff.'</td>';
< 		otherrow($rw);
< 	}
< 	else
< 	{
< 		$count = $gpus['GPUS']['Count'];
< 		if ($count == 0)
< 			otherrow('<td>No GPUs</td>');
< 		else
< 			gpubuttons($count, $rig);
< 	}
<  }
< }
< #
2124,2126d2013
<  if ($haderror == false && $readonly === false)
< 	processgpus($rig);
< 
2133c2020
< # DEVS is a special case that will match GPU, PGA or ASC
---
> # DEVS is a special case that will match PGA or ASC
2142d2028
< 	'GPU' => 'devs',	// You would normally use DEVS
2330,2342d2215
<  // GPU's don't have Name,ID fields - so create them
<  foreach ($results as $section => $res)
< 	foreach ($res as $rig => $result)
< 		foreach ($result as $name => $fields)
< 		{
< 			$subname = preg_replace('/[0-9]/', '', $name);
< 			if ($subname == 'GPU' and isset($result[$name]['GPU']))
< 			{
< 				$results[$section][$rig][$name]['Name'] = 'GPU';
< 				$results[$section][$rig][$name]['ID'] = $result[$name]['GPU'];
< 			}
< 		}
< 
2420c2293
<  &&  ($field == 'GPU' || $field == 'PGA' || $field == 'ASC'))
---
>  &&  ($field == 'PGA' || $field == 'ASC'))
diff '--color=auto' cgminer-4.9.0/missing cgminer-4.10.0/missing
6c6
< # Copyright (C) 1996-2013 Free Software Foundation, Inc.
---
> # Copyright (C) 1996-2014 Free Software Foundation, Inc.
diff '--color=auto' cgminer-4.9.0/NEWS cgminer-4.10.0/NEWS
0a1,324
> Version 4.10.0 - 23rd January 2017
> 
> - Silence warning.
> - Clean up compac driver.
> - Allocate appropriate memory size for PSECURITY_DESCRIPTOR
> - Remove jansson memory tricks.
> - Increase header size for gbt solo.
> - Increase header size.
> - Fix curl build on mingw
> - Windows build fixes.
> - Fix avalon4 warnings.
> - We can only change diff once per notify so assume successive diffs are stacked
> for successive notifies.
> - Enable avalon4 building with avalon7.
> - Move to system libusb.
> - Upgrade to jansson 2.9
> - display restart thread errno
> - String length sanity checks in config parsing.
> - Make pool_no and block height logging more consistent
> - Always clean swork when prev_hash changes
> - Add nonce mask to api for Avalon7
> - Add new options for Avalon7
> - Add a device table for Avalon7
> - Update AVA7_DEFAULT_MINER_CNT usage
> - Add frequency range support 100MHz - 500MHz
> - Added roll_work_ntime() to enchance performance
> - Revert "Set default ava7 nonce mask to 27 which empiric testing shows stable
> and more rapid rise in frequency without significant overshoot."
> - Remove useless code in avalon7
> - Detect avalon7 modules during ava7 init and only add the device if any modules
> exist.
> - Unplug avalon7 on failing to re-init AUC to allow a clean hotplug event which
> is more reliable.
> - Fix warning without ava4/7
> - Re-initialise libusb if there are no active devices before the next hotplug
> event.
> - Reset the tv_end variable before each libusb handle events call.
> - Fix Vo display for A741
> - Update AVA7_DEFAULT_ASIC_MAX for A741
> - Tweak ava7 fan control further.
> - Set default ava7 nonce mask to 27 which empiric testing shows stable and more
> rapid rise in frequency without significant overshoot.
> - Set ava7 starting fan to 1/3 speed between min and max.
> - Convert the avalon7 fan control to use a PID-like feedback mechanism for
> optimal fan speed and quasi-constant temperature. Change meaning of target
> temperature to actual desired temperature, setting it to 90C. Set minimum
> fanspeed to 5% as a safety fallback.
> - Inherit the diff from the original stratum in submit_nonce2_nonce, fixing
> wrong diff submits on avalon6/7.
> - Use diff1 and diff rejected to calculate hashrate in avalon7 for a more stable
> displayed hashrate.
> - Check for nodev errors after usb transfers to not change the err value.
> - There is no need for complicated locking in usb_reset; simply use the write
> lock and avoid locking risks.
> - Update nonce mask from 31 to 29
> - Send jobid when it's update
> - Flush useless works when new block was found
> - Update error polling count
> - Fix frequency mode for Avalon7
> - Added connection overload detection and API entry
> - Fixed some English mistakes
> - Fix display mm status when stratum pool is failed
> - Update api display
> - Reset usb devices if they fail to initialise.
> - TIMER_ABSTIME is not available on osx
> - Get rid of binary stratum work based on avalon7 define.
> - Remove impossible comparisons from avalon7.c
> - Style police.
> - Don't use the stratum work generator for Avalon7
> - Add STRATUM_USER_AGENT macro for utils
> - Update README and ASIC-README for Avalon7
> - Add Avalon7 support
> - Fix warning in AV4 driver
> - Update AVA4_DEFAULT_MODULARS
> - Update nonce2 start and range
> - Add more options for AVA4_FREQ_TEMPADJ_MODE
> - Double check data size when use avalon4_auc_xfer
> - Update AVA4_MM60_TEMP_FREQADJ
> - Fix xfer_err_cnt
> - Avoid thread block when use AV4 iic driver
> - Update check rules for AUC
> - Support AV4 miner detect through iic
> - Fix some settings for AvalonMiner 6.0
> - advertise segwit support for solo mining
> - add support for segwit commitment insertion
> - add bip9 support
> - Fix work update for hash_work
> - Fix various minor once-off memory leaks
> - Fix read beyond stack size issue
> - Reattach kernel driver to correct IF
> - Fix clobbered by ‘longjmp’ or ‘vfork’ warning
> - Fix unreachable code
> - allow for independent target freq so bad stick doesn't effect group
> - +1 freq hex alignment
> - tidy up naming to match general conventions
> - tidy up some unused vars
> - Add in ramp code. Untie compac detect from default icarus fallback detect to
> have a cleaner device detect path.
> - move over code to fit serial number on screen
> - changed a few spaces to tabs
> - Added GekkoScience Compac detection and support to the icarus driver.
> - Show Current Block Version under pools api
> - Show Current Block Height under pools api
> - Update avalon4 options
> - Update AVA4_DEFAULT_SMART_SPEED to AVA4_DEFAULT_SMARTSPEED_MODE3
> - Update avalon4_update process
> - Code cleanup
> - Minor update
> - Detach the duplicate dev when detect in xfer
> - Update mm count when scan hash
> - Check module if exits when detect
> - Update hashmeter for avalon devs
> - Fix i_5s usage
> - Update smart frequency for AVA4_DEFAULT_SMARTSPEED_MODE3
> - Add new smart speed mode (mode 3)
> - Update default value
> - Add more options for smartspeed
> - Don't label threads of devices that are paused as sick
> - Set avalon4 to cut off if thread should be paused
> - ASIC-README: Avalon6 will come up as AV6
> - Update the ASIC-README and help message of Avalon4/4.1/6
> - fix cgminer-api compilation on osx
> - Support low diffs like those on testnets
> - Restart being missed outside of block change
> - Set default frequencies for ava4/6 in the correct place if none is specified
> - Use a generic zero stats function for drivers that don't implement their own
> - The fan control for ava6 overshoots often so use a safer non-linear curve
> mechanism relative to the target temperature and remove inappropriate caps to
> opt_avalon4_overheat and opt_avalon4_temp_target
> - 450 would appear to be the most reliable startup speed for ava6 so revise it
> down further
> - Avoid double locking when checking if a block exists to prevent a further race
> between seeing it and adding it
> - AVA6 is more reliable starting up at the slightly slower speed of 470, making
> it internally start at 450 before working its way up
> - Set the freq array variables when setting default frequency as well
> - Set default frequency according to ava type if none is specified on the
> command line, choosing 475 as default for ava6
> - Use AV6 name for avalon6 in ava4 driver
> - Update copyright notices for ava4 driver
> - Fix warnings
> - Log blockheight when the pool changes to a new block.
> - Check for stratum clean message in test_work_current to not give false
> positive messages for missed pool notifications of block changes
> - Update AVA4_DEFAULT_SPEED_ERROR
> - Add new option for Avalon6
> - Update frequency process
> - Update AVA4_DEFAULT_TEMP_TARGET for Avalon6
> - Update voltage decode for Avalon6
> - Update temperature target and overheat
> - Update target temp settting
> - Update fan adjust
> - Update Vol api display
> - Update avalon4 option
> - Display stratum difficulty in pool api
> - Fix divide by zero
> - Fix nonce counter
> - Fix GHS display
> - Display total asics for Avalon6
> - Update max diff for Avalon4 and Avalon6
> - Update temperature check
> - Fix typo
> - By default we enable automatic frequency
> - Minor changes
> - Update display
> - Update api display
> - Fix GHSmm
> - Update api for Avalon6
> - Display pll infomation for Avalon6
> - Update frequency for Avalon6
> - Turn on avalon6 nonce check as default
> - Update convert voltage
> - Update voltage display
> - Display more status
> - Enable adjust frequency automatically
> - Update convert voltage
> - Update temperature display for Avalon6
> - Add more options for Avalon6
> - Update asic count for Avalon6
> - Update hashrate counter
> - Decode voltage and temperature for Avalon6
> - Support error code for Avalon6
> - Support 2 miners for Avalon6
> - Show ASCI status for Avalon6
> - Don't need config voltage for Avalon6
> - Update MM60 profile
> - Add nonce counter for Avalon6
> - Hide MW for Avalon6.0
> - Count hw for Avalon6
> - Increse stat buffer size
> - Fix job_idcmp when copy stratum
> - Add Avalon6 support
> - Apply immediately the first set_difficulty
> - store the next difficulty
> - Make pool fallback time configurable and default to 2 minutes instead of 5.
> Rework fallback mechanism to check pool status every 5 seconds and not miss a
> recovering pool.
> - Fix error message for pools such as p2pool that use no nonce1 in their stratum
> templates
> - Set work delay to 1 for AntS1 and AntS2
> - driver-bitmain default tempoverctrl off so it can be disabled
> - API add Work Difficulty to pools
> - remove some documention references to getwork
> - Support multiple modulars frequency setting
> - Decode frequency for Avalon nano 2.0
> - Decode adc status for Avalon nano 2.0
> - Display temperature in api (Avalon nano 2.0
> - Display asic match works for Avalon5
> - Support adjust frequency by asics
> - Display asic freq in status
> - Diplay moving average dh for Avalon5
> - Fix api display
> - Upgrade date/timestamp strings to millisecond accuracy
> - Support voltage adjustment automatically by modular
> - Support Avalon5
> - Increase AVAM_DEFAULT_ADJ_INTERVAL
> - Boundary check
> - Update AVAM_DEFAULT_VOLTAGE_MIN
> - Check the final freq
> - Support frequency adjust automatically
> - Add simple moving sum of the hardware errors
> - Add elapsed info for Avalon miner
> - Advise against building blockerupter driver
> - Move blockerupter driver to after icarus to not interfere with their detection
> if built in
> 
> 
> Version 4.9.2 - 12th June 2015
> 
> - Only blacklist devices on iManufacturer if they don't have an iProduct
> - Simplify the pool work choice switching now that only local work generation is
> supported
> - Check for absense of stratum notify on stratum pools to see if they're usable
> - Remove getwork support
> - Remove test for localgen since all work will be
> - Deprecate failover only option in anticipation of removing getwork
> - Deprecate expiry option and fix it to 10 minutes, replacing all deprecated
> config calls in the API with a deprecated message
> - Deprecate scan-time which is irrelevant with ASIC speed mining
> - Deprecate opt_queue since all mining is now local work generation which is
> rapid and it serves no useful purpose to generate work that is potentially
> stale, increasing CPU usage to check it before using it
> - Change default au3 voltage to 775 to more reliably run at default frequency
> - Set correct timeout for AU3 in icarus_detect_one though it won't affect
> functioning
> - Blacklist LIX device which doesn't exist
> - Round up fail time to next highest integer on icarus
> - AntS3 - set default work delay
> - add pool block quality to api
> - AntS3 - redo work send/stats and add a tuning option - not yet tuned
> - Ant - ignore useless options in case they are passed
> - AntS3 - initial S3 merge basic support
> - Ant voltage isn't S1
> - API - restore IPv4 address .0 padding and update copyright dates
> - ants2 - separate freq from options
> - ants2 - make it compile :p
> - ants2 - add voltage
> - ants2 - remove libusb/udev dependency since it doesn't use USB
> - AntS1 ensure correct endian and correct wid
> - libsystemd: Notify watchdog
> - libsystemd: Notify run state and status line
> - Catch SIGABRT signal and exit gracefully
> - Add libsystemd configure option (default disabled)
> - Document --with-system-jansson configure option
> - SP30: Fix logging to use applog over printf calls
> - Allow building with system jansson
> - Set request ID in validateaddress JSON-RPC request.
> - Cope with reconnect being sent a port number as an integer or string
> - Added syslog mask to limit amount of output
> - regressed with "BAL" little-jalapenos
> - Add yet more whitelisting of BMA devices, removing the case insensitive match
> for manufacturer
> - Fix detection of no mining device configuration.
> - Remove LT_INIT from configure which breaks ltmain.sh detection for some
> automagic reason
> - Add missing hashtable_seed file
> - Add missing file
> - Speed up shutdown by decreasing usb poll time to 100ms and using no timeout on
> exit
> - Cope with attempted reuse of strings in input_pool
> - Manage failed URL entry at startup more gracefully, adding stratum+tcp://
> automatically if http:// isn't specified
> - Fix various symbol size change warnings
> - Import jansson updates from ckpool
> - Check for attempts to copy to/from null in cg_memcpy
> - Use cg_memcpy throughtout bitfury driver
> - Use cg_memcpy throughout cgminer.c and util.c
> - Use alloc helper in miner.h
> - Use alloc helpers in bitfury driver
> - Use alloc helpers in spondoolies drivers
> - Use alloc helpers in bflsc driver
> - Align_len in all alloc helper calls
> - Use align_len in all alloc helpers
> - Use alloc helpers in usbutils
> - Use alloc helpers in icarus driver
> - Use alloc helpers in avalon4 driver
> - Use alloc helpers in api.c
> - Use the alloc helpers in util.c
> - Convert all users of alloc to use the helpers in cgminer.c
> - Add helper functions to various alloc functions that automatically check for
> failure
> - Fix rare dereference error on pool stratum queue
> 
> 
> Version 4.9.1 - 3rd February 2015
> 
> - Fix various unused warnings
> - Fix avalon4 warnings
> - Display notice if pool successfully negotiates stratum resume
> - Support auto adjust voltage individually
> - Don't keep retrying to connect to a pool that has been removed
> - Null the actual pointer used to call discard and free_work and safely handle
> being called with a null pointer, giving a verbose warning about the call site
> - Fix off by one error when running out of queued IDs in bflsc28_queue_full
> - Uninit BET driver when it fails to initialise any boards
> - Fix detection of butterfly labs sc 65nm devices with the addition of the 28nm
> device imanufacturers trumping their detection
> - Remove compilation warnings. Cast overly-specific #def'd values to the
> destination type, unsigned int.
> - Basic ability to compile and run on FreeBSD 10.  Only tested compilation with
> avalon, avalon2, bflsc, and icarus; only tested functionality of bflsc and
> icarus.
> 
> 
diff '--color=auto' cgminer-4.9.0/README cgminer-4.10.0/README
99a100,102
> 	libusb-1 dev library (libusb-1.0-0-dev)
> 	(This is only required for USB device support)
> 
107,110d109
< If building on Red Hat:
<         sudo yum install autoconf automake autoreconf libtool openssl-compat-bitcoin-devel.x86_64 \
<                          curl libcurl libcurl-devel openssh
< 
113c112,113
<                              libcurl3-dev libudev-dev
---
>                              libcurl4-openssl-dev libudev-dev libusb-1.0-0-dev \
>                              libncurses5-dev
121,122c121,123
<   --enable-avalon2        Compile support for Avalon2 (default disabled)
<   --enable-avalon4        Compile support for Avalon4 (default disabled)
---
>   --enable-avalon2        Compile support for Avalon2/3 (default disabled)
>   --enable-avalon4        Compile support for Avalon4/4.1/6 (default disabled)
>   --enable-avalon7        Compile support for Avalon7 (default disabled)
147,148c148,150
<   --disable-libcurl       Disable building with libcurl for getwork and GBT
<                           support
---
>   --disable-libcurl       Disable building with libcurl for GBT support
>   --enable-libsystemd     Compile support for system watchdog and status
>                           notifications (default disabled)
150,151c152,153
<   --with-system-libusb    Compile against dynamic system libusb (default use
<                           included static libusb)
---
>   --with-system-jansson   Compile against dynamic system jansson (default use
>                           included static jansson)
196c198
< --au3-volt <arg>    Set AntminerU3 voltage in mv, range 725-850, 0 to not set (default: 750)
---
> --au3-volt <arg>    Set AntminerU3 voltage in mv, range 725-850, 0 to not set (default: 775)
217a220,253
> --avalon4-miningmode <arg> Set Avalon4 mining mode(0:custom, 1:eco, 2:normal, 3:turbo (default: 0)
> --avalon4-freezesafe Make Avalon4 running as a radiator when stratum server failed
> --avalon4-ntcb <arg> Set Avalon4 MM NTC B value (default: 3450)
> --avalon4-freq-min <arg> Set minimum frequency for Avalon4 (default: 100)
> --avalon4-freq-max <arg> Set maximum frequency for Avalon4 (default: 1000)
> --avalon4-noncecheck-off Disable A3218 inside nonce check function
> --avalon4-smart-speed <arg> Set smart speed, range 0-3. 0 means Disable (default: 2)
> --avalon4-speed-bingo <arg> Set A3218 speed bingo for smart speed mode 1 (default: 255)
> --avalon4-speed-error <arg> Set A3218 speed error for smart speed mode 1 (default: 3)
> --avalon4-least-pll <arg> Set least pll check threshold for smart speed mode 2 (default: 768)
> --avalon4-most-pll <arg> Set most pll check threshold for smart speed mode 2 (default: 256)
> --avalon7-voltage   Set Avalon7 default core voltage, in millivolts, step: 78
> --avalon7-voltage-level Set Avalon7 default level of core voltage, range:[0, 15], step: 1
> --avalon7-voltage-offset Set Avalon7 default offset of core voltage, range:[-2, 1], step: 1
> --avalon7-freq      Set Avalon7 default frequency, range:[24, 1404], step: 12, example: 500
> --avalon7-freq-sel <arg> Set Avalon7 default frequency select, range:[0, 5], step: 1, example: 3 (default: 0)
> --avalon7-fan       Set Avalon7 target fan speed, range:[0, 100], step: 1, example: 0-100
> --avalon7-temp <arg> Set Avalon7 target temperature, range:[0, 100] (default: 99)
> --avalon7-polling-delay <arg> Set Avalon7 polling delay value (ms) (default: 20)
> --avalon7-aucspeed <arg> Set AUC3 IIC bus speed (default: 400000)
> --avalon7-aucxdelay <arg> Set AUC3 IIC xfer read delay, 4800 ~= 1ms (default: 19200)
> --avalon7-smart-speed <arg> Set Avalon7 smart speed, range 0-1. 0 means Disable (default: 1)
> --avalon7-th-pass <arg> Set A3212 th pass value (default: 162)
> --avalon7-th-fail <arg> Set A3212 th fail value (default: 10921)
> --avalon7-th-init <arg> Set A3212 th init value (default: 32767)
> --avalon7-th-ms <arg> Set A3212 th ms value (default: 1)
> --avalon7-th-timeout <arg> Set A3212 th timeout value (default: 0)
> --avalon7-iic-detect Enable Avalon7 detect through iic controller
> --avalon7-freqadj-time <arg> Set Avalon7 check interval when run in AVA7_FREQ_TEMPADJ_MODE (default: 60)
> --avalon7-delta-temp <arg> Set Avalon7 delta temperature when reset freq in AVA7_FREQ_TEMPADJ_MODE (default: 0)
> --avalon7-delta-freq <arg> Set Avalon7 delta freq when adjust freq in AVA7_FREQ_TEMPADJ_MODE (default: 100)
> --avalon7-freqadj-temp <arg> Set Avalon7 check temperature when run into AVA7_FREQ_TEMPADJ_MODE (default: 104)
> --avalon7-nonce-mask <arg> Set A3212 nonce mask, range 24-32. (default: 31)
> --no-avalon7-asic-debug Disable A3212 debug.
230,232c266,268
< --bitmain-cutoff    Set bitmain overheat cut off temperature
< --bitmain-fan       Set fanspeed percentage for bitmain, single value or range (default: 20-100)
< --bitmain-freq      Set frequency range for bitmain-auto, single value or range
---
> --bitmain-cutoff <arg> Set bitmain overheat cut off temperature
> --bitmain-fan <arg> Set fanspeed percentage for bitmain, single value or range (default: 20-100)
> --bitmain-freq <arg> Set bitmain freq options timeout:freq:regdata
234,235c270,276
< --bitmain-options   Set bitmain options baud:miners:asic:timeout:freq
< --bitmain-temp      Set bitmain target temperature
---
> --bitmain-options <arg> Set bitmain options baud:miners:asic:timeout:freq:regdata
> --bitmain-temp <arg> Set bitmain target temperature
> --bitmain-workdelay <arg> Set bitmain work delay (ms) 0-100
> --bitmain-voltage <arg> Set bitmain voltage - S2/S3 only
> --bitmain-dev <arg> Set bitmain device - S2 only
> --bitmainbeeper     Set bitmain beeper ringing
> --bitmaintempoverctrl Set bitmain stop runing when temprerature is over 80 degree Celsius
240a282
> --compac-freq <arg> Set GekkoScience Compac frequency in MHz, range 100-500 (default: 150.0)
247c289
< --fix-protocol      Do not redirect to a different getwork protocol (eg. stratum)
---
> --fix-protocol      Do not redirect to stratum protocol from GBT
351a394,416
> --avalon7-voltage   Set Avalon7 default core voltage, in millivolts, step: 78
> --avalon7-voltage-level Set Avalon7 default level of core voltage, range:[0, 15], step: 1
> --avalon7-voltage-offset Set Avalon7 default offset of core voltage, range:[-2, 1], step: 1
> --avalon7-freq      Set Avalon7 default frequency, range:[24, 1404], step: 12, example: 500
> --avalon7-freq-sel <arg> Set Avalon7 default frequency select, range:[0, 5], step: 1, example: 3 (default: 0)
> --avalon7-fan       Set Avalon7 target fan speed, range:[0, 100], step: 1, example: 0-100
> --avalon7-temp <arg> Set Avalon7 target temperature, range:[0, 100] (default: 99)
> --avalon7-polling-delay <arg> Set Avalon7 polling delay value (ms) (default: 20)
> --avalon7-aucspeed <arg> Set AUC3 IIC bus speed (default: 400000)
> --avalon7-aucxdelay <arg> Set AUC3 IIC xfer read delay, 4800 ~= 1ms (default: 19200)
> --avalon7-smart-speed <arg> Set Avalon7 smart speed, range 0-1. 0 means Disable (default: 1)
> --avalon7-th-pass <arg> Set A3212 th pass value (default: 162)
> --avalon7-th-fail <arg> Set A3212 th fail value (default: 10921)
> --avalon7-th-init <arg> Set A3212 th init value (default: 32767)
> --avalon7-th-ms <arg> Set A3212 th ms value (default: 1)
> --avalon7-th-timeout <arg> Set A3212 th timeout value (default: 0)
> --avalon7-iic-detect Enable Avalon7 detect through iic controller
> --avalon7-freqadj-time <arg> Set Avalon7 check interval when run in AVA7_FREQ_TEMPADJ_MODE (default: 60)
> --avalon7-delta-temp <arg> Set Avalon7 delta temperature when reset freq in AVA7_FREQ_TEMPADJ_MODE (default: 0)
> --avalon7-delta-freq <arg> Set Avalon7 delta freq when adjust freq in AVA7_FREQ_TEMPADJ_MODE (default: 100)
> --avalon7-freqadj-temp <arg> Set Avalon7 check temperature when run into AVA7_FREQ_TEMPADJ_MODE (default: 104)
> --avalon7-nonce-mask <arg> Set A3212 nonce mask, range 24-32. (default: 31)
> --no-avalon7-asic-debug Disable A3212 debug.
359a425
> --compac-freq <arg> Set GekkoScience Compac frequency in MHz, range 100-500 (default: 150.0)
974,975c1040,1041
< A; Try the --net-delay option if you are on a getwork or GBT server. This does
< nothing with stratum mining.
---
> A; Try the --net-delay option if you are on a GBT server. This does nothing
> with stratum mining.
1042a1109
> --enable-avalon7
1045d1111
< --enable-blockerupter
diff '--color=auto' cgminer-4.9.0/usbutils.c cgminer-4.10.0/usbutils.c
3c3
<  * Copyright 2013-2014 Con Kolivas <kernel@kolivas.org>
---
>  * Copyright 2013-2015 Con Kolivas <kernel@kolivas.org>
65c65
< #define ANT_S2_TIMEOUT_MS 200
---
> #define ANT_S3_TIMEOUT_MS 200
72a73,74
> #define AVALON7_TIMEOUT_MS 999
> #define AVALONM_TIMEOUT_MS 999
88c90,92
< #define AVALON4_TIMEOUT_MS 50
---
> #define AVALON4_TIMEOUT_MS 200
> #define AVALON7_TIMEOUT_MS 200
> #define AVALONM_TIMEOUT_MS 300
289a294,308
> #ifdef USE_AVALON7
> static struct usb_epinfo ava7_epinfos[] = {
> 	{ LIBUSB_TRANSFER_TYPE_BULK,	64,	EPI(1), 0, 0 },
> 	{ LIBUSB_TRANSFER_TYPE_BULK,	64,	EPO(1), 0, 0 }
> };
> 
> static struct usb_intinfo ava7_ints[] = {
> 	USB_EPS(1, ava7_epinfos)
> };
> #endif
> #ifdef USE_AVALON_MINER
> static struct usb_epinfo avam_epinfos[] = {
> 	{ LIBUSB_TRANSFER_TYPE_INTERRUPT,	40,	EPI(1), 0, 0 },
> 	{ LIBUSB_TRANSFER_TYPE_INTERRUPT,	40,	EPO(1), 0, 0 }
> };
290a310,321
> static struct usb_intinfo avam_ints[] = {
> 	USB_EPS(1, avam_epinfos)
> };
> static struct usb_epinfo av3u_epinfos[] = {
> 	{ LIBUSB_TRANSFER_TYPE_INTERRUPT,	40,	EPI(1), 0, 0 },
> 	{ LIBUSB_TRANSFER_TYPE_INTERRUPT,	40,	EPO(1), 0, 0 }
> };
> 
> static struct usb_intinfo av3u_ints[] = {
> 	USB_EPS(0, av3u_epinfos)
> };
> #endif
414,415c445,446
< #ifdef USE_ANT_S2
< static struct usb_epinfo ants2_epinfos[] = {
---
> #ifdef USE_ANT_S3
> static struct usb_epinfo ants3_epinfos[] = {
420,421c451,452
< static struct usb_intinfo ants2_ints[] = {
< 	USB_EPS(0, ants2_epinfos)
---
> static struct usb_intinfo ants3_ints[] = {
> 	USB_EPS(0, ants3_epinfos)
435d465
< // TODO: Add support for (at least) Isochronous endpoints
437a468,480
> 	/* Wish these guys would be more consistent with setting these fields */
> 	{
> 		.drv = DRIVER_bflsc,
> 		.name = "BAS",
> 		.ident = IDENT_BAS,
> 		.idVendor = IDVENDOR_FTDI,
> 		.idProduct = 0x6014,
> 		.iManufacturer = "FTDI",
> 		.iProduct = "BitFORCE SHA256 SC",
> 		.config = 1,
> 		.timeout = BFLSC_TIMEOUT_MS,
> 		.latency = LATENCY_STD,
> 		INTINFO(bflsc_ints) },
444c487
< 		//.iManufacturer = "Butterfly Labs",
---
> 		.iManufacturer = "Butterfly Labs",
456c499,511
< 		//.iManufacturer = "BUTTERFLY LABS"
---
> 		.iManufacturer = "BUTTERFLY LABS",
> 		.iProduct = "BitFORCE SHA256 SC",
> 		.config = 1,
> 		.timeout = BFLSC_TIMEOUT_MS,
> 		.latency = LATENCY_STD,
> 		INTINFO(bflsc_ints) },
> 	{
> 		.drv = DRIVER_bflsc,
> 		.name = "BMA",
> 		.ident = IDENT_BMA,
> 		.idVendor = IDVENDOR_FTDI,
> 		.idProduct = 0x6014,
> 		.iManufacturer = "BUTTERFLY LABS",
552,564d606
< #ifdef USE_BLOCKERUPTER
< 	{
< 		.drv = DRIVER_blockerupter,
< 		.name = "BET",
< 		.ident = IDENT_BET,
< 		.idVendor = 0x10c4,
< 		.idProduct = 0xea60,
< 		.config = 1,
< 		.timeout = BLOCKERUPTER_TIMEOUT_MS,
< 		.latency = LATENCY_UNUSED,
< 		INTINFO(bet_ints) },
< 	
< #endif	
653a696,736
> #ifdef USE_AVALON7
> 	{
> 		.drv = DRIVER_avalon7,
> 		.name = "AV7",
> 		.ident = IDENT_AV7,
> 		.idVendor = 0x29f1,
> 		.idProduct = 0x33f2,
> 		.iManufacturer = "CANAAN",
> 		.iProduct = "USB2IIC Converter",
> 		.config = 1,
> 		.timeout = AVALON7_TIMEOUT_MS,
> 		.latency = LATENCY_UNUSED,
> 		INTINFO(ava7_ints) },
> #endif
> #ifdef USE_AVALON_MINER
> 	{
> 		.drv = DRIVER_avalonm,
> 		.name = "AV4M",
> 		.ident = IDENT_AVM,
> 		.idVendor = 0x29f1,
> 		.idProduct = 0x40f1,
> 		.iManufacturer = "CANAAN",
> 		.iProduct = "Avalon4 mini",
> 		.config = 1,
> 		.timeout = AVALONM_TIMEOUT_MS,
> 		.latency = LATENCY_UNUSED,
> 		INTINFO(avam_ints) },
> 	{
> 		.drv = DRIVER_avalonm,
> 		.name = "AV3U",
> 		.ident = IDENT_AVM,
> 		.idVendor = 0x29f1,
> 		.idProduct = 0x33f3,
> 		.iManufacturer = "CANAAN",
> 		.iProduct = "Avalon nano",
> 		.config = 1,
> 		.timeout = AVALONM_TIMEOUT_MS,
> 		.latency = LATENCY_UNUSED,
> 		INTINFO(av3u_ints) },
> 
> #endif
724a808,831
> 		.name = "BSC",
> 		.ident = IDENT_BSC,
> 		.idVendor = 0x10c4,
> 		.idProduct = 0xea60,
> 		.iManufacturer = "bitshopperde",
> 		.iProduct = "Compac BM1384 Bitcoin Miner",
> 		.config = 1,
> 		.timeout = ICARUS_TIMEOUT_MS,
> 		.latency = LATENCY_UNUSED,
> 		INTINFO(amu_ints) },
> 	{
> 		.drv = DRIVER_icarus,
> 		.name = "GSC",
> 		.ident = IDENT_GSC,
> 		.idVendor = 0x10c4,
> 		.idProduct = 0xea60,
> 		.iManufacturer = "GekkoScience",
> 		.iProduct = "Compac BM1384 Bitcoin Miner",
> 		.config = 1,
> 		.timeout = ICARUS_TIMEOUT_MS,
> 		.latency = LATENCY_UNUSED,
> 		INTINFO(amu_ints) },
> 	{
> 		.drv = DRIVER_icarus,
822c929
< #ifdef USE_ANT_S2
---
> #ifdef USE_ANT_S3
824,826c931,933
< 		.drv = DRIVER_ants1,
< 		.name = "AS2",
< 		.ident = IDENT_AS2,
---
> 		.drv = DRIVER_ants3,
> 		.name = "AS3",
> 		.ident = IDENT_AS3,
830,832c937,952
< 		.timeout = ANT_S2_TIMEOUT_MS,
< 		.latency = LATENCY_ANTS2,
< 		INTINFO(ants2_ints) },
---
> 		.timeout = ANT_S3_TIMEOUT_MS,
> 		.latency = LATENCY_ANTS3,
> 		INTINFO(ants3_ints) },
> #endif
> #ifdef USE_BLOCKERUPTER
> 	{
> 		.drv = DRIVER_blockerupter,
> 		.name = "BET",
> 		.ident = IDENT_BET,
> 		.idVendor = 0x10c4,
> 		.idProduct = 0xea60,
> 		.config = 1,
> 		.timeout = BLOCKERUPTER_TIMEOUT_MS,
> 		.latency = LATENCY_UNUSED,
> 		INTINFO(bet_ints) },
> 
1125,1127c1245
< 		*buf = realloc(*buf, *len);
< 		if (unlikely(!*buf))
< 			quit(1, "USB failed to realloc append");
---
> 		*buf = cgrealloc(*buf, *len);
1665,1667c1783
< 	in_use_tmp = calloc(1, sizeof(*in_use_tmp));
< 	if (unlikely(!in_use_tmp))
< 		quit(1, "USB failed to calloc in_use_tmp");
---
> 	in_use_tmp = cgcalloc(1, sizeof(*in_use_tmp));
1735,1737c1851
< 	res_work = calloc(1, sizeof(*res_work));
< 	if (unlikely(!res_work))
< 		quit(1, "USB failed to calloc lock res_work");
---
> 	res_work = cgcalloc(1, sizeof(*res_work));
1794,1796c1908
< 	res_work = calloc(1, sizeof(*res_work));
< 	if (unlikely(!res_work))
< 		quit(1, "USB failed to calloc unlock res_work");
---
> 	res_work = cgcalloc(1, sizeof(*res_work));
1856d1967
< 		}
1858c1969
< 		libusb_attach_kernel_driver(cgpu->usbdev->handle, THISIF(cgpu->usbdev->found, ifinfo));
---
> 			libusb_attach_kernel_driver(cgpu->usbdev->handle, THISIF(cgpu->usbdev->found, ifinfo));
1859a1971
> 		}
1979,1981c2091
< 	copy = calloc(1, sizeof(*copy));
< 	if (unlikely(!copy))
< 		quit(1, "Failed to calloc cgpu for %s in usb_copy_cgpu", orig->drv->dname);
---
> 	copy = cgcalloc(1, sizeof(*copy));
2001,2004c2111
< 	struct cgpu_info *cgpu = calloc(1, sizeof(*cgpu));
< 
< 	if (unlikely(!cgpu))
< 		quit(1, "Failed to calloc cgpu for %s in usb_alloc_cgpu", drv->dname);
---
> 	struct cgpu_info *cgpu = cgcalloc(1, sizeof(*cgpu));
2067,2069c2174
< 	cgusb = calloc(1, sizeof(*cgusb));
< 	if (unlikely(!cgusb))
< 		quit(1, "USB failed to calloc _usb_init cgusb");
---
> 	cgusb = cgcalloc(1, sizeof(*cgusb));
2077,2079c2182
< 	cgusb->descriptor = calloc(1, sizeof(*(cgusb->descriptor)));
< 	if (unlikely(!cgusb->descriptor))
< 		quit(1, "USB failed to calloc _usb_init cgusb descriptor");
---
> 	cgusb->descriptor = cgcalloc(1, sizeof(*(cgusb->descriptor)));
2149c2252
< 		if (strcasecmp((char *)man, found->iManufacturer)) {
---
> 		if (strcmp((char *)man, found->iManufacturer)) {
2164c2267,2271
< 			if (!strcasecmp((char *)man, iManufacturer)) {
---
> 			/* If the alternative driver also has an iProduct, only
> 			 * use that for comparison. */
> 			if (find_dev[i].iProduct)
> 				continue;
> 			if (!strcmp((char *)man, iManufacturer)) {
2413,2415c2520
< 			found_use = malloc(sizeof(*found_use));
< 			if (unlikely(!found_use))
< 				quit(1, "USB failed to malloc found_use");
---
> 			found_use = cgmalloc(sizeof(*found_use));
2425,2426c2530,2531
< 	if (ret == USB_INIT_FAIL)
< 		applog(LOG_ERR, "%s detect (%d:%d) failed to initialise (incorrect device?)",
---
> 	if (ret == USB_INIT_FAIL) {
> 		applog(LOG_ERR, "%s detect (%d:%d) failed to initialise (incorrect device?), resetting",
2429a2535,2537
> 		if (cgpu->usbdev && cgpu->usbdev->handle)
> 			libusb_reset_device(cgpu->usbdev->handle);
> 	}
2489,2491c2597
< 				found = malloc(sizeof(*found));
< 				if (unlikely(!found))
< 					quit(1, "USB failed to malloc found");
---
> 				found = cgmalloc(sizeof(*found));
2720,2723c2826
< 	usb_stats = realloc(usb_stats, sizeof(*usb_stats) * (next_stat+1));
< 	if (unlikely(!usb_stats))
< 		quit(1, "USB failed to realloc usb_stats %d", next_stat+1);
< 
---
> 	usb_stats = cgrealloc(usb_stats, sizeof(*usb_stats) * (next_stat+1));
2726,2728c2829
< 	usb_stats[next_stat].details = calloc(2, sizeof(struct cg_usb_stats_details) * (C_MAX + 1));
< 	if (unlikely(!usb_stats[next_stat].details))
< 		quit(1, "USB failed to calloc details for %d", next_stat+1);
---
> 	usb_stats[next_stat].details = cgcalloc(2, sizeof(struct cg_usb_stats_details) * (C_MAX + 1));
3105c3206
< 	DEVRLOCK(cgpu, pstate);
---
> 	DEVWLOCK(cgpu, pstate);
3111,3112c3212
< 	if (NODEV(err)) {
< 		cg_ruwlock(&cgpu->usbinfo.devlock);
---
> 	if (NODEV(err))
3114,3116c3214
< 		DEVWUNLOCK(cgpu, pstate);
< 	} else
< 		DEVRUNLOCK(cgpu, pstate);
---
> 	DEVWUNLOCK(cgpu, pstate);
3183a3282,3284
> 		if (NODEV(err))
> 			goto out_noerrmsg;
> 
3218a3320,3323
> 
> 		if (NODEV(err))
> 			goto out_noerrmsg;
> 
3320a3426,3428
> 		if (NODEV(err))
> 			goto out_noerrmsg;
> 
3706a3815,3816
> 			case DRIVER_avalon7:
> 			case DRIVER_avalonm:
3807,3810c3917
< 				busdev = realloc(busdev, sizeof(*busdev) * (++busdev_count));
< 				if (unlikely(!busdev))
< 					quit(1, "USB failed to realloc busdev");
< 
---
> 				busdev = cgrealloc(busdev, sizeof(*busdev) * (++busdev_count));
3871c3978,3979
< 	FreeSid(((PSECURITY_DESCRIPTOR)(sec->lpSecurityDescriptor))->Group);
---
> 	SECURITY_DESCRIPTOR *sd = (PSECURITY_DESCRIPTOR)(sec->lpSecurityDescriptor);
> 	FreeSid(sd->Group);
3884,3886c3992
< 	sec_des = malloc(sizeof(*sec_des));
< 	if (unlikely(!sec_des))
< 		quit(1, "MTX: Failed to malloc LPSECURITY_DESCRIPTOR");
---
> 	sec_des = cgmalloc(SECURITY_DESCRIPTOR_MIN_LENGTH);
3925,3927c4031
< 	sec_att = malloc(sizeof(*sec_att));
< 	if (unlikely(!sec_att))
< 		quit(1, "MTX: Failed to malloc LPSECURITY_ATTRIBUTES");
---
> 	sec_att = cgmalloc(sizeof(*sec_att));
4115,4117c4219
< 		res_reply = calloc(1, sizeof(*res_reply));
< 		if (unlikely(!res_reply))
< 			quit(1, "USB failed to calloc res_reply");
---
> 		res_reply = cgcalloc(1, sizeof(*res_reply));
diff '--color=auto' cgminer-4.9.0/usbutils.h cgminer-4.10.0/usbutils.h
146c146
< 	IDENT_AS2,
---
> 	IDENT_AS3,
150a151,152
> 	IDENT_AV7,
> 	IDENT_AVM,
160a163
> 	IDENT_BSC,
167a171
> 	IDENT_GSC,
200c204
< #define LATENCY_ANTS2 10
---
> #define LATENCY_ANTS3 10
385a390,393
> 	USB_ADD_COMMAND(C_AVA7_READ, "Ava7Read") \
> 	USB_ADD_COMMAND(C_AVA7_WRITE, "Ava7Write") \
> 	USB_ADD_COMMAND(C_AVAM_READ, "AvamRead") \
> 	USB_ADD_COMMAND(C_AVAM_WRITE, "AvamWrite") \
diff '--color=auto' cgminer-4.9.0/util.c cgminer-4.10.0/util.c
2c2,3
<  * Copyright 2011-2014 Con Kolivas
---
>  * Copyright 2011-2015 Con Kolivas
>  * Copyright 2011-2015 Andrew Smith
47a49,51
> #ifndef STRATUM_USER_AGENT
> #define STRATUM_USER_AGENT
> #endif
140c144
< 	memcpy(dst, tmp, W32NS_INADDRSZ);
---
> 	cg_memcpy(dst, tmp, W32NS_INADDRSZ);
237c241
< 	memcpy(dst, tmp, W32NS_IN6ADDRSZ);
---
> 	cg_memcpy(dst, tmp, W32NS_IN6ADDRSZ);
255a260,299
> /* Align a size_t to 4 byte boundaries for fussy arches */
> static inline void align_len(size_t *len)
> {
> 	if (*len % 4)
> 		*len += 4 - (*len % 4);
> }
> 
> void *_cgmalloc(size_t size, const char *file, const char *func, const int line)
> {
> 	void *ret;
> 
> 	align_len(&size);
> 	ret = malloc(size);
> 	if (unlikely(!ret))
> 		quit(1, "Failed to malloc size %d from %s %s:%d", (int)size, file, func, line);
> 	return ret;
> }
> 
> void *_cgcalloc(const size_t memb, size_t size, const char *file, const char *func, const int line)
> {
> 	void *ret;
> 
> 	align_len(&size);
> 	ret = calloc(memb, size);
> 	if (unlikely(!ret))
> 		quit(1, "Failed to calloc memb %d size %d from %s %s:%d", (int)memb, (int)size, file, func, line);
> 	return ret;
> }
> 
> void *_cgrealloc(void *ptr, size_t size, const char *file, const char *func, const int line)
> {
> 	void *ret;
> 
> 	align_len(&size);
> 	ret = realloc(ptr, size);
> 	if (unlikely(!ret))
> 		quit(1, "Failed to realloc size %d from %s %s:%d", (int)size, file, func, line);
> 	return ret;
> }
> 
306,309c350
< 	newmem = realloc(db->buf, newlen + 1);
< 	if (!newmem)
< 		return 0;
< 
---
> 	newmem = cgrealloc(db->buf, newlen + 1);
312,313c353,354
< 	memcpy(db->buf + oldlen, ptr, len);
< 	memcpy(db->buf + newlen, &zero, 1);	/* null terminate */
---
> 	cg_memcpy(db->buf + oldlen, ptr, len);
> 	cg_memcpy(db->buf + newlen, &zero, 1);	/* null terminate */
328c369
< 		memcpy(ptr, ub->buf, len);
---
> 		cg_memcpy(ptr, ub->buf, len);
343,346c384,385
< 	val = calloc(1, ptrlen);
< 	key = calloc(1, ptrlen);
< 	if (!key || !val)
< 		goto out;
---
> 	val = cgcalloc(1, ptrlen);
> 	key = cgcalloc(1, ptrlen);
354c393
< 	memcpy(key, ptr, slen);		/* store & nul term key */
---
> 	cg_memcpy(key, ptr, slen);		/* store & nul term key */
364c403
< 	memcpy(val, rem, remlen);	/* store value, trim trailing ws */
---
> 	cg_memcpy(val, rem, remlen);	/* store value, trim trailing ws */
388c427
< 				hi->rolltime = opt_scantime;
---
> 				hi->rolltime = max_scantime;
607c646
< 		sprintf(ghashrate, "X-Mining-Hashrate: %llu", global_hashrate);
---
> 		sprintf(ghashrate, "X-Mining-Hashrate: %"PRIu64, global_hashrate);
800,803c839
< 			pool->rpc_proxy = malloc(1 + len - plen);
< 			if (!(pool->rpc_proxy))
< 				quithere(1, "Failed to malloc rpc_proxy");
< 
---
> 			pool->rpc_proxy = cgmalloc(1 + len - plen);
838,841c874
< 	s = calloc(slen, 1);
< 	if (unlikely(!s))
< 		quithere(1, "Failed to calloc");
< 
---
> 	s = cgcalloc(slen, 1);
996c1029
< 	memcpy(&pkh[3], &b58bin[1], 20);
---
> 	cg_memcpy(&pkh[3], &b58bin[1], 20);
1026,1028c1059
< 	ret = malloc(1 + len + 8); // Leave room for largest size
< 	if (unlikely(!ret))
< 		quit(1, "Failed to malloc ret in ser_string");
---
> 	ret = cgmalloc(1 + len + 8); // Leave room for largest size
1031c1062
< 		memcpy(ret + 1, s, len);
---
> 		cg_memcpy(ret + 1, s, len);
1038c1069
< 		memcpy(ret + 3, s, len);
---
> 		cg_memcpy(ret + 3, s, len);
1046c1077
< 		memcpy(ret + 5, s, len);
---
> 		cg_memcpy(ret + 5, s, len);
1099,1102c1130
< 	tq = calloc(1, sizeof(*tq));
< 	if (!tq)
< 		return NULL;
< 
---
> 	tq = cgcalloc(1, sizeof(*tq));
1152,1155c1180
< 	ent = calloc(1, sizeof(*ent));
< 	if (!ent)
< 		return false;
< 
---
> 	ent = cgcalloc(1, sizeof(*ent));
1243c1268
< 	memcpy(dest, src, sizeof(struct timeval));
---
> 	cg_memcpy(dest, src, sizeof(struct timeval));
1422c1447,1448
< #ifdef CLOCK_MONOTONIC /* Essentially just linux */
---
> #if defined(CLOCK_MONOTONIC) && !defined(__FreeBSD__) && !defined(__APPLE__) && !defined(WIN32) /* Essentially just linux */
> //#ifdef CLOCK_MONOTONIC /* Essentially just linux */
1478,1479c1504,1505
< 	ts_start->tv_sec = tv->tv_sec;
< 	ts_start->tv_nsec = tv->tv_usec * 1000;
---
> 	ts_start->tv_sec = tv.tv_sec;
> 	ts_start->tv_nsec = tv.tv_usec * 1000;
1654c1680
< 	
---
> 
1660c1686
< 	
---
> 
1811c1837
< void _recalloc(void **ptr, size_t old, size_t new, const char *file, const char *func, const int line)
---
> void ckrecalloc(void **ptr, size_t old, size_t new, const char *file, const char *func, const int line)
1815,1817c1841
< 	*ptr = realloc(*ptr, new);
< 	if (unlikely(!*ptr))
< 		quitfrom(1, file, func, line, "Failed to realloc");
---
> 	*ptr = _cgrealloc(*ptr, new, file, func, line);
1836,1838c1860
< 	pool->sockbuf = realloc(pool->sockbuf, new);
< 	if (!pool->sockbuf)
< 		quithere(1, "Failed to realloc pool sockbuf");
---
> 	pool->sockbuf = cgrealloc(pool->sockbuf, new);
1950c1972
< 	     *ntime, header[228];
---
> 	     *ntime, header[260];
1984a2007,2011
> 	if (memcmp(pool->prev_hash, prev_hash, 64)) {
> 		pool->swork.clean = true;
> 	} else {
> 		pool->swork.clean = clean;
> 	}
1991c2018,2022
< 	pool->swork.clean = clean;
---
> 	if (pool->next_diff > 0) {
> 		pool->sdiff = pool->next_diff;
> 		pool->next_diff = pool->diff_after;
> 		pool->diff_after = 0;
> 	}
1998,1999c2029,2030
< 		pool->swork.merkle_bin = realloc(pool->swork.merkle_bin,
< 						 sizeof(char *) * merkles + 1);
---
> 		pool->swork.merkle_bin = cgrealloc(pool->swork.merkle_bin,
> 						   sizeof(char *) * merkles + 1);
2003,2005c2034
< 			pool->swork.merkle_bin[i] = malloc(32);
< 			if (unlikely(!pool->swork.merkle_bin[i]))
< 				quit(1, "Failed to malloc pool swork merkle_bin");
---
> 			pool->swork.merkle_bin[i] = cgmalloc(32);
2016a2046,2047
> 	if (pool->merkles < 2)
> 		pool->bad_work++;
2028c2059
< 	snprintf(header, 225,
---
> 	snprintf(header, 257,
2037c2068,2069
< 	ret = hex2bin(pool->header_bin, header, 112);
---
> 
> 	ret = hex2bin(pool->header_bin, header, 128);
2056,2062c2088,2092
< 	align_len(&alloc_len);
< 	pool->coinbase = calloc(alloc_len, 1);
< 	if (unlikely(!pool->coinbase))
< 		quit(1, "Failed to calloc pool coinbase in parse_notify");
< 	memcpy(pool->coinbase, cb1, cb1_len);
< 	memcpy(pool->coinbase + cb1_len, pool->nonce1bin, pool->n1_len);
< 	memcpy(pool->coinbase + cb1_len + pool->n1_len + pool->n2size, cb2, cb2_len);
---
> 	pool->coinbase = cgcalloc(alloc_len, 1);
> 	cg_memcpy(pool->coinbase, cb1, cb1_len);
> 	if (pool->n1_len)
> 		cg_memcpy(pool->coinbase + cb1_len, pool->nonce1bin, pool->n1_len);
> 	cg_memcpy(pool->coinbase + cb1_len + pool->n1_len + pool->n2size, cb2, cb2_len);
2099c2129
< 	if (diff == 0)
---
> 	if (diff <= 0)
2101a2132,2133
> 	/* We can only change one diff per notify so assume diffs are being
> 	 * stacked for successive notifies. */
2102a2135,2138
> 	if (pool->next_diff)
> 		pool->diff_after = diff;
> 	else
> 		pool->next_diff = diff;
2104d2139
< 	pool->sdiff = diff;
2135a2171
> 	int port_no;
2162,2164c2198,2206
< 	port = (char *)json_string_value(json_array_get(val, 1));
< 	if (!port)
< 		port = pool->stratum_port;
---
> 	port_no = json_integer_value(json_array_get(val, 1));
> 	if (port_no) {
> 		port = alloca(256);
> 		sprintf(port, "%d", port_no);
> 	} else {
> 		port = (char *)json_string_value(json_array_get(val, 1));
> 		if (!port)
> 			port = pool->stratum_port;
> 	}
2199c2241
< 	sprintf(s, "{\"id\": %d, \"result\": \""PACKAGE"/"VERSION"\", \"error\": null}", id);
---
> 	sprintf(s, "{\"id\": %d, \"result\": \""PACKAGE"/"VERSION""STRATUM_USER_AGENT"\", \"error\": null}", id);
2467c2509
< 	memcpy(buf + 5, pool->sockaddr_url, len);
---
> 	cg_memcpy(buf + 5, pool->sockaddr_url, len);
2557c2599
< 		memcpy(&buf[16], pool->sockaddr_url, len);
---
> 		cg_memcpy(&buf[16], pool->sockaddr_url, len);
2739,2741c2781
< 		pool->sockbuf = calloc(RBUFSIZE, 1);
< 		if (!pool->sockbuf)
< 			quithere(1, "Failed to calloc pool sockbuf");
---
> 		pool->sockbuf = cgcalloc(RBUFSIZE, 1);
2790c2830
< 	char s[RBUFSIZE], *sret = NULL, *nonce1, *sessionid;
---
> 	char s[RBUFSIZE], *sret = NULL, *nonce1, *sessionid, *tmp;
2809c2849
< 			sprintf(s, "{\"id\": %d, \"method\": \"mining.subscribe\", \"params\": [\""PACKAGE"/"VERSION"\", \"%s\"]}", swork_id++, pool->sessionid);
---
> 			sprintf(s, "{\"id\": %d, \"method\": \"mining.subscribe\", \"params\": [\""PACKAGE"/"VERSION""STRATUM_USER_AGENT"\", \"%s\"]}", swork_id++, pool->sessionid);
2811c2851
< 			sprintf(s, "{\"id\": %d, \"method\": \"mining.subscribe\", \"params\": [\""PACKAGE"/"VERSION"\"]}", swork_id++);
---
> 			sprintf(s, "{\"id\": %d, \"method\": \"mining.subscribe\", \"params\": [\""PACKAGE"/"VERSION""STRATUM_USER_AGENT"\"]}", swork_id++);
2862a2903
> 		free(nonce1);
2872a2914,2918
> 	if (sessionid && pool->sessionid && !strcmp(sessionid, pool->sessionid)) {
> 		applog(LOG_NOTICE, "Pool %d successfully negotiated resume with the same session ID",
> 		       pool->pool_no);
> 	}
> 
2873a2920
> 	tmp = pool->sessionid;
2874a2922,2923
> 	free(tmp);
> 	tmp = pool->nonce1;
2875a2925
> 	free(tmp);
2878,2880c2928
< 	pool->nonce1bin = calloc(pool->n1_len, 1);
< 	if (unlikely(!pool->nonce1bin))
< 		quithere(1, "Failed to calloc pool->nonce1bin");
---
> 	pool->nonce1bin = cgcalloc(pool->n1_len, 1);
2893a2942
> 		pool->next_diff = pool->diff_after = 0;
2994,2998c3043
< 	align_len(&len);
< 
< 	ret = malloc(len);
< 	if (unlikely(!ret))
< 		quithere(1, "Failed to malloc");
---
> 	ret = cgmalloc(len);
3025,3027c3070
< 	ret = txt = malloc(strlen(ptr)*4+5); // Guaranteed >= needed
< 	if (unlikely(!txt))
< 		quithere(1, "Failed to malloc txt");
---
> 	ret = txt = cgmalloc(strlen(ptr) * 4 + 5); // Guaranteed >= needed
3251,3253c3294
< 	cgc = malloc(sizeof(struct cg_completion));
< 	if (unlikely(!cgc))
< 		return ret;
---
> 	cgc = cgmalloc(sizeof(struct cg_completion));
3273c3314,3324
< 			      n, file, func, line);
---
> 		       n, file, func, line);
> 		return;
> 	}
> 	if (unlikely(!dest)) {
> 		applog(LOG_ERR, "ERR: Asked to memcpy %u bytes to NULL from %s %s():%d",
> 		       n, file, func, line);
> 		return;
> 	}
> 	if (unlikely(!src)) {
> 		applog(LOG_ERR, "ERR: Asked to memcpy %u bytes from NULL from %s %s():%d",
> 		       n, file, func, line);
diff '--color=auto' cgminer-4.9.0/util.h cgminer-4.10.0/util.h
33a34
> 	#include <windows.h>
105,106c106,113
< int no_yield(void);
< int (*selective_yield)(void);
---
> extern int no_yield(void);
> extern int (*selective_yield)(void);
> void *_cgmalloc(size_t size, const char *file, const char *func, const int line);
> void *_cgcalloc(const size_t memb, size_t size, const char *file, const char *func, const int line);
> void *_cgrealloc(void *ptr, size_t size, const char *file, const char *func, const int line);
> #define cgmalloc(_size) _cgmalloc(_size, __FILE__, __func__, __LINE__)
> #define cgcalloc(_memb, _size) _cgcalloc(_memb, _size, __FILE__, __func__, __LINE__)
> #define cgrealloc(_ptr, _size) _cgrealloc(_ptr, _size, __FILE__, __func__, __LINE__)
144,145c151,152
< void _recalloc(void **ptr, size_t old, size_t new, const char *file, const char *func, const int line);
< #define recalloc(ptr, old, new) _recalloc((void *)&(ptr), old, new, __FILE__, __func__, __LINE__)
---
> void ckrecalloc(void **ptr, size_t old, size_t new, const char *file, const char *func, const int line);
> #define recalloc(ptr, old, new) ckrecalloc((void *)&(ptr), old, new, __FILE__, __func__, __LINE__)
171,177d177
< 
< /* Align a size_t to 4 byte boundaries for fussy arches */
< static inline void align_len(size_t *len)
< {
< 	if (*len % 4)
< 		*len += 4 - (*len % 4);
< }
